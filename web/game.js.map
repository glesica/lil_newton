{
  "version": 3,
  "sources": ["../node_modules/parzec/lib/ref.js", "../node_modules/parzec/lib/error.js", "../node_modules/parzec/lib/input.js", "../node_modules/parzec/lib/result.js", "../node_modules/parzec/lib/utils.js", "../node_modules/parzec/lib/lexer.js", "../node_modules/parzec/lib/parser.js", "../node_modules/parzec/lib/arrayparsers.js", "../node_modules/parzec/lib/index.js", "../node_modules/excalibur/build/node_modules/core-js/es/array/sort.js", "../node_modules/excalibur/build/node_modules/core-js/es/object/keys.js", "../node_modules/excalibur/build/node_modules/core-js/internals/a-callable.js", "../node_modules/excalibur/build/node_modules/core-js/internals/an-object.js", "../node_modules/excalibur/build/node_modules/core-js/internals/array-includes.js", "../node_modules/excalibur/build/node_modules/core-js/internals/array-method-is-strict.js", "../node_modules/excalibur/build/node_modules/core-js/internals/array-slice-simple.js", "../node_modules/excalibur/build/node_modules/core-js/internals/array-sort.js", "../node_modules/excalibur/build/node_modules/core-js/internals/classof-raw.js", "../node_modules/excalibur/build/node_modules/core-js/internals/classof.js", "../node_modules/excalibur/build/node_modules/core-js/internals/copy-constructor-properties.js", "../node_modules/excalibur/build/node_modules/core-js/internals/create-non-enumerable-property.js", "../node_modules/excalibur/build/node_modules/core-js/internals/create-property-descriptor.js", "../node_modules/excalibur/build/node_modules/core-js/internals/create-property.js", "../node_modules/excalibur/build/node_modules/core-js/internals/define-built-in.js", "../node_modules/excalibur/build/node_modules/core-js/internals/define-global-property.js", "../node_modules/excalibur/build/node_modules/core-js/internals/delete-property-or-throw.js", "../node_modules/excalibur/build/node_modules/core-js/internals/descriptors.js", "../node_modules/excalibur/build/node_modules/core-js/internals/document-create-element.js", "../node_modules/excalibur/build/node_modules/core-js/internals/engine-ff-version.js", "../node_modules/excalibur/build/node_modules/core-js/internals/engine-is-ie-or-edge.js", "../node_modules/excalibur/build/node_modules/core-js/internals/engine-user-agent.js", "../node_modules/excalibur/build/node_modules/core-js/internals/engine-v8-version.js", "../node_modules/excalibur/build/node_modules/core-js/internals/engine-webkit-version.js", "../node_modules/excalibur/build/node_modules/core-js/internals/entry-unbind.js", "../node_modules/excalibur/build/node_modules/core-js/internals/enum-bug-keys.js", "../node_modules/excalibur/build/node_modules/core-js/internals/export.js", "../node_modules/excalibur/build/node_modules/core-js/internals/fails.js", "../node_modules/excalibur/build/node_modules/core-js/internals/function-bind-native.js", "../node_modules/excalibur/build/node_modules/core-js/internals/function-call.js", "../node_modules/excalibur/build/node_modules/core-js/internals/function-name.js", "../node_modules/excalibur/build/node_modules/core-js/internals/function-uncurry-this.js", "../node_modules/excalibur/build/node_modules/core-js/internals/get-built-in.js", "../node_modules/excalibur/build/node_modules/core-js/internals/get-method.js", "../node_modules/excalibur/build/node_modules/core-js/internals/global.js", "../node_modules/excalibur/build/node_modules/core-js/internals/has-own-property.js", "../node_modules/excalibur/build/node_modules/core-js/internals/hidden-keys.js", "../node_modules/excalibur/build/node_modules/core-js/internals/ie8-dom-define.js", "../node_modules/excalibur/build/node_modules/core-js/internals/indexed-object.js", "../node_modules/excalibur/build/node_modules/core-js/internals/inspect-source.js", "../node_modules/excalibur/build/node_modules/core-js/internals/internal-state.js", "../node_modules/excalibur/build/node_modules/core-js/internals/is-callable.js", "../node_modules/excalibur/build/node_modules/core-js/internals/is-forced.js", "../node_modules/excalibur/build/node_modules/core-js/internals/is-object.js", "../node_modules/excalibur/build/node_modules/core-js/internals/is-pure.js", "../node_modules/excalibur/build/node_modules/core-js/internals/is-symbol.js", "../node_modules/excalibur/build/node_modules/core-js/internals/length-of-array-like.js", "../node_modules/excalibur/build/node_modules/core-js/internals/make-built-in.js", "../node_modules/excalibur/build/node_modules/core-js/internals/math-trunc.js", "../node_modules/excalibur/build/node_modules/core-js/internals/native-symbol.js", "../node_modules/excalibur/build/node_modules/core-js/internals/native-weak-map.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-define-property.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-descriptor.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-names.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-symbols.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-is-prototype-of.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-keys-internal.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-keys.js", "../node_modules/excalibur/build/node_modules/core-js/internals/object-property-is-enumerable.js", "../node_modules/excalibur/build/node_modules/core-js/internals/ordinary-to-primitive.js", "../node_modules/excalibur/build/node_modules/core-js/internals/own-keys.js", "../node_modules/excalibur/build/node_modules/core-js/internals/path.js", "../node_modules/excalibur/build/node_modules/core-js/internals/require-object-coercible.js", "../node_modules/excalibur/build/node_modules/core-js/internals/shared-key.js", "../node_modules/excalibur/build/node_modules/core-js/internals/shared-store.js", "../node_modules/excalibur/build/node_modules/core-js/internals/shared.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-absolute-index.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-indexed-object.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-integer-or-infinity.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-length.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-object.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-primitive.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-property-key.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-string-tag-support.js", "../node_modules/excalibur/build/node_modules/core-js/internals/to-string.js", "../node_modules/excalibur/build/node_modules/core-js/internals/try-to-string.js", "../node_modules/excalibur/build/node_modules/core-js/internals/uid.js", "../node_modules/excalibur/build/node_modules/core-js/internals/use-symbol-as-uid.js", "../node_modules/excalibur/build/node_modules/core-js/internals/v8-prototype-define-bug.js", "../node_modules/excalibur/build/node_modules/core-js/internals/well-known-symbol.js", "../node_modules/excalibur/build/node_modules/core-js/modules/es.array.sort.js", "../node_modules/excalibur/build/node_modules/core-js/modules/es.object.keys.js", "../node_modules/excalibur/build/esm/webpack:/Loader.css", "../node_modules/excalibur/build/esm/webpack:/Util/Toaster.css", "../node_modules/excalibur/build/node_modules/css-loader/dist/runtime/api.js", "../node_modules/excalibur/build/node_modules/css-loader/dist/runtime/sourceMaps.js", "../node_modules/excalibur/build/esm/webpack:/webpack/bootstrap", "../node_modules/excalibur/build/esm/webpack:/webpack/runtime/compat get default export", "../node_modules/excalibur/build/esm/webpack:/webpack/runtime/define property getters", "../node_modules/excalibur/build/esm/webpack:/webpack/runtime/global", "../node_modules/excalibur/build/esm/webpack:/webpack/runtime/hasOwnProperty shorthand", "../node_modules/excalibur/build/esm/webpack:/webpack/runtime/make namespace object", "../node_modules/excalibur/build/esm/webpack:/Polyfill.ts", "../node_modules/excalibur/build/esm/webpack:/Flags.ts", "../node_modules/excalibur/build/esm/webpack:/Id.ts", "../node_modules/excalibur/build/esm/webpack:/Math/Random.ts", "../node_modules/excalibur/build/esm/webpack:/Math/util.ts", "../node_modules/excalibur/build/esm/webpack:/Math/vector.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Log.ts", "../node_modules/excalibur/build/esm/webpack:/Color.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Side.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/BoundingBox.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Future.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Util.ts", "../node_modules/excalibur/build/esm/webpack:/Math/matrix.ts", "../node_modules/excalibur/build/esm/webpack:/Math/affine-matrix.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/transform-stack.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/state-stack.ts", "../node_modules/excalibur/build/esm/webpack:/Events.ts", "../node_modules/excalibur/build/esm/webpack:/EventDispatcher.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Resource.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Watch.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Graphic.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Sprite.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Filtering.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/texture-loader.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/ImageSource.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/SpriteSheet.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/SpriteFont.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/debug-font.png", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/debug-text.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/render-source.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/render-target.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/webgl-adapter.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-vertex.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-fragment.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/webgl-util.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/shader.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/vertex-buffer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/vertex-layout.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsDiagnostics.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-renderer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/point-renderer/point-vertex.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/point-renderer/point-fragment.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/point-renderer/point-renderer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/screen-pass-painter/screen-vertex.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/screen-pass-painter/screen-fragment.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/screen-pass-painter/screen-pass-painter.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/quad-index-buffer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.frag.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.vert.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/rectangle-renderer/rectangle-renderer.vert.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/rectangle-renderer/rectangle-renderer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/circle-renderer/circle-renderer.frag.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/circle-renderer/circle-renderer.vert.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/circle-renderer/circle-renderer.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Pool.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/draw-call.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/ExcaliburGraphicsContextWebGL.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts", "../node_modules/excalibur/build/esm/webpack:/Screen.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Sound/AudioContext.ts", "../node_modules/excalibur/build/esm/webpack:/Util/WebAudio.ts", "../node_modules/excalibur/build/esm/webpack:/Class.ts", "../node_modules/excalibur/build/esm/webpack:/Util/DrawUtil.ts", "../node_modules/excalibur/build/esm/webpack:/Loader.logo.png", "../node_modules/excalibur/build/esm/webpack:/Graphics/Raster.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Canvas.ts", "../node_modules/excalibur/build/esm/webpack:/Interfaces/AudioImplementation.ts", "../node_modules/excalibur/build/esm/webpack:/Util/StateMachine.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Sound/WebAudioInstance.ts", "../node_modules/excalibur/build/esm/webpack:/Events/MediaEvents.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Sound.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Sound/Sound.ts", "../node_modules/excalibur/build/esm/webpack:/Loader.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Detector.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/CollisionType.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Decorators.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Physics.ts", "../node_modules/excalibur/build/esm/webpack:/Math/coord-plane.ts", "../node_modules/excalibur/build/esm/webpack:/Math/vector-view.ts", "../node_modules/excalibur/build/esm/webpack:/Math/watch-vector.ts", "../node_modules/excalibur/build/esm/webpack:/Math/transform.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Component.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Observable.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Components/TransformComponent.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Components/MotionComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Group/CollisionGroup.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Detection/Pair.ts", "../node_modules/excalibur/build/esm/webpack:/Math/projection.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Detection/DynamicTree.ts", "../node_modules/excalibur/build/esm/webpack:/Math/ray.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Detection/DynamicTreeCollisionProcessor.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/Collider.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CompositeCollider.ts", "../node_modules/excalibur/build/esm/webpack:/Math/line-segment.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/ClosestLineJumpTable.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CircleCollider.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Detection/CollisionContact.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/SeparatingAxis.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CollisionJumpTable.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/EdgeCollider.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/PolygonCollider.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Colliders/Shape.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/ColliderComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/BodyComponent.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Entity.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Rectangle.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Circle.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Util/EasingFunctions.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/ActionQueue.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Repeat.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/RepeatForever.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/MoveBy.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/MoveTo.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/RotationType.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/RotateTo.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/RotateBy.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/ScaleTo.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/ScaleBy.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/CallMethod.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/EaseTo.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/EaseBy.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Blink.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Fade.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Delay.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Die.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Follow.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/Meet.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/ActionContext.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/ActionsComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/FontCommon.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Font.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Text.ts", "../node_modules/excalibur/build/esm/webpack:/Actor.ts", "../node_modules/excalibur/build/esm/webpack:/ScreenElement.ts", "../node_modules/excalibur/build/esm/webpack:/Timer.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/ParallaxComponent.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/DebugGraphicsComponent.ts", "../node_modules/excalibur/build/esm/webpack:/TileMap/TileMap.ts", "../node_modules/excalibur/build/esm/webpack:/Camera.ts", "../node_modules/excalibur/build/esm/webpack:/Trigger.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/System.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/EntityManager.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Util.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Query.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/QueryManager.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/SystemManager.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/World.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Integrator.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/MotionSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Solver/ArcadeSolver.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Solver/ContactConstraintPoint.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Solver/RealisticSolver.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/CollisionSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Animation.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsGroup.ts", "../node_modules/excalibur/build/esm/webpack:/Configurable.ts", "../node_modules/excalibur/build/esm/webpack:/Particles.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Debug/DebugSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/ActionsSystem.ts", "../node_modules/excalibur/build/esm/webpack:/TileMap/IsometricEntityComponent.ts", "../node_modules/excalibur/build/esm/webpack:/TileMap/IsometricEntitySystem.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/OffscreenSystem.ts", "../node_modules/excalibur/build/esm/webpack:/Scene.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/ColorBlindnessMode.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/color-blind-fragment.glsl", "../node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/ScreenShader.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts", "../node_modules/excalibur/build/esm/webpack:/Debug/DebugFlags.ts", "../node_modules/excalibur/build/esm/webpack:/Debug/Debug.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerScope.ts", "../node_modules/excalibur/build/esm/webpack:/Input/Keyboard.ts", "../node_modules/excalibur/build/esm/webpack:/Input/Gamepad.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Browser.ts", "../node_modules/excalibur/build/esm/webpack:/Math/global-coordinates.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerEvent.ts", "../node_modules/excalibur/build/esm/webpack:/Input/WheelEvent.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerAbstraction.ts", "../node_modules/excalibur/build/esm/webpack:/Input/WheelDeltaMode.ts", "../node_modules/excalibur/build/esm/webpack:/Input/NativePointerButton.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerButton.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerType.ts", "../node_modules/excalibur/build/esm/webpack:/Input/PointerEventReceiver.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Fps.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Clock.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Toaster.ts", "../node_modules/excalibur/build/esm/webpack:/Engine.ts", "../node_modules/excalibur/build/esm/webpack:/Math/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Debug/index.ts", "../node_modules/excalibur/build/esm/webpack:/Label.ts", "../node_modules/excalibur/build/esm/webpack:/TileMap/IsometricMap.ts", "../node_modules/excalibur/build/esm/webpack:/TileMap/index.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/ActionSequence.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Action/ParallelActions.ts", "../node_modules/excalibur/build/esm/webpack:/Actions/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Group/CollisionGroupManager.ts", "../node_modules/excalibur/build/esm/webpack:/Collision/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Interfaces/LifecycleEvents.ts", "../node_modules/excalibur/build/esm/webpack:/Interfaces/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Sound/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Gif.ts", "../node_modules/excalibur/build/esm/webpack:/Resources/Index.ts", "../node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/index.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Line.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/Polygon.ts", "../node_modules/excalibur/build/esm/webpack:/Graphics/index.ts", "../node_modules/excalibur/build/esm/webpack:/Input/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Index.ts", "../node_modules/excalibur/build/esm/webpack:/Util/Semaphore.ts", "../node_modules/excalibur/build/esm/webpack:/index.ts", "../src/game/turtle.ts", "../src/game/drawing.ts", "../src/language/parser/parser.ts", "../src/language/parser/lexer.ts", "../src/language/parser/name.ts", "../src/language/ast/Name.ts", "../src/language/parser/whitespace.ts", "../src/language/parser/newline.ts", "../src/language/parser/enum.ts", "../src/language/ast/Enum.ts", "../src/language/parser/number.ts", "../src/language/ast/Num.ts", "../src/language/ast/Instruction.ts", "../src/language/ast/Program.ts", "../src/language/execution/Scope.ts", "../src/language/execution/Interpreter.ts", "../src/game/game.ts", "../src/game.ts"],
  "sourcesContent": ["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Ref = void 0;\r\n/**\r\n * # Reference Cells\r\n *\r\n * `Ref<T>` class provides a simple reference cell, which can be used\r\n * as a surrogate for a parser that is defined later on. We can define\r\n * a _reference_ to parser, but we don't have to give the target right\r\n * away. When composing parsers we can use the `forwardRef` function\r\n * to pass a reference to any combinator expecting a `Parser<T, S>`.\r\n * Of course, we have to eventually assign a real parser as the target\r\n * of the reference before running the parser.\r\n */\r\nclass Ref {\r\n    /**\r\n     * Constructing a reference. The target value is optional.\r\n     */\r\n    constructor(value) {\r\n        this._target = null;\r\n        if (value)\r\n            this._target = value;\r\n    }\r\n    /**\r\n     * Get the target of the reference. If no target is set, a\r\n     * `ReferenceError` is thrown.\r\n     */\r\n    get target() {\r\n        if (this._target)\r\n            return this._target;\r\n        throw ReferenceError(\"Target not set.\");\r\n    }\r\n    /**\r\n     * Set the target.\r\n     */\r\n    set target(value) {\r\n        this._target = value;\r\n    }\r\n}\r\nexports.Ref = Ref;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ParseError = exports.ErrorSource = void 0;\r\n/**\r\n * # Error Reporting\r\n *\r\n * We define a custom Error class for parsing errors.\r\n *\r\n * The possible sources of errors are defined in the enumeration below.\r\n */\r\nvar ErrorSource;\r\n(function (ErrorSource) {\r\n    ErrorSource[\"Input\"] = \"Input\";\r\n    ErrorSource[\"Lexer\"] = \"Lexer\";\r\n    ErrorSource[\"Parser\"] = \"Parsing\";\r\n})(ErrorSource = exports.ErrorSource || (exports.ErrorSource = {}));\r\n/**\r\n * The ParseError class contains information about the parsing error in\r\n * an easily accessible form.\r\n */\r\nclass ParseError extends Error {\r\n    constructor(\r\n    /**\r\n     * The source of the error.\r\n     */\r\n    source, \r\n    /**\r\n     * The position where the error happened.\r\n     */\r\n    position, \r\n    /**\r\n     * Input found at `position`.\r\n     */\r\n    found, \r\n    /**\r\n     * Input expected at `position`. There can be multiple terminals.\r\n     */\r\n    expected = []) {\r\n        /**\r\n         * Constructor formats the error message using the parameters provided.\r\n         */\r\n        super(`${source} error at position ${position + 1}.\\n` +\r\n            `\\tFound: \"${found}\"\\n` +\r\n            `\\tExpected: ${expected.map(s => `\"${s}\"`).join(\", \")}`);\r\n        this.source = source;\r\n        this.position = position;\r\n        this.found = found;\r\n        this.expected = expected;\r\n    }\r\n}\r\nexports.ParseError = ParseError;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.arrayInput = void 0;\r\n/**\r\n * ## Array Input\r\n *\r\n * Arrays are the most common input data type. Therefore we provide a generic\r\n * implementation for them. Array items may have any type `S`. The class is\r\n * not exported outside the module. Users can create it using the `arrayInput`\r\n * function.\r\n */\r\nclass ArrayInput {\r\n    /**\r\n     * We set the position initially to -1 to indicate that no input has been\r\n     * consumed. The current item is `undefined`.\r\n     */\r\n    constructor(array, eof) {\r\n        this.array = array;\r\n        this.position = -1;\r\n        this.current = undefined;\r\n        this.eof = eof;\r\n    }\r\n    /**\r\n     * Return the next item in the array. Update `position` and\r\n     * `current` fields.\r\n     */\r\n    next() {\r\n        let pos = this.position + 1;\r\n        if (pos >= this.array.length)\r\n            return this.eof;\r\n        this.position = pos;\r\n        this.current = this.array[pos];\r\n        return this.current;\r\n    }\r\n}\r\n/**\r\n * ## Exported Functions\r\n *\r\n * Create a ParserInput wrapper for an array.\r\n */\r\nfunction arrayInput(array, eof) {\r\n    return new ArrayInput(array, eof);\r\n}\r\nexports.arrayInput = arrayInput;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.failed = exports.succeeded = exports.expectedAsCsv = exports.joinExpected = void 0;\r\n/**\r\n * ## Helper Functions\r\n *\r\n * The `joinExpected` function concatenates the list of expected\r\n * inputs from the `other` failed parse result into the `expected`\r\n * array of the first one.\r\n */\r\nfunction joinExpected(result, other) {\r\n    if (other.expected.length > 0)\r\n        result.expected = result.expected.concat(other.expected);\r\n}\r\nexports.joinExpected = joinExpected;\r\n/**\r\n * This function formats the array of expected inputs as a string for\r\n * printing.\r\n */\r\nfunction expectedAsCsv(result) {\r\n    return result.expected.map(s => `\"${s}\"`).join(\", \");\r\n}\r\nexports.expectedAsCsv = expectedAsCsv;\r\n/**\r\n * ## Constructor Functions\r\n *\r\n * The following function is used to construct an `Ok<T>` result.\r\n */\r\nfunction succeeded(pos, res) {\r\n    return {\r\n        kind: \"ok\",\r\n        position: pos,\r\n        result: res\r\n    };\r\n}\r\nexports.succeeded = succeeded;\r\n/**\r\n * The next one constructs a `Fail` result.\r\n */\r\nfunction failed(pos, fnd, exp = []) {\r\n    return {\r\n        kind: \"fail\",\r\n        position: pos,\r\n        found: fnd,\r\n        expected: exp\r\n    };\r\n}\r\nexports.failed = failed;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.escapeWhitespace = exports.initObject = void 0;\r\n/**\r\n * # Utility Functions\r\n *\r\n * This module contains general functions used elsewhere in the library.\r\n *\r\n * The first function initializes an object from an array of `[string, any]`\r\n * pairs. It is used to populate an object dynamically.\r\n */\r\nfunction initObject(members) {\r\n    let res = {};\r\n    for (let i = 0; i < members.length; i++) {\r\n        let [m, v] = members[i];\r\n        res[m] = v;\r\n    }\r\n    return res;\r\n}\r\nexports.initObject = initObject;\r\n/**\r\n * The `escapeWhitespace` function helps printing strings containing whitespace\r\n * characters. It replaces them with their escape codes.\r\n */\r\nfunction escapeWhitespace(text) {\r\n    return text.replace(\"\\n\", \"\\\\n\").replace(\"\\r\", \"\\\\r\").replace(\"\\t\", \"\\\\t\");\r\n}\r\nexports.escapeWhitespace = escapeWhitespace;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.lexerInput = exports.Lexer = exports.Token = void 0;\r\nconst utils = require(\"./utils\");\r\nconst err = require(\"./error\");\r\n/**\r\n * ## Representing a Token\r\n *\r\n * When a token is recognized it is wrapped in a `Token<S>` object. This\r\n * contains also the recognized string for error reporting and diagnostics.\r\n */\r\nclass Token {\r\n    constructor(token, text) {\r\n        this.token = token;\r\n        this.text = text;\r\n    }\r\n    /**\r\n     * We override the `toString` function so we can output a token\r\n     * to screen.\r\n     */\r\n    toString() {\r\n        return this.text ? utils.escapeWhitespace(this.text) : this.token;\r\n    }\r\n}\r\nexports.Token = Token;\r\n/**\r\n * ## Lexer\r\n *\r\n * The lexer itself is a simple class that contains all the TokenMatchers and\r\n * recognizes the next token in a string.\r\n */\r\nclass Lexer {\r\n    /**\r\n     * The constructor adds two flags to the regular expressions given as\r\n     * arguments. The `y` flag makes the search sticky so that it scans the\r\n     * input string from the position indicated by the `lastIndex` property.\r\n     * The `u` flag makes the search support unicode characters.\r\n     */\r\n    constructor(...tokens) {\r\n        this.matchers = tokens.map(t => ({\r\n            regex: new RegExp(t[0], \"yu\"),\r\n            token: t[1]\r\n        }));\r\n    }\r\n    /**\r\n     * We check matchers one-by-one in the order they were given to\r\n     * recognize the token in the given position. If none of the matchers\r\n     * succeed, we return `null`.\r\n     */\r\n    matchToken(input, pos) {\r\n        for (let i = 0; i < this.matchers.length; i++) {\r\n            let matcher = this.matchers[i];\r\n            matcher.regex.lastIndex = pos;\r\n            let match = matcher.regex.exec(input);\r\n            if (match != null)\r\n                return new Token(matcher.token, match[0]);\r\n        }\r\n        return null;\r\n    }\r\n}\r\nexports.Lexer = Lexer;\r\n/**\r\n * ## Lexer as Input\r\n *\r\n * We can integrate lexing directly into the parsing process by implementing\r\n * the `ParserInput` interface for any token. We don't expose `LexerInput`\r\n * class outside the module. It can be created with the `lexerInput` function.\r\n */\r\nclass LexerInput {\r\n    /**\r\n     * Create an input stream for given string and lexer. Initialize the\r\n     * instance variables.\r\n     */\r\n    constructor(input, lexer, eof) {\r\n        this.input = input;\r\n        this.lexer = lexer;\r\n        this.tokens = new Array(input.length);\r\n        this.position = -1;\r\n        this.eof = eof;\r\n        this.current = this.eof;\r\n    }\r\n    /**\r\n     * The iterator implementation is fairly straightforward. We need to make\r\n     * sure that the state variables `position` and `current` are kept in sync\r\n     * while we advance in the input string. We must also do a lookup in the\r\n     * cach\u00E9 before calling the lexer to recognize the token. If the lexer finds\r\n     * a match, we update the cach\u00E9. If the lexer cannot recognize the next\r\n     * token, we throw a `ParseError`.\r\n     */\r\n    next() {\r\n        let pos = this.position;\r\n        pos += this.tokens[pos] ? this.tokens[pos].text.length : 1;\r\n        if (pos >= this.input.length)\r\n            return this.eof;\r\n        this.position = pos;\r\n        let match = this.tokens[pos] || this.lexer.matchToken(this.input, pos);\r\n        if (!match)\r\n            throw new err.ParseError(err.ErrorSource.Lexer, pos, this.input.substr(pos, 10) + \"...\", [\"<valid token>\"]);\r\n        this.tokens[pos] = match;\r\n        this.current = match;\r\n        return match;\r\n    }\r\n}\r\n/**\r\n * Create an input stream for given `text` string using the given `lexer`.\r\n */\r\nfunction lexerInput(text, lexer, eof) {\r\n    return new LexerInput(text, lexer, eof);\r\n}\r\nexports.lexerInput = lexerInput;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.terminal = exports.token = exports.is = exports.anything = exports.forwardRef = exports.cleanupState = exports.checkState = exports.mutateState = exports.setState = exports.getState = exports.position = exports.choose = exports.peek = exports.any = exports.notSatisfy = exports.satisfy = exports.fail = exports.mret = exports.parse = exports.tryParse = exports.parserDebug = exports.Parser = void 0;\r\nconst pr = require(\"./result\");\r\nconst utils = require(\"./utils\");\r\nconst err = require(\"./error\");\r\n/**\r\n * ## Parser Class\r\n *\r\n * The central type in the Parzec library is the `Parser<T, S>` class. It wraps\r\n * a parsing function and provides the core combinators to combine parsers in\r\n * various ways.\r\n */\r\nclass Parser {\r\n    /**\r\n     * Constructor wraps the parsing function.\r\n     */\r\n    constructor(parse) {\r\n        this.parse = parse;\r\n    }\r\n    /**\r\n     * The monadic bind that corresponds to Haskell's `>>=` operator. Runs\r\n     * `this` parser, and if it succeeds, feeds its result to the `binder`\r\n     * function that returns a new Parser. This is the basic operation that is\r\n     * used in other combinators to glue parsers together.\r\n     */\r\n    bind(binder) {\r\n        return new Parser(input => {\r\n            let pos = input.position;\r\n            let res1 = this.parse(input);\r\n            if (res1.kind == \"ok\") {\r\n                let res2 = binder(res1.result).parse(input);\r\n                if (res2.kind == \"fail\" && pos !== input.position)\r\n                    input.position = pos; // backtrack\r\n                return res2;\r\n            }\r\n            return res1;\r\n        });\r\n    }\r\n    /**\r\n     * The sequence operator. Runs `this` parser, and if it succeeds, runs the\r\n     * `other` parser ignoring the result of `this` one.\r\n     */\r\n    seq(other) {\r\n        return this.bind(_ => other);\r\n    }\r\n    /**\r\n     * Map result of the parser to another value. This function implements a\r\n     * [_functor_](https://en.wikipedia.org/wiki/Functor) which is a superclass\r\n     * of monad.\r\n     */\r\n    map(mapper) {\r\n        return this.bind(x => mret(mapper(x)));\r\n    }\r\n    /**\r\n     * ## Conditional Parsing\r\n     *\r\n     * The ordered choice operation. Creates a parser that first runs `this`\r\n     * parser, and if that fails, runs the `other` one. Corresponds to the `/`\r\n     * operation in [PEG grammars](https://en.wikipedia.org/wiki/Parsing_expression_grammar).\r\n     */\r\n    or(other) {\r\n        return new Parser(input => {\r\n            let pos = input.position;\r\n            let res1 = this.parse(input);\r\n            if (res1.kind == \"ok\")\r\n                return res1;\r\n            if (res1.position > pos)\r\n                return res1;\r\n            let res2 = other.parse(input);\r\n            if (res2.kind == \"ok\")\r\n                return res2;\r\n            pr.joinExpected(res2, res1);\r\n            return res2;\r\n        });\r\n    }\r\n    /**\r\n     * Parse an optional value, if the parser fails then the default value is\r\n     * returned.\r\n     */\r\n    optional(defaultValue) {\r\n        return this.or(mret(defaultValue));\r\n    }\r\n    /**\r\n     * Parse an optional reference value, if the parser fails then null is\r\n     * returned.\r\n     */\r\n    optionalRef() {\r\n        return this.or(mret(null));\r\n    }\r\n    /**\r\n     * Runs parser and checks that it succeeds and that the result it returns\r\n     * satisfies a given predicate.\r\n     */\r\n    where(predicate) {\r\n        return this.bind(x => predicate(x) ? mret(x) : fail(`${x}`, \"predicate\"));\r\n    }\r\n    /**\r\n     * ## Parsing Multiple Items\r\n     *\r\n     * Creates a parser that will run `this` parser zero or more times. The\r\n     * results of the input parser are added to an array.\r\n     */\r\n    zeroOrMore() {\r\n        return new Parser(input => {\r\n            let list = [];\r\n            while (true) {\r\n                let pos = input.position;\r\n                let res = this.parse(input);\r\n                if (res.kind == \"fail\")\r\n                    return res.position > pos ?\r\n                        res : pr.succeeded(res.position, list);\r\n                list.push(res.result);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Creates a parser that runs `this` parser one or more times.\r\n     */\r\n    oneOrMore() {\r\n        return new Parser(input => {\r\n            let res = this.parse(input);\r\n            if (res.kind == \"fail\")\r\n                return res;\r\n            let list = [res.result];\r\n            while (true) {\r\n                let pos = input.position;\r\n                res = this.parse(input);\r\n                if (res.kind == \"fail\")\r\n                    return res.position > pos ?\r\n                        res : pr.succeeded(res.position, list);\r\n                list.push(res.result);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Parsing succeeds if `this` parser succeeds from `min` to `max` times.\r\n     */\r\n    occurrences(min, max) {\r\n        return this.zeroOrMore().bind(list => {\r\n            let cnt = list.length;\r\n            return cnt >= min && cnt <= max ?\r\n                mret(list) :\r\n                fail(`${cnt} occurrences`, `${min}-${max} occurrences`);\r\n        });\r\n    }\r\n    /**\r\n     * ## Lookahead & Backtracking\r\n     *\r\n     * Check that `this` parser succeeds without consuming any input.\r\n     * Corresponds to the `&` operator in PEG grammars.\r\n     */\r\n    and() {\r\n        return new Parser(input => {\r\n            let pos = input.position;\r\n            let res = this.parse(input);\r\n            input.position = pos;\r\n            return res;\r\n        });\r\n    }\r\n    /**\r\n     * Check that `this` parser fails without consuming any input. Corresponds\r\n     * to the `!` operator in PEG grammars.\r\n     */\r\n    not() {\r\n        return new Parser(input => {\r\n            let pos = input.position;\r\n            let res = this.parse(input);\r\n            input.position = pos;\r\n            if (res.kind == \"ok\") {\r\n                let found = `${res.result}`;\r\n                return pr.failed(res.position, found, [\"not \" + found]);\r\n            }\r\n            return pr.succeeded(res.position, undefined);\r\n        });\r\n    }\r\n    /**\r\n     * Bactrack to the current input position, even if the given parser fails\r\n     * and has advanced the input position. Normally we do not bactrack when a\r\n     * parser has advanced in the input. Doing so would loose the position where\r\n     * the parsing failed and make error messages more vague. Sometimes,\r\n     * however, we need more input lookahead. In these cases, you can use the\r\n     * backtrack operation to retry the next rule.\r\n     */\r\n    backtrack() {\r\n        return new Parser(input => {\r\n            let pos = input.position;\r\n            let res = this.parse(input);\r\n            if (res.kind == \"fail\" && res.position > pos)\r\n                res.position = pos;\r\n            return res;\r\n        });\r\n    }\r\n    /**\r\n     * ## Error Reporting and Debugging\r\n     *\r\n     * Give a human-readable name to the \"thing\" that the given parser matches.\r\n     * This name is reported as expected value, if the parsing fails.\r\n     */\r\n    expect(expected) {\r\n        if (!exports.parserDebug.errorMessages)\r\n            return this;\r\n        let resParser = new Parser((input) => {\r\n            let res = this.parse(input);\r\n            if (res.kind == \"fail\")\r\n                res.expected.push(expected);\r\n            return res;\r\n        });\r\n        return exports.parserDebug.debugging ? resParser.trace(expected) : resParser;\r\n    }\r\n    /**\r\n     * Attach debugging information to a parser. To trace which rules are\r\n     * triggered during parsing, you can add debugging info to any parser. This\r\n     * combinator produces a hierarchical tree of parser invocations which\r\n     * includes information about input symbol and its position. If debugging\r\n     * is disabled, this function does nothing.\r\n     */\r\n    trace(ruleName) {\r\n        if (!exports.parserDebug.debugging)\r\n            return this;\r\n        return new Parser(input => {\r\n            exports.parserDebug.write(`${ruleName} called with input '${input.current}'.`);\r\n            exports.parserDebug.indent();\r\n            let res = this.parse(input);\r\n            exports.parserDebug.rulesEvaluated++;\r\n            exports.parserDebug.unindent();\r\n            exports.parserDebug.write((res.kind == \"ok\" ?\r\n                `${ruleName} SUCCEEDED with value '${utils.escapeWhitespace(`${res.result}`)}'` :\r\n                `${ruleName} FAILED with value '${utils.escapeWhitespace(`${res.found}`)}'. Expected values: ${pr.expectedAsCsv(res)}`) +\r\n                ` at position ${res.position}`);\r\n            return res;\r\n        });\r\n    }\r\n}\r\nexports.Parser = Parser;\r\n/**\r\n * ## Debugging Options\r\n *\r\n * The following object contains the global settings that control the parser\r\n * reporting.\r\n */\r\nexports.parserDebug = {\r\n    /**\r\n     * When `debugging` flag is on parsers count the number of rules evaluated\r\n     * during their operation. The `rulesEvaluated` field contains this\r\n     * information.\r\n     */\r\n    debugging: false,\r\n    rulesEvaluated: 0,\r\n    /**\r\n     * If errorMessages flag is turned off, the expected information will not be\r\n     * available in parse errors. This speeds up the parsing nominally.\r\n     */\r\n    errorMessages: true,\r\n    /**\r\n     * The current indentation level in the debugging output is stored in this\r\n     * field.\r\n     */\r\n    indentation: 0,\r\n    /**\r\n     * Indent the debug output by one level.\r\n     */\r\n    indent() {\r\n        this.indentation++;\r\n    },\r\n    /**\r\n     * Unndent the debug output by one level.\r\n     */\r\n    unindent() {\r\n        this.indentation--;\r\n    },\r\n    /**\r\n     * Write a string to the debug output.\r\n     */\r\n    write(text) {\r\n        let tabs = \"  \".repeat(this.indentation);\r\n        console.log(tabs + text);\r\n    }\r\n};\r\n/**\r\n * ## Main Functions\r\n *\r\n * Attempt to parse an input with a given parser. Takes a Parser and a\r\n * ParserInput as arguments and return a ParseResult.\r\n */\r\nfunction tryParse(parser, input) {\r\n    exports.parserDebug.rulesEvaluated = 0;\r\n    let res = parser.parse(input);\r\n    if (exports.parserDebug.debugging)\r\n        console.info(\"Number of rules evaluated: \" + exports.parserDebug.rulesEvaluated);\r\n    return res;\r\n}\r\nexports.tryParse = tryParse;\r\n/**\r\n * Parse an input using a given parser, or throw an exception, if parsing fails.\r\n */\r\nfunction parse(parser, input) {\r\n    var res = tryParse(parser, input);\r\n    if (res.kind == \"fail\")\r\n        throw new err.ParseError(err.ErrorSource.Parser, res.position, res.found, res.expected);\r\n    return res.result;\r\n}\r\nexports.parse = parse;\r\n/**\r\n * ## Monadic Returns\r\n *\r\n * Create a parser that always succeeds and returns the given value without\r\n * consuming any input. This function implements the monadic return, that is,\r\n * it lifts a value to the parser monad.\r\n */\r\nfunction mret(value) {\r\n    return new Parser(input => pr.succeeded(input.position, value));\r\n}\r\nexports.mret = mret;\r\n/**\r\n * Create a parser that always fails. The terminals reported as\r\n * found or expected are given as an argument.\r\n */\r\nfunction fail(found, ...expected) {\r\n    return new Parser(input => pr.failed(input.position, found, expected));\r\n}\r\nexports.fail = fail;\r\n/**\r\n * ## Parsing Terminals\r\n *\r\n * Creates a parser that reads one terminal from the input and returns it, if it\r\n * satisfies the given predicate; otherwise the parser fails.\r\n */\r\nfunction satisfy(predicate) {\r\n    return new Parser(input => {\r\n        let pos = input.position;\r\n        let item = input.next();\r\n        if (predicate(item))\r\n            return pr.succeeded(input.position, item);\r\n        input.position = pos;\r\n        return pr.failed(input.position, `${item}`);\r\n    });\r\n}\r\nexports.satisfy = satisfy;\r\n/**\r\n * Creates a parser that reads one terminal from the input and returns it, if it\r\n * does **not** satisfy a given predicate.\r\n */\r\nfunction notSatisfy(predicate) {\r\n    return satisfy(x => !predicate(x));\r\n}\r\nexports.notSatisfy = notSatisfy;\r\n/**\r\n * Any of the given parsers must succeed. The operation is the same\r\n * as the `or` combinator generalized to arbitrary number of choices.\r\n */\r\nfunction any(...parsers) {\r\n    if (parsers.length == 0)\r\n        throw Error(\"At least one parser must be given.\");\r\n    return new Parser(input => {\r\n        let res = null;\r\n        let i = 0;\r\n        let pos = input.position;\r\n        do {\r\n            let r = parsers[i++].parse(input);\r\n            if (r.kind == \"ok\")\r\n                return r;\r\n            if (r.position > pos)\r\n                return r;\r\n            if (res == null)\r\n                res = r;\r\n            else\r\n                pr.joinExpected(res, r);\r\n        } while (i < parsers.length);\r\n        return res;\r\n    });\r\n}\r\nexports.any = any;\r\n/**\r\n * Peek next symbol in the input stream without changing the position.\r\n */\r\nfunction peek() {\r\n    return new Parser(input => {\r\n        let pos = input.position;\r\n        let next = input.next();\r\n        input.position = pos;\r\n        return pr.succeeded(pos, next);\r\n    });\r\n}\r\nexports.peek = peek;\r\n/**\r\n * Select a parser to be used based on the next symbol in the input. This\r\n * function is an alternative to the the \"any\" combinator. It reduces\r\n * backtracking when the parser to be applied can be deduced from the next\r\n * symbol.\r\n */\r\nfunction choose(selector) {\r\n    return peek().bind(selector);\r\n}\r\nexports.choose = choose;\r\n/**\r\n * ## Getting Current Position\r\n *\r\n * A parser that returns the current position of the input. This is useful\r\n * when binding parsers together and you want to know the position where you\r\n * currently are. The position can be also used for backtracking.\r\n */\r\nfunction position() {\r\n    return new Parser(input => pr.succeeded(input.position, input.position));\r\n}\r\nexports.position = position;\r\n/**\r\n * ## User-Managed State\r\n *\r\n * Get the current satellite state stored in the input.\r\n */\r\nfunction getState() {\r\n    return new Parser(input => pr.succeeded(input.position, input.state));\r\n}\r\nexports.getState = getState;\r\n/**\r\n * Set the current satellite state stored in the input. The new state\r\n * is not given explicitly. Rather, a funcion which returns the new\r\n * state is specified.\r\n */\r\nfunction setState(newValue) {\r\n    return new Parser(input => pr.succeeded(input.position, input.state = newValue()));\r\n}\r\nexports.setState = setState;\r\n/**\r\n * Mutate the satellite state stored in the input. The mutation is done\r\n * with a function given as an argument.\r\n */\r\nfunction mutateState(mutate) {\r\n    return new Parser(input => {\r\n        mutate(input.state);\r\n        return pr.succeeded(input.position, input.state);\r\n    });\r\n}\r\nexports.mutateState = mutateState;\r\n/**\r\n * Check that the current state matches a predicate. If not, the result parser\r\n * fails.\r\n */\r\nfunction checkState(predicate) {\r\n    return new Parser(input => predicate(input.state) ?\r\n        pr.succeeded(input.position, input.state) :\r\n        pr.failed(input.position, \"Matching predicate.\"));\r\n}\r\nexports.checkState = checkState;\r\n/**\r\n * Clean up the current state after a parser has been executed. The clean-up\r\n * function is run regardless of whether the parser succeeds or fails.\r\n */\r\nfunction cleanupState(parser, cleanup) {\r\n    return new Parser(input => {\r\n        let res = parser.parse(input);\r\n        cleanup(input.state);\r\n        return res;\r\n    });\r\n}\r\nexports.cleanupState = cleanupState;\r\n/**\r\n * ## Defining Mutually Recursive Parsers\r\n *\r\n * Often grammar rules are mutually recursive, which means that there is no way\r\n * to write them in an order where all the dependent rules are defined. In these\r\n * occasions, you can just create a _reference_ to a parser and set its\r\n * implementation later. To refer to the parser that is not yet defined, you can\r\n * use this function.\r\n */\r\nfunction forwardRef(parser) {\r\n    return new Parser(input => parser.target.parse(input));\r\n}\r\nexports.forwardRef = forwardRef;\r\n/**\r\n * ## General Parsers\r\n *\r\n * The catch-all parser that will match any symbol read from the input.\r\n */\r\nfunction anything() {\r\n    return satisfy(_ => true);\r\n}\r\nexports.anything = anything;\r\n/**\r\n * Parser that succeeds if the symbol read from the input is equal (===) to\r\n * given parameter; otherwise parsing fails.\r\n */\r\nfunction is(value) {\r\n    return satisfy(x => x === value);\r\n}\r\nexports.is = is;\r\n/**\r\n * Parse a specific token from the lexer input stream.\r\n */\r\nfunction token(token) {\r\n    return satisfy(t => t.token === token);\r\n}\r\nexports.token = token;\r\n/**\r\n * Helper function to create a terminal parser.\r\n */\r\nfunction terminal(tok, name) {\r\n    return token(tok).expect(name);\r\n}\r\nexports.terminal = terminal;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.operators = void 0;\r\n/**\r\n * # Combinators for Parsing Arrays and Expressions\r\n *\r\n * This module contains additional combinators that are useful when parsing\r\n * sequences or expressions. They are adapted from the original\r\n * [Parsec](http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Combinator.html)\r\n * library.\r\n */\r\nconst par = require(\"./parser\");\r\n/**\r\n * ## Parsing Separated Lists\r\n *\r\n * Parse an array containing at least one element. The items of the array are\r\n * recognized by `parser`. The items are separated by input recognized by\r\n * `separator`. The function returns an array of parsed elements.\r\n */\r\npar.Parser.prototype.oneOrMoreSeparatedBy = function (separator) {\r\n    return this.bind(x => separator.seq(this).zeroOrMore().bind(xs => par.mret([x].concat(xs))));\r\n};\r\n/**\r\n * Parse a potentially empty array. The items of the array are recognized by\r\n * `parser`. The items are separated by input recognized by `separator`.\r\n */\r\npar.Parser.prototype.zeroOrMoreSeparatedBy = function (separator) {\r\n    return this.oneOrMoreSeparatedBy(separator).or(par.mret([]));\r\n};\r\n/**\r\n * ## Terminators & Brackets\r\n *\r\n * Parse item(s) followed by a terminator given in the `after` parser. The\r\n * result of `parser` is returned, and result of `after` is ignored.\r\n */\r\npar.Parser.prototype.followedBy = function (after) {\r\n    return this.bind(p => after.bind(_ => par.mret(p)));\r\n};\r\n/**\r\n * Parse item(s) surrounded by input recognized by the `surround` parser. The\r\n * result of `parser` is returned.\r\n */\r\npar.Parser.prototype.surroundedBy = function (surround) {\r\n    return surround.bind(o => this.bind(p => surround.bind(c => par.mret(p))));\r\n};\r\n/**\r\n * Parse item(s) surrounded by an open and closing bracket. The result `parser`\r\n * is returned.\r\n */\r\npar.Parser.prototype.bracketedBy = function (open, close) {\r\n    return open.bind(o => this.bind(p => close.bind(c => par.mret(p))));\r\n};\r\n/**\r\n * ## Parsing Expressions\r\n *\r\n * Parse one or more occurrences of `parser`, separated by `operation`.\r\n * Return a value obtained by a left associative application of all functions\r\n * returned by `operation` to the values returned by `parser`. This parser can\r\n * for example be used to eliminate left recursion which typically occurs in\r\n * expression grammars.\r\n */\r\npar.Parser.prototype.chainOneOrMore = function (operation) {\r\n    return this.bind(x => operation.bind(f => this.bind(y => par.mret([f, y]))).zeroOrMore().bind(fys => par.mret(fys.reduce((z, [f, y]) => f(z, y), x))));\r\n};\r\n/**\r\n * Parse zero or more occurrences of `parser`, separated by `operation`.\r\n * Return a value obtained by a left associative application of all functions\r\n * returned by `operation` to the values returned by `parser`. If there are\r\n * zero occurrences of `parser`, the `value` is returned.\r\n */\r\npar.Parser.prototype.chainZeroOrMore = function (operation, value) {\r\n    return this.chainOneOrMore(operation).or(par.mret(value));\r\n};\r\n/**\r\n * Construct a parser for operator selection. Used typically in conjunction\r\n * with `chain*` functions.\r\n */\r\nfunction operators(...ops) {\r\n    return par.any(...ops.map(([p, o]) => p.map(_ => o)));\r\n}\r\nexports.operators = operators;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * ---\r\n * {\r\n *  \"visualizers\": [\r\n *      {\r\n *          \"path\": \"./src/visualizers/dependency-diag.ts\",\r\n *          \"includeStyles\": true\r\n *      }\r\n *  ]\r\n * }\r\n * ---\r\n * # Library Structure\r\n *\r\n * Below is the dependency graph showing the module hierarchy. Note that it\r\n * shows also the testing modules which are not included in the published\r\n * package. You can jump to a module by clicking it in the diagram.\r\n *\r\n * <<v:dependency-diag ../dependencies.json src\\/(?!extras)>>\r\n *\r\n * ## Exports\r\n *\r\n * Parzec library consists of following modules. All of them are exported\r\n * outside the library.\r\n */\r\n__exportStar(require(\"./ref\"), exports);\r\n__exportStar(require(\"./error\"), exports);\r\n__exportStar(require(\"./input\"), exports);\r\n__exportStar(require(\"./result\"), exports);\r\n__exportStar(require(\"./error\"), exports);\r\n__exportStar(require(\"./lexer\"), exports);\r\n__exportStar(require(\"./parser\"), exports);\r\n__exportStar(require(\"./arrayparsers\"), exports);\r\n__exportStar(require(\"./utils\"), exports);\r\n", "require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n", "require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n", "var isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar $TypeError = TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw $TypeError(tryToString(argument) + ' is not a function');\n};\n", "var isObject = require('../internals/is-object');\n\nvar $String = String;\nvar $TypeError = TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw $TypeError($String(argument) + ' is not an object');\n};\n", "var toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n", "'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call -- required for testing\n    method.call(null, argument || function () { return 1; }, 1);\n  });\n};\n", "var toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar createProperty = require('../internals/create-property');\n\nvar $Array = Array;\nvar max = Math.max;\n\nmodule.exports = function (O, start, end) {\n  var length = lengthOfArrayLike(O);\n  var k = toAbsoluteIndex(start, length);\n  var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n  var result = $Array(max(fin - k, 0));\n  for (var n = 0; k < fin; k++, n++) createProperty(result, n, O[k]);\n  result.length = n;\n  return result;\n};\n", "var arraySlice = require('../internals/array-slice-simple');\n\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    array,\n    mergeSort(arraySlice(array, 0, middle), comparefn),\n    mergeSort(arraySlice(array, middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (array, left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n\n  while (lindex < llength || rindex < rlength) {\n    array[lindex + rindex] = (lindex < llength && rindex < rlength)\n      ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n      : lindex < llength ? left[lindex++] : right[rindex++];\n  } return array;\n};\n\nmodule.exports = mergeSort;\n", "var uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n", "var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar $Object = Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = $Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n", "var hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n", "module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n", "'use strict';\nvar toPropertyKey = require('../internals/to-property-key');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPropertyKey(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n", "var isCallable = require('../internals/is-callable');\nvar definePropertyModule = require('../internals/object-define-property');\nvar makeBuiltIn = require('../internals/make-built-in');\nvar defineGlobalProperty = require('../internals/define-global-property');\n\nmodule.exports = function (O, key, value, options) {\n  if (!options) options = {};\n  var simple = options.enumerable;\n  var name = options.name !== undefined ? options.name : key;\n  if (isCallable(value)) makeBuiltIn(value, name, options);\n  if (options.global) {\n    if (simple) O[key] = value;\n    else defineGlobalProperty(key, value);\n  } else {\n    try {\n      if (!options.unsafe) delete O[key];\n      else if (O[key]) simple = true;\n    } catch (error) { /* empty */ }\n    if (simple) O[key] = value;\n    else definePropertyModule.f(O, key, {\n      value: value,\n      enumerable: false,\n      configurable: !options.nonConfigurable,\n      writable: !options.nonWritable\n    });\n  } return O;\n};\n", "var global = require('../internals/global');\n\n// eslint-disable-next-line es-x/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n", "'use strict';\nvar tryToString = require('../internals/try-to-string');\n\nvar $TypeError = TypeError;\n\nmodule.exports = function (O, P) {\n  if (!delete O[P]) throw $TypeError('Cannot delete property ' + tryToString(P) + ' of ' + tryToString(O));\n};\n", "var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n", "var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n", "var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n", "var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n", "var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n", "var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n", "var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n", "var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n", "// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n", "var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar defineBuiltIn = require('../internals/define-built-in');\nvar defineGlobalProperty = require('../internals/define-global-property');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target         - name of the target object\n  options.global         - target is the global object\n  options.stat           - export as static methods of target\n  options.proto          - export as prototype methods of target\n  options.real           - real prototype method for the `pure` version\n  options.forced         - export even if the native feature is available\n  options.bind           - bind methods to the target, required for the `pure` version\n  options.wrap           - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe         - use the simple assignment of property instead of delete + defineProperty\n  options.sham           - add a flag to not completely full polyfills\n  options.enumerable     - export as enumerable property\n  options.dontCallGetSet - prevent calling a getter on target\n  options.name           - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || defineGlobalProperty(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.dontCallGetSet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    defineBuiltIn(target, key, sourceProperty, options);\n  }\n};\n", "module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n", "var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es-x/no-function-prototype-bind -- safe\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n", "var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n", "var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar bind = FunctionPrototype.bind;\nvar call = FunctionPrototype.call;\nvar uncurryThis = NATIVE_BIND && bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? function (fn) {\n  return fn && uncurryThis(fn);\n} : function (fn) {\n  return fn && function () {\n    return call.apply(fn, arguments);\n  };\n};\n", "var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n", "var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n", "var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es-x/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n", "var uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\n// eslint-disable-next-line es-x/no-object-hasown -- safe\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n", "module.exports = {};\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n", "var uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar $Object = Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !$Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split(it, '') : $Object(it);\n} : $Object;\n", "var uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n", "var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = uncurryThis(store.get);\n  var wmhas = uncurryThis(store.has);\n  var wmset = uncurryThis(store.set);\n  set = function (it, metadata) {\n    if (wmhas(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n", "// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument == 'function';\n};\n", "var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n", "var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n", "module.exports = false;\n", "var getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar $Object = Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, $Object(it));\n};\n", "var toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n", "var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar enforceInternalState = InternalStateModule.enforce;\nvar getInternalState = InternalStateModule.get;\n// eslint-disable-next-line es-x/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nvar CONFIGURABLE_LENGTH = DESCRIPTORS && !fails(function () {\n  return defineProperty(function () { /* empty */ }, 'length', { value: 8 }).length !== 8;\n});\n\nvar TEMPLATE = String(String).split('String');\n\nvar makeBuiltIn = module.exports = function (value, name, options) {\n  if (String(name).slice(0, 7) === 'Symbol(') {\n    name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n  }\n  if (options && options.getter) name = 'get ' + name;\n  if (options && options.setter) name = 'set ' + name;\n  if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n    if (DESCRIPTORS) defineProperty(value, 'name', { value: name, configurable: true });\n    else value.name = name;\n  }\n  if (CONFIGURABLE_LENGTH && options && hasOwn(options, 'arity') && value.length !== options.arity) {\n    defineProperty(value, 'length', { value: options.arity });\n  }\n  try {\n    if (options && hasOwn(options, 'constructor') && options.constructor) {\n      if (DESCRIPTORS) defineProperty(value, 'prototype', { writable: false });\n    // in V8 ~ Chrome 53, prototypes of some methods, like `Array.prototype.values`, are non-writable\n    } else if (value.prototype) value.prototype = undefined;\n  } catch (error) { /* empty */ }\n  var state = enforceInternalState(value);\n  if (!hasOwn(state, 'source')) {\n    state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n  } return value;\n};\n\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n// eslint-disable-next-line no-extend-native -- required\nFunction.prototype.toString = makeBuiltIn(function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n}, 'toString');\n", "var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `Math.trunc` method\n// https://tc39.es/ecma262/#sec-math.trunc\n// eslint-disable-next-line es-x/no-math-trunc -- safe\nmodule.exports = Math.trunc || function trunc(x) {\n  var n = +x;\n  return (n > 0 ? floor : ceil)(n);\n};\n", "/* eslint-disable es-x/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es-x/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n", "var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar $TypeError = TypeError;\n// eslint-disable-next-line es-x/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw $TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n", "var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es-x/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n", "// eslint-disable-next-line es-x/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n", "var uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n", "var uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n", "var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es-x/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n", "'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es-x/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n", "var call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar $TypeError = TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw $TypeError(\"Can't convert object to primitive value\");\n};\n", "var getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n", "var global = require('../internals/global');\n\nmodule.exports = global;\n", "var $TypeError = TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw $TypeError(\"Can't call method on \" + it);\n  return it;\n};\n", "var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n", "var global = require('../internals/global');\nvar defineGlobalProperty = require('../internals/define-global-property');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || defineGlobalProperty(SHARED, {});\n\nmodule.exports = store;\n", "var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.23.3',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '\u00A9 2014-2022 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n", "var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n", "// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n", "var trunc = require('../internals/math-trunc');\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- NaN check\n  return number !== number || number === 0 ? 0 : trunc(number);\n};\n", "var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n", "var requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar $Object = Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return $Object(requireObjectCoercible(argument));\n};\n", "var call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar $TypeError = TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw $TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n", "var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n", "var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n", "var classof = require('../internals/classof');\n\nvar $String = String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return $String(argument);\n};\n", "var $String = String;\n\nmodule.exports = function (argument) {\n  try {\n    return $String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n", "var uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n", "/* eslint-disable es-x/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n", "var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es-x/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype != 42;\n});\n", "var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar symbolFor = Symbol && Symbol['for'];\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    var description = 'Symbol.' + name;\n    if (NATIVE_SYMBOL && hasOwn(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else if (USE_SYMBOL_AS_UID && symbolFor) {\n      WellKnownSymbolsStore[name] = symbolFor(description);\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n", "'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar deletePropertyOrThrow = require('../internals/delete-property-or-throw');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar un$Sort = uncurryThis(test.sort);\nvar push = uncurryThis(test.push);\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n    var items = [];\n    var arrayLength = lengthOfArrayLike(array);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) push(items, array[index]);\n    }\n\n    internalSort(items, getSortCompare(comparefn));\n\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) deletePropertyOrThrow(array, index++);\n\n    return array;\n  }\n});\n", "var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n", "// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n", "// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\\r\\n#ex-toast-container {\\r\\n  position: absolute;\\r\\n  height: 0;\\r\\n  min-width: 50%;\\r\\n  left: 50%;\\r\\n  top: 0;\\r\\n}\\r\\n\\r\\n.ex-toast-message {\\r\\n  left: -50%;\\r\\n  position: relative;\\r\\n  display: flex;\\r\\n  justify-content: space-between;\\r\\n\\r\\n\\r\\n  padding: 10px;\\r\\n  margin-top: 5px;\\r\\n  font-size: 18px;\\r\\n  font-family: sans-serif;\\r\\n  border-radius: 6px;\\r\\n  border: 3px solid #b7b779;\\r\\n  background-color: rgb(253, 253, 192);\\r\\n}\\r\\n\\r\\n\\r\\n.ex-toast-message button {\\r\\n  align-self: flex-start;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./Util/Toaster.css\"],\"names\":[],\"mappings\":\";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB\",\"sourcesContent\":[\"\\r\\n#ex-toast-container {\\r\\n  position: absolute;\\r\\n  height: 0;\\r\\n  min-width: 50%;\\r\\n  left: 50%;\\r\\n  top: 0;\\r\\n}\\r\\n\\r\\n.ex-toast-message {\\r\\n  left: -50%;\\r\\n  position: relative;\\r\\n  display: flex;\\r\\n  justify-content: space-between;\\r\\n\\r\\n\\r\\n  padding: 10px;\\r\\n  margin-top: 5px;\\r\\n  font-size: 18px;\\r\\n  font-family: sans-serif;\\r\\n  border-radius: 6px;\\r\\n  border: 3px solid #b7b779;\\r\\n  background-color: rgb(253, 253, 192);\\r\\n}\\r\\n\\r\\n\\r\\n.ex-toast-message button {\\r\\n  align-self: flex-start;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n", "\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};", "\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};", "// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n", "// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};", "// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};", "__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();", "__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))", "// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};", "import 'core-js/es/array/sort';\r\nimport 'core-js/es/object/keys';\r\n\r\n/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n}\r\n", "\r\n/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n\r\n  /**\r\n   * Force excalibur to load the Canvas 2D graphics context fallback\r\n   *\r\n   * @warning not all features of excalibur are supported in the Canvas 2D fallback\r\n   */\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable('use-canvas-context');\r\n  }\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n", "export type Id<T extends string> = {\r\n  type: T,\r\n  value: number\r\n};\r\n\r\n/**\r\n * Create a branded ID type from a number\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n};\r\n", "/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T = null;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n", "import { Random } from './Random';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Returns the fractional part of a number\r\n * @param x\r\n */\r\nexport function frac(x: number): number {\r\n  if (x >= 0) {\r\n    return x - Math.floor(x);\r\n  } else {\r\n    return x - Math.ceil(x);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the sign of a number, if 0 returns 0\r\n */\r\nexport function sign(val: number): number {\r\n  if (val === 0) {\r\n    return 0;\r\n  }\r\n  return val < 0 ? -1 : 1;\r\n};\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI]\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle > TwoPI) {\r\n    while (tmpAngle > TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}", "import { Clonable } from '../Interfaces/Clonable';\r\nimport { clamp } from './util';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  public static min(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.min(vec1.x, vec2.x), Math.min(vec1.y, vec2.y));\r\n  }\r\n\r\n  public static max(vec1: Vector, vec2: Vector) {\r\n    return new Vector(Math.max(vec1.x, vec2.x), Math.max(vec1.y, vec2.y));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   *\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    const deltaX = this.x - v.x;\r\n    const deltaY = this.y - v.y;\r\n    return deltaX * deltaX + deltaY * deltaY;\r\n  }\r\n\r\n  /**\r\n   * Clamps the current vector's magnitude mutating it\r\n   * @param magnitude\r\n   */\r\n  public clampMagnitude(magnitude: number): Vector {\r\n    const size = this.size;\r\n    const newSize = clamp(size, 0, magnitude);\r\n    this.size = newSize;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   *\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a vector to have a magnitude of 1.\r\n   */\r\n  public normalize(): Vector {\r\n    const d = this.distance();\r\n    if (d > 0) {\r\n      return new Vector(this.x / d, this.y / d);\r\n    } else {\r\n      return new Vector(0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   * @param dest  Optionally provide a destination vector for the result\r\n   */\r\n  public scale(scale: Vector, dest?: Vector): Vector;\r\n  public scale(size: number, dest?: Vector): Vector;\r\n  public scale(sizeOrScale: number | Vector, dest?: Vector): Vector {\r\n    const result = dest || new Vector(0, 0);\r\n    if (sizeOrScale instanceof Vector) {\r\n      result.x = this.x * sizeOrScale.x;\r\n      result.y = this.y * sizeOrScale.y;\r\n    } else {\r\n      result.x = this.x * sizeOrScale;\r\n      result.y = this.y * sizeOrScale;\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   * @param dest Optionally copy the result into a provided vector\r\n   */\r\n  public add(v: Vector, dest?: Vector): Vector {\r\n    if (dest) {\r\n      dest.x = this.x + v.x;\r\n      dest.y = this.y + v.y;\r\n      return dest;\r\n    }\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector): Vector {\r\n    return new Vector(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector.\r\n   */\r\n  public toAngle(): number {\r\n    return Math.atan2(this.y, this.x);\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain number of\r\n   * degrees in radians\r\n   */\r\n  public rotate(angle: number, anchor?: Vector): Vector {\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    return new Vector(x, y);\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(dest?: Vector): Vector {\r\n    const v = dest ?? new Vector(0, 0);\r\n    v.x = this.x;\r\n    v.y = this.y;\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n *\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n", "/* eslint-disable no-console */\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\r\n * Derive from [[Appender]] to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[Appender]] to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Debug]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Info]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Warn]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Error]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Fatal]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  // @todo Clean this up\r\n\r\n  private _messages: string[] = [];\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * @param width   Width of the screen appender in pixels\r\n   * @param height  Height of the screen appender in pixels\r\n   */\r\n  constructor(width?: number, height?: number) {\r\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._canvas.width = width || window.innerWidth;\r\n    this._canvas.height = height || window.innerHeight;\r\n    this._canvas.style.position = 'absolute';\r\n    // eslint-disable-next-line\r\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\r\n    document.body.appendChild(this._canvas);\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n    let opacity = 1.0;\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\r\n      this._ctx.fillText(this._messages[i], 200, pos);\r\n      pos += 10;\r\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\r\n    }\r\n  }\r\n}\r\n", "\r\n/**\r\n * Provides standard colors (e.g. [[Color.Black]])\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   *\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   *\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   *\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   *\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    const hex = c.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(): Color {\r\n    return new Color(this.r, this.g, this.b, this.a);\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction (via dot product)\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n    let max = -Number.MAX_VALUE;\r\n    let maxIndex = -1;\r\n    for (let i = 0; i < directions.length; i++) {\r\n      if (directions[i].dot(direction) > max) {\r\n        max = directions[i].dot(direction);\r\n        maxIndex = i;\r\n      }\r\n    }\r\n    return directionEnum[maxIndex];\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { Ray } from '../Math/ray';\r\nimport { Color } from '../Color';\r\nimport { Side } from './Side';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface BoundingBoxOptions {\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  bottom: number;\r\n}\r\n\r\n/**\r\n * Axis Aligned collision primitive for Excalibur.\r\n */\r\nexport class BoundingBox {\r\n  public top: number;\r\n  public right: number;\r\n  public bottom: number;\r\n  public left: number;\r\n\r\n  /**\r\n   * Constructor allows passing of either an object with all coordinate components,\r\n   * or the coordinate components passed separately.\r\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\r\n   * containing the four coordinate components.\r\n   * @param top     y coordinate of the top edge\r\n   * @param right   x coordinate of the right edge\r\n   * @param bottom  y coordinate of the bottom edge\r\n   */\r\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n    if (typeof leftOrOptions === 'object') {\r\n      this.left = leftOrOptions.left;\r\n      this.top = leftOrOptions.top;\r\n      this.right = leftOrOptions.right;\r\n      this.bottom = leftOrOptions.bottom;\r\n    } else if (typeof leftOrOptions === 'number') {\r\n      this.left = leftOrOptions;\r\n      this.top = top;\r\n      this.right = right;\r\n      this.bottom = bottom;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of [[BoundingBox]] that is a copy of the current instance\r\n   */\r\n  public clone(): BoundingBox {\r\n    return new BoundingBox(this.left, this.top, this.right, this.bottom);\r\n  }\r\n\r\n  /**\r\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\r\n   * @param intersection Intersection vector between 2 bounding boxes\r\n   */\r\n  public static getSideFromIntersection(intersection: Vector): Side {\r\n    if (!intersection) {\r\n      return Side.None;\r\n    }\r\n    if (intersection) {\r\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\r\n        if (intersection.x < 0) {\r\n          return Side.Right;\r\n        }\r\n        return Side.Left;\r\n      } else {\r\n        if (intersection.y < 0) {\r\n          return Side.Bottom;\r\n        }\r\n        return Side.Top;\r\n      }\r\n    }\r\n    return Side.None;\r\n  }\r\n\r\n  public static fromPoints(points: Vector[]): BoundingBox {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (let i = 0; i < points.length; i++) {\r\n      if (points[i].x < minX) {\r\n        minX = points[i].x;\r\n      }\r\n      if (points[i].x > maxX) {\r\n        maxX = points[i].x;\r\n      }\r\n      if (points[i].y < minY) {\r\n        minY = points[i].y;\r\n      }\r\n      if (points[i].y > maxY) {\r\n        maxY = points[i].y;\r\n      }\r\n    }\r\n    return new BoundingBox(minX, minY, maxX, maxY);\r\n  }\r\n\r\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\r\n    return new BoundingBox(\r\n      -width * anchor.x + pos.x,\r\n      -height * anchor.y + pos.y,\r\n      width - width * anchor.x + pos.x,\r\n      height - height * anchor.y + pos.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated width of the bounding box\r\n   */\r\n  public get width() {\r\n    return this.right - this.left;\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated height of the bounding box\r\n   */\r\n  public get height() {\r\n    return this.bottom - this.top;\r\n  }\r\n\r\n  /**\r\n   * Return whether the bounding box has zero dimensions in height,width or both\r\n   */\r\n  public hasZeroDimensions() {\r\n    return this.width === 0 || this.height === 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the bounding box\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\r\n  }\r\n\r\n  public translate(pos: Vector): BoundingBox {\r\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\r\n  }\r\n\r\n  /**\r\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\r\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\r\n   */\r\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\r\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  /**\r\n   * Scale a bounding box by a scale factor, optionally provide a point\r\n   * @param scale\r\n   * @param point\r\n   */\r\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\r\n    const shifted = this.translate(point);\r\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\r\n  }\r\n\r\n  /**\r\n   * Transform the axis aligned bounding box by a [[Matrix]], producing a new axis aligned bounding box\r\n   * @param matrix\r\n   */\r\n  public transform(matrix: AffineMatrix) {\r\n    // inlined these calculations to not use vectors would speed it up slightly\r\n    // const matFirstColumn = vec(matrix.data[0], matrix.data[1]);\r\n    // const xa = matFirstColumn.scale(this.left);\r\n    const xa1 = matrix.data[0] * this.left;\r\n    const xa2 = matrix.data[1] * this.left;\r\n\r\n    // const xb = matFirstColumn.scale(this.right);\r\n    const xb1 = matrix.data[0] * this.right;\r\n    const xb2 = matrix.data[1] * this.right;\r\n\r\n    // const matSecondColumn = vec(matrix.data[2], matrix.data[3]);\r\n    // const ya = matSecondColumn.scale(this.top);\r\n    const ya1 = matrix.data[2] * this.top;\r\n    const ya2 = matrix.data[3] * this.top;\r\n\r\n    // const yb = matSecondColumn.scale(this.bottom);\r\n    const yb1 = matrix.data[2] * this.bottom;\r\n    const yb2 = matrix.data[3] * this.bottom;\r\n\r\n    const matrixPos = matrix.getPosition();\r\n    // const topLeft = Vector.min(xa, xb).add(Vector.min(ya, yb)).add(matrixPos);\r\n    // const bottomRight = Vector.max(xa, xb).add(Vector.max(ya, yb)).add(matrixPos);\r\n    const left = Math.min(xa1, xb1) + Math.min(ya1, yb1) + matrixPos.x;\r\n    const top = Math.min(xa2, xb2) + Math.min(ya2, yb2) + matrixPos.y;\r\n    const right = Math.max(xa1, xb1) + Math.max(ya1, yb1) + matrixPos.x;\r\n    const bottom = Math.max(xa2, xb2) + Math.max(ya2, yb2) + matrixPos.y;\r\n\r\n    return new BoundingBox({\r\n      left,//: topLeft.x,\r\n      top,//: topLeft.y,\r\n      right,//: bottomRight.x,\r\n      bottom//: bottomRight.y\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the perimeter of the bounding box\r\n   */\r\n  public getPerimeter(): number {\r\n    const wx = this.width;\r\n    const wy = this.height;\r\n    return 2 * (wx + wy);\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    const results = [];\r\n    results.push(new Vector(this.left, this.top));\r\n    results.push(new Vector(this.right, this.top));\r\n    results.push(new Vector(this.right, this.bottom));\r\n    results.push(new Vector(this.left, this.bottom));\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Determines whether a ray intersects with a bounding box\r\n   */\r\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tmin = -Infinity;\r\n    let tmax = +Infinity;\r\n\r\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xinv;\r\n    const tx2 = (this.right - ray.pos.x) * xinv;\r\n    tmin = Math.min(tx1, tx2);\r\n    tmax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yinv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\r\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\r\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\r\n\r\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\r\n  }\r\n\r\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tmin = -Infinity;\r\n    let tmax = +Infinity;\r\n\r\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xinv;\r\n    const tx2 = (this.right - ray.pos.x) * xinv;\r\n    tmin = Math.min(tx1, tx2);\r\n    tmax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yinv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\r\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\r\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\r\n\r\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\r\n      return tmin;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a point is contained within the bounding box\r\n   * @param p  The point to test\r\n   */\r\n  public contains(p: Vector): boolean;\r\n\r\n  /**\r\n   * Tests whether another bounding box is totally contained in this one\r\n   * @param bb  The bounding box to test\r\n   */\r\n  public contains(bb: BoundingBox): boolean;\r\n  public contains(val: any): boolean {\r\n    if (val instanceof Vector) {\r\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\r\n    } else if (val instanceof BoundingBox) {\r\n      if (this.left <= val.left && this.top <= val.top && val.bottom <= this.bottom && val.right <= this.right) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Combines this bounding box and another together returning a new bounding box\r\n   * @param other  The bounding box to combine\r\n   */\r\n  public combine(other: BoundingBox): BoundingBox {\r\n    const compositeBB = new BoundingBox(\r\n      Math.min(this.left, other.left),\r\n      Math.min(this.top, other.top),\r\n      Math.max(this.right, other.right),\r\n      Math.max(this.bottom, other.bottom)\r\n    );\r\n    return compositeBB;\r\n  }\r\n\r\n  public get dimensions(): Vector {\r\n    return new Vector(this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the bounding boxes overlap.\r\n   * @param other\r\n   * @param epsilon Optionally specify a small epsilon (default 0) as amount of overlap to ignore as overlap.\r\n   * This epsilon is useful in stable collision simulations.\r\n   */\r\n  public overlaps(other: BoundingBox, epsilon?: number): boolean {\r\n    const e = epsilon || 0;\r\n    if (other.hasZeroDimensions()){\r\n      return this.contains(other);\r\n    }\r\n    if (this.hasZeroDimensions()) {\r\n      return other.contains(this);\r\n    }\r\n    const totalBoundingBox = this.combine(other);\r\n    return totalBoundingBox.width + e < other.width + this.width &&\r\n           totalBoundingBox.height + e < other.height + this.height;\r\n  }\r\n\r\n  /**\r\n   * Test wether this bounding box intersects with another returning\r\n   * the intersection vector that can be used to resolve the collision. If there\r\n   * is no intersection null is returned.\r\n   *\r\n   * @param other  Other [[BoundingBox]] to test intersection with\r\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\r\n   */\r\n  public intersect(other: BoundingBox): Vector {\r\n    const totalBoundingBox = this.combine(other);\r\n\r\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\r\n    if (\r\n      totalBoundingBox.width < other.width + this.width &&\r\n      totalBoundingBox.height < other.height + this.height &&\r\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\r\n      !totalBoundingBox.dimensions.equals(this.dimensions)\r\n    ) {\r\n      // collision\r\n      let overlapX = 0;\r\n      // right edge is between the other's left and right edge\r\n      /**\r\n       *     +-this-+\r\n       *     |      |\r\n       *     |    +-other-+\r\n       *     +----|-+     |\r\n       *          |       |\r\n       *          +-------+\r\n       *         <---\r\n       *          ^ overlap\r\n       */\r\n      if (this.right >= other.left && this.right <= other.right) {\r\n        overlapX = other.left - this.right;\r\n        // right edge is past the other's right edge\r\n        /**\r\n         *     +-other-+\r\n         *     |       |\r\n         *     |    +-this-+\r\n         *     +----|--+   |\r\n         *          |      |\r\n         *          +------+\r\n         *          --->\r\n         *          ^ overlap\r\n         */\r\n      } else {\r\n        overlapX = other.right - this.left;\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // top edge is between the other's top and bottom edge\r\n      /**\r\n       *     +-other-+\r\n       *     |       |\r\n       *     |    +-this-+   | <- overlap\r\n       *     +----|--+   |   |\r\n       *          |      |  \\ /\r\n       *          +------+   '\r\n       */\r\n      if (this.top <= other.bottom && this.top >= other.top) {\r\n        overlapY = other.bottom - this.top;\r\n        // top edge is above the other top edge\r\n        /**\r\n         *     +-this-+         .\r\n         *     |      |        / \\\r\n         *     |    +-other-+   | <- overlap\r\n         *     +----|-+     |   |\r\n         *          |       |\r\n         *          +-------+\r\n         */\r\n      } else {\r\n        overlapY = other.top - this.bottom;\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n      // Case of total containment of one bounding box by another\r\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\r\n      let overlapX = 0;\r\n      // this is wider than the other\r\n      if (this.width - other.width >= 0) {\r\n        // This right edge is closest to the others right edge\r\n        if (this.right - other.right <= other.left - this.left) {\r\n          overlapX = other.left - this.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = other.right - this.left;\r\n        }\r\n        // other is wider than this\r\n      } else {\r\n        // This right edge is closest to the others right edge\r\n        if (other.right - this.right <= this.left - other.left) {\r\n          overlapX = this.left - other.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = this.right - other.left;\r\n        }\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // this is taller than other\r\n      if (this.height - other.height >= 0) {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (this.bottom - other.bottom <= other.top - this.top) {\r\n          overlapY = other.top - this.bottom;\r\n        } else {\r\n          overlapY = other.bottom - this.top;\r\n        }\r\n        // other is taller than this\r\n      } else {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (other.bottom - this.bottom <= this.top - other.top) {\r\n          overlapY = this.top - other.bottom;\r\n        } else {\r\n          overlapY = this.bottom - other.top;\r\n        }\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\r\n   * @param bb The other actor to test\r\n   */\r\n  public intersectWithSide(bb: BoundingBox): Side {\r\n    const intersect = this.intersect(bb);\r\n    return BoundingBox.getSideFromIntersection(intersect);\r\n  }\r\n\r\n  /**\r\n   * Draw a debug bounding box\r\n   * @param ex\r\n   * @param color\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\r\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\r\n  }\r\n}\r\n", "\r\n/**\r\n * Future is a wrapper around a native browser Promise to allow resolving/rejecting at any time\r\n */\r\nexport class Future<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _resolver: (value: T) => void;\r\n  private _rejecter: (error: Error) => void;\r\n  private _isCompleted: boolean = false;\r\n\r\n  constructor() {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this._resolver = resolve;\r\n      this._rejecter = reject;\r\n    });\r\n  }\r\n\r\n  public readonly promise: Promise<T>;\r\n\r\n  public get isCompleted(): boolean {\r\n    return this._isCompleted;\r\n  }\r\n\r\n  public resolve(value: T): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._resolver(value);\r\n  }\r\n\r\n  public reject(error: Error): void {\r\n    if (this._isCompleted) {\r\n      return;\r\n    }\r\n    this._isCompleted = true;\r\n    this._rejecter(error);\r\n  }\r\n}", "import { Vector } from '../Math/vector';\r\nimport { Clock } from './Clock';\r\nimport { Future } from './Future';\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  let oLeft: number = 0,\r\n    oTop: number = 0;\r\n\r\n  const calcOffsetLeft = (parent: HTMLElement) => {\r\n    oLeft += parent.offsetLeft;\r\n\r\n    if (parent.offsetParent) {\r\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n  const calcOffsetTop = (parent: HTMLElement) => {\r\n    oTop += parent.offsetTop;\r\n    if (parent.offsetParent) {\r\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n\r\n  calcOffsetLeft(el);\r\n  calcOffsetTop(el);\r\n\r\n  return new Vector(oLeft, oTop);\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n *\r\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\r\n * excalibur clock which would be unaffected by stop/pause.\r\n * @param milliseconds\r\n * @param clock\r\n */\r\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\r\n  const future = new Future<void>();\r\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\r\n  schedule(() => {\r\n    future.resolve();\r\n  }, milliseconds);\r\n  return future.promise;\r\n}\r\n", "import { sign } from './util';\r\nimport { Vector, vec } from './vector';\r\nimport { canonicalizeAngle } from './util';\r\n\r\nexport enum MatrixLocations {\r\n  X = 12,\r\n  Y = 13\r\n}\r\n\r\n/**\r\n * Excalibur Matrix helper for 4x4 matrices\r\n *\r\n * Useful for webgl 4x4 matrices\r\n */\r\nexport class Matrix {\r\n  /**\r\n   *  4x4 matrix in column major order\r\n   *\r\n   * |         |         |          |          |\r\n   * | ------- | ------- | -------- | -------- |\r\n   * | data[0] | data[4] | data[8]  | data[12] |\r\n   * | data[1] | data[5] | data[9]  | data[13] |\r\n   * | data[2] | data[6] | data[10] | data[14] |\r\n   * | data[3] | data[7] | data[11] | data[15] |\r\n   *\r\n   */\r\n  public data: Float32Array = new Float32Array(16);\r\n\r\n  /**\r\n   * Creates an orthographic (flat non-perspective) projection\r\n   * https://en.wikipedia.org/wiki/Orthographic_projection\r\n   * @param left\r\n   * @param right\r\n   * @param bottom\r\n   * @param top\r\n   * @param near\r\n   * @param far\r\n   */\r\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 2 / (right - left);\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 2 / (top - bottom);\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = -2 / (far - near);\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = -(right + left) / (right - left);\r\n    mat.data[13] = -(top + bottom) / (top - bottom);\r\n    mat.data[14] = -(far + near) / (far - near);\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current 4x4\r\n   */\r\n  public clone(dest?: Matrix): Matrix {\r\n    const mat = dest || new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat.data[6] = this.data[6];\r\n    mat.data[7] = this.data[7];\r\n\r\n    mat.data[8] = this.data[8];\r\n    mat.data[9] = this.data[9];\r\n    mat.data[10] = this.data[10];\r\n    mat.data[11] = this.data[11];\r\n\r\n    mat.data[12] = this.data[12];\r\n    mat.data[13] = this.data[13];\r\n    mat.data[14] = this.data[14];\r\n    mat.data[15] = this.data[15];\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static fromFloat32Array(data: Float32Array) {\r\n    const matrix =  new Matrix();\r\n    matrix.data = data;\r\n    return matrix;\r\n  }\r\n\r\n  /**\r\n   * Creates a new identity matrix (a matrix that when applied does nothing)\r\n   */\r\n  public static identity(): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {Matrix} Current matrix as identity\r\n   */\r\n  public reset(): Matrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[12] = x;\r\n    mat.data[13] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[5] = sy;\r\n    mat.data[10] = 1;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle\r\n   * @param angleRadians\r\n   */\r\n  public static rotation(angleRadians: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = Math.cos(angleRadians);\r\n    mat.data[4] = -Math.sin(angleRadians);\r\n    mat.data[1] = Math.sin(angleRadians);\r\n    mat.data[5] = Math.cos(angleRadians);\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: Matrix, dest?: Matrix): Matrix;\r\n  multiply(vectorOrMatrix: Vector | Matrix, dest?: Vector | Matrix): Vector | Matrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[4] + this.data[12];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[5] + this.data[13];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as Matrix) || new Matrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      const a31 = this.data[2];\r\n      const a41 = this.data[3];\r\n\r\n      const a12 = this.data[4];\r\n      const a22 = this.data[5];\r\n      const a32 = this.data[6];\r\n      const a42 = this.data[7];\r\n\r\n      const a13 = this.data[8];\r\n      const a23 = this.data[9];\r\n      const a33 = this.data[10];\r\n      const a43 = this.data[11];\r\n\r\n      const a14 = this.data[12];\r\n      const a24 = this.data[13];\r\n      const a34 = this.data[14];\r\n      const a44 = this.data[15];\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      const b31 = other.data[2];\r\n      const b41 = other.data[3];\r\n\r\n      const b12 = other.data[4];\r\n      const b22 = other.data[5];\r\n      const b32 = other.data[6];\r\n      const b42 = other.data[7];\r\n\r\n      const b13 = other.data[8];\r\n      const b23 = other.data[9];\r\n      const b33 = other.data[10];\r\n      const b43 = other.data[11];\r\n\r\n      const b14 = other.data[12];\r\n      const b24 = other.data[13];\r\n      const b34 = other.data[14];\r\n      const b44 = other.data[15];\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n      result.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n      result.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n      result.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\r\n      result.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n      result.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n      result.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n      result.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\r\n      result.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n      result.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n      result.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n      result.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\r\n      result.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n      result.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n      result.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n      result.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n      const s = this.getScale();\r\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\r\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const a13 = this.data[8];\r\n    const a23 = this.data[9];\r\n    const a33 = this.data[10];\r\n    const a43 = this.data[11];\r\n\r\n    const a14 = this.data[12];\r\n    const a24 = this.data[13];\r\n    const a34 = this.data[14];\r\n    const a44 = this.data[15];\r\n\r\n    // Doesn't change z\r\n    const z = 0;\r\n    const w = 1;\r\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\r\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\r\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\r\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[12] = x;\r\n    this.data[13] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[12], this.data[13]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n    this.data[2] = cosine * a31 + sine * a32;\r\n    this.data[3] = cosine * a41 + sine * a42;\r\n\r\n    this.data[4] = cosine * a12 - sine * a11;\r\n    this.data[5] = cosine * a22 - sine * a21;\r\n    this.data[6] = cosine * a32 - sine * a31;\r\n    this.data[7] = cosine * a42 - sine * a41;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n    this.data[2] = a31 * x;\r\n    this.data[3] = a41 * x;\r\n\r\n    this.data[4] = a12 * y;\r\n    this.data[5] = a22 * y;\r\n    this.data[6] = a32 * y;\r\n    this.data[7] = a42 * y;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[4] = -sine * currentScale.x;\r\n    this.data[5] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xscale = vec(this.data[0], this.data[4]).size;\r\n    return this._scaleSignX * xscale;\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yscale = vec(this.data[1], this.data[5]).size;\r\n    return this._scaleSignY * yscale;\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scaleX = 1;\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (this._scaleX === val) {\r\n      return;\r\n    }\r\n\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[4] = xscale.y * val;\r\n    this._scaleX = val;\r\n  }\r\n\r\n  private _scaleY = 1;\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (this._scaleY === val) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[5] = yscale.y * val;\r\n    this._scaleY = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  /**\r\n   * Determinant of the upper left 2x2 matrix\r\n   */\r\n  public getBasisDeterminant() {\r\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public getAffineInverse(target?: Matrix): Matrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.getBasisDeterminant();\r\n    const inverseDet = 1 / det; // todo zero check\r\n    const a = this.data[0];\r\n    const b = this.data[4];\r\n    const c = this.data[1];\r\n    const d = this.data[5];\r\n\r\n    const m = target || Matrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[4] = -b * inverseDet;\r\n    m.data[5] = a * inverseDet;\r\n\r\n    const tx = this.data[12];\r\n    const ty = this.data[13];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\r\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\r\n\r\n    return m;\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return (\r\n      this.data[0] === 1 &&\r\n      this.data[1] === 0 &&\r\n      this.data[2] === 0 &&\r\n      this.data[3] === 0 &&\r\n      this.data[4] === 0 &&\r\n      this.data[5] === 1 &&\r\n      this.data[6] === 0 &&\r\n      this.data[7] === 0 &&\r\n      this.data[8] === 0 &&\r\n      this.data[9] === 0 &&\r\n      this.data[10] === 1 &&\r\n      this.data[11] === 0 &&\r\n      this.data[12] === 0 &&\r\n      this.data[13] === 0 &&\r\n      this.data[14] === 0 &&\r\n      this.data[15] === 1\r\n    );\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\r\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\r\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\r\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\r\n`;\r\n  }\r\n}\r\n", "import { Matrix } from './matrix';\r\nimport { canonicalizeAngle, sign } from './util';\r\nimport { vec, Vector } from './vector';\r\n\r\n\r\nexport class AffineMatrix {\r\n  /**\r\n   * |         |         |          |\r\n   * | ------- | ------- | -------- |\r\n   * | data[0] | data[2] | data[4]  |\r\n   * | data[1] | data[3] | data[5]  |\r\n   * |   0     |    0    |    1     |\r\n   */\r\n  public data = new Float64Array(6);\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  public static identity(): AffineMatrix {\r\n    const mat = new AffineMatrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[4] = x;\r\n    mat.data[5] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[3] = sy;\r\n    mat._scale[0] = sx;\r\n    mat._scale[1] = sy;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle\r\n   * @param angleRadians\r\n   */\r\n  public static rotation(angleRadians: number): AffineMatrix {\r\n    const mat = AffineMatrix.identity();\r\n    mat.data[0] = Math.cos(angleRadians);\r\n    mat.data[1] = Math.sin(angleRadians);\r\n    mat.data[2] = -Math.sin(angleRadians);\r\n    mat.data[3] = Math.cos(angleRadians);\r\n    return mat;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[4] = x;\r\n    this.data[5] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[4], this.data[5]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n\r\n    this.data[2] = cosine * a12 - sine * a11;\r\n    this.data[3] = cosine * a22 - sine * a21;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    // const a31 = 0;\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n    // const a32 = 0;\r\n\r\n    const a13 = this.data[4];\r\n    const a23 = this.data[5];\r\n    // const a33 = 1;\r\n\r\n    // Doesn't change z\r\n    this.data[4] = a11 * x + a12 * y + a13;\r\n    this.data[5] = a21 * x + a22 * y + a23;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n\r\n    const a12 = this.data[2];\r\n    const a22 = this.data[3];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n\r\n    this.data[2] = a12 * y;\r\n    this.data[3] = a22 * y;\r\n\r\n    this._scale[0] = x;\r\n    this._scale[1] = y;\r\n    return this;\r\n  }\r\n\r\n  public determinant() {\r\n    return this.data[0] * this.data[3] - this.data[1] * this.data[2];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public inverse(target?: AffineMatrix): AffineMatrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.determinant();\r\n    const inverseDet = 1 / det; // TODO zero check\r\n    const a = this.data[0];\r\n    const b = this.data[2];\r\n    const c = this.data[1];\r\n    const d = this.data[3];\r\n\r\n    const m = target || AffineMatrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[2] = -b * inverseDet;\r\n    m.data[3] = a * inverseDet;\r\n\r\n    const tx = this.data[4];\r\n    const ty = this.data[5];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[4] = -(tx * m.data[0] + ty * m.data[2]);\r\n    m.data[5] = -(tx * m.data[1] + ty * m.data[3]);\r\n\r\n    return m;\r\n  }\r\n\r\n  /**\r\n   * Multiply the current matrix by a vector producing a new vector\r\n   * @param vector\r\n   * @param dest\r\n   */\r\n  multiply(vector: Vector, dest?: Vector): Vector;\r\n  /**\r\n   * Multiply the current matrix by another matrix producing a new matrix\r\n   * @param matrix\r\n   * @param dest\r\n   */\r\n  multiply(matrix: AffineMatrix, dest?: AffineMatrix): AffineMatrix;\r\n  multiply(vectorOrMatrix: Vector | AffineMatrix, dest?: Vector | AffineMatrix): Vector | AffineMatrix {\r\n    if (vectorOrMatrix instanceof Vector) {\r\n      const result = (dest as Vector) || new Vector(0, 0);\r\n      const vector = vectorOrMatrix;\r\n      // these shenanigans are to allow dest and vector to be the same instance\r\n      const resultX = vector.x * this.data[0] + vector.y * this.data[2] + this.data[4];\r\n      const resultY = vector.x * this.data[1] + vector.y * this.data[3] + this.data[5];\r\n\r\n      result.x = resultX;\r\n      result.y = resultY;\r\n      return result;\r\n    } else {\r\n      const result = (dest as AffineMatrix) || new AffineMatrix();\r\n      const other = vectorOrMatrix;\r\n      const a11 = this.data[0];\r\n      const a21 = this.data[1];\r\n      //  const a31 = 0;\r\n\r\n      const a12 = this.data[2];\r\n      const a22 = this.data[3];\r\n      //  const a32 = 0;\r\n\r\n      const a13 = this.data[4];\r\n      const a23 = this.data[5];\r\n      //  const a33 = 1;\r\n\r\n      const b11 = other.data[0];\r\n      const b21 = other.data[1];\r\n      //  const b31 = 0;\r\n\r\n      const b12 = other.data[2];\r\n      const b22 = other.data[3];\r\n      //  const b32 = 0;\r\n\r\n      const b13 = other.data[4];\r\n      const b23 = other.data[5];\r\n      //  const b33 = 1;\r\n\r\n\r\n      result.data[0] = a11 * b11 + a12 * b21;// + a13 * b31; // zero\r\n      result.data[1] = a21 * b11 + a22 * b21;// + a23 * b31; // zero\r\n\r\n      result.data[2] = a11 * b12 + a12 * b22;// + a13 * b32; // zero\r\n      result.data[3] = a21 * b12 + a22 * b22;// + a23 * b32; // zero\r\n\r\n      result.data[4] = a11 * b13 + a12 * b23 + a13;// * b33; // one\r\n      result.data[5] = a21 * b13 + a22 * b23 + a23;// * b33; // one\r\n\r\n      const s = this.getScale();\r\n      result._scaleSignX = sign(s.x) * sign(result._scaleSignX);\r\n      result._scaleSignY = sign(s.y) * sign(result._scaleSignY);\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  to4x4() {\r\n    const mat = new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = this.data[2];\r\n    mat.data[5] = this.data[3];\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = this.data[4];\r\n    mat.data[13] = this.data[5];\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[2] = -sine * currentScale.x;\r\n    this.data[3] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xscale = vec(this.data[0], this.data[2]).distance();\r\n    return this._scaleSignX * xscale;\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yscale = vec(this.data[1], this.data[3]).distance();\r\n    return this._scaleSignY * yscale;\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scale = new Float64Array([1, 1]);\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    if (val === this._scale[0]) {\r\n      return;\r\n    }\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[2] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[2] = xscale.y * val;\r\n    this._scale[0] = val;\r\n  }\r\n\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    if (val === this._scale[1]) {\r\n      return;\r\n    }\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[3] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[3] = yscale.y * val;\r\n    this._scale[1] = val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return (\r\n      this.data[0] === 1 &&\r\n      this.data[1] === 0 &&\r\n      this.data[2] === 0 &&\r\n      this.data[3] === 1 &&\r\n      this.data[4] === 0 &&\r\n      this.data[5] === 0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {AffineMatrix} Current matrix as identity\r\n   */\r\n  public reset(): AffineMatrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 1;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 0;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current 4x4\r\n   */\r\n  public clone(dest?: AffineMatrix): AffineMatrix {\r\n    const mat = dest || new AffineMatrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    return mat;\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[2]} ${this.data[4]}]\r\n[${this.data[1]} ${this.data[3]} ${this.data[5]}]\r\n[0 0 1]\r\n`;\r\n  }\r\n\r\n}", "import { AffineMatrix } from '../../Math/affine-matrix';\r\n\r\nexport class TransformStack {\r\n  private _transforms: AffineMatrix[] = [];\r\n  private _currentTransform: AffineMatrix = AffineMatrix.identity();\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentTransform = this._transforms.pop();\r\n  }\r\n\r\n  public translate(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): AffineMatrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): AffineMatrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public set current(matrix: AffineMatrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): AffineMatrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n", "import { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class StateStack {\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\r\n\r\n  private _getDefaultState() {\r\n    return {\r\n      opacity: 1,\r\n      z: 0,\r\n      tint: Color.White\r\n    };\r\n  }\r\n\r\n  private _cloneState() {\r\n    return {\r\n      opacity: this._currentState.opacity,\r\n      z: this._currentState.z,\r\n      tint: this._currentState.tint.clone()\r\n    };\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this._currentState);\r\n    this._currentState = this._cloneState();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentState = this._states.pop();\r\n  }\r\n\r\n  public get current(): ExcaliburGraphicsContextState {\r\n    return this._currentState;\r\n  }\r\n\r\n  public set current(val: ExcaliburGraphicsContextState) {\r\n    this._currentState = val;\r\n  }\r\n}\r\n", "import { Scene } from './Scene';\r\nimport { Vector } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { Trigger } from './Trigger';\r\nimport { FrameStats } from './Debug';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Side } from './Collision/Side';\r\nimport * as Input from './Input/Index';\r\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\r\nimport { Collider } from './Collision/Colliders/Collider';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate, SceneActivationContext } from './Interfaces/LifecycleEvents';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\n\r\nexport enum EventTypes {\r\n  Kill = 'kill',\r\n  PreKill = 'prekill',\r\n  PostKill = 'postkill',\r\n\r\n  PreDraw = 'predraw',\r\n  PostDraw = 'postdraw',\r\n\r\n  PreDebugDraw = 'predebugdraw',\r\n  PostDebugDraw = 'postdebugdraw',\r\n\r\n  PreUpdate = 'preupdate',\r\n  PostUpdate = 'postupdate',\r\n\r\n  PreFrame = 'preframe',\r\n  PostFrame = 'postframe',\r\n\r\n  PreCollision = 'precollision',\r\n  CollisionStart = 'collisionstart',\r\n  CollisionEnd = 'collisionend',\r\n  PostCollision = 'postcollision',\r\n\r\n  Initialize = 'initialize',\r\n  Activate = 'activate',\r\n  Deactivate = 'deactivate',\r\n\r\n  ExitViewport = 'exitviewport',\r\n  EnterViewport = 'enterviewport',\r\n\r\n  ExitTrigger = 'exit',\r\n  EnterTrigger = 'enter',\r\n\r\n  Connect = 'connect',\r\n  Disconnect = 'disconnect',\r\n  Button = 'button',\r\n  Axis = 'axis',\r\n\r\n  Visible = 'visible',\r\n  Hidden = 'hidden',\r\n  Start = 'start',\r\n  Stop = 'stop',\r\n\r\n  PointerUp = 'pointerup',\r\n  PointerDown = 'pointerdown',\r\n  PointerMove = 'pointermove',\r\n  PointerEnter = 'pointerenter',\r\n  PointerLeave = 'pointerleave',\r\n  PointerCancel = 'pointercancel',\r\n  PointerWheel = 'pointerwheel',\r\n\r\n  Up = 'up',\r\n  Down = 'down',\r\n  Move = 'move',\r\n  Enter = 'enter',\r\n  Leave = 'leave',\r\n  Cancel = 'cancel',\r\n  Wheel = 'wheel',\r\n\r\n  Press = 'press',\r\n  Release = 'release',\r\n  Hold = 'hold',\r\n\r\n  PointerDragStart = 'pointerdragstart',\r\n  PointerDragEnd = 'pointerdragend',\r\n  PointerDragEnter = 'pointerdragenter',\r\n  PointerDragLeave = 'pointerdragleave',\r\n  PointerDragMove = 'pointerdragmove'\r\n}\r\n\r\n/* istanbul ignore next */\r\n/* compiler only: these are internal to lib */\r\nexport type kill = 'kill';\r\nexport type prekill = 'prekill';\r\nexport type postkill = 'postkill';\r\n\r\nexport type predraw = 'predraw';\r\nexport type postdraw = 'postdraw';\r\n\r\nexport type predebugdraw = 'predebugdraw';\r\nexport type postdebugdraw = 'postdebugdraw';\r\n\r\nexport type preupdate = 'preupdate';\r\nexport type postupdate = 'postupdate';\r\n\r\nexport type preframe = 'preframe';\r\nexport type postframe = 'postframe';\r\n\r\nexport type precollision = 'precollision';\r\nexport type collisionstart = 'collisionstart';\r\nexport type collisionend = 'collisionend';\r\nexport type postcollision = 'postcollision';\r\n\r\nexport type initialize = 'initialize';\r\nexport type activate = 'activate';\r\nexport type deactivate = 'deactivate';\r\n\r\nexport type exitviewport = 'exitviewport';\r\nexport type enterviewport = 'enterviewport';\r\n\r\nexport type exittrigger = 'exit';\r\nexport type entertrigger = 'enter';\r\n\r\nexport type connect = 'connect';\r\nexport type disconnect = 'disconnect';\r\nexport type button = 'button';\r\nexport type axis = 'axis';\r\n\r\nexport type subscribe = 'subscribe';\r\nexport type unsubscribe = 'unsubscribe';\r\n\r\nexport type visible = 'visible';\r\nexport type hidden = 'hidden';\r\nexport type start = 'start';\r\nexport type stop = 'stop';\r\n\r\nexport type pointerup = 'pointerup';\r\nexport type pointerdown = 'pointerdown';\r\nexport type pointermove = 'pointermove';\r\nexport type pointerenter = 'pointerenter';\r\nexport type pointerleave = 'pointerleave';\r\nexport type pointercancel = 'pointercancel';\r\nexport type pointerwheel = 'pointerwheel';\r\n\r\nexport type up = 'up';\r\nexport type down = 'down';\r\nexport type move = 'move';\r\nexport type enter = 'enter';\r\nexport type leave = 'leave';\r\nexport type cancel = 'cancel';\r\nexport type wheel = 'wheel';\r\n\r\nexport type press = 'press';\r\nexport type release = 'release';\r\nexport type hold = 'hold';\r\n\r\nexport type pointerdragstart = 'pointerdragstart';\r\nexport type pointerdragend = 'pointerdragend';\r\nexport type pointerdragenter = 'pointerdragenter';\r\nexport type pointerdragleave = 'pointerdragleave';\r\nexport type pointerdragmove = 'pointerdragmove';\r\n\r\n/**\r\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\r\n * some events are unique to a type, others are not.\r\n *\r\n */\r\nexport class GameEvent<T, U = T> {\r\n  /**\r\n   * Target object for this event.\r\n   */\r\n  public target: T;\r\n\r\n  /**\r\n   * Other target object for this event\r\n   */\r\n  public other: U | null;\r\n\r\n  /**\r\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\r\n   * to all actors that apply.\r\n   */\r\n  public get bubbles(): boolean {\r\n    return this._bubbles;\r\n  }\r\n\r\n  public set bubbles(value: boolean) {\r\n    this._bubbles = value;\r\n  }\r\n\r\n  private _bubbles: boolean = true;\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation() {\r\n    this.bubbles = false;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\r\n */\r\nexport class KillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'prekill' event is emitted directly before an actor is killed.\r\n */\r\nexport class PreKillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postkill' event is emitted directly after the actor is killed.\r\n */\r\nexport class PostKillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'start' event is emitted on engine when has started and is ready for interaction.\r\n */\r\nexport class GameStartEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\r\n */\r\nexport class GameStopEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(public ctx: ExcaliburGraphicsContext, public delta: number, public target: Entity | Scene | Engine | TileMap) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(public ctx: ExcaliburGraphicsContext, public delta: number, public target: Entity | Scene | Engine | TileMap) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\r\n */\r\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(public ctx: ExcaliburGraphicsContext, public target: Entity | Actor | Scene | Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\r\n */\r\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(public ctx: ExcaliburGraphicsContext, public target: Entity | Actor | Scene | Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\r\n */\r\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\r\n  constructor(public engine: Engine, public delta: number, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\r\n */\r\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\r\n  constructor(public engine: Engine, public delta: number, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preframe' event is emitted on the engine, before the frame begins.\r\n */\r\nexport class PreFrameEvent extends GameEvent<Engine> {\r\n  constructor(public engine: Engine, public prevStats: FrameStats) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postframe' event is emitted on the engine, after a frame ends.\r\n */\r\nexport class PostFrameEvent extends GameEvent<Engine> {\r\n  constructor(public engine: Engine, public stats: FrameStats) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\r\n */\r\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\r\n  constructor(public index: number, public gamepad: Input.Gamepad) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\r\n */\r\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\r\n  constructor(public index: number, public gamepad: Input.Gamepad) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\r\n */\r\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\r\n  /**\r\n   * @param button  The Gamepad button\r\n   * @param value   A numeric value between 0 and 1\r\n   */\r\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\r\n */\r\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\r\n  /**\r\n   * @param axis  The Gamepad axis\r\n   * @param value A numeric value between -1 and 1\r\n   */\r\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the [[Engine]] when the browser window is visible on a screen.\r\n */\r\nexport class VisibleEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\r\n */\r\nexport class HiddenEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\r\n */\r\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   * @param actor         The actor the event was thrown on\r\n   * @param other         The actor that will collided with the current actor\r\n   * @param side          The side that will be collided with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\r\n */\r\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   * @param actor         The actor the event was thrown on\r\n   * @param other         The actor that did collide with the current actor\r\n   * @param side          The side that did collide with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\nexport class ContactStartEvent<T> {\r\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\r\n}\r\n\r\nexport class ContactEndEvent<T> {\r\n  constructor(public target: T, public other: T) {}\r\n}\r\n\r\nexport class CollisionPreSolveEvent<T> {\r\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\r\n}\r\n\r\nexport class CollisionPostSolveEvent<T> {\r\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\r\n}\r\n\r\n/**\r\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\r\n */\r\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   * @param actor\r\n   * @param other\r\n   * @param contact\r\n   */\r\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\r\n */\r\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   */\r\n  constructor(actor: T, public other: T) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\r\n */\r\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\r\n  /**\r\n   * @param engine  The reference to the current engine\r\n   */\r\n  constructor(public engine: Engine, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a [[Scene]] on activation\r\n */\r\nexport class ActivateEvent<TData = undefined> extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene activation\r\n   */\r\n  constructor(public context: SceneActivationContext<TData>, public target: Scene) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a [[Scene]] on deactivation\r\n */\r\nexport class DeactivateEvent extends GameEvent<Scene> {\r\n  /**\r\n   * @param context  The context for the scene deactivation\r\n   */\r\n  constructor(public context: SceneActivationContext<never>, public target: Scene) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when it completely leaves the screen.\r\n */\r\nexport class ExitViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public target: Entity) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when it completely leaves the screen.\r\n */\r\nexport class EnterViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public target: Entity) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport class EnterTriggerEvent extends GameEvent<Actor> {\r\n  constructor(public target: Trigger, public actor: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport class ExitTriggerEvent extends GameEvent<Actor> {\r\n  constructor(public target: Trigger, public actor: Actor) {\r\n    super();\r\n  }\r\n}\r\n", "import { GameEvent } from './Events';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\nexport class EventDispatcher<T = any> implements Eventable {\r\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\r\n  private _wiredEventDispatchers: Eventable[] = [];\r\n\r\n  /**\r\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\r\n   */\r\n  public clear() {\r\n    this._handlers = {};\r\n    this._wiredEventDispatchers = [];\r\n  }\r\n\r\n  private _deferedHandlerRemovals: {name: string, handler?: (...args: any[]) => any }[] = [];\r\n  private _processDeferredHandlerRemovals() {\r\n    for (const eventHandler of this._deferedHandlerRemovals) {\r\n      this._removeHandler(eventHandler.name, eventHandler.handler);\r\n    }\r\n    this._deferedHandlerRemovals.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Emits an event for target\r\n   * @param eventName  The name of the event to publish\r\n   * @param event      Optionally pass an event data object to the handler\r\n   */\r\n  public emit(eventName: string, event: GameEvent<T>) {\r\n    this._processDeferredHandlerRemovals();\r\n    if (!eventName) {\r\n      // key not mapped\r\n      return;\r\n    }\r\n    eventName = eventName.toLowerCase();\r\n    if (!event) {\r\n      event = new GameEvent();\r\n    }\r\n    let i: number, len: number;\r\n\r\n    if (this._handlers[eventName]) {\r\n      i = 0;\r\n      len = this._handlers[eventName].length;\r\n      for (i; i < len; i++) {\r\n        this._handlers[eventName][i](event);\r\n      }\r\n    }\r\n\r\n    i = 0;\r\n    len = this._wiredEventDispatchers.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this._wiredEventDispatchers[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\r\n   * @param eventName  The name of the event to subscribe to\r\n   * @param handler    The handler callback to fire on this event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    this._processDeferredHandlerRemovals();\r\n    eventName = eventName.toLowerCase();\r\n\r\n    if (!this._handlers[eventName]) {\r\n      this._handlers[eventName] = [];\r\n    }\r\n    this._handlers[eventName].push(handler);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an event handler(s) from an event. If a specific handler\r\n   * is specified for an event, only that handler will be unsubscribed.\r\n   * Otherwise all handlers will be unsubscribed for that event.\r\n   *\r\n   * @param eventName  The name of the event to unsubscribe\r\n   * @param handler    Optionally the specific handler to unsubscribe\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    this._deferedHandlerRemovals.push({name: eventName, handler});\r\n  }\r\n\r\n  private _removeHandler(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    const eventHandlers = this._handlers[eventName];\r\n\r\n    if (eventHandlers) {\r\n      // if no explicit handler is give with the event name clear all handlers\r\n      if (!handler) {\r\n        this._handlers[eventName].length = 0;\r\n      } else {\r\n        const index = eventHandlers.indexOf(handler);\r\n        if (index > -1) {\r\n          this._handlers[eventName].splice(index, 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    this._processDeferredHandlerRemovals();\r\n    const metaHandler = (event: GameEvent<T>) => {\r\n      const ev = event || new GameEvent();\r\n      this.off(eventName, metaHandler);\r\n      handler(ev);\r\n    };\r\n\r\n    this.on(eventName, metaHandler);\r\n  }\r\n\r\n  /**\r\n   * Wires this event dispatcher to also receive events from another\r\n   */\r\n  public wire(eventDispatcher: EventDispatcher): void {\r\n    eventDispatcher._wiredEventDispatchers.push(this);\r\n  }\r\n\r\n  /**\r\n   * Unwires this event dispatcher from another\r\n   */\r\n  public unwire(eventDispatcher: EventDispatcher): void {\r\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\r\n    if (index > -1) {\r\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n", "import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\n\r\n/**\r\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events: EventDispatcher = new EventDispatcher();\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = true\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n", "/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n", "import { Vector, vec } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { watch } from '../Util/Watch';\r\nimport { AffineMatrix } from '../Math/affine-matrix';\r\n\r\nexport interface GraphicOptions {\r\n  /**\r\n   * The width of the graphic\r\n   */\r\n  width?: number;\r\n  /**\r\n   * The height of the graphic\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Should the graphic be flipped horizontally\r\n   */\r\n  flipHorizontal?: boolean;\r\n  /**\r\n   * Should the graphic be flipped vertically\r\n   */\r\n  flipVertical?: boolean;\r\n  /**\r\n   * The rotation of the graphic\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * The scale of the graphic\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * The opacity of the graphic\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * The tint of the graphic, this color will be multiplied by the original pixel colors\r\n   */\r\n  tint?: Color;\r\n  /**\r\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\r\n   */\r\n  origin?: Vector;\r\n}\r\n\r\n/**\r\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\r\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\r\n * [[Graphic]] abstract class.\r\n *\r\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\r\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\r\n */\r\nexport abstract class Graphic {\r\n  private static _ID: number = 0;\r\n  readonly id = Graphic._ID++;\r\n\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public tint: Color = null;\r\n\r\n  private _transformStale = true;\r\n  public isStale() {\r\n    return this._transformStale;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets wether to show debug information about the graphic\r\n   */\r\n  public showDebug: boolean = false;\r\n\r\n\r\n  private _flipHorizontal = false;\r\n  /**\r\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\r\n   */\r\n  public get flipHorizontal(): boolean {\r\n    return this._flipHorizontal;\r\n  }\r\n\r\n  public set flipHorizontal(value: boolean) {\r\n    this._flipHorizontal = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _flipVertical = false;\r\n  /**\r\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\r\n   */\r\n  public get flipVertical(): boolean {\r\n    return this._flipVertical;\r\n  }\r\n\r\n  public set flipVertical(value: boolean) {\r\n    this._flipVertical = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _rotation = 0;\r\n  /**\r\n   * Gets or sets the rotation of the graphic\r\n   */\r\n  public get rotation(): number {\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(value: number) {\r\n    this._rotation = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _scale = Vector.One;\r\n  /**\r\n   * Gets or sets the scale of the graphic, this affects the width and\r\n   */\r\n  public get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(value: Vector) {\r\n    this._scale = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _origin: Vector | null = null;\r\n  /**\r\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\r\n   */\r\n  public get origin(): Vector | null {\r\n    return this._origin;\r\n  }\r\n\r\n  public set origin(value: Vector | null) {\r\n    this._origin = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  constructor(options?: GraphicOptions) {\r\n    if (options) {\r\n      this.origin = options.origin ?? this.origin;\r\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\r\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\r\n      this.rotation = options.rotation ?? this.rotation;\r\n      this.opacity = options.opacity ?? this.opacity;\r\n      this.scale = options.scale ?? this.scale;\r\n    }\r\n  }\r\n\r\n  public cloneGraphicOptions(): GraphicOptions {\r\n    return {\r\n      origin: this.origin ? this.origin.clone() : null,\r\n      flipHorizontal: this.flipHorizontal,\r\n      flipVertical: this.flipVertical,\r\n      rotation: this.rotation,\r\n      opacity: this.opacity,\r\n      scale: this.scale ? this.scale.clone() : null\r\n    };\r\n  }\r\n\r\n  private _width: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the width of the graphic (always positive)\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._width * this.scale.x);\r\n  }\r\n\r\n  private _height: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the height of the graphic (always positive)\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._height * this.scale.y);\r\n  }\r\n\r\n  public set width(value: number) {\r\n    this._width = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  public set height(value: number) {\r\n    this._height = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Draw the whole graphic to the context including transform\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  /**\r\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\r\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\r\n   * and [[Graphic._postDraw]]\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\r\n\r\n  /**\r\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\r\n   * @param ex\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    ex.save();\r\n    ex.translate(x, y);\r\n    if (this._transformStale) {\r\n      this.transform.reset();\r\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n      this._rotate(this.transform);\r\n      this._flip(this.transform);\r\n      this._transformStale = false;\r\n    }\r\n    ex.multiply(this.transform);\r\n    // it is important to multiply alphas so graphics respect the current context\r\n    ex.opacity = ex.opacity * this.opacity;\r\n    if (this.tint) {\r\n      ex.tint = this.tint;\r\n    }\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ex.scale(scaleDirX, scaleDirY);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext | AffineMatrix) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, this.height / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply any additional work after [[Graphic._drawImage]] and restore the context state.\r\n   * @param ex\r\n   */\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    if (this.showDebug) {\r\n      ex.debug.drawRect(0, 0, this.width, this.height);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of the graphic that has the same properties\r\n   */\r\n  abstract clone(): Graphic;\r\n}\r\n", "import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the [[ImageSource]]\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the [[ImageSource]]\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  private _logger = Logger.getInstance();\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n  private _dirty = true;\r\n\r\n  public static from(image: ImageSource): Sprite {\r\n    return new Sprite({\r\n      image: image\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    return Math.abs(this.destSize.width * this.scale.x);\r\n  }\r\n\r\n  public override get height(): number {\r\n    return Math.abs(this.destSize.height * this.scale.y);\r\n  }\r\n\r\n  public override set width(newWidth: number) {\r\n    newWidth /= Math.abs(this.scale.x);\r\n    this.destSize.width = newWidth;\r\n    super.width = Math.ceil(this.destSize.width);\r\n  }\r\n\r\n  public override set height(newHeight: number) {\r\n    newHeight /= Math.abs(this.scale.y);\r\n    this.destSize.height = newHeight;\r\n    super.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\r\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded() && this._dirty) {\r\n      this._dirty = false;\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  private _logNotLoadedWarning = false;\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    } else {\r\n      if (!this._logNotLoadedWarning) {\r\n        this._logger.warn(\r\n          `ImageSource ${this.image.path}` +\r\n          ` is not yet loaded and won't be drawn. Please call .load() or include in a Loader.\\n\\n` +\r\n          `Read https://excaliburjs.com/docs/imagesource for more information.`\r\n        );\r\n      }\r\n      this._logNotLoadedWarning = true;\r\n    }\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n", "\r\n/**\r\n * Describes the different image filtering modes\r\n */\r\nexport enum ImageFiltering {\r\n\r\n  /**\r\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\r\n   *\r\n   * Useful for Pixel art aesthetics.\r\n   */\r\n  Pixel = 'Pixel',\r\n\r\n  /**\r\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\r\n   */\r\n  Blended = 'Blended'\r\n}", "import { Logger } from '../../Util/Log';\r\nimport { ImageFiltering } from '../Filtering';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _LOGGER = Logger.getInstance();\r\n  /**\r\n   * Sets the default filtering for the Excalibur texture loader, default [[ImageFiltering.Blended]]\r\n   */\r\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\r\n\r\n  private static _GL: WebGLRenderingContext;\r\n\r\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  private static _MAX_TEXTURE_SIZE: number  = 0;\r\n\r\n  public static register(context: WebGLRenderingContext): void {\r\n    TextureLoader._GL = context;\r\n    TextureLoader._MAX_TEXTURE_SIZE = context.getParameter(context.MAX_TEXTURE_SIZE);\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public static get(image: HTMLImageSource): WebGLTexture {\r\n    return TextureLoader._TEXTURE_MAP.get(image);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public static has(image: HTMLImageSource): boolean {\r\n    return TextureLoader._TEXTURE_MAP.has(image);\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param filtering {ImageFiltering} The ImageFiltering mode to apply to the loaded texture\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public static load(image: HTMLImageSource, filtering?: ImageFiltering, forceUpdate = false): WebGLTexture {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n      }\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // NEAREST for pixel art, LINEAR for hi-res\r\n    const filterMode = filtering ?? TextureLoader.filtering;\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\r\n    TextureLoader._TEXTURE_MAP.set(image, tex);\r\n    return tex;\r\n  }\r\n\r\n  public static delete(image: HTMLImageSource): void {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n      gl.deleteTexture(tex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Takes an image and returns if it meets size criteria for hardware\r\n   * @param image\r\n   * @returns if the image will be supported at runtime\r\n   */\r\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\r\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\r\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\r\n      TextureLoader._LOGGER.error(\r\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of `+\r\n        `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image `\r\n        +`for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n`+\r\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\r\n      return false;\r\n    } else if (image.width > 4096 || image.height > 4096) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\r\n      TextureLoader._LOGGER.warn(\r\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, `+\r\n        `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\r\n        `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\r\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\r\n    }\r\n    return true;\r\n  }\r\n}\r\n", "import { Resource } from '../Resources/Resource';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\nimport { TextureLoader } from '.';\r\nimport { ImageFiltering } from './Filtering';\r\nimport { Future } from '../Util/Future';\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n  private _filtering: ImageFiltering;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  private _src: string;\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    if (!this._src) {\r\n      // this boosts speed of access\r\n      this._src = this.data.src;\r\n    }\r\n    return !!this._src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image element\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  private _readyFuture = new Future<HTMLImageElement>();\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement> = this._readyFuture.promise;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param path {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\r\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by [[EngineOptions.antialiasing]]\r\n   */\r\n  constructor(public readonly path: string, bustCache: boolean = false, filtering?: ImageFiltering) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._filtering = filtering;\r\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\r\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      // Use Image.onload over Image.decode()\r\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1055828#c7\r\n      // Otherwise chrome will throw still Image.decode() failures for large textures\r\n      const loadedFuture = new Future<void>();\r\n      image.onload = () => loadedFuture.resolve();\r\n      image.src = url;\r\n      image.setAttribute('data-original-src', this.path);\r\n\r\n      await loadedFuture.promise;\r\n\r\n      // Set results\r\n      this.data = image;\r\n    } catch (error) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    TextureLoader.load(this.data, this._filtering);\r\n    // todo emit complete\r\n    this._readyFuture.resolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(): Sprite {\r\n    return Sprite.from(this);\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n", "import { ImageSource } from './ImageSource';\r\nimport { SourceView, Sprite } from './Sprite';\r\nimport { Logger } from '../Util/Log';\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number, y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: {x?: number, y?: number};\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specify any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetSparseOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * List of source view rectangles to create a sprite sheet from\r\n   */\r\n  sourceViews: SourceView[];\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  private _logger = Logger.getInstance();\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number): Sprite | null {\r\n    if (x >= this.columns || x < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\r\n      return null;\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\r\n      return null;\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    return this.sprites[spriteIndex];\r\n  }\r\n\r\n  /**\r\n   * Create a sprite sheet from a sparse set of [[SourceView]] rectangles\r\n   * @param options\r\n   */\r\n  public static fromImageSourceWithSourceViews(options: SpriteSheetSparseOptions): SpriteSheet {\r\n    const sprites: Sprite[] = options.sourceViews.map(sourceView => {\r\n      return new Sprite({\r\n        image: options.image,\r\n        sourceView\r\n      });\r\n    });\r\n    return new SpriteSheet({sprites});\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   *\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\r\n    const marginDefaults = { x: 0, y: 0, ...margin};\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { BoundingBox, Color } from '..';\r\n\r\nexport interface SpriteFontOptions {\r\n  /**\r\n   * Alphabet string in spritesheet order (default is row column order)\r\n   * example: 'abcdefghijklmnopqrstuvwxyz'\r\n   */\r\n  alphabet: string;\r\n  /**\r\n   * [[SpriteSheet]] to source character sprites from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * Optionally ignore case in the supplied text;\r\n   */\r\n  caseInsensitive?: boolean;\r\n  /**\r\n   * Optionally adjust the spacing between character sprites\r\n   */\r\n  spacing?: number;\r\n  /**\r\n   * Optionally specify a \"shadow\"\r\n   */\r\n  shadow?: { offset: Vector };\r\n}\r\n\r\nexport class SpriteFont extends Graphic implements FontRenderer {\r\n  private _text: string = '';\r\n  public alphabet: string = '';\r\n  public spriteSheet: SpriteSheet;\r\n\r\n  public shadow: { offset: Vector } = null;\r\n  public caseInsensitive = false;\r\n  public spacing: number = 0;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(options: SpriteFontOptions & GraphicOptions) {\r\n    super(options);\r\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\r\n    this.alphabet = alphabet;\r\n    this.spriteSheet = spriteSheet;\r\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\r\n    this.spacing = spacing ?? this.spacing;\r\n    this.shadow = shadow ?? this.shadow;\r\n  }\r\n\r\n  private _alreadyWarnedAlphabet = false;\r\n  private _alreadyWarnedSpriteSheet = false;\r\n  private _getCharacterSprites(text: string): Sprite[] {\r\n    const results: Sprite[] = [];\r\n    // handle case insensitive\r\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\r\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\r\n\r\n    // for each letter in text\r\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\r\n      // find the sprite index in alphabet , if there is an error pick the first\r\n      const letter = textToRender[letterIndex];\r\n      let spriteIndex = alphabet.indexOf(letter);\r\n      if (spriteIndex === -1) {\r\n        spriteIndex = 0;\r\n        if (!this._alreadyWarnedAlphabet) {\r\n          this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\r\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n          this._alreadyWarnedAlphabet = true;\r\n        }\r\n      }\r\n\r\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\r\n      if (letterSprite) {\r\n        results.push(letterSprite);\r\n      } else {\r\n        if (!this._alreadyWarnedSpriteSheet) {\r\n          this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\r\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n          this._alreadyWarnedSpriteSheet = true;\r\n        }\r\n      }\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public measureText(text: string): BoundingBox {\r\n    const lines = text.split('\\n');\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n    const sprites = this._getCharacterSprites(maxWidthLine);\r\n    let width = 0;\r\n    let height = 0;\r\n    for (const sprite of sprites) {\r\n      width += sprite.width + this.spacing;\r\n      height = Math.max(height, sprite.height);\r\n    }\r\n    return BoundingBox.fromDimension(width, height * lines.length, Vector.Zero);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    let xCursor = 0;\r\n    let yCursor = 0;\r\n    let height = 0;\r\n    const lines = this._text.split('\\n');\r\n    for (const line of lines) {\r\n      for (const sprite of this._getCharacterSprites(line)) {\r\n        // draw it in the right spot and increase the cursor by sprite width\r\n        sprite.draw(ex, x + xCursor, y + yCursor);\r\n        xCursor += sprite.width + this.spacing;\r\n        height = Math.max(height, sprite.height);\r\n      }\r\n      xCursor = 0;\r\n      yCursor += height;\r\n    }\r\n  }\r\n\r\n  render(ex: ExcaliburGraphicsContext, text: string, _color: Color, x: number, y: number) {\r\n    // SpriteFont doesn't support _color, yet...\r\n    this._text = text;\r\n    const bounds = this.measureText(text);\r\n    this.width = bounds.width;\r\n    this.height = bounds.height;\r\n    if (this.shadow) {\r\n      ex.save();\r\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\r\n      this.draw(ex, x, y);\r\n      ex.restore();\r\n    }\r\n\r\n    this.draw(ex, x, y);\r\n  }\r\n\r\n  clone(): SpriteFont {\r\n    return new SpriteFont({\r\n      alphabet: this.alphabet,\r\n      spriteSheet: this.spriteSheet,\r\n      spacing: this.spacing\r\n    });\r\n  }\r\n}\r\n", "export default \"data:image/png;base64,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\"", "import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\r\nimport { Vector } from '../..';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debugtext helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource: ImageSource;\r\n  private _spriteSheet: SpriteSheet;\r\n  private _spriteFont: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 3,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n", "export class RenderSource {\r\n  constructor(\r\n    private _gl: WebGLRenderingContext,\r\n    private _texture: WebGLTexture) {}\r\n\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\r\n  }\r\n\r\n  public disable() {\r\n    const gl = this._gl;\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}", "import { RenderSource } from './render-source';\r\n\r\nexport class RenderTarget {\r\n  width: number;\r\n  height: number;\r\n  private _gl: WebGLRenderingContext;\r\n  constructor(options: {gl: WebGLRenderingContext, width: number, height: number}) {\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this._gl = options.gl;\r\n    this._setupFramebuffer();\r\n  }\r\n\r\n  setResolution(width: number, height: number) {\r\n    const gl = this._gl;\r\n    this.width = width;\r\n    this.height = height;\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n  }\r\n\r\n  private _frameBuffer: WebGLFramebuffer;\r\n  public get frameBuffer() {\r\n    return this._frameBuffer;\r\n  }\r\n  private _frameTexture: WebGLTexture;\r\n  public get frameTexture() {\r\n    return this._frameTexture;\r\n  }\r\n  private _setupFramebuffer() {\r\n    // Allocates frame buffer\r\n    const gl = this._gl;\r\n    this._frameTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // set the filtering so we don't need mips\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n\r\n    // attach the texture as the first color attachment\r\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\r\n\r\n    // After this bind all draw calls will draw to this framebuffer texture\r\n    this._frameBuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\r\n    // Reset after initialized\r\n    this.disable();\r\n  }\r\n\r\n  public toRenderSource() {\r\n    const source = new RenderSource(this._gl, this._frameTexture);\r\n    return source;\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing gets redirected to this render target\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    // very important to set the viewport to the size of the framebuffer texture\r\n    gl.viewport(0, 0, this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing is sent back to the canvas\r\n   */\r\n  public disable() {\r\n    const gl = this._gl;\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}", "\r\n/**\r\n * Must be accessed after Engine construction time to ensure the context has been created\r\n */\r\nexport class ExcaliburWebGLContextAccessor {\r\n  private static _GL: WebGL2RenderingContext;\r\n  public static clear() {\r\n    ExcaliburWebGLContextAccessor._GL = null;\r\n  }\r\n  public static register(gl: WebGL2RenderingContext) {\r\n    ExcaliburWebGLContextAccessor._GL = gl;\r\n  }\r\n  // current webgl context\r\n  public static get gl(): WebGL2RenderingContext {\r\n    if (!ExcaliburWebGLContextAccessor._GL) {\r\n      throw Error('Attempted gl access before init');\r\n    }\r\n    return ExcaliburWebGLContextAccessor._GL;\r\n  }\r\n}", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\n\\r\\nout lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";", "export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Color\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  fragColor = v_color;\\r\\n}\";", "/**\r\n * Return the size of the GlType in bytes\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.FLOAT:\r\n      return 4;\r\n    case gl.SHORT:\r\n      return 2;\r\n    case gl.UNSIGNED_SHORT:\r\n      return 2;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Based on the type return the number of attribute components\r\n *\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n      return 1;\r\n    case gl.FLOAT_VEC2:\r\n      return 2;\r\n    case gl.FLOAT_VEC3:\r\n      return 3;\r\n    case gl.FLOAT_VEC4:\r\n      return 4;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_SHORT:\r\n    case gl.SHORT:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the attribute return the corresponding supported attrib pointer type\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n *\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n    case gl.FLOAT_VEC2:\r\n    case gl.FLOAT_VEC3:\r\n    case gl.FLOAT_VEC4:\r\n      return gl.FLOAT;\r\n    case gl.BYTE:\r\n      return gl.BYTE;\r\n    case gl.UNSIGNED_BYTE:\r\n      return gl.UNSIGNED_BYTE;\r\n    case gl.SHORT:\r\n      return gl.SHORT;\r\n    case gl.UNSIGNED_SHORT:\r\n      return gl.UNSIGNED_SHORT;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}", "import { Vector } from '../..';\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\r\n\r\nexport type UniformTypeNames =\r\n  'uniform1f' |\r\n  'uniform1i' |\r\n  'uniform2f' |\r\n  'uniform2i' |\r\n  'uniform3f' |\r\n  'uniform3i' |\r\n  'uniform4f' |\r\n  'uniform4i' |\r\n  'uniform1fv' |\r\n  'uniform1iv' |\r\n  'uniform2fv' |\r\n  'uniform2iv' |\r\n  'uniform3fv' |\r\n  'uniform3iv' |\r\n  'uniform4fv' |\r\n  'uniform4iv' |\r\n  'uniformMatrix2fv' |\r\n  'uniformMatrix3fv' |\r\n  'uniformMatrix4fv';\r\n\r\ntype RemoveFirstFromTuple<T extends any[]> =\r\n  T['length'] extends 0 ? undefined :\r\n    (((...b: T) => void) extends (a: any, ...b: infer I) => void ? I : [])\r\n\r\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  glType: number;\r\n  location: WebGLUniformLocation;\r\n}\r\n\r\n\r\nexport interface VertexAttributeDefinition {\r\n  /**\r\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\r\n   */\r\n  name: string;\r\n  /**\r\n   * Number of components for a given attribute\r\n   * Must be 1, 2, 3, or 4\r\n   *\r\n   * For example a vec4 attribute would be `4` floats, so 4\r\n   */\r\n  size: number;\r\n  /**\r\n   * Supported types in webgl 1\r\n   * * gl.BYTE\r\n   * * gl.SHORT\r\n   * * gl.UNSIGNED_BYTE\r\n   * * gl.UNSIGNED_SHORT\r\n   * * gl.FLOAT\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n   */\r\n  glType: number;\r\n  /**\r\n   * Is the attribute normalized between (0-1)\r\n   */\r\n  normalized: boolean;\r\n  /**\r\n   * Location index in the shader program\r\n   */\r\n  location: number;\r\n}\r\n\r\nexport interface ShaderOptions {\r\n  vertexSource: string;\r\n  fragmentSource: string;\r\n}\r\n\r\nexport class Shader {\r\n  private static _ACTIVE_SHADER_INSTANCE: Shader = null;\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  public program: WebGLProgram;\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  private _compiled = false;\r\n  public readonly vertexSource: string;\r\n  public readonly fragmentSource: string;\r\n\r\n  public get compiled() {\r\n    return this._compiled;\r\n  }\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param options specify shader vertex and fragment source\r\n   */\r\n  constructor(options?: ShaderOptions) {\r\n    const { vertexSource, fragmentSource } = options;\r\n    this.vertexSource = vertexSource;\r\n    this.fragmentSource = fragmentSource;\r\n  }\r\n\r\n  /**\r\n   * Binds the shader program\r\n   */\r\n  use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    Shader._ACTIVE_SHADER_INSTANCE = this;\r\n  }\r\n\r\n  isCurrentlyBound() {\r\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   */\r\n  compile(): WebGLProgram {\r\n    const gl = this._gl;\r\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\r\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\r\n\r\n    const attributes = this.getAttributes();\r\n    for (const attribute of attributes) {\r\n      this.attributes[attribute.name] = attribute;\r\n    }\r\n    const uniforms = this.getUniforms();\r\n    for (const uniform of uniforms) {\r\n      this.uniforms[uniform.name] = uniform;\r\n    }\r\n\r\n    this._compiled = true;\r\n    return this.program;\r\n  }\r\n\r\n  getUniforms(): UniformDefinition[] {\r\n    const gl = this._gl;\r\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\r\n    const uniforms: UniformDefinition[] = [];\r\n    for (let i = 0; i < uniformCount; i++) {\r\n      const uniform = gl.getActiveUniform(this.program, i);\r\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\r\n      uniforms.push({\r\n        name: uniform.name,\r\n        glType: uniform.type,\r\n        location: uniformLocation\r\n      });\r\n    }\r\n    return uniforms;\r\n  }\r\n\r\n  getAttributes(): VertexAttributeDefinition[] {\r\n    const gl = this._gl;\r\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\r\n    const attributes: VertexAttributeDefinition[] = [];\r\n    for (let i = 0; i < attributeCount; i++) {\r\n      const attribute = gl.getActiveAttrib(this.program, i);\r\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\r\n      attributes.push({\r\n        name: attribute.name,\r\n        glType: getAttributePointerType(gl, attribute.type),\r\n        size: getAttributeComponentSize(gl, attribute.type),\r\n        location: attributeLocation,\r\n        normalized: false\r\n      });\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  /**\r\n   * Set a texture in a gpu texture slot\r\n   * @param slotNumber\r\n   * @param texture\r\n   */\r\n  setTexture(slotNumber: number, texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformInt(name: string, value: number) {\r\n    this.setUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformIntArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformBoolean(name: string, value: boolean) {\r\n    this.setUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloat(name: string, value: number) {\r\n    this.setUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1fv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a [[Vector]] uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatVector(name: string, value: Vector) {\r\n    this.setUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set an [[Matrix]] uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformMatrix(name: string, value: Matrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   */\r\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\r\n    if (!this._compiled) {\r\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\r\n      ' must call `shader.use()` before setting uniforms');\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      this._gl[uniformType].apply(this._gl, args);\r\n    } else {\r\n      throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,`+\r\n      ' unused uniforms are optimized away by most browsers');\r\n    }\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      const errorInfo = gl.getShaderInfoLog(shader);\r\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  private _processSourceForError(source: string, errorInfo: string) {\r\n    const lines = source.split('\\n');\r\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\r\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\r\n    const [_, error2] = errorInfo.slice(errorLineStart, errorLineEnd).split(':').map(v => Number(v));\r\n    for (let i = 0; i < lines.length; i++) {\r\n      lines[i] = `${i+1}: ${lines[i]}${error2 === (i+1)? ' <----- ERROR!' : ''}`;\r\n    }\r\n\r\n    return '\\n\\nSource:\\n' + lines.join('\\n');\r\n  }\r\n}", "import { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\n\r\nexport interface VertexBufferOptions {\r\n  /**\r\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\r\n   *\r\n   * Ignored if data is passed directly\r\n   */\r\n  size?: number;\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  type?: 'static' | 'dynamic';\r\n\r\n  /**\r\n   * Optionally pass pre-seeded data, size parameter is ignored\r\n   */\r\n  data?: Float32Array\r\n}\r\n\r\n/**\r\n * Helper around vertex buffer to simplify creating and uploading geometry\r\n *\r\n * Under the hood uses Float32Array\r\n */\r\nexport class VertexBuffer {\r\n  private _gl: WebGL2RenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public readonly buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the vertex buffer\r\n   */\r\n  public readonly bufferData: Float32Array;\r\n\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  public type: 'static' | 'dynamic' = 'dynamic';\r\n\r\n  constructor(options: VertexBufferOptions) {\r\n    const { size, type, data } = options;\r\n    this.buffer = this._gl.createBuffer();\r\n    if (!data && !size) {\r\n      throw Error('Must either provide data or a size to the VertexBuffer');\r\n    }\r\n\r\n    if (!data) {\r\n      this.bufferData = new Float32Array(size);\r\n    } else {\r\n      this.bufferData = data;\r\n    }\r\n    this.type = type ?? this.type;\r\n    // Allocate buffer\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this vertex buffer\r\n   */\r\n  bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n\r\n  }\r\n\r\n  /**\r\n   * Upload vertex buffer geometry to the GPU\r\n   */\r\n  upload(count?: number) {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    if (count) {\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.bufferData, 0, count);\r\n    } else {\r\n      // TODO always use bufferSubData? need to perf test it\r\n      gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n    }\r\n  }\r\n}", "import { Logger } from '../..';\r\nimport { Shader, VertexAttributeDefinition } from './shader';\r\nimport { VertexBuffer } from './vertex-buffer';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { getGlTypeSizeBytes } from './webgl-util';\r\n\r\n\r\nexport interface VertexLayoutOptions {\r\n  /**\r\n   * Shader that this layout will be for\r\n   */\r\n  shader: Shader;\r\n  /**\r\n   * Vertex buffer to use for vertex data\r\n   */\r\n  vertexBuffer: VertexBuffer,\r\n  /**\r\n   * Specify the attributes that will exist in the vertex buffer\r\n   *\r\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\r\n   */\r\n  attributes: [name: string, numberOfComponents: number][]\r\n}\r\n\r\n/**\r\n * Helper around creating vertex attributes in a given [[VertexBuffer]], this is useful for describing\r\n * the memory layout for your vertices inside a particular buffer\r\n *\r\n * Note: This helper assumes interleaved attributes in one [[VertexBuffer]], not many.\r\n *\r\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\r\n */\r\nexport class VertexLayout {\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  private _logger = Logger.getInstance();\r\n  private _shader: Shader;\r\n  private _layout: VertexAttributeDefinition[] = [];\r\n  private _attributes: [name: string, numberOfComponents: number][] = [];\r\n  private _vertexBuffer: VertexBuffer;\r\n  public get vertexBuffer() {\r\n    return this._vertexBuffer;\r\n  }\r\n\r\n  public get attributes(): readonly [name: string, numberOfComponents: number][] {\r\n    return this._attributes;\r\n  }\r\n\r\n  constructor(options: VertexLayoutOptions) {\r\n    const {shader, vertexBuffer, attributes} = options;\r\n    this._vertexBuffer = vertexBuffer;\r\n    this._attributes = attributes;\r\n    this._shader = shader;\r\n    this.initialize();\r\n  }\r\n\r\n  private _vertexTotalSizeBytes = 0;\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    return this._vertexTotalSizeBytes;\r\n  }\r\n\r\n  /**\r\n   * Layouts need shader locations and must be bound to a shader\r\n   */\r\n  initialize() {\r\n    if (!this._shader.compiled) {\r\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\r\n    }\r\n    this._layout.length = 0;\r\n    const shaderAttributes = this._shader.attributes;\r\n    for (const attribute of this._attributes) {\r\n      const attrib = shaderAttributes[attribute[0]];\r\n      if (!attrib) {\r\n        throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}`+\r\n        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\r\n      }\r\n      if (attrib.size !== attribute[1]) {\r\n        throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],`\r\n        +` doesnt match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\r\n      }\r\n      this._layout.push(attrib);\r\n    }\r\n\r\n    // calc size\r\n    let componentsPerVertex = 0;\r\n    for (const vertAttribute of this._layout) {\r\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\r\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\r\n      componentsPerVertex += vertAttribute.size;\r\n    }\r\n\r\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\r\n      this._logger.warn(`The vertex component size (${componentsPerVertex})  does divide evenly into the specified vertex buffer`\r\n      +` (${this._vertexBuffer.bufferData.length})`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bind this layout with it's associated vertex buffer\r\n   *\r\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\r\n   */\r\n  use(uploadBuffer = false, count?: number) {\r\n    const gl = this._gl;\r\n    if (!this._shader.isCurrentlyBound()) {\r\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\r\n    }\r\n    this._vertexBuffer.bind();\r\n    if (uploadBuffer) {\r\n      this._vertexBuffer.upload(count);\r\n    }\r\n    let offset = 0;\r\n    // TODO switch to VAOs if the extension is\r\n    for (const vert of this._layout) {\r\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n      gl.enableVertexAttribArray(vert.location);\r\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\r\n    }\r\n  }\r\n}", "export class GraphicsDiagnostics {\r\n  public static DrawCallCount: number = 0;\r\n  public static DrawnImagesCount: number = 0;\r\n  public static clear(): void {\r\n    GraphicsDiagnostics.DrawCallCount = 0;\r\n    GraphicsDiagnostics.DrawnImagesCount = 0;\r\n  }\r\n}\r\n", "import { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport lineVertexSource from './line-vertex.glsl';\r\nimport lineFragmentSource from './line-fragment.glsl';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class LineRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.line';\r\n  public priority: number = 0;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _maxLines: number = 10922;\r\n  private _vertexBuffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _vertexIndex = 0;\r\n  private _lineCount = 0;\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      vertexSource: lineVertexSource,\r\n      fragmentSource: lineFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    this._vertexBuffer = new VertexBuffer({\r\n      size: 6 * 2 * this._maxLines,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      vertexBuffer: this._vertexBuffer,\r\n      shader: this._shader,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4]\r\n      ]\r\n    });\r\n  }\r\n\r\n  draw(start: Vector, end: Vector, color: Color): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._lineCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const finalStart = transform.multiply(start);\r\n    const finalEnd = transform.multiply(end);\r\n\r\n\r\n    const vertexBuffer = this._vertexBuffer.bufferData;\r\n    // Start\r\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\r\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n\r\n    // End\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._lineCount >= this._maxLines) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._lineCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._lineCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // reset\r\n    this._vertexIndex = 0;\r\n    this._lineCount = 0;\r\n  }\r\n}\r\n", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\nin vec4 a_color;\\r\\nin float a_size;\\r\\nout lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";", "export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\nin lowp vec4 v_color;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n  // \\\"premultiply\\\" the color by alpha\\r\\n  vec4 color = v_color;\\r\\n  color.a = color.a * alpha;\\r\\n  color.rgb = color.rgb * color.a;\\r\\n  fragColor = color;\\r\\n}\";", "import pointVertexSource from './point-vertex.glsl';\r\nimport pointFragmentSource from './point-fragment.glsl';\r\nimport { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class PointRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.point';\r\n  public priority: number = 0;\r\n  private _shader: Shader;\r\n  private _maxPoints: number = 10922;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _gl: WebGLRenderingContext;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _pointCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      vertexSource: pointVertexSource,\r\n      fragmentSource: pointFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    this._buffer = new VertexBuffer({\r\n      size: 7 * this._maxPoints,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4],\r\n        ['a_size', 1]\r\n      ]\r\n    });\r\n  }\r\n\r\n  draw(point: Vector, color: Color, size: number): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._pointCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const finalPoint = transform.multiply(point);\r\n\r\n    if (snapToPixel) {\r\n      finalPoint.x = ~~(finalPoint.x + pixelSnapEpsilon);\r\n      finalPoint.y = ~~(finalPoint.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    const vertexBuffer = this._buffer.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\r\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._pointCount >= this._maxPoints) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._pointCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._pointCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    this._pointCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n  // Pass the texcoord to the fragment shader.\\r\\n  v_texcoord = a_texcoord;\\r\\n}\";", "export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// Passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// The texture.\\r\\nuniform sampler2D u_texture;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n   fragColor = texture(u_texture, v_texcoord);\\r\\n}\";", "\r\nimport screenVertex from './screen-vertex.glsl';\r\nimport screenFragment from './screen-fragment.glsl';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\r\n\r\n/**\r\n * This is responsible for painting the entire screen during the render passes\r\n */\r\nexport class ScreenPassPainter {\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGLRenderingContext) {\r\n    this._gl = gl;\r\n    this._shader = new Shader({\r\n      vertexSource: screenVertex,\r\n      fragmentSource: screenFragment\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1,          0, 0,\r\n        -1, 1,           0, 1,\r\n        1, -1,           1, 0,\r\n\r\n        1, -1,            1, 0,\r\n        -1, 1,           0, 1,\r\n        1, 1,            1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\r\n    const gl = this._gl;\r\n    postprocessor.getShader().use();\r\n    postprocessor.getLayout().use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n\r\n  renderToScreen(): void {\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n}", "import { Logger } from '../..';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\n\r\n/**\r\n * Helper that defines and index buffer for quad geometry\r\n *\r\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\r\n * it is almost always worth it in terms of performance to use an index buffer.\r\n */\r\nexport class QuadIndexBuffer {\r\n  private _gl: WebGL2RenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the index buffer\r\n   */\r\n  public bufferData: Uint16Array | Uint32Array;\r\n  /**\r\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\r\n   */\r\n  public bufferGlType: number;\r\n\r\n  /**\r\n   * @param numberOfQuads Specify the max number of quads you want to draw\r\n   * @param useUint16 Optionally force a uint16 buffer\r\n   */\r\n  constructor(numberOfQuads: number, useUint16?: boolean) {\r\n    const gl = this._gl;\r\n    this.buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n\r\n    const totalVertices = numberOfQuads * 6;\r\n\r\n    if (!useUint16) {\r\n      this.bufferData = new Uint32Array(totalVertices);\r\n    } else {\r\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\r\n      const maxUint16 = 65_535;\r\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\r\n\r\n      this.bufferGlType = gl.UNSIGNED_SHORT;\r\n      this.bufferData = new Uint16Array(totalVertices);\r\n      // TODO Should we error if this happens?? maybe not might crash mid game\r\n      if (numberOfQuads > maxUint16Index) {\r\n        this._logger.warn(\r\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\r\n      }\r\n    }\r\n\r\n\r\n    let currentQuad = 0;\r\n    for (let i = 0; i < totalVertices; i += 6) {\r\n      // first triangle\r\n      this.bufferData[i + 0] = currentQuad + 0;\r\n      this.bufferData[i + 1] = currentQuad + 1;\r\n      this.bufferData[i + 2] = currentQuad + 2;\r\n      // second triangle\r\n      this.bufferData[i + 3] = currentQuad + 2;\r\n      this.bufferData[i + 4] = currentQuad + 1;\r\n      this.bufferData[i + 5] = currentQuad + 3;\r\n      currentQuad += 4;\r\n    }\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  public get size() {\r\n    return this.bufferData.length;\r\n  }\r\n\r\n  /**\r\n   * Upload data to the GPU\r\n   */\r\n  public upload() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this index buffer\r\n   */\r\n  public bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n  }\r\n}", "export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nin lowp float v_textureIndex;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nin vec4 v_tint;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n   // In order to support the most efficient sprite batching, we have multiple\\r\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n   // that do not apply to a particular sprite.\\r\\n\\r\\n   vec4 color = vec4(1.0, 0, 0, 1.0);\\r\\n\\r\\n   // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n   %%texture_picker%%\\r\\n\\r\\n   color.rgb = color.rgb * v_opacity;\\r\\n   color.a = color.a * v_opacity;\\r\\n   fragColor = color * v_tint;\\r\\n}\";", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_texcoord;\\r\\nout vec2 v_texcoord;\\r\\n\\r\\n// Texture number\\r\\nin lowp float a_textureIndex;\\r\\nout lowp float v_textureIndex;\\r\\n\\r\\nin vec4 a_tint;\\r\\nout vec4 v_tint;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the UV coord to the fragment shader\\r\\n   v_texcoord = a_texcoord;\\r\\n   // Pass through the texture number to the fragment shader\\r\\n   v_textureIndex = a_textureIndex;\\r\\n   // Pass through the tint\\r\\n   v_tint = a_tint;\\r\\n}\";", "import { vec } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { TextureLoader } from '../texture-loader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport frag from './image-renderer.frag.glsl';\r\nimport vert from './image-renderer.vert.glsl';\r\n\r\nexport class ImageRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.image';\r\n  public priority: number = 0;\r\n\r\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\r\n    this._maxTextures = Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS), 125);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      size: 10 * 4 * this._maxImages, // 10 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_opacity', 1],\r\n        ['a_texcoord', 2],\r\n        ['a_textureIndex', 1],\r\n        ['a_tint', 4]\r\n      ]\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(this._maxImages, true);\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture(u_textures[${i}], v_texcoord);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    const texture = TextureLoader.load(image);\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this._maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      return this._textures.indexOf(TextureLoader.get(image));\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  draw(image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number): void {\r\n\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    this._addImageAsTexture(image);\r\n\r\n    let width = image?.width || swidth || 0;\r\n    let height = image?.height || sheight || 0;\r\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n    let dest = [sx ?? 1, sy ?? 1];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n      dest = [dx, dy];\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = view[0];\r\n    sy = view[1];\r\n    const sw = view[2];\r\n    const sh = view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    let topLeft = vec(dest[0], dest[1]);\r\n    let topRight = vec(dest[0] + width, dest[1]);\r\n    let bottomLeft = vec(dest[0], dest[1] + height);\r\n    let bottomRight = vec(dest[0] + width, dest[1] + height);\r\n\r\n    topLeft = transform.multiply(topLeft);\r\n    topRight = transform.multiply(topRight);\r\n    bottomLeft = transform.multiply(bottomLeft);\r\n    bottomRight = transform.multiply(bottomRight);\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    const tint = this._context.tint;\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const imageWidth = image.width || width;\r\n    const imageHeight = image.height || height;\r\n\r\n    const uvx0 = (sx) / imageWidth;\r\n    const uvy0 = (sy) / imageHeight;\r\n    const uvx1 = (sx + sw - 0.01) / imageWidth;\r\n    const uvy1 = (sy + sh - 0.01) / imageHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n    vertexBuffer[this._vertexIndex++] = tint.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = tint.a;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true, 4 * 10 * this._imageCount);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n  }\r\n}", "export default \"#version 300 es\\r\\n\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\nin vec2 v_size; // in pixels\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness; // in pixels\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\r\\n    vec2 uv = v_uv;\\r\\n    vec2 fragCoord = uv * v_size;\\r\\n    float maxX = v_size.x - v_strokeThickness;\\r\\n    float minX = v_strokeThickness;\\r\\n    float maxY = v_size.y - v_strokeThickness;\\r\\n    float minY = v_strokeThickness;\\r\\n\\r\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\r\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\r\\n      fragColor = v_color;\\r\\n    } else {\\r\\n      fragColor = v_strokeColor;\\r\\n    }\\r\\n    fragColor.a *= v_opacity;\\r\\n    fragColor.rgb *= fragColor.a;\\r\\n\\r\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\r\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\r\\n\\r\\n    // float fHalfBorderDist      = 0.0;\\r\\n    // float fHalfBorderThickness = 0.0;\\r\\n\\r\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\r\\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\r\\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else\\r\\n    // {\\r\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\r\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\r\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\r\\n        \\r\\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\r\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\r\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\r\\n            \\r\\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\r\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\r\\n    // }\\r\\n\\r\\n    // vec4 v4FromColor = v_strokeColor;\\r\\n    // v4FromColor.rgb *= v4FromColor.a;\\r\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\r\\n    // if (fHalfBorderDist < 0.0) {\\r\\n    //     v4ToColor = v_color;\\r\\n    //     v4ToColor.rgb *= v4ToColor.a;\\r\\n    // }\\r\\n\\r\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\r\\n\\r\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\r\\n    // gl_FragColor = finalColor;\\r\\n}\";", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\nin vec2 a_size;\\r\\nout vec2 v_size;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through size\\r\\n   v_size = a_size;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";", "import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './rectangle-renderer.frag.glsl';\r\nimport vert from './rectangle-renderer.vert.glsl';\r\n\r\nexport class RectangleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.rectangle';\r\n  public priority: number = 0;\r\n\r\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader: Shader;\r\n  private _gl: WebGLRenderingContext;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n  private _rectangleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r\n    this._shader = new Shader({\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      size: 16 * 4 * this._maxRectangles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_size', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n    this._quads = new QuadIndexBuffer(this._maxRectangles, true);\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._rectangleCount >= this._maxRectangles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(...args: any[]): void {\r\n    if (args[0] instanceof Vector && args[1] instanceof Vector) {\r\n      this.drawLine.apply(this, args);\r\n    } else {\r\n      this.drawRectangle.apply(this, args);\r\n    }\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\r\n\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const dir = end.sub(start);\r\n    const length = dir.size;\r\n    const normal = dir.normalize().perpendicular();\r\n    const halfThick = thickness / 2;\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startx, starty)------------------>(endx, endy)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n    const startTop = transform.multiply(normal.scale(halfThick).add(start));\r\n    const startBottom = transform.multiply(normal.scale(-halfThick).add(start));\r\n    const endTop = transform.multiply(normal.scale(halfThick).add(end));\r\n    const endBottom = transform.multiply(normal.scale(-halfThick).add(end));\r\n\r\n    if (snapToPixel) {\r\n      startTop.x = ~~(startTop.x + pixelSnapEpsilon);\r\n      startTop.y = ~~(startTop.y + pixelSnapEpsilon);\r\n\r\n      endTop.x = ~~(endTop.x + pixelSnapEpsilon);\r\n      endTop.y = ~~(endTop.y + pixelSnapEpsilon);\r\n\r\n      startBottom.x = ~~(startBottom.x + pixelSnapEpsilon);\r\n      startBottom.y = ~~(startBottom.y + pixelSnapEpsilon);\r\n\r\n      endBottom.x = ~~(endBottom.x + pixelSnapEpsilon);\r\n      endBottom.y = ~~(endBottom.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    const stroke = Color.Transparent;\r\n    const strokeThickness = 0;\r\n    const width = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = startTop.x;\r\n    vertexBuffer[this._vertexIndex++] = startTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = endTop.x;\r\n    vertexBuffer[this._vertexIndex++] = endTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n  }\r\n\r\n  drawRectangle(\r\n    pos: Vector,\r\n    width: number,\r\n    height: number,\r\n    color: Color,\r\n    stroke: Color = Color.Transparent,\r\n    strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(0, 0)));\r\n    const topRight = transform.multiply(pos.add(vec(width, 0)));\r\n    const bottomRight = transform.multiply(pos.add(vec(width, height)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(0, height)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._rectangleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._rectangleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._rectangleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n\r\n}", "export default \"#version 300 es\\r\\nprecision highp float;\\r\\n\\r\\n// UV coord\\r\\nin vec2 v_uv;\\r\\n\\r\\n// Color coord to blend with image\\r\\nin lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nin lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nin lowp float v_strokeThickness;\\r\\n\\r\\n// Opacity\\r\\nin float v_opacity;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  // make (0, 0) the center the uv \\r\\n  vec2 uv = v_uv * 2.0 - 1.0;\\r\\n\\r\\n  vec4 color = v_color;\\r\\n  vec4 strokeColor = v_strokeColor;\\r\\n\\r\\n  // circle border is at radius 1.0 \\r\\n  // dist is > 0 when inside the circle \\r\\n  float d = length(uv);\\r\\n  float dist = 1.0 - length(uv);\\r\\n\\r\\n  // Fade based on fwidth\\r\\n  float fade = fwidth(dot(uv, uv));\\r\\n\\r\\n  // if dist is greater than 0 step to 1;\\r\\n  // when we cross this 0 threshold add a smooth fade\\r\\n  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\\r\\n\\r\\n  // if dist is greater than the stroke thickness step to 1\\r\\n  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\\r\\n\\r\\n  strokeColor.a *= fill * stroke;\\r\\n  strokeColor.rgb *= strokeColor.a;\\r\\n\\r\\n  color.a *= fill * (1.0 - stroke);\\r\\n  color.rgb *= color.a;\\r\\n\\r\\n  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\\r\\n  finalColor.rgb = finalColor.rgb * v_opacity;\\r\\n  finalColor.a = finalColor.a * v_opacity;\\r\\n  fragColor = finalColor;\\r\\n}\";", "export default \"#version 300 es\\r\\nin vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nin vec2 a_uv;\\r\\nout vec2 v_uv;\\r\\n\\r\\n// Opacity \\r\\nin float a_opacity;\\r\\nout float v_opacity;\\r\\n\\r\\nin vec4 a_color;\\r\\nout vec4 v_color;\\r\\n\\r\\nin vec4 a_strokeColor;\\r\\nout vec4 v_strokeColor;\\r\\n\\r\\nin float a_strokeThickness;\\r\\nout float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";", "import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL, pixelSnapEpsilon } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './circle-renderer.frag.glsl';\r\nimport vert from './circle-renderer.vert.glsl';\r\n\r\nexport class CircleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.circle';\r\n  public priority: number = 0;\r\n\r\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader: Shader;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n\r\n  private _circleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      size: 14 * 4 * this._maxCircles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n\r\n    this._quads = new QuadIndexBuffer(this._maxCircles, true);\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._circleCount >= this._maxCircles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._circleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topLeft = transform.multiply(pos.add(vec(-radius, -radius)));\r\n    const topRight = transform.multiply(pos.add(vec(radius, -radius)));\r\n    const bottomRight = transform.multiply(pos.add(vec(radius, radius)));\r\n    const bottomLeft = transform.multiply(pos.add(vec(-radius, radius)));\r\n\r\n    if (snapToPixel) {\r\n      topLeft.x = ~~(topLeft.x + pixelSnapEpsilon);\r\n      topLeft.y = ~~(topLeft.y + pixelSnapEpsilon);\r\n\r\n      topRight.x = ~~(topRight.x + pixelSnapEpsilon);\r\n      topRight.y = ~~(topRight.y + pixelSnapEpsilon);\r\n\r\n      bottomLeft.x = ~~(bottomLeft.x + pixelSnapEpsilon);\r\n      bottomLeft.y = ~~(bottomLeft.y + pixelSnapEpsilon);\r\n\r\n      bottomRight.x = ~~(bottomRight.x + pixelSnapEpsilon);\r\n      bottomRight.y = ~~(bottomRight.y + pixelSnapEpsilon);\r\n    }\r\n\r\n    // TODO UV could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._circleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._circleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._circleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n\r\n}", "import { Logger } from '..';\r\nexport class Pool<Type> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  public disableWarnings = false;\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: (...args: any[]) => Type,\r\n    public recycler: (instance: Type, ...args: any[]) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  preallocate() {\r\n    for (let i = 0; i < this.maxObjects; i++) {\r\n      this.objects[i] = this.builder();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   * @param args\r\n   */\r\n  get(...args: any[]): Type {\r\n    if (this.index === this.maxObjects) {\r\n      if (!this.disableWarnings) {\r\n        this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      }\r\n      this.maxObjects = this.maxObjects * 2;\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      return this.recycler(this.objects[this.index++], ...args);\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder(...args));\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\r\n      this.totalAllocations++;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n", "import { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class DrawCall {\r\n  public z: number = 0;\r\n  public priority: number = 0;\r\n  public renderer: string;\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public state: ExcaliburGraphicsContextState = {\r\n    z: 0,\r\n    opacity: 1,\r\n    tint: Color.White\r\n  };\r\n  public args: any[];\r\n}", "import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { DebugText } from './debug-text';\r\nimport { ScreenDimension } from '../../Screen';\r\nimport { RenderTarget } from './render-target';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { RendererPlugin } from './renderer';\r\n\r\n// renderers\r\nimport { LineRenderer } from './line-renderer/line-renderer';\r\nimport { PointRenderer } from './point-renderer/point-renderer';\r\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\r\nimport { ImageRenderer } from './image-renderer/image-renderer';\r\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\r\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\r\nimport { Pool } from '../../Util/Pool';\r\nimport { DrawCall } from './draw-call';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\n\r\nexport const pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions.color);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  ortho: Matrix;\r\n  context: ExcaliburGraphicsContextWebGL;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  private _logger = Logger.getInstance();\r\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\r\n  private _isDrawLifecycle = false;\r\n  public useDrawSorting = true;\r\n\r\n  private _drawCallPool = new Pool<DrawCall>(\r\n    () => new DrawCall(),\r\n    (instance) => {\r\n      instance.priority = 0;\r\n      instance.z = 0;\r\n      instance.renderer = undefined;\r\n      instance.args = undefined;\r\n      return instance;\r\n    }, 4000);\r\n  private _drawCalls: DrawCall[] = [];\r\n\r\n  // Main render target\r\n  private _renderTarget: RenderTarget;\r\n\r\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\r\n  private _postProcessTargets: RenderTarget[] = [];\r\n\r\n  private _screenRenderer: ScreenPassPainter;\r\n\r\n  private _postprocessors: PostProcessor[] = [];\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGL2RenderingContext;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  public snapToPixel: boolean = false;\r\n\r\n  public smoothing: boolean = false;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public get z(): number {\r\n    return this._state.current.z;\r\n  }\r\n\r\n  public set z(value: number) {\r\n    this._state.current.z = value;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  public get ortho(): Matrix {\r\n    return this._ortho;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    let supported = true;\r\n    if (dim.width > 4096 || dim.height > 4096) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor, useDrawSorting } = options;\r\n    this.__gl = canvasElement.getContext('webgl2', {\r\n      antialias: smoothing ?? this.smoothing,\r\n      premultipliedAlpha: false,\r\n      alpha: enableTransparency ?? true,\r\n      depth: true,\r\n      powerPreference: 'high-performance'\r\n      // TODO Chromium fixed the bug where this didn't work now it breaks CI :(\r\n      // failIfMajorPerformanceCaveat: true\r\n    });\r\n    if (!this.__gl) {\r\n      throw Error('Failed to retrieve webgl context from browser');\r\n    }\r\n    ExcaliburWebGLContextAccessor.register(this.__gl);\r\n    TextureLoader.register(this.__gl);\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.useDrawSorting = useDrawSorting ?? this.useDrawSorting;\r\n    this._drawCallPool.disableWarnings = true;\r\n    this._drawCallPool.preallocate();\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\r\n    gl.enable(gl.BLEND);\r\n    gl.blendEquation(gl.FUNC_ADD);\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    // Setup builtin renderers\r\n    this.register(new ImageRenderer());\r\n    this.register(new RectangleRenderer());\r\n    this.register(new CircleRenderer());\r\n    this.register(new PointRenderer());\r\n    this.register(new LineRenderer());\r\n\r\n    this._screenRenderer = new ScreenPassPainter(gl);\r\n\r\n    this._renderTarget = new RenderTarget({\r\n      gl,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n\r\n\r\n    this._postProcessTargets = [\r\n      new RenderTarget({\r\n        gl,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      }),\r\n      new RenderTarget({\r\n        gl,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      })\r\n    ];\r\n  }\r\n\r\n  public register<T extends RendererPlugin>(renderer: T) {\r\n    this._renderers.set(renderer.type, renderer);\r\n    renderer.initialize(this.__gl, this);\r\n  }\r\n\r\n  public get(rendererName: string): RendererPlugin {\r\n    return this._renderers.get(rendererName);\r\n  }\r\n\r\n  private _currentRenderer: RendererPlugin;\r\n\r\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\r\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    this._isDrawLifecycle = true;\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    this._isDrawLifecycle = false;\r\n  }\r\n\r\n  private _alreadyWarnedDrawLifecycle = false;\r\n\r\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\r\n    if (!this._isDrawLifecycle && !this._alreadyWarnedDrawLifecycle) {\r\n      this._logger.warn(\r\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\r\n        `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\r\n      this._alreadyWarnedDrawLifecycle = true;\r\n    }\r\n\r\n    const renderer = this._renderers.get(rendererName);\r\n    if (renderer) {\r\n      if (this.useDrawSorting) {\r\n        const drawCall = this._drawCallPool.get();\r\n        drawCall.z = this._state.current.z;\r\n        drawCall.priority = renderer.priority;\r\n        drawCall.renderer = rendererName;\r\n        this.getTransform().clone(drawCall.transform);\r\n        drawCall.state.z = this._state.current.z;\r\n        drawCall.state.opacity = this._state.current.opacity;\r\n        drawCall.state.tint = this._state.current.tint;\r\n        drawCall.args = args;\r\n        this._drawCalls.push(drawCall);\r\n      } else {\r\n        // Set the current renderer if not defined\r\n        if (!this._currentRenderer) {\r\n          this._currentRenderer = renderer;\r\n        }\r\n\r\n        if (!this._isCurrentRenderer(renderer)) {\r\n          // switching graphics means we must flush the previous\r\n          this._currentRenderer.flush();\r\n        }\r\n\r\n        // If we are still using the same renderer we can add to the current batch\r\n        renderer.draw(...args);\r\n\r\n        this._currentRenderer = renderer;\r\n      }\r\n    } else {\r\n      throw Error(`No renderer with name ${rendererName} has been registered`);\r\n    }\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.current = AffineMatrix.identity();\r\n  }\r\n\r\n  public updateViewport(resolution: ScreenDimension): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\r\n\r\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n    this.draw<ImageRenderer>('ex.image', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', start, end, color, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: AffineMatrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    return this._transform.current;\r\n  }\r\n\r\n  public multiply(m: AffineMatrix) {\r\n    this._transform.current.multiply(m, this._transform.current);\r\n  }\r\n\r\n  public addPostProcessor(postprocessor: PostProcessor) {\r\n    this._postprocessors.push(postprocessor);\r\n    postprocessor.initialize(this.__gl);\r\n  }\r\n\r\n  public removePostProcessor(postprocessor: PostProcessor) {\r\n    const index = this._postprocessors.indexOf(postprocessor);\r\n    if (index !== -1) {\r\n      this._postprocessors.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    this._postprocessors.length = 0;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    this._renderTarget.use();\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    const gl = this.__gl;\r\n\r\n    // render target captures all draws and redirects to the render target\r\n    this._renderTarget.use();\r\n\r\n    if (this.useDrawSorting) {\r\n      // sort draw calls\r\n      // Find the original order of the first instance of the draw call\r\n      const originalSort = new Map<string, number>();\r\n      for (const [name] of this._renderers) {\r\n        const firstIndex = this._drawCalls.findIndex(dc => dc.renderer === name);\r\n        originalSort.set(name, firstIndex);\r\n      }\r\n\r\n      this._drawCalls.sort((a, b) => {\r\n        const zIndex = a.z - b.z;\r\n        const originalSortOrder = originalSort.get(a.renderer) - originalSort.get(b.renderer);\r\n        const priority = a.priority - b.priority;\r\n        if (zIndex === 0) { // sort by z first\r\n          if (priority === 0) { // sort by priority\r\n            return originalSortOrder; // use the original order to inform draw call packing to maximally preserve painter order\r\n          }\r\n          return priority;\r\n        }\r\n        return zIndex;\r\n      });\r\n\r\n      const oldTransform = this._transform.current;\r\n      const oldState = this._state.current;\r\n\r\n      if (this._drawCalls.length) {\r\n        let currentRendererName = this._drawCalls[0].renderer;\r\n        let currentRenderer = this._renderers.get(currentRendererName);\r\n        for (let i = 0; i < this._drawCalls.length; i++) {\r\n          // hydrate the state for renderers\r\n          this._transform.current = this._drawCalls[i].transform;\r\n          this._state.current = this._drawCalls[i].state;\r\n\r\n          if (this._drawCalls[i].renderer !== currentRendererName) {\r\n            // switching graphics renderer means we must flush the previous\r\n            currentRenderer.flush();\r\n            currentRendererName = this._drawCalls[i].renderer;\r\n            currentRenderer = this._renderers.get(currentRendererName);\r\n          }\r\n\r\n          // If we are still using the same renderer we can add to the current batch\r\n          currentRenderer.draw(...this._drawCalls[i].args);\r\n        }\r\n        if (currentRenderer.hasPendingDraws()) {\r\n          currentRenderer.flush();\r\n        }\r\n      }\r\n\r\n      // reset state\r\n      this._transform.current = oldTransform;\r\n      this._state.current = oldState;\r\n\r\n      // reclaim draw calls\r\n      this._drawCallPool.done();\r\n      this._drawCalls.length = 0;\r\n    } else {\r\n      // This is the final flush at the moment to draw any leftover pending draw\r\n      for (const renderer of this._renderers.values()) {\r\n        if (renderer.hasPendingDraws()) {\r\n          renderer.flush();\r\n        }\r\n      }\r\n    }\r\n\r\n    this._renderTarget.disable();\r\n\r\n    // post process step\r\n    const source = this._renderTarget.toRenderSource();\r\n    source.use();\r\n\r\n    // flip flop render targets\r\n    for (let i = 0; i < this._postprocessors.length; i++) {\r\n      this._postProcessTargets[i % 2].use();\r\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\r\n      this._postProcessTargets[i % 2].toRenderSource().use();\r\n    }\r\n\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    this._screenRenderer.renderToScreen();\r\n  }\r\n}\r\n", "import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { ScreenDimension } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\n\r\nconst pixelSnapEpsilon = 0.0001;\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~(x + pixelSnapEpsilon) : x,\r\n      this._ex.snapToPixel ? ~~(y + pixelSnapEpsilon) : y,\r\n      this._ex.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this._ex.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\r\n    this._ex.__ctx.moveTo(\r\n      this._ex.snapToPixel ? ~~(start.x + pixelSnapEpsilon) : start.x,\r\n      this._ex.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this._ex.__ctx.lineTo(\r\n      this._ex.snapToPixel ? ~~(end.x + pixelSnapEpsilon) : end.x,\r\n      this._ex.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y\r\n    );\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~(point.x + pixelSnapEpsilon) : point.x,\r\n      this._ex.snapToPixel ? ~~(point.y + pixelSnapEpsilon) : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public readonly useDrawSorting: boolean = false;\r\n\r\n  /**\r\n   * Unused in Canvas implementation\r\n   */\r\n  public z: number = 0;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get tint(): Color {\r\n    return this._state.current.tint;\r\n  }\r\n\r\n  public set tint(color: Color) {\r\n    this._state.current.tint = color;\r\n  }\r\n\r\n  public snapToPixel: boolean = false;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\r\n    this.__ctx = canvasElement.getContext('2d', {\r\n      alpha: enableTransparency ?? true\r\n    });\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(_resolution: ScreenDimension): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(\r\n      this.snapToPixel ? ~~ (start.x + pixelSnapEpsilon) : start.x,\r\n      this.snapToPixel ? ~~(start.y + pixelSnapEpsilon) : start.y\r\n    );\r\n    this.__ctx.lineTo(\r\n      this.snapToPixel ? ~~ (end.x + pixelSnapEpsilon) : end.x,\r\n      this.snapToPixel ? ~~(end.y + pixelSnapEpsilon) : end.y\r\n    );\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y,\r\n      this.snapToPixel ? ~~(width + pixelSnapEpsilon) : width,\r\n      this.snapToPixel ? ~~(height + pixelSnapEpsilon) : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    if (stroke) {\r\n      this.__ctx.strokeStyle = stroke.toString();\r\n    }\r\n    if (thickness) {\r\n      this.__ctx.lineWidth = thickness;\r\n    }\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(\r\n      this.snapToPixel ? ~~(pos.x + pixelSnapEpsilon) : pos.x,\r\n      this.snapToPixel ? ~~(pos.y + pixelSnapEpsilon) : pos.y, radius, 0, Math.PI * 2\r\n    );\r\n    this.__ctx.fill();\r\n    if (stroke) {\r\n      this.__ctx.stroke();\r\n    }\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~(x + pixelSnapEpsilon) : x, this.snapToPixel ? ~~(y + pixelSnapEpsilon) : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  public getTransform(): AffineMatrix {\r\n    throw new Error('Not implemented');\r\n  }\r\n\r\n  public multiply(_m: AffineMatrix): void {\r\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\r\n  }\r\n\r\n  public addPostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public removePostProcessor(_postprocessor: PostProcessor) {\r\n    // pass\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    // pass\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n}\r\n", "import { vec, Vector } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\nimport { ExcaliburGraphicsContext2DCanvas } from './Graphics/Context/ExcaliburGraphicsContext2DCanvas';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution within the container at all times will fill any gaps with canvas.\r\n   * The displayed area outside the aspect ratio is not guaranteed to be on the screen, only the [[Screen.contentArea]]\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitContainerAndFill = 'FitContainerAndFill',\r\n\r\n  /**\r\n   * Fit the aspect ratio given by the game resolution the screen at all times will fill the screen.\r\n   * This displayed area outside the aspect ratio is not guaranteed to be on the screen, only the [[Screen.contentArea]]\r\n   * is guaranteed to be on screen.\r\n   */\r\n  FitScreenAndFill = 'FitScreenAndFill',\r\n\r\n  /**\r\n   * Fit the viewport to the parent element maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in [[FitContainer]].\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use [[Screen.contentArea]] to know the safe to draw area.\r\n   */\r\n  FitContainerAndZoom = 'FitContainerAndZoom',\r\n\r\n  /**\r\n   * Fit the viewport to the device screen maintaining aspect ratio given by the game resolution, but zooms in to avoid the black bars\r\n   * (letterbox) that would otherwise be present in [[FitScreen]].\r\n   *\r\n   * **warning** This will clip some drawable area from the user because of the zoom,\r\n   * use [[Screen.contentArea]] to know the safe to draw area.\r\n   */\r\n  FitScreenAndZoom = 'FitScreenAndZoom',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): ScreenDimension {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): ScreenDimension {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): ScreenDimension {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): ScreenDimension {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): ScreenDimension {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): ScreenDimension {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): ScreenDimension {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): ScreenDimension {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\nexport interface ScreenDimension {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\r\n   * [[DisplayMode.FillScreen]].\r\n   */\r\n  resolution?: ScreenDimension;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ScreenDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n}\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n  private _canvas: HTMLCanvasElement;\r\n  private _antialiasing: boolean = true;\r\n  private _contentResolution: ScreenDimension;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: ScreenDimension;\r\n  private _resolutionStack: ScreenDimension[] = [];\r\n  private _viewport: ScreenDimension;\r\n  private _viewportStack: ScreenDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullScreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._contentResolution = this.resolution;\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this.graphicsContext = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._browser = options.browser;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n\r\n    this._applyDisplayMode();\r\n\r\n    this._listenForPixelRatio();\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  private _listenForPixelRatio() {\r\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\r\n      // Safari <=13.1 workaround, remove any existing handlers\r\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n    }\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n\r\n    // Safari <=13.1 workaround\r\n    if (this._mediaQueryList.addEventListener) {\r\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\r\n    } else {\r\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\r\n    }\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      // Safari <=13.1 workaround\r\n      if (this._mediaQueryList.removeEventListener) {\r\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      } else {\r\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n      }\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    this._isFullScreen = !this._isFullScreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._listenForPixelRatio();\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    switch (this.displayMode) {\r\n      case DisplayMode.FillContainer:\r\n      case DisplayMode.FitContainer:\r\n      case DisplayMode.FitContainerAndFill:\r\n      case DisplayMode.FitContainerAndZoom:\r\n        return this.canvas.parentElement || document.body;\r\n      default:\r\n        return window;\r\n    }\r\n  }\r\n\r\n  public get resolution(): ScreenDimension {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: ScreenDimension) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  public get viewport(): ScreenDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ScreenDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ScreenDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): ScreenDimension {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    this.resolution = this._resolutionStack.pop();\r\n    this.viewport = this._viewportStack.pop();\r\n  }\r\n\r\n  private _alreadyWarned = false;\r\n  public applyResolutionAndViewport() {\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      const supported = this.graphicsContext.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!supported && !this._alreadyWarned) {\r\n        this._alreadyWarned = true; // warn once\r\n        this._logger.warn(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio})` +\r\n          ' are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\r\n      }\r\n    }\r\n\r\n    if (this._antialiasing) {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n    this._canvas.style.width = this.viewport.width + 'px';\r\n    this._canvas.style.height = this.viewport.height + 'px';\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this.graphicsContext.updateViewport(this.resolution);\r\n    this.graphicsContext.resetTransform();\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContext2DCanvas) {\r\n      this.graphicsContext.scale(this.pixelRatio, this.pixelRatio);\r\n    }\r\n  }\r\n\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   *\r\n   * Optionally specify a target element id to go fullscreen, by default the game canvas is used\r\n   * @param elementId\r\n   */\r\n  public goFullScreen(elementId?: string): Promise<void> {\r\n    if (elementId) {\r\n      const maybeElement = document.getElementById(elementId);\r\n      if (maybeElement) {\r\n        return maybeElement.requestFullscreen();\r\n      }\r\n    }\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullScreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\r\n        newX = (newX / window.innerWidth) * this.viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\r\n        newY = (newY / window.innerHeight) * this.viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / this.viewport.width) * this.resolution.width;\r\n    newY = (newY / this.viewport.height) * this.resolution.height;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    newX = (newX / this.resolution.width) * this.viewport.width;\r\n    newY = (newY / this.resolution.height) * this.viewport.height;\r\n\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / this.viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / this.viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullScreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\r\n   * and extends infinitely out relative from the [[Camera]].\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    // the only difference between screen & world is the camera transform\r\n    if (this._camera) {\r\n      return this._camera.inverse.multiply(point);\r\n    }\r\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    if (this._camera) {\r\n      return this._camera.transform.multiply(point);\r\n    }\r\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const topLeft = this.screenToWorldCoordinates(Vector.Zero);\r\n    const right = topLeft.x + this.drawWidth;\r\n    const bottom = topLeft.y + this.drawHeight;\r\n\r\n    return new BoundingBox(topLeft.x, topLeft.y, right, bottom);\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  /**\r\n   * Returns the content area in screen space where it is safe to place content\r\n   */\r\n  public get contentArea(): BoundingBox {\r\n    return this._contentArea;\r\n  }\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n  }\r\n\r\n  private _contentArea: BoundingBox = new BoundingBox();\r\n  private _computeFitScreenAndFill() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n    this._computeFitAndFill(vw, vh);\r\n  }\r\n\r\n\r\n\r\n  private _computeFitContainerAndFill() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const parent = this.canvas.parentElement;\r\n    const vw = parent.clientWidth;\r\n    const vh = parent.clientHeight;\r\n    this._computeFitAndFill(vw, vh);\r\n  }\r\n\r\n  private _computeFitAndFill(vw: number, vh: number) {\r\n    this.viewport = {\r\n      width: vw,\r\n      height: vh\r\n    };\r\n    // if the current screen aspectRatio is less than the original aspectRatio\r\n    if (vw / vh <= this._contentResolution.width / this._contentResolution.height) {\r\n      // compute new resolution to match the original aspect ratio\r\n      this.resolution = {\r\n        width:  vw * this._contentResolution.width / vw,\r\n        height: vw * this._contentResolution.width / vw * vh / vw\r\n      };\r\n      const clip = (this.resolution.height - this._contentResolution.height) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: clip,\r\n        left: 0,\r\n        right: this._contentResolution.width,\r\n        bottom: this.resolution.height - clip\r\n      });\r\n    } else {\r\n      this.resolution = {\r\n        width: vh *  this._contentResolution.height / vh * vw / vh,\r\n        height: vh *  this._contentResolution.height / vh\r\n      };\r\n      const clip = (this.resolution.width - this._contentResolution.width) / 2;\r\n      this._contentArea = new BoundingBox({\r\n        top: 0,\r\n        left: clip,\r\n        right: this.resolution.width - clip,\r\n        bottom: this._contentResolution.height\r\n      });\r\n    }\r\n  }\r\n\r\n  private _computeFitScreenAndZoom() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    this.canvas.style.position = 'absolute';\r\n\r\n    const vw = window.innerWidth;\r\n    const vh = window.innerHeight;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n  }\r\n\r\n  private _computeFitContainerAndZoom() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    this.canvas.style.position = 'absolute';\r\n    const parent = this.canvas.parentElement;\r\n    parent.style.position = 'relative';\r\n    parent.style.overflow = 'hidden';\r\n\r\n    const vw = parent.clientWidth;\r\n    const vh = parent.clientHeight;\r\n\r\n    this._computeFitAndZoom(vw, vh);\r\n  }\r\n\r\n  private _computeFitAndZoom(vw: number, vh: number) {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (vw / aspect < vh) {\r\n      adjustedWidth = vw;\r\n      adjustedHeight = vw / aspect;\r\n    } else {\r\n      adjustedWidth = vh * aspect;\r\n      adjustedHeight = vh;\r\n    }\r\n\r\n    const scaleX = vw / adjustedWidth;\r\n    const scaleY = vh / adjustedHeight;\r\n\r\n    const maxScaleFactor = Math.max(scaleX, scaleY);\r\n\r\n    const zoomedWidth = adjustedWidth * maxScaleFactor;\r\n    const zoomedHeight = adjustedHeight * maxScaleFactor;\r\n\r\n    // Center zoomed dimension if bigger than the screen\r\n    if (zoomedWidth > vw) {\r\n      this.canvas.style.left = -(zoomedWidth - vw) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.left = '';\r\n    }\r\n\r\n    if (zoomedHeight > vh) {\r\n      this.canvas.style.top = -(zoomedHeight - vh) / 2 + 'px';\r\n    } else {\r\n      this.canvas.style.top = '';\r\n    }\r\n\r\n    this.viewport = {\r\n      width: zoomedWidth,\r\n      height: zoomedHeight\r\n    };\r\n\r\n    const bounds = BoundingBox.fromDimension(this.viewport.width, this.viewport.height, Vector.Zero);\r\n    // return safe area\r\n    if (this.viewport.width > vw) {\r\n      const clip = (this.viewport.width - vw)/this.viewport.width * this.resolution.width;\r\n      bounds.top = 0;\r\n      bounds.left = clip / 2;\r\n      bounds.right = this.resolution.width - clip / 2;\r\n      bounds.bottom = this.resolution.height;\r\n    }\r\n\r\n    if (this.viewport.height > vh) {\r\n      const clip = (this.viewport.height - vh)/this.viewport.height * this.resolution.height;\r\n      bounds.top = clip / 2;\r\n      bounds.left = 0;\r\n      bounds.bottom = this.resolution.height - clip / 2;\r\n      bounds.right = this.resolution.width;\r\n    }\r\n    this._contentArea = bounds;\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      adjustedWidth = parent.clientWidth;\r\n      adjustedHeight = parent.clientWidth / aspect;\r\n    } else {\r\n      adjustedWidth = parent.clientHeight * aspect;\r\n      adjustedHeight = parent.clientHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n    this._contentArea = BoundingBox.fromDimension(this.resolution.width, this.resolution.height, Vector.Zero);\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n    // watch resizing\r\n    if (this.parent instanceof Window) {\r\n      this._browser.window.on('resize', this._resizeHandler);\r\n    } else {\r\n      this._resizeObserver = new ResizeObserver(() => {\r\n        this._resizeHandler();\r\n      });\r\n      this._resizeObserver.observe(this.parent);\r\n    }\r\n    this.parent.addEventListener('resize', this._resizeHandler);\r\n  }\r\n\r\n  /**\r\n   * Sets the resolution and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.resolution = {\r\n        width: (<HTMLElement> parent).clientWidth,\r\n        height: (<HTMLElement> parent).clientHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window> parent).innerWidth,\r\n        height: (<Window> parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndFill) {\r\n      this._computeFitScreenAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndFill){\r\n      this._computeFitContainerAndFill();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreenAndZoom) {\r\n      this._computeFitScreenAndZoom();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainerAndZoom){\r\n      this._computeFitContainerAndZoom();\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE: AudioContext = null;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE;\r\n  }\r\n}\r\n", "import { AudioContextFactory } from '../Resources/Sound/AudioContext';\r\nimport { Logger } from './Log';\r\n\r\nexport interface LegacyWebAudioSource {\r\n  playbackState: string;\r\n  PLAYING_STATE: 'playing';\r\n  FINISHED_STATE: 'finished';\r\n}\r\n\r\n/**\r\n * Patch for detecting legacy web audio in browsers\r\n * @internal\r\n * @param source\r\n */\r\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\r\n  return !!source.playbackState;\r\n}\r\n\r\nexport class WebAudio {\r\n  private static _UNLOCKED: boolean = false;\r\n\r\n  /**\r\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\r\n   * right after a user interaction event.\r\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\r\n   */\r\n  static unlock(): Promise<boolean> {\r\n    const promise = new Promise<boolean>((resolve, reject) => {\r\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\r\n        return resolve(true);\r\n      }\r\n      const unlockTimeoutTimer = setTimeout(() => {\r\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\r\n        resolve(false);\r\n      }, 200);\r\n\r\n      const audioContext = AudioContextFactory.create();\r\n      audioContext.resume().then(\r\n        () => {\r\n          // create empty buffer and play it\r\n          const buffer = audioContext.createBuffer(1, 1, 22050);\r\n          const source = audioContext.createBufferSource();\r\n          let ended = false;\r\n\r\n          source.buffer = buffer;\r\n          source.connect(audioContext.destination);\r\n          source.onended = () => (ended = true);\r\n\r\n          source.start(0);\r\n\r\n          // by checking the play state after some time, we know if we're really unlocked\r\n          setTimeout(() => {\r\n            if (isLegacyWebAudioSource(source)) {\r\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            } else {\r\n              if (audioContext.currentTime > 0 || ended) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            }\r\n          }, 0);\r\n\r\n          clearTimeout(unlockTimeoutTimer);\r\n          resolve(true);\r\n        },\r\n        () => {\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  static isUnlocked() {\r\n    return this._UNLOCKED;\r\n  }\r\n}\r\n", "import { EventDispatcher } from './EventDispatcher';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\n/**\r\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\r\n * and extending abilities for vanilla Javascript projects\r\n */\r\nexport class Class implements Eventable {\r\n  /**\r\n   * Direct access to the game object event dispatcher.\r\n   */\r\n  public eventDispatcher: EventDispatcher;\r\n\r\n  constructor() {\r\n    this.eventDispatcher = new EventDispatcher();\r\n  }\r\n\r\n  /**\r\n   * Alias for `addEventListener`. You can listen for a variety of\r\n   * events off of the engine; see the events section below for a complete list.\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public on(eventName: string, handler: (event: any) => void) {\r\n    this.eventDispatcher.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Alias for `removeEventListener`. If only the eventName is specified\r\n   * it will remove all handlers registered for that specific event. If the eventName\r\n   * and the handler instance are specified only that handler will be removed.\r\n   *\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public off(eventName: string, handler?: (event: any) => void) {\r\n    this.eventDispatcher.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Emits a new event\r\n   * @param eventName   Name of the event to emit\r\n   * @param eventObject Data associated with this event\r\n   */\r\n  public emit(eventName: string, eventObject: any) {\r\n    this.eventDispatcher.emit(eventName, eventObject);\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: any) => void) {\r\n    this.eventDispatcher.once(eventName, handler);\r\n  }\r\n}\r\n", "import { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\r\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\r\n */\r\nexport type LineCapStyle = 'butt' | 'round' | 'square';\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw a line on canvas context\r\n *\r\n * @param ctx The canvas context\r\n * @param color The color of the line\r\n * @param x1 The start x coordinate\r\n * @param y1 The start y coordinate\r\n * @param x2 The ending x coordinate\r\n * @param y2 The ending y coordinate\r\n * @param thickness The line thickness\r\n * @param cap The [[LineCapStyle]] (butt, round, or square)\r\n */\r\nexport function line(\r\n  ctx: CanvasRenderingContext2D,\r\n  color: Color = Color.Red,\r\n  x1: number,\r\n  y1: number,\r\n  x2: number,\r\n  y2: number,\r\n  thickness: number = 1,\r\n  cap: LineCapStyle = 'butt'\r\n) {\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.lineWidth = thickness;\r\n  ctx.lineCap = cap;\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.moveTo(x1, y1);\r\n  ctx.lineTo(x2, y2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw the vector as a point onto the canvas.\r\n */\r\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw the vector as a line onto the canvas starting a origin point.\r\n */\r\n/* istanbul ignore next */\r\n/**\r\n *\r\n */\r\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\r\n  const c = color ? color.toString() : 'blue';\r\n  const v = vector.scale(scale);\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = c;\r\n  ctx.moveTo(origin.x, origin.y);\r\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Represents border radius values\r\n */\r\nexport interface BorderRadius {\r\n  /**\r\n   * Top-left\r\n   */\r\n  tl: number;\r\n  /**\r\n   * Top-right\r\n   */\r\n  tr: number;\r\n  /**\r\n   * Bottom-right\r\n   */\r\n  br: number;\r\n  /**\r\n   * Bottom-left\r\n   */\r\n  bl: number;\r\n}\r\n\r\n/**\r\n * Draw a round rectangle on a canvas context\r\n *\r\n * @param ctx The canvas context\r\n * @param x The top-left x coordinate\r\n * @param y The top-left y coordinate\r\n * @param width The width of the rectangle\r\n * @param height The height of the rectangle\r\n * @param radius The border radius of the rectangle\r\n * @param stroke The [[Color]] to stroke rectangle with\r\n * @param fill The [[Color]] to fill rectangle with\r\n */\r\nexport function roundRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  radius: number | BorderRadius = 5,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  let br: BorderRadius;\r\n\r\n  if (typeof radius === 'number') {\r\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\r\n  } else {\r\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n\r\n    for (const prop in defaultRadius) {\r\n      if (defaultRadius.hasOwnProperty(prop)) {\r\n        const side = <keyof BorderRadius>prop;\r\n        br[side] = radius[side] || defaultRadius[side];\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + br.tl, y);\r\n  ctx.lineTo(x + width - br.tr, y);\r\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\r\n  ctx.lineTo(x + width, y + height - br.br);\r\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\r\n  ctx.lineTo(x + br.bl, y + height);\r\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\r\n  ctx.lineTo(x, y + br.tl);\r\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function circle(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n", "export default \"data:image/png;base64,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\"", "import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { watch } from '../Util/Watch';\r\nimport { TextureLoader } from './Context/texture-loader';\r\nimport { ImageFiltering } from './Filtering';\r\n\r\n\r\nexport interface RasterOptions {\r\n  /**\r\n   * Optionally specify a quality number, which is how much to scale the internal Raster. Default is 1.\r\n   *\r\n   * For example if the quality is set to 2, it doubles the internal raster bitmap in memory.\r\n   *\r\n   * Adjusting this value can be useful if you are working with small rasters.\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\r\n   */\r\n  smoothing?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the color of the raster's bitmap context, by default [[Color.Black]]\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\r\n   */\r\n  strokeColor?: Color;\r\n\r\n  /**\r\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\r\n   */\r\n  lineWidth?: number;\r\n\r\n  /**\r\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\r\n   */\r\n  lineDash?: number[];\r\n\r\n  /**\r\n   * Optionally specify the line end style, default is \"butt\".\r\n   */\r\n  lineCap?: 'butt' | 'round' | 'square';\r\n\r\n  /**\r\n   * Optionally specify the padding to apply to the bitmap\r\n   */\r\n  padding?: number;\r\n\r\n  /**\r\n   * Optionally specify what image filtering mode should be used, [[ImageFiltering.Pixel]] for pixel art,\r\n   * [[ImageFiltering.Blended]] for hi-res art\r\n   *\r\n   * By default unset, rasters defer to the engine antialiasing setting\r\n   */\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\n/**\r\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\r\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\r\n *\r\n * Implementors must implement the [[Raster.execute]] method to rasterize their drawing.\r\n */\r\nexport abstract class Raster extends Graphic {\r\n  public filtering: ImageFiltering = null;\r\n  public lineCap: 'butt' | 'round' | 'square' = 'butt';\r\n  public quality: number = 1;\r\n\r\n  public _bitmap: HTMLCanvasElement;\r\n  protected _ctx: CanvasRenderingContext2D;\r\n  private _dirty: boolean = true;\r\n\r\n  constructor(options?: GraphicOptions & RasterOptions) {\r\n    super(options);\r\n    if (options) {\r\n      this.quality = options.quality ?? this.quality;\r\n      this.color = options.color ?? Color.Black;\r\n      this.strokeColor = options?.strokeColor;\r\n      this.smoothing = options.smoothing ?? this.smoothing;\r\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\r\n      this.lineDash = options.lineDash ?? this.lineDash;\r\n      this.lineCap = options.lineCap ?? this.lineCap;\r\n      this.padding = options.padding ?? this.padding;\r\n      this.filtering = options.filtering ?? this.filtering;\r\n    }\r\n    this._bitmap = document.createElement('canvas');\r\n    // get the default canvas width/height as a fallback\r\n    const bitmapWidth = options?.width ?? this._bitmap.width;\r\n    const bitmapHeight = options?.height ?? this._bitmap.height;\r\n    this.width = bitmapWidth;\r\n    this.height = bitmapHeight;\r\n    const maybeCtx = this._bitmap.getContext('2d');\r\n    if (!maybeCtx) {\r\n      /* istanbul ignore next */\r\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\r\n    } else {\r\n      this._ctx = maybeCtx;\r\n    }\r\n  }\r\n\r\n  public cloneRasterOptions(): RasterOptions {\r\n    return {\r\n      color: this.color ? this.color.clone() : null,\r\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\r\n      smoothing: this.smoothing,\r\n      lineWidth: this.lineWidth,\r\n      lineDash: this.lineDash,\r\n      lineCap: this.lineCap,\r\n      quality: this.quality,\r\n      padding: this.padding\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\r\n   */\r\n  public get dirty() {\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\r\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\r\n   */\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n\r\n  private _originalWidth: number;\r\n  /**\r\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding`s or `quality` set will be factored into the width\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._getTotalWidth() * this.scale.x);\r\n  }\r\n  public set width(value: number) {\r\n    value /= Math.abs(this.scale.x);\r\n    this._bitmap.width = value;\r\n    this._originalWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _originalHeight: number;\r\n  /**\r\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding` or `quality` set will be factored into the height\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._getTotalHeight() * this.scale.y);\r\n  }\r\n\r\n  public set height(value: number) {\r\n    value /= Math.abs(this.scale.y);\r\n    this._bitmap.height = value;\r\n    this._originalHeight = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _getTotalWidth() {\r\n    return ((this._originalWidth ?? this._bitmap.width) + this.padding * 2) * 1;\r\n  }\r\n\r\n  private _getTotalHeight() {\r\n    return ((this._originalHeight ?? this._bitmap.height) + this.padding * 2) * 1;\r\n  }\r\n\r\n  /**\r\n   * Returns the local bounds of the Raster including the padding\r\n   */\r\n  public get localBounds() {\r\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  private _smoothing: boolean = false;\r\n  /**\r\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get smoothing() {\r\n    return this._smoothing;\r\n  }\r\n  public set smoothing(value: boolean) {\r\n    this._smoothing = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\r\n  /**\r\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get color() {\r\n    return this._color;\r\n  }\r\n  public set color(value) {\r\n    this.flagDirty();\r\n    this._color = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _strokeColor: Color;\r\n  /**\r\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get strokeColor() {\r\n    return this._strokeColor;\r\n  }\r\n  public set strokeColor(value) {\r\n    this.flagDirty();\r\n    this._strokeColor = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _lineWidth: number = 1;\r\n  /**\r\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get lineWidth() {\r\n    return this._lineWidth;\r\n  }\r\n  public set lineWidth(value) {\r\n    this._lineWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _lineDash: number[] = [];\r\n  public get lineDash() {\r\n    return this._lineDash;\r\n  }\r\n\r\n  public set lineDash(value) {\r\n    this._lineDash = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _padding: number = 0;\r\n  public get padding() {\r\n    return this._padding;\r\n  }\r\n\r\n  public set padding(value: number) {\r\n    this._padding = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\r\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\r\n   */\r\n  public rasterize(): void {\r\n    this._dirty = false;\r\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\r\n    this._ctx.save();\r\n    this._applyRasterProperties(this._ctx);\r\n    this.execute(this._ctx);\r\n    this._ctx.restore();\r\n    // The webgl texture needs to be updated if it exists after a raster cycle\r\n    TextureLoader.load(this._bitmap, this.filtering, true);\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    this._bitmap.width = this._getTotalWidth() * this.quality;\r\n    this._bitmap.height = this._getTotalHeight() * this.quality;\r\n    ctx.scale(this.quality, this.quality);\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.lineCap = this.lineCap;\r\n    ctx.strokeStyle = this.strokeColor?.toString();\r\n    ctx.fillStyle = this.color?.toString();\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this._dirty) {\r\n      this.rasterize();\r\n    }\r\n    ex.scale(1 / this.quality, 1 / this.quality);\r\n    ex.drawImage(this._bitmap, x, y);\r\n  }\r\n\r\n  /**\r\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\r\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\r\n   * @param ctx Canvas to draw the graphic to\r\n   */\r\n  abstract execute(ctx: CanvasRenderingContext2D): void;\r\n}\r\n", "import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\r\n *\r\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n", "import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like [[WebAudioInstance]]\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n", "\r\nexport interface State {\r\n  name?: string;\r\n  transitions: string[];\r\n  onEnter?: (context: {from: string, eventData?: any, data: any}) => boolean | void;\r\n  onState?: () => any;\r\n  onExit?: (context: {to: string, data: any}) => boolean | void;\r\n  onUpdate?: (data: any, elapsedMs: number) => any;\r\n}\r\n\r\nexport interface StateMachineDescription {\r\n  start: string,\r\n  states: { [name: string]: State }\r\n}\r\n\r\nexport type PossibleStates<TMachine> = TMachine extends StateMachineDescription ? Extract<keyof TMachine['states'], string> : never;\r\n\r\nexport interface StateMachineState {\r\n  data: any;\r\n  currentState: string;\r\n}\r\n\r\nexport class StateMachine<TPossibleStates extends string, TData> {\r\n  public startState: State;\r\n  private _currentState: State;\r\n  public get currentState(): State {\r\n    return this._currentState;\r\n  }\r\n  public set currentState(state: State) {\r\n    this._currentState = state;\r\n  }\r\n  public states = new Map<string, State>();\r\n  public data: TData;\r\n\r\n  static create<TMachine extends StateMachineDescription, TData>(\r\n    machineDescription: TMachine, data?: TData): StateMachine<PossibleStates<TMachine>, TData> {\r\n    const machine = new StateMachine<PossibleStates<TMachine>, TData>();\r\n    machine.data = data;\r\n    for (const stateName in machineDescription.states) {\r\n      machine.states.set(stateName as PossibleStates<TMachine>, {\r\n        name: stateName,\r\n        ...machineDescription.states[stateName]\r\n      });\r\n    }\r\n\r\n    // validate transitions are states\r\n    for (const state of machine.states.values()) {\r\n      for (const transitionState of state.transitions) {\r\n        if (transitionState === '*') {\r\n          continue;\r\n        }\r\n        if (!machine.states.has(transitionState)) {\r\n          throw Error(\r\n            `Invalid state machine, state [${state.name}] has a transition to another state that doesn't exist [${transitionState}]`\r\n          );\r\n        }\r\n      }\r\n    }\r\n    machine.currentState = machine.startState = machine.states.get(machineDescription.start);\r\n    return machine;\r\n  }\r\n\r\n  in(state: TPossibleStates): boolean {\r\n    return this.currentState.name === state;\r\n  }\r\n\r\n  go(stateName: TPossibleStates, eventData?: any): boolean {\r\n    if (this.currentState.transitions.includes(stateName) || this.currentState.transitions.includes('*')) {\r\n      const potentialNewState = this.states.get(stateName);\r\n      if (this.currentState.onExit) {\r\n        const canExit = this.currentState?.onExit({to: potentialNewState.name, data: this.data});\r\n        if (canExit === false) {\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if (potentialNewState?.onEnter) {\r\n        const canEnter = potentialNewState?.onEnter({from: this.currentState.name, eventData, data: this.data});\r\n        if (canEnter === false) {\r\n          return false;\r\n        }\r\n      }\r\n      // console.log(`${this.currentState.name} => ${potentialNewState.name} (${eventData})`);\r\n      this.currentState = potentialNewState;\r\n      if (this.currentState?.onState) {\r\n        this.currentState.onState();\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  update(elapsedMs: number) {\r\n    if (this.currentState.onUpdate) {\r\n      this.currentState.onUpdate(this.data, elapsedMs);\r\n    }\r\n  }\r\n\r\n  save(saveKey: string) {\r\n    localStorage.setItem(saveKey, JSON.stringify({\r\n      currentState: this.currentState.name,\r\n      data: this.data\r\n    }));\r\n  }\r\n\r\n  restore(saveKey: string) {\r\n    const state: StateMachineState = JSON.parse(localStorage.getItem(saveKey));\r\n    this.currentState = this.states.get(state.currentState);\r\n    this.data = state.data;\r\n  }\r\n}\r\n\r\n", "import { StateMachine } from '../../Util/StateMachine';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { clamp } from '../../Math/util';\r\nimport { AudioContextFactory } from './AudioContext';\r\n\r\ninterface SoundState {\r\n  startedAt: number;\r\n  pausedAt: number;\r\n}\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _instance: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n  private _playingResolve: (value: boolean) => void;\r\n  private _playingPromise = new Promise<boolean>((resolve) => {\r\n    this._playingResolve = resolve;\r\n  });\r\n  private _stateMachine = StateMachine.create({\r\n    start: 'STOPPED',\r\n    states: {\r\n      PLAYING: {\r\n        onEnter: ({data}: {from: string, data: SoundState}) => {\r\n\r\n          // Buffer nodes are single use\r\n          this._createNewBufferSource();\r\n          this._handleEnd();\r\n          this._instance.start(0, data.pausedAt * this._playbackRate, this.duration);\r\n          data.startedAt = (this._audioContext.currentTime - data.pausedAt);\r\n          data.pausedAt = 0;\r\n        },\r\n        onState: () => this._playStarted(),\r\n        onExit: ({to}) => {\r\n          // If you've exited early only resolve if explicitly STOPPED\r\n          if (to === 'STOPPED') {\r\n            this._playingResolve(true);\r\n          }\r\n          // Whenever you're not playing... you stop!\r\n          this._instance.onended = null; // disconnect the wired on-end handler\r\n          this._instance.disconnect();\r\n          this._instance.stop(0);\r\n          this._instance = null;\r\n        },\r\n        transitions: ['STOPPED', 'PAUSED', 'SEEK']\r\n      },\r\n      SEEK: {\r\n        onEnter: ({ eventData: position, data }: {eventData?: number, data: SoundState}) => {\r\n          data.pausedAt = (position ?? 0) / this._playbackRate;\r\n          data.startedAt = 0;\r\n        },\r\n        transitions: ['*']\r\n      },\r\n      STOPPED: {\r\n        onEnter: ({data}: {from: string, data: SoundState}) => {\r\n          data.pausedAt = 0;\r\n          data.startedAt = 0;\r\n          this._playingResolve(true);\r\n        },\r\n        transitions: ['PLAYING', 'PAUSED', 'SEEK']\r\n      },\r\n      PAUSED: {\r\n        onEnter: ({data}: {data: SoundState}) => {\r\n          // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n          // default is 1.0\r\n          // we need to invert it to get the time scale\r\n          data.pausedAt = (this._audioContext.currentTime - data.startedAt);\r\n        },\r\n        transitions: ['PLAYING', 'STOPPED', 'SEEK']\r\n      }\r\n    }\r\n  }, {\r\n    startedAt: 0,\r\n    pausedAt: 0\r\n  } as SoundState);\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.value = this._playbackRate;\r\n    this._instance.connect(this._volumeNode);\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n  }\r\n\r\n  private _handleEnd() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => {\r\n        this._playingResolve(true);\r\n      };\r\n    }\r\n  }\r\n\r\n  private _volume = 1;\r\n  private _loop = false;\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  private _playStarted: () => any = () => {};\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      if (!this.loop) {\r\n        this._instance.onended = () => {\r\n          this._playingResolve(true);\r\n        };\r\n      }\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._stateMachine.in('PLAYING') && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Returns the set duration to play, otherwise returns the total duration if unset\r\n   */\r\n  public get duration() {\r\n    return this._duration ?? this.getTotalPlaybackDuration();\r\n  }\r\n\r\n  /**\r\n   * Set the duration that this audio should play.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number) {\r\n    this._duration = duration;\r\n  }\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._stateMachine.in('PLAYING');\r\n  }\r\n\r\n  public isPaused() {\r\n    return this._stateMachine.in('PAUSED') || this._stateMachine.in('SEEK');\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    this._playStarted = playStarted;\r\n    this._stateMachine.go('PLAYING');\r\n    return this._playingPromise;\r\n  }\r\n\r\n  public pause() {\r\n    this._stateMachine.go('PAUSED');\r\n  }\r\n\r\n  public stop() {\r\n    this._stateMachine.go('STOPPED');\r\n  }\r\n\r\n  public seek(position: number) {\r\n    this._stateMachine.go('PAUSED');\r\n    this._stateMachine.go('SEEK', position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    return this._src.duration;\r\n  }\r\n\r\n  public getPlaybackPosition() {\r\n    const {pausedAt, startedAt} =  this._stateMachine.data;\r\n    if (pausedAt) {\r\n      return pausedAt * this._playbackRate;\r\n    }\r\n    if (startedAt) {\r\n      return (this._audioContext.currentTime - startedAt) * this._playbackRate;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _playbackRate = 1.0;\r\n  public set playbackRate(playbackRate: number) {\r\n    this._instance.playbackRate.value = this._playbackRate = playbackRate;\r\n  }\r\n\r\n  public get playbackRate() {\r\n    return this._instance.playbackRate.value;\r\n  }\r\n}\r\n", "import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(target: Sound, public track?: WebAudioInstance) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n", "import { Logger } from './Log';\r\n\r\n/**\r\n * Whether or not the browser can play this file as HTML5 Audio\r\n */\r\nexport function canPlayFile(file: string): boolean {\r\n  try {\r\n    const a = new Audio();\r\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\r\n    const type = file.match(filetype)[1];\r\n    if (a.canPlayType('audio/' + type)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (e) {\r\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\r\n    return false;\r\n  }\r\n}\r\n", "import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Class } from '../../Class';\r\n\r\n/**\r\n * The [[Sound]] object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\r\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\r\n */\r\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\r\n  public logger: Logger = Logger.getInstance();\r\n  public data: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  private _duration: number | undefined;\r\n  /**\r\n   * Get the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   */\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n  /**\r\n   * Set the duration that this audio should play. If unset the total natural playback duration will be used.\r\n   *\r\n   * Note: if you seek to a specific point the duration will start from that point, for example\r\n   *\r\n   * If you have a 10 second clip, seek to 5 seconds, then set the duration to 2, it will play the clip from 5-7 seconds.\r\n   */\r\n  public set duration(duration: number | undefined){\r\n    this._duration = duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _isStopped = false;\r\n  // private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _playbackRate = 1.0;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    super();\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = this._duration ?? audiobuffer?.duration ?? undefined;\r\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return this.data = audiobuffer;\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  public isPaused(): boolean {\r\n    return this._tracks.some(t => t.isPaused());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this.isPaused()) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n  public get playbackRate(): number {\r\n    return this._playbackRate;\r\n  }\r\n\r\n  public set playbackRate(playbackRate: number) {\r\n    this._playbackRate = playbackRate;\r\n    this._tracks.forEach(t => {\r\n      t.playbackRate = this._playbackRate;\r\n    });\r\n  }\r\n\r\n  public seek(position: number, trackId = 0) {\r\n    if (this._tracks.length === 0) {\r\n      this._getTrackInstance(this.data);\r\n    }\r\n\r\n    this._tracks[trackId].seek(position);\r\n  }\r\n\r\n  public getTotalPlaybackDuration() {\r\n    return this.data.duration;\r\n  }\r\n\r\n  /**\r\n   * Return the current playback time of the playing track in seconds from the start.\r\n   *\r\n   * Optionally specify the track to query if multiple are playing at once.\r\n   * @param trackId\r\n   */\r\n  public getPlaybackPosition(trackId = 0) {\r\n    if (this._tracks.length) {\r\n      return this._tracks[trackId].getPlaybackPosition();\r\n    }\r\n    return 0;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track [[Audio]] which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this.isPaused) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(track.play().then(() => {\r\n          this.emit('playbackend', new NativeSoundEvent(this, track as WebAudioInstance));\r\n          this._tracks.splice(this.getTrackId(track), 1);\r\n          return true;\r\n        }));\r\n      }\r\n\r\n      this.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = await this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    // when done, remove track\r\n    this.emit('playbackend', new NativeSoundEvent(this, track));\r\n    this._tracks.splice(this.getTrackId(track), 1);\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration;\r\n    newTrack.playbackRate = this._playbackRate;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n}\r\n", "import { Color } from './Color';\r\nimport { WebAudio } from './Util/WebAudio';\r\nimport { Engine } from './Engine';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Class } from './Class';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Canvas } from './Graphics/Canvas';\r\nimport { Vector } from './Math/vector';\r\nimport { delay } from './Util/Util';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { clamp } from './Math/util';\r\nimport { Sound } from './Resources/Sound/Sound';\r\nimport { Future } from './Util/Future';\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\r\n  public canvas: Canvas = new Canvas({\r\n    filtering: ImageFiltering.Blended,\r\n    smoothing: true,\r\n    cache: true,\r\n    draw: this.draw.bind(this)\r\n  });\r\n  private _resourceList: Loadable<any>[] = [];\r\n  private _index = 0;\r\n\r\n  private _playButtonShown: boolean = false;\r\n  private _resourceCount: number = 0;\r\n  private _numLoaded: number = 0;\r\n  private _progressCounts: { [key: string]: number } = {};\r\n  private _totalCounts: { [key: string]: number } = {};\r\n  private _engine: Engine;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement: HTMLImageElement;\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement: HTMLElement;\r\n  protected _playButtonElement: HTMLButtonElement;\r\n  protected _styleBlock: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]) {\r\n    super();\r\n\r\n    if (loadables) {\r\n      this.addResources(loadables);\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    this._engine = engine;\r\n    this.canvas.width = this._engine.canvas.width;\r\n    this.canvas.height = this._engine.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    const key = this._index++;\r\n    this._resourceList.push(loadable);\r\n    this._progressCounts[key] = 0;\r\n    this._totalCounts[key] = 1;\r\n    this._resourceCount++;\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resourceCount;\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public async showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      // Delay is to give the logo a chance to show, otherwise don't delay\r\n      await delay(500, this._engine?.clock);\r\n    } else {\r\n      const resizeHandler = () => {\r\n        this._positionPlayButton();\r\n      };\r\n      if (this._engine?.browser) {\r\n        this._engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      this._positionPlayButton();\r\n      const playButtonClicked = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this._engine?.browser) {\r\n            this._engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n      });\r\n\r\n      return await playButtonClicked;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null;\r\n      this._playButtonElement = null;\r\n      this._styleBlock = null;\r\n    }\r\n  }\r\n\r\n  update(_engine: Engine, _delta: number): void {\r\n    // override me\r\n  }\r\n\r\n  data: Loadable<any>[];\r\n\r\n  private _loadingFuture = new Future<void>();\r\n  public areResourcesLoaded() {\r\n    return this._loadingFuture.promise;\r\n  }\r\n\r\n  /**\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete AND the user has clicked the \"Play button\"\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await this._image?.decode(); // decode logo if it exists\r\n    this.canvas.flagDirty();\r\n\r\n    await Promise.all(\r\n      this._resourceList.map(async (r) => {\r\n        await r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n          this.canvas.flagDirty();\r\n        });\r\n      })\r\n    );\r\n    // Wire all sound to the engine\r\n    for (const resource of this._resourceList) {\r\n      if (resource instanceof Sound) {\r\n        resource.wireEngine(this._engine);\r\n      }\r\n    }\r\n\r\n    this._loadingFuture.resolve();\r\n\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200, this._engine?.clock);\r\n    this.canvas.flagDirty();\r\n\r\n    await this.showPlayButton();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await WebAudio.unlock();\r\n\r\n    return (this.data = this._resourceList);\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    if (this._engine) {\r\n      const screenHeight = this._engine.screen.viewport.height;\r\n      const screenWidth = this._engine.screen.viewport.width;\r\n      if (this._playButtonRootElement) {\r\n        const left = this._engine.canvas.offsetLeft;\r\n        const top = this._engine.canvas.offsetTop;\r\n        const buttonWidth = this._playButton.clientWidth;\r\n        const buttonHeight = this._playButton.clientHeight;\r\n        if (this.playButtonPosition) {\r\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n        } else {\r\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\r\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this._engine.getAntialiasing();\r\n    this._engine.setAntialiasing(true);\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this._engine.setAntialiasing(oldAntialias);\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this._engine.setAntialiasing(oldAntialias);\r\n  }\r\n}\r\n", "import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // (\u2713)\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // (\u2717)\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function() {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function() {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function() {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function() {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function() {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n", "/**\r\n * An enum that describes the types of collisions bodies can participate in\r\n */\r\nexport enum CollisionType {\r\n  /**\r\n   * Bodies with the `PreventCollision` setting do not participate in any\r\n   * collisions and do not raise collision events.\r\n   */\r\n  PreventCollision = 'PreventCollision',\r\n  /**\r\n   * Bodies with the `Passive` setting only raise collision events, but are not\r\n   * influenced or moved by other bodies and do not influence or move other bodies.\r\n   * This is useful for use in trigger type behavior.\r\n   */\r\n  Passive = 'Passive',\r\n  /**\r\n   * Bodies with the `Active` setting raise collision events and participate\r\n   * in collisions with other bodies and will be push or moved by bodies sharing\r\n   * the `Active` or `Fixed` setting.\r\n   */\r\n  Active = 'Active',\r\n  /**\r\n   * Bodies with the `Fixed` setting raise collision events and participate in\r\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\r\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\r\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\r\n   * not be pushed or moved by each other, they will not interact except to throw\r\n   * collision events.\r\n   */\r\n  Fixed = 'Fixed'\r\n}\r\n", "import { Flags } from '../Flags';\r\nimport { Logger } from './Log';\r\n\r\n/**\r\n * Obsolete decorator options\r\n */\r\nexport interface ObsoleteOptions {\r\n  // Optionally specify a custom message\r\n  message?: string;\r\n  // Optionally indicate that an alternate method to the obsolete one exists\r\n  alternateMethod?: string;\r\n  // Optional show stack trace, by default off\r\n  showStackTrace?: boolean;\r\n}\r\n\r\nexport const maxMessages = 5;\r\nconst obsoleteMessage: { [messageCount: string]: number } = {};\r\nexport const resetObsoleteCounter = () => {\r\n  for (const message in obsoleteMessage) {\r\n    obsoleteMessage[message] = 0;\r\n  }\r\n};\r\n\r\nconst logMessage = (message: string, options: ObsoleteOptions) => {\r\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\r\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\r\n    Logger.getInstance().warn(message);\r\n\r\n    // tslint:disable-next-line: no-console\r\n    if (console.trace && options.showStackTrace) {\r\n      // tslint:disable-next-line: no-console\r\n      console.trace();\r\n    }\r\n  }\r\n  obsoleteMessage[message]++;\r\n};\r\n\r\n/**\r\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\r\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\r\n */\r\nexport function obsolete(options?: ObsoleteOptions): any {\r\n  options = {\r\n    message: 'This feature will be removed in future versions of Excalibur.',\r\n    alternateMethod: null,\r\n    showStackTrace: false,\r\n    ...options\r\n  };\r\n\r\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\r\n    if (\r\n      descriptor &&\r\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\r\n    ) {\r\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\r\n    }\r\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\r\n\r\n    const message =\r\n      `${methodSignature} is marked obsolete: ${options.message}` +\r\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\r\n\r\n    if (!obsoleteMessage[message]) {\r\n      obsoleteMessage[message] = 0;\r\n    }\r\n\r\n    // If descriptor is null it is a class\r\n    const method = descriptor ? { ...descriptor } : target;\r\n    if (!descriptor) {\r\n      // with es2015 classes we need to change our decoration tactic\r\n      class DecoratedClass extends method {\r\n        constructor(...args: any) {\r\n          logMessage(message, options);\r\n          super(...args);\r\n        }\r\n      }\r\n      return DecoratedClass;\r\n    }\r\n\r\n    if (descriptor && descriptor.value) {\r\n      method.value = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.value.apply(this, arguments);\r\n      };\r\n      return method;\r\n    }\r\n\r\n    if (descriptor && descriptor.get) {\r\n      method.get = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.get.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    if (descriptor && descriptor.set) {\r\n      method.set = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.set.apply(this, arguments);\r\n      };\r\n    }\r\n    return method;\r\n  };\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n\r\n/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum CollisionResolutionStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n\r\n/**\r\n * Possible broadphase collision pair identification strategies\r\n *\r\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n * potential collision pairs which is O(nlog(n)) faster.\r\n */\r\nexport enum BroadphaseStrategy {\r\n  DynamicAABBTree\r\n}\r\n\r\n/**\r\n * Possible numerical integrators for position and velocity\r\n */\r\nexport enum Integrator {\r\n  Euler\r\n}\r\n\r\n/**\r\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\r\n */\r\n/* istanbul ignore next */\r\nexport class Physics {\r\n  /**\r\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\r\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\r\n   *\r\n   * This is a great way to globally simulate effects like gravity.\r\n   */\r\n  public static acc = new Vector(0, 0);\r\n  public static get gravity() {\r\n    return Physics.acc;\r\n  }\r\n  public static set gravity(v: Vector) {\r\n    Physics.acc = v;\r\n  }\r\n\r\n  /**\r\n   * Globally switches all Excalibur physics behavior on or off.\r\n   */\r\n  public static enabled = true;\r\n\r\n  /**\r\n   * Gets or sets the broadphase pair identification strategy.\r\n   *\r\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n   * potential collision pairs which is O(nlog(n)) faster.\r\n   */\r\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\r\n\r\n  /**\r\n   * Gets or sets the global collision resolution strategy (narrowphase).\r\n   *\r\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\r\n   *\r\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  /**\r\n   * The default mass to use if none is specified\r\n   */\r\n  public static defaultMass: number = 10;\r\n  /**\r\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\r\n   */\r\n  public static integrator: Integrator = Integrator.Euler;\r\n\r\n  /**\r\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\r\n   */\r\n  public static useArcadePhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  }\r\n\r\n  /**\r\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static useRealisticPhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\r\n  }\r\n\r\n  /**\r\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   */\r\n  public static dynamicTreeVelocityMultiplier = 2;\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\r\n  })\r\n  public static get dynamicTreeVelocityMultiplyer() {\r\n    return Physics.dynamicTreeVelocityMultiplier;\r\n  }\r\n\r\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\r\n    Physics.dynamicTreeVelocityMultiplier = value;\r\n  }\r\n\r\n  /**\r\n   * Pad RigidBody BoundingBox by a constant amount\r\n   */\r\n  public static boundsPadding = 5;\r\n\r\n  /**\r\n   * Number of position iterations (overlap) to run in the solver\r\n   */\r\n  public static positionIterations = 3;\r\n\r\n  /**\r\n   * Number of velocity iteration (response) to run in the solver\r\n   */\r\n  public static velocityIterations = 8;\r\n\r\n  /**\r\n   * Amount of overlap to tolerate in pixels\r\n   */\r\n  public static slop = 1;\r\n\r\n  /**\r\n   * Amount of positional overlap correction to apply each position iteration of the solver\r\n   * O - meaning no correction, 1 - meaning correct all overlap\r\n   */\r\n  public static steeringFactor = 0.2;\r\n\r\n  /**\r\n   * Warm start set to true re-uses impulses from previous frames back in the solver\r\n   */\r\n  public static warmStart = true;\r\n\r\n  /**\r\n   * By default bodies do not sleep\r\n   */\r\n  public static bodiesCanSleepByDefault = false;\r\n\r\n  /**\r\n   * Surface epsilon is used to help deal with surface penetration\r\n   */\r\n  public static surfaceEpsilon = 0.1;\r\n\r\n  public static sleepEpsilon = 0.07;\r\n\r\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\r\n\r\n  public static sleepBias = 0.9;\r\n\r\n  /**\r\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n   * bodies from tunneling through one another.\r\n   */\r\n  public static checkForFastBodies = true;\r\n\r\n  /**\r\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\r\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\r\n   * Excalibur will always perform the fast body raycast regardless of speed.\r\n   */\r\n  public static disableMinimumSpeedForFastBody = false;\r\n}\r\n", "/**\r\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}", "import { Vector } from './vector';\r\n\r\nexport interface VectorViewOptions {\r\n  getX: () => number;\r\n  getY: () => number;\r\n  setX: (x: number) => void;\r\n  setY: (y: number) => void;\r\n}\r\nexport class VectorView extends Vector {\r\n  private _getX: () => number;\r\n  private _getY: () => number;\r\n  private _setX: (x: number) => void;\r\n  private _setY: (y: number) => void;\r\n  constructor(options: VectorViewOptions) {\r\n    super(0, 0);\r\n    this._getX = options.getX;\r\n    this._getY = options.getY;\r\n    this._setX = options.setX;\r\n    this._setY = options.setY;\r\n  }\r\n  public get x() {\r\n    return (this._x = this._getX());\r\n  }\r\n\r\n  public set x(val) {\r\n    this._setX(val);\r\n    this._x = val;\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this._getY());\r\n  }\r\n  public set y(val) {\r\n    this._setY(val);\r\n    this._y = val;\r\n  }\r\n}\r\n", "import { Vector } from './vector';\r\n\r\n/**\r\n * Wraps a vector and watches for changes in the x/y, modifies the original vector.\r\n */\r\nexport class WatchVector extends Vector {\r\n  constructor(public original: Vector, public change: (x: number, y: number) => any) {\r\n    super(original.x, original.y);\r\n  }\r\n  public get x() {\r\n    return this._x = this.original.x;\r\n  }\r\n\r\n  public set x(newX: number) {\r\n    this.change(newX, this._y);\r\n    this._x = this.original.x = newX;\r\n  }\r\n\r\n  public get y() {\r\n    return this._y = this.original.y;\r\n  }\r\n\r\n  public set y(newY: number) {\r\n    this.change(this._x, newY);\r\n    this._y = this.original.y = newY;\r\n  }\r\n}", "import { AffineMatrix } from './affine-matrix';\r\nimport { canonicalizeAngle } from './util';\r\nimport { vec, Vector } from './vector';\r\nimport { VectorView } from './vector-view';\r\nimport { WatchVector } from './watch-vector';\r\n\r\nexport class Transform {\r\n  private _parent: Transform | null = null;\r\n  get parent() {\r\n    return this._parent;\r\n  }\r\n  set parent(transform: Transform) {\r\n    if (this._parent) {\r\n      const index = this._parent._children.indexOf(this);\r\n      if (index > -1) {\r\n        this._parent._children.splice(index, 1);\r\n      }\r\n    }\r\n    this._parent = transform;\r\n    if (this._parent) {\r\n      this._parent._children.push(this);\r\n    }\r\n    this.flagDirty();\r\n  }\r\n  get children(): readonly Transform[] {\r\n    return this._children;\r\n  }\r\n  private _children: Transform[] = [];\r\n\r\n  private _pos: Vector = vec(0, 0);\r\n  set pos(v: Vector) {\r\n    if (!v.equals(this._pos)) {\r\n      this._pos.x = v.x;\r\n      this._pos.y = v.y;\r\n      this.flagDirty();\r\n    }\r\n  }\r\n  get pos() {\r\n    return new WatchVector(this._pos, (x, y) => {\r\n      if (x !== this._pos.x || y !== this._pos.y) {\r\n        this.flagDirty();\r\n      }\r\n    });\r\n  }\r\n\r\n  set globalPos(v: Vector) {\r\n    let localPos = v.clone();\r\n    if (this.parent) {\r\n      localPos = this.parent.inverse.multiply(v);\r\n    }\r\n    if (!localPos.equals(this._pos)) {\r\n      this._pos = localPos;\r\n      this.flagDirty();\r\n    }\r\n  }\r\n  get globalPos() {\r\n    return new VectorView({\r\n      getX: () => this.matrix.data[4],\r\n      getY: () => this.matrix.data[5],\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const { x: newX } = this.parent.inverse.multiply(vec(x, this.pos.y));\r\n          this.pos.x = newX;\r\n        } else {\r\n          this.pos.x = x;\r\n        }\r\n        if (x !== this.matrix.data[4]) {\r\n          this.flagDirty();\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const { y: newY } = this.parent.inverse.multiply(vec(this.pos.x, y));\r\n          this.pos.y = newY;\r\n        } else {\r\n          this.pos.y = y;\r\n        }\r\n        if (y !== this.matrix.data[5]) {\r\n          this.flagDirty();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private _rotation: number = 0;\r\n  set rotation(rotation: number) {\r\n    const canonRotation = canonicalizeAngle(rotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n  get rotation() {\r\n    return this._rotation;\r\n  }\r\n\r\n  set globalRotation(rotation: number) {\r\n    let inverseRotation = 0;\r\n    if (this.parent) {\r\n      inverseRotation = this.parent.globalRotation;\r\n    }\r\n    const canonRotation = canonicalizeAngle(rotation + inverseRotation);\r\n    if (canonRotation !== this._rotation) {\r\n      this.flagDirty();\r\n    }\r\n    this._rotation = canonRotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    if (this.parent) {\r\n      return this.matrix.getRotation();\r\n    }\r\n    return this.rotation;\r\n  }\r\n\r\n  private _scale: Vector = vec(1, 1);\r\n  set scale(v: Vector) {\r\n    if (!v.equals(this._scale)) {\r\n      this._scale.x = v.x;\r\n      this._scale.y = v.y;\r\n      this.flagDirty();\r\n    }\r\n  }\r\n  get scale() {\r\n    return new WatchVector(this._scale, (x, y) => {\r\n      if (x !== this._scale.x || y !== this._scale.y) {\r\n        this.flagDirty();\r\n      }\r\n    });\r\n  }\r\n\r\n  set globalScale(v: Vector) {\r\n    let inverseScale = vec(1, 1);\r\n    if (this.parent) {\r\n      inverseScale = this.parent.globalScale;\r\n    }\r\n    this.scale = v.scale(vec(1 / inverseScale.x, 1 / inverseScale.y));\r\n  }\r\n\r\n  get globalScale() {\r\n    return new VectorView({\r\n      getX: () => this.parent ? this.matrix.getScaleX() : this.scale.x,\r\n      getY: () => this.parent ? this.matrix.getScaleY() : this.scale.y,\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const globalScaleX = this.parent.globalScale.x;\r\n          this.scale.x = x / globalScaleX;\r\n        } else {\r\n          this.scale.x = x;\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const globalScaleY = this.parent.globalScale.y;\r\n          this.scale.y = y / globalScaleY;\r\n        } else {\r\n          this.scale.y = y;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private _isDirty = false;\r\n  private _isInverseDirty = false;\r\n  private _matrix = AffineMatrix.identity();\r\n  private _inverse = AffineMatrix.identity();\r\n\r\n  public get matrix() {\r\n    if (this._isDirty) {\r\n      if (this.parent === null) {\r\n        this._matrix = this._calculateMatrix();\r\n      } else {\r\n        this._matrix = this.parent.matrix.multiply(this._calculateMatrix());\r\n      }\r\n      this._isDirty = false;\r\n    }\r\n    return this._matrix;\r\n  }\r\n\r\n  public get inverse() {\r\n    if (this._isInverseDirty) {\r\n      this._inverse = this.matrix.inverse();\r\n      this._isInverseDirty = false;\r\n    }\r\n    return this._inverse;\r\n  }\r\n\r\n  private _calculateMatrix(): AffineMatrix {\r\n    const matrix = AffineMatrix.identity()\r\n      .translate(this.pos.x, this.pos.y)\r\n      .rotate(this.rotation)\r\n      .scale(this.scale.x, this.scale.y);\r\n    return matrix;\r\n  }\r\n\r\n\r\n  public flagDirty() {\r\n    this._isDirty = true;\r\n    this._isInverseDirty = true;\r\n    for (let i = 0; i < this._children.length; i ++) {\r\n      this._children[i].flagDirty();\r\n    }\r\n  }\r\n\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multiply(point);\r\n  }\r\n\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.inverse.multiply(point);\r\n  }\r\n\r\n  public setTransform(pos: Vector, rotation: number, scale: Vector) {\r\n    this._pos.x = pos.x;\r\n    this._pos.y = pos.y;\r\n    this._rotation = canonicalizeAngle(rotation);\r\n    this._scale.x = scale.x;\r\n    this._scale.y = scale.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  public clone(dest?: Transform) {\r\n    const target = dest ?? new Transform();\r\n    this._pos.clone(target._pos);\r\n    target._rotation = this._rotation;\r\n    this._scale.clone(target._scale);\r\n    target.flagDirty();\r\n  }\r\n}", "import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Contructor Types\r\n */\r\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * Plucks the string type out of a component type\r\n */\r\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependencies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component<'my'> {\r\n *   public readonly type = 'my';\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component<TypeName extends string = string> {\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  // todo implement optional\r\n  readonly optional?: ComponentCtor[];\r\n\r\n  /**\r\n   * Type of this component, must be a unique type among component types in you game.\r\n   */\r\n  abstract readonly type: TypeName;\r\n\r\n  /**\r\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\r\n   */\r\n  owner?: Entity = null;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): this {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n\r\n/**\r\n * Tag components are a way of tagging a component with label and a simple value\r\n *\r\n * For example:\r\n *\r\n * ```typescript\r\n * const isOffscreen = new TagComponent('offscreen');\r\n * entity.addComponent(isOffscreen);\r\n * entity.tags.includes\r\n * ```\r\n */\r\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\r\nTypeName\r\n> {\r\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\r\n    super();\r\n  }\r\n}\r\n", "/**\r\n * Defines a generic message that can contain any data\r\n * @template T is the typescript Type of the data\r\n */\r\nexport interface Message<T> {\r\n  type: string;\r\n  data: T;\r\n}\r\n\r\n/**\r\n * Defines an interface for an observer to receive a message via a notify() method\r\n */\r\nexport interface Observer<T> {\r\n  notify(message: T): void;\r\n}\r\n\r\n/**\r\n * Defines an interface for something that might be an observer if a notify() is present\r\n */\r\nexport type MaybeObserver<T> = Partial<Observer<T>>;\r\n\r\n/**\r\n * Simple Observable implementation\r\n * @template T is the typescript Type that defines the data being observed\r\n */\r\nexport class Observable<T> {\r\n  public observers: Observer<T>[] = [];\r\n  public subscriptions: ((val: T) => any)[] = [];\r\n\r\n  /**\r\n   * Register an observer to listen to this observable\r\n   * @param observer\r\n   */\r\n  register(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n\r\n  /**\r\n   * Register a callback to listen to this observable\r\n   * @param func\r\n   */\r\n  subscribe(func: (val: T) => any) {\r\n    this.subscriptions.push(func);\r\n  }\r\n\r\n  /**\r\n   * Remove an observer from the observable\r\n   * @param observer\r\n   */\r\n  unregister(observer: Observer<T>) {\r\n    const i = this.observers.indexOf(observer);\r\n    if (i !== -1) {\r\n      this.observers.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a callback that is listening to this observable\r\n   * @param func\r\n   */\r\n  unsubscribe(func: (val: T) => any) {\r\n    const i = this.subscriptions.indexOf(func);\r\n    if (i !== -1) {\r\n      this.subscriptions.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcasts a message to all observers and callbacks\r\n   * @param message\r\n   */\r\n  notifyAll(message: T) {\r\n    const observersLength = this.observers.length;\r\n    for (let i = 0; i < observersLength; i++) {\r\n      this.observers[i].notify(message);\r\n    }\r\n    const subscriptionsLength = this.subscriptions.length;\r\n    for (let i = 0; i < subscriptionsLength; i++) {\r\n      this.subscriptions[i](message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all observers and callbacks\r\n   */\r\n  clear() {\r\n    this.observers.length = 0;\r\n    this.subscriptions.length = 0;\r\n  }\r\n}\r\n", "import { Vector } from '../../Math/vector';\r\nimport { CoordPlane } from '../../Math/coord-plane';\r\nimport { Transform } from '../../Math/transform';\r\nimport { Component } from '../Component';\r\nimport { Entity } from '../Entity';\r\nimport { Observable } from '../../Util/Observable';\r\n\r\n\r\nexport class TransformComponent extends Component<'ex.transform'> {\r\n  public readonly type = 'ex.transform';\r\n\r\n  private _transform = new Transform();\r\n  public get() {\r\n    return this._transform;\r\n  }\r\n\r\n  private _addChildTransform = (child: Entity) => {\r\n    const childTxComponent = child.get(TransformComponent);\r\n    if (childTxComponent) {\r\n      childTxComponent._transform.parent = this._transform;\r\n    }\r\n  };\r\n  onAdd(owner: Entity): void {\r\n    for (const child of owner.children) {\r\n      this._addChildTransform(child);\r\n    }\r\n    owner.childrenAdded$.subscribe(child => this._addChildTransform(child));\r\n    owner.childrenRemoved$.subscribe(child => {\r\n      const childTxComponent = child.get(TransformComponent);\r\n      if (childTxComponent) {\r\n        childTxComponent._transform.parent = null;\r\n      }\r\n    });\r\n  }\r\n  onRemove(_previousOwner: Entity): void {\r\n    this._transform.parent = null;\r\n  }\r\n\r\n  /**\r\n   * Observable that emits when the z index changes on this component\r\n   */\r\n  public zIndexChanged$ = new Observable<number>();\r\n  private _z = 0;\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public get z(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    const oldz = this._z;\r\n    this._z = val;\r\n    if (oldz !== val) {\r\n      this.zIndexChanged$.notifyAll(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\r\n   */\r\n  public coordPlane = CoordPlane.World;\r\n\r\n  get pos() {\r\n    return this._transform.pos;\r\n  }\r\n  set pos(v: Vector) {\r\n    this._transform.pos = v;\r\n  }\r\n\r\n  get globalPos() {\r\n    return this._transform.globalPos;\r\n  }\r\n  set globalPos(v: Vector) {\r\n    this._transform.globalPos = v;\r\n  }\r\n\r\n  get rotation() {\r\n    return this._transform.rotation;\r\n  }\r\n  set rotation(rotation) {\r\n    this._transform.rotation = rotation;\r\n  }\r\n\r\n  get globalRotation() {\r\n    return this._transform.globalRotation;\r\n  }\r\n  set globalRotation(rotation) {\r\n    this._transform.globalRotation = rotation;\r\n  }\r\n\r\n  get scale() {\r\n    return this._transform.scale;\r\n  }\r\n  set scale(v: Vector) {\r\n    this._transform.scale = v;\r\n  }\r\n\r\n  get globalScale() {\r\n    return this._transform.globalScale;\r\n  }\r\n  set globalScale(v: Vector) {\r\n    this._transform.globalScale = v;\r\n  }\r\n\r\n  applyInverse(v: Vector) {\r\n    return this._transform.applyInverse(v);\r\n  }\r\n\r\n  apply(v: Vector) {\r\n    return this._transform.apply(v);\r\n  }\r\n}", "import { Vector } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Motion {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  vel: Vector;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  acc: Vector;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  scaleFactor: Vector;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  angularVelocity: number;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  torque: number;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  inertia: number;\r\n}\r\n\r\nexport class MotionComponent extends Component<'ex.motion'> {\r\n  public readonly type = 'ex.motion';\r\n\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  public scaleFactor: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  public angularVelocity = 0;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  public torque: number = 0;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  public inertia: number = 1;\r\n}\r\n", "/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   *\r\n   * @param collisionGroups\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    return CollisionGroup.combine(collisionGroups).invert();\r\n  }\r\n}\r\n", "import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(public colliderA: Collider, public colliderB: Collider) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\r\n   * @param colliderA\r\n   * @param colliderB\r\n   */\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Prevent self collision\r\n    if (colliderA.id === colliderB.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner &&\r\n        colliderB.owner &&\r\n        colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.active || !bodyB.active) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n", "/**\r\n * A 1 dimensional projection on an axis, used to test overlaps\r\n */\r\n\r\nexport class Projection {\r\n  constructor(public min: number, public max: number) {}\r\n  public overlaps(projection: Projection): boolean {\r\n    return this.max > projection.min && projection.max > this.min;\r\n  }\r\n\r\n  public getOverlap(projection: Projection): number {\r\n    if (this.overlaps(projection)) {\r\n      if (this.max > projection.max) {\r\n        return projection.max - this.min;\r\n      } else {\r\n        return this.max - projection.min;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n", "import { Physics } from '../Physics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<T>;\r\n  public nodes: { [key: number]: TreeNode<T> };\r\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<T>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<T>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<T>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: T) {\r\n    const node = new TreeNode<T>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= Physics.boundsPadding;\r\n    b.top -= Physics.boundsPadding;\r\n    b.right += Physics.boundsPadding;\r\n    b.bottom += Physics.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<T>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: T, callback: (other: T) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.overlaps(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<T>[] {\r\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<T>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n", "import { LineSegment } from './line-segment';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * A 2D ray that can be cast into the scene to do collision detection\r\n */\r\n\r\nexport class Ray {\r\n  public pos: Vector;\r\n  public dir: Vector;\r\n\r\n  /**\r\n   * @param pos The starting position for the ray\r\n   * @param dir The vector indicating the direction of the ray\r\n   */\r\n  constructor(pos: Vector, dir: Vector) {\r\n    this.pos = pos;\r\n    this.dir = dir.normalize();\r\n  }\r\n\r\n  /**\r\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\r\n   * This number indicates the mathematical intersection time.\r\n   * @param line  The line to test\r\n   */\r\n  public intersect(line: LineSegment): number {\r\n    const numerator = line.begin.sub(this.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\r\n      return -1;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = this.dir.cross(line.getSlope());\r\n    if (divisor === 0) {\r\n      return -1;\r\n    }\r\n\r\n    const t = numerator.cross(line.getSlope()) / divisor;\r\n\r\n    if (t >= 0) {\r\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return t;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  public intersectPoint(line: LineSegment): Vector {\r\n    const time = this.intersect(line);\r\n    if (time < 0) {\r\n      return null;\r\n    }\r\n    return this.getPoint(time);\r\n  }\r\n\r\n  /**\r\n   * Returns the point of intersection given the intersection time\r\n   */\r\n  public getPoint(time: number): Vector {\r\n    return this.pos.add(this.dir.scale(time));\r\n  }\r\n}\r\n", "import { Physics } from '../Physics';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential collisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\r\n  private _pairs = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    return this._pairs.has(hash);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\r\n    const seconds = delta / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._pairs.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._pairs.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (Physics.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.size * seconds + // velocity term\r\n          body.acc.size * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.globalPos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\r\n              if (hitPoint) {\r\n                const translate = hitPoint.sub(origin);\r\n                if (translate.size < minTranslate.size) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._pairs.has(pair.id)) {\r\n              this._pairs.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.globalPos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform.get());\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n", "import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { EventDispatcher } from '../../EventDispatcher';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  /**\r\n   * Excalibur uses this to signal to the [[CollisionSystem]] this is part of a composite collider\r\n   * @internal\r\n   * @hidden\r\n   */\r\n  public __compositeColliderId: Id<'collider'> | null = null;\r\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>();\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other [[Collider]]\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): LineSegment;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): Vector;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n", "import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { Collider } from './Collider';\r\nimport { Transform } from '../../Math/transform';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\r\n  private _dynamicAABBTree = new DynamicTree();\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    this.events.wire(collider.events);\r\n    collider.__compositeColliderId = this.id;\r\n    this._colliders.push(collider);\r\n    this._collisionProcessor.track(collider);\r\n    this._dynamicAABBTree.trackCollider(collider);\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    this.events.unwire(collider.events);\r\n    collider.__compositeColliderId = null;\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    // TODO transform component world pos\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get center(): Vector {\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results;\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): LineSegment {\r\n    const colliders = this.getColliders();\r\n    const lines: LineSegment[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): Vector {\r\n    const colliders = this.getColliders();\r\n    const points: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      const vec = collider.rayCast(ray, max);\r\n      if (vec) {\r\n        points.push(vec);\r\n      }\r\n    }\r\n    if (points.length) {\r\n      let minPoint = points[0];\r\n      let minDistance = minPoint.dot(ray.dir);\r\n      for (const point of points) {\r\n        const distance = ray.dir.dot(point);\r\n        if (distance < minDistance) {\r\n          minPoint = point;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minPoint;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projs: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projs.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projs.length) {\r\n      const newProjection = new Projection(projs[0].min, projs[0].max);\r\n      for (const proj of projs) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color);\r\n    }\r\n  }\r\n\r\n  clone(): Collider {\r\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n  }\r\n}\r\n", "import { Vector } from './vector';\r\n\r\n/**\r\n * A 2D line segment\r\n */\r\n\r\nexport class LineSegment {\r\n\r\n  /**\r\n   * @param begin  The starting point of the line segment\r\n   * @param end  The ending point of the line segment\r\n   */\r\n  constructor(public readonly begin: Vector, public readonly end: Vector) {}\r\n\r\n  /**\r\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\r\n   */\r\n  public get slope() {\r\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\r\n  }\r\n\r\n  /**\r\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\r\n   */\r\n  public get intercept() {\r\n    return this.begin.y - this.slope * this.begin.x;\r\n  }\r\n\r\n  private _normal: Vector;\r\n  /**\r\n   * Gets the normal of the line\r\n   */\r\n  public normal(): Vector {\r\n    if (this._normal) {\r\n      return this._normal;\r\n    }\r\n    return this._normal = this.end.sub(this.begin).normal();\r\n  }\r\n\r\n  private _dir: Vector;\r\n  public dir(): Vector {\r\n    if (this._dir) {\r\n      return this._dir;\r\n    }\r\n    return this._dir = this.end.sub(this.begin);\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    return [this.begin, this.end];\r\n  }\r\n\r\n  private _slope: Vector;\r\n  /**\r\n   * Returns the slope of the line in the form of a vector of length 1\r\n   */\r\n  public getSlope(): Vector {\r\n    if (this._slope) {\r\n      return this._slope;\r\n    }\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return this._slope = end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\r\n   */\r\n  public getEdge(): Vector {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    return end.sub(begin);\r\n  }\r\n\r\n  private _length: number;\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    if (this._length) {\r\n      return this._length;\r\n    }\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return this._length = distance;\r\n  }\r\n\r\n  /**\r\n   * Returns the midpoint of the edge\r\n   */\r\n  public get midpoint(): Vector {\r\n    return this.begin.add(this.end).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Flips the direction of the line segment\r\n   */\r\n  public flip(): LineSegment {\r\n    return new LineSegment(this.end, this.begin);\r\n  }\r\n\r\n  /**\r\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\r\n   * @param point\r\n   */\r\n  public below(point: Vector): boolean {\r\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\r\n    return above2 >= 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the clip point\r\n   * @param sideVector Vector that traces the line\r\n   * @param length Length to clip along side\r\n   */\r\n  public clip(sideVector: Vector, length: number): LineSegment {\r\n    let dir = sideVector;\r\n    dir = dir.normalize();\r\n\r\n    const near = dir.dot(this.begin) - length;\r\n    const far = dir.dot(this.end) - length;\r\n\r\n    const results = [];\r\n    if (near <= 0) {\r\n      results.push(this.begin);\r\n    }\r\n    if (far <= 0) {\r\n      results.push(this.end);\r\n    }\r\n\r\n    if (near * far < 0) {\r\n      const clipTime = near / (near - far);\r\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\r\n    }\r\n    if (results.length !== 2) {\r\n      return null;\r\n    }\r\n\r\n    return new LineSegment(results[0], results[1]);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular distance from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * @param point\r\n   */\r\n  public distanceToPoint(point: Vector, signed: boolean = false) {\r\n    const x0 = point.x;\r\n    const y0 = point.y;\r\n\r\n    const l = this.getLength();\r\n\r\n    const dy = this.end.y - this.begin.y;\r\n    const dx = this.end.x - this.begin.x;\r\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\r\n    return signed ? distance : Math.abs(distance);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular line from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * (a - p) - ((a - p) * n)n\r\n   * a is a point on the line\r\n   * p is the arbitrary point above the line\r\n   * n is a unit vector in direction of the line\r\n   * @param point\r\n   */\r\n  public findVectorToPoint(point: Vector): Vector {\r\n    const aMinusP = this.begin.sub(point);\r\n    const n = this.getSlope();\r\n\r\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\r\n  }\r\n\r\n  /**\r\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\r\n   * a new point with the calculated Y value and vice-versa.\r\n   *\r\n   * @param x The known X value of the target point\r\n   * @param y The known Y value of the target point\r\n   * @returns A new point with the other calculated axis value\r\n   */\r\n  public findPoint(x: number = null, y: number = null): Vector {\r\n    const m = this.slope;\r\n    const b = this.intercept;\r\n\r\n    if (x !== null) {\r\n      return new Vector(x, m * x + b);\r\n    } else if (y !== null) {\r\n      return new Vector((y - b) / m, y);\r\n    } else {\r\n      throw new Error('You must provide an X or a Y value');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(v: Vector, threshold?: number): boolean;\r\n\r\n  /**\r\n   * @see http://stackoverflow.com/a/11908158/109458\r\n   */\r\n  public hasPoint(): boolean {\r\n    let currPoint: Vector;\r\n    let threshold = 0;\r\n\r\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\r\n      currPoint = new Vector(arguments[0], arguments[1]);\r\n      threshold = arguments[2] || 0;\r\n    } else if (arguments[0] instanceof Vector) {\r\n      currPoint = arguments[0];\r\n      threshold = arguments[1] || 0;\r\n    } else {\r\n      throw 'Could not determine the arguments for Vector.hasPoint';\r\n    }\r\n\r\n    const dxc = currPoint.x - this.begin.x;\r\n    const dyc = currPoint.y - this.begin.y;\r\n\r\n    const dx1 = this.end.x - this.begin.x;\r\n    const dy1 = this.end.y - this.begin.y;\r\n\r\n    const cross = dxc * dy1 - dyc * dx1;\r\n\r\n    // check whether point lines on the line\r\n    if (Math.abs(cross) > threshold) {\r\n      return false;\r\n    }\r\n\r\n    // check whether point lies in-between start and end\r\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\r\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\r\n    } else {\r\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\r\n    }\r\n  }\r\n}\r\n", "import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\n\r\n/**\r\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\r\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n * @param p0 Point where L1 begins\r\n * @param u Direction and length of L1\r\n * @param q0 Point were L2 begins\r\n * @param v Direction and length of L2\r\n */\r\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\r\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\r\n\r\n  // w(s, t) = P(s) - Q(t)\r\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\r\n  //\r\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\r\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\r\n  //\r\n  // The closest point between 2 lines then satisfies this pair of equations\r\n  // 1: u * wClosest = 0\r\n  // 2: v * wClosest = 0\r\n  //\r\n  // Substituting wClosest into the equations we get\r\n  //\r\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\r\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\r\n\r\n  // simplify w0\r\n  const w0 = p0.sub(q0);\r\n\r\n  // simplify (u * u);\r\n  const a = u.dot(u);\r\n  // simplify (u * v);\r\n  const b = u.dot(v);\r\n  // simplify (v * v)\r\n  const c = v.dot(v);\r\n  // simplify (u * w0)\r\n  const d = u.dot(w0);\r\n  // simplify (v * w0)\r\n  const e = v.dot(w0);\r\n\r\n  // denominator ac - b^2\r\n  const denom = a * c - b * b;\r\n  let sDenom = denom;\r\n  let tDenom = denom;\r\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\r\n  if (denom === 0 || denom <= 0.01) {\r\n    const tClosestParallel = d / b;\r\n    return new LineSegment(p0, q0.add(v.scale(tClosestParallel)));\r\n  }\r\n\r\n  // Solve for sClosest for infinite line\r\n  let sClosest = b * e - c * d; // / denom;\r\n\r\n  // Solve for tClosest for infinite line\r\n  let tClosest = a * e - b * d; // / denom;\r\n\r\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\r\n  if (sClosest < 0) {\r\n    sClosest = 0;\r\n    tClosest = e;\r\n    tDenom = c;\r\n  } else if (sClosest > sDenom) {\r\n    sClosest = sDenom;\r\n    tClosest = e + b;\r\n    tDenom = c;\r\n  }\r\n\r\n  if (tClosest < 0) {\r\n    tClosest = 0;\r\n    if (-d < 0) {\r\n      sClosest = 0;\r\n    } else if (-d > a) {\r\n      sClosest = sDenom;\r\n    } else {\r\n      sClosest = -d;\r\n      sDenom = a;\r\n    }\r\n  } else if (tClosest > tDenom) {\r\n    tClosest = tDenom;\r\n    if (-d + b < 0) {\r\n      sClosest = 0;\r\n    } else if (-d + b > a) {\r\n      sClosest = sDenom;\r\n    } else {\r\n      sClosest = -d + b;\r\n      sDenom = a;\r\n    }\r\n  }\r\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\r\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\r\n\r\n  return new LineSegment(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\r\n}\r\n\r\nexport const ClosestLineJumpTable = {\r\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = polygonB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\r\n    const thisDirection = otherDirection.negate();\r\n\r\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\r\n\r\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\r\n\r\n    const thisFace = polygonA.getClosestFace(thisPoint);\r\n    const otherFace = polygonB.getClosestFace(otherPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const q0 = otherFace.face.begin;\r\n    const v = otherFace.face.getEdge();\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  },\r\n\r\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = edge.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const q0 = edgeStart;\r\n    const v = edgeVector;\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  },\r\n\r\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circle.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\r\n  },\r\n\r\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circleB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\r\n\r\n    const thisWorldPos = circleA.worldPos;\r\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\r\n\r\n    const thisPoint = circleA.rayCast(rayTowardsOther);\r\n    const otherPoint = circleB.rayCast(rayTowardsThis);\r\n\r\n    return new LineSegment(thisPoint, otherPoint);\r\n  },\r\n\r\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    const circleWorlPos = circle.worldPos;\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const p0 = edgeStart;\r\n    const u = edgeVector;\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp to edge\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\r\n    return new LineSegment(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\r\n  },\r\n\r\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLineA = edgeA.asLine();\r\n    const edgeStartA = edgeLineA.begin;\r\n    const edgeVectorA = edgeLineA.getEdge();\r\n    const p0 = edgeStartA;\r\n    const u = edgeVectorA;\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLineB = edgeB.asLine();\r\n    const edgeStartB = edgeLineB.begin;\r\n    const edgeVectorB = edgeLineB.getEdge();\r\n    const q0 = edgeStartB;\r\n    const v = edgeVectorB;\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  }\r\n};\r\n", "import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  public get worldPos(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  private _naturalRadius: number;\r\n  /**\r\n   * Get the radius of the circle\r\n   */\r\n  public get radius(): number {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    return this._naturalRadius * Math.min(scale.x, scale.y);\r\n  }\r\n\r\n  /**\r\n   * Set the radius of the circle\r\n   */\r\n  public set radius(val: number) {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\r\n  }\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this._globalMatrix.getPosition();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n    if (discriminant < 0) {\r\n      // no intersection\r\n      return null;\r\n    } else {\r\n      let toi = 0;\r\n      if (discriminant === 0) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          return ray.getPoint(toi);\r\n        }\r\n        return null;\r\n      } else {\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const mintoi = Math.min(...positiveToi);\r\n        if (mintoi <= max) {\r\n          return ray.getPoint(mintoi);\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n    return new BoundingBox(\r\n      this.offset.x - this._naturalRadius,\r\n      this.offset.y - this._naturalRadius,\r\n      this.offset.x + this._naturalRadius,\r\n      this.offset.y + this._naturalRadius\r\n    ).rotate(rotation).scale(scale).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return new BoundingBox(\r\n      this.offset.x - this._naturalRadius,\r\n      this.offset.y - this._naturalRadius,\r\n      this.offset.x + this._naturalRadius,\r\n      this.offset.y + this._naturalRadius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const tx = this._transform;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n    ex.save();\r\n    ex.translate(pos.x, pos.y);\r\n    ex.rotate(rotation);\r\n    ex.scale(scale.x, scale.y);\r\n    ex.drawCircle((this.offset ?? Vector.Zero), this._naturalRadius, Color.Transparent, color, 2);\r\n    ex.restore();\r\n  }\r\n}\r\n", "import { Vector } from '../../Math/vector';\r\nimport { Physics } from '../Physics';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Pair } from './Pair';\r\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\r\n * Pair prevents collisions from being evaluated more than one time\r\n */\r\nexport class CollisionContact {\r\n  private _canceled = false;\r\n\r\n  /**\r\n   * Currently the ids between colliders\r\n   */\r\n  readonly id: string;\r\n\r\n  /**\r\n   * The first collider in the collision\r\n   */\r\n  colliderA: Collider;\r\n\r\n  /**\r\n   * The second collider in the collision\r\n   */\r\n  colliderB: Collider;\r\n\r\n  /**\r\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\r\n   */\r\n  mtv: Vector;\r\n\r\n  /**\r\n   * World space contact points between colliderA and colliderB\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Local space contact points between colliderA and colliderB\r\n   */\r\n  localPoints: Vector[];\r\n\r\n  /**\r\n   * The collision normal, pointing away from colliderA\r\n   */\r\n  normal: Vector;\r\n\r\n  /**\r\n   * The collision tangent\r\n   */\r\n  tangent: Vector;\r\n\r\n  /**\r\n   * Information about the specifics of the collision contact separation\r\n   */\r\n  info: SeparationInfo;\r\n\r\n  constructor(\r\n    colliderA: Collider,\r\n    colliderB: Collider,\r\n    mtv: Vector,\r\n    normal: Vector,\r\n    tangent: Vector,\r\n    points: Vector[],\r\n    localPoints: Vector[],\r\n    info: SeparationInfo\r\n  ) {\r\n    this.colliderA = colliderA;\r\n    this.colliderB = colliderB;\r\n    this.mtv = mtv;\r\n    this.normal = normal;\r\n    this.tangent = tangent;\r\n    this.points = points;\r\n    this.localPoints = localPoints;\r\n    this.info = info;\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (colliderA.__compositeColliderId || colliderB.__compositeColliderId) {\r\n      // Add on the parent composite pair for start/end contact\r\n      this.id += '|' + Pair.calculatePairHash(\r\n        colliderA.__compositeColliderId ?? colliderA.id,\r\n        colliderB.__compositeColliderId ?? colliderB.id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Match contact awake state, except if body's are Fixed\r\n   */\r\n  public matchAwake(): void {\r\n    const bodyA = this.colliderA.owner.get(BodyComponent);\r\n    const bodyB = this.colliderB.owner.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.sleeping !== bodyB.sleeping) {\r\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\r\n          bodyA.setSleeping(false);\r\n        }\r\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\r\n          bodyB.setSleeping(false);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public cancel(): void {\r\n    this._canceled = true;\r\n  }\r\n}\r\n", "import { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Collider } from './Collider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\n/**\r\n * Specific information about a contact and it's separation\r\n */\r\nexport interface SeparationInfo {\r\n  /**\r\n   * Collider A\r\n   */\r\n  collider: Collider;\r\n\r\n  /**\r\n   * Signed value (negative means overlap, positive no overlap)\r\n   */\r\n  separation: number;\r\n\r\n  /**\r\n   * Axis of separation from the collider's perspective\r\n   */\r\n  axis: Vector;\r\n\r\n  /**\r\n   * Side of separation (reference) from the collider's perspective\r\n   */\r\n\r\n  side?: LineSegment;\r\n\r\n  /**\r\n   * Local side of separation (reference) from the collider's perspective\r\n   */\r\n  localSide?: LineSegment;\r\n\r\n  /**\r\n   * Index of the separation side (reference) from the collider's perspective\r\n   */\r\n  sideId?: number;\r\n\r\n  /**\r\n   * Point on collider B (incident point)\r\n   */\r\n  point: Vector;\r\n\r\n  /**\r\n   * Local point on collider B (incident point)\r\n   */\r\n  localPoint?: Vector;\r\n}\r\n\r\nexport class SeparatingAxis {\r\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSide: LineSegment | null = null;\r\n    let bestAxis: Vector | null = null;\r\n    let bestSideIndex: number = -1;\r\n    let bestOtherPoint: Vector | null = null;\r\n    const sides = polyA.getSides();\r\n    const localSides = polyA.getLocalSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const side = sides[i];\r\n      const axis = side.normal();\r\n      const vertB = polyB.getFurthestPoint(axis.negate());\r\n      // Separation on side i's axis\r\n      // We are looking for the largest separation between poly A's sides\r\n      const vertSeparation = side.distanceToPoint(vertB, true);\r\n      if (vertSeparation > bestSeparation) {\r\n        bestSeparation = vertSeparation;\r\n        bestSide = side;\r\n        bestAxis = axis;\r\n        bestSideIndex = i;\r\n        bestOtherPoint = vertB;\r\n      }\r\n    }\r\n\r\n    return {\r\n      collider: polyA,\r\n      separation: bestAxis ? bestSeparation : 99,\r\n      axis: bestAxis as Vector,\r\n      side: bestSide,\r\n      localSide: localSides[bestSideIndex],\r\n      sideId: bestSideIndex,\r\n      point: bestOtherPoint as Vector,\r\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\r\n    };\r\n  }\r\n\r\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\r\n    const axes = polygon.axes;\r\n    const pc = polygon.center;\r\n    // Special SAT with circles\r\n    const polyDir = pc.sub(circle.worldPos);\r\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\r\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\r\n\r\n    let minOverlap = Number.MAX_VALUE;\r\n    let minAxis = null;\r\n    let minIndex = -1;\r\n    for (let i = 0; i < axes.length; i++) {\r\n      const proj1 = polygon.project(axes[i]);\r\n      const proj2 = circle.project(axes[i]);\r\n      const overlap = proj1.getOverlap(proj2);\r\n      if (overlap <= 0) {\r\n        return null;\r\n      } else {\r\n        if (overlap < minOverlap) {\r\n          minOverlap = overlap;\r\n          minAxis = axes[i];\r\n          minIndex = i;\r\n        }\r\n      }\r\n    }\r\n    if (minIndex < 0) {\r\n      return null;\r\n    }\r\n    return minAxis.normalize().scale(minOverlap);\r\n  }\r\n}\r\n", "import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.size,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent).get());\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const incident = other.findSide(separation.axis.negate()) as LineSegment;\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const reference = separation.side;\r\n    const refDir = reference.dir().normalize();\r\n\r\n    // Find our contact points by clipping the incident by the collision side\r\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\r\n    let clipLeft: LineSegment | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\r\n    }\r\n\r\n    // If there is no left there is no collision\r\n    if (clipLeft) {\r\n      // We only want clip points below the reference edge, discard the others\r\n      const points = clipLeft.getPoints().filter((p) => {\r\n        return reference.below(p);\r\n      });\r\n\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      // Points are clipped from incident which is the other collider\r\n      // Store those as locals\r\n      let localPoints: Vector[] = [];\r\n      if (separation.collider === polyA) {\r\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      } else {\r\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: LineSegment;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new LineSegment(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new LineSegment(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n", "import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Transform } from '../../Math/transform';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionally specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const pos = begin.average(end);\r\n    return pos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    return this._globalMatrix.multiply(this.begin);\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    return this._globalMatrix.multiply(this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return ray.getPoint(t);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): LineSegment {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): LineSegment {\r\n    return new LineSegment(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): LineSegment {\r\n    return new LineSegment(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n\r\n}\r\n", "import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { LineSegment } from '../../Math/line-segment';\r\nimport { Vector } from '../../Math/vector';\r\nimport { AffineMatrix } from '../../Math/affine-matrix';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Collider } from './Collider';\r\nimport { ExcaliburGraphicsContext, Logger, range } from '../..';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Shape } from './Shape';\r\nimport { Transform } from '../../Math/transform';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  points: Vector[];\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  private _logger = Logger.getInstance();\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  private _points: Vector[];\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public set points(points: Vector[]) {\r\n    this._localBoundsDirty = true;\r\n    this._localSidesDirty = true;\r\n    this._sidesDirty = true;\r\n    this._points = points;\r\n  }\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   * Excalibur stores these in counter-clockwise order\r\n   */\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n\r\n  private _transform: Transform;\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _sides: LineSegment[] = [];\r\n  private _localSides: LineSegment[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n    this.points = options.points ?? [];\r\n    const counterClockwise = this._isCounterClockwiseWinding(this.points);\r\n    if (!counterClockwise) {\r\n      this.points.reverse();\r\n    }\r\n    if (!this.isConvex()) {\r\n      this._logger.warn(\r\n        'Excalibur only supports convex polygon colliders and will not behave properly.'+\r\n        'Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles');\r\n    }\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  private _isCounterClockwiseWinding(points: Vector[]): boolean {\r\n    // https://stackoverflow.com/a/1165943\r\n    let sum = 0;\r\n    for (let i = 0; i < points.length; i++) {\r\n      sum += (points[(i + 1) % points.length].x - points[i].x) * (points[(i + 1) % points.length].y + points[i].y);\r\n    }\r\n    return sum < 0;\r\n  }\r\n\r\n  /**\r\n   * Returns if the polygon collider is convex, Excalibur does not handle non-convex collision shapes.\r\n   * Call [[Polygon.triangulate]] to generate a [[CompositeCollider]] from this non-convex shape\r\n   */\r\n  public isConvex(): boolean {\r\n    // From SO: https://stackoverflow.com/a/45372025\r\n    if (this.points.length < 3) {\r\n      return false;\r\n    }\r\n    let oldPoint = this.points[this.points.length - 2];\r\n    let newPoint = this.points[this.points.length - 1];\r\n    let direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n    let oldDirection = 0;\r\n    let orientation = 0;\r\n    let angleSum = 0;\r\n    for (const [i, point] of this.points.entries()) {\r\n      oldPoint = newPoint;\r\n      oldDirection = direction;\r\n      newPoint =  point;\r\n      direction = Math.atan2(newPoint.y - oldPoint.y, newPoint.x - oldPoint.x);\r\n      if (oldPoint.equals(newPoint)) {\r\n        return false; // repeat point\r\n      }\r\n      let angle = direction - oldDirection;\r\n      if (angle <= -Math.PI){\r\n        angle += Math.PI * 2;\r\n      } else if (angle > Math.PI) {\r\n        angle -= Math.PI * 2;\r\n      }\r\n      if (i === 0) {\r\n        if (angle === 0.0) {\r\n          return false;\r\n        }\r\n        orientation = angle  > 0 ? 1 : -1;\r\n      } else {\r\n        if (orientation * angle <= 0) {\r\n          return false;\r\n        }\r\n      }\r\n      angleSum += angle;\r\n    }\r\n    return Math.abs(Math.round(angleSum / (Math.PI * 2))) === 1;\r\n  }\r\n\r\n  /**\r\n   * Tessellates the polygon into a triangle fan as a [[CompositeCollider]] of triangle polygons\r\n   */\r\n  public tessellate(): CompositeCollider {\r\n    const polygons: Vector[][] = [];\r\n    for (let i = 1; i < this.points.length - 2; i++) {\r\n      polygons.push([this.points[0], this.points[i + 1], this.points[i + 2]]);\r\n    }\r\n    polygons.push([this.points[0], this.points[1], this.points[2]]);\r\n\r\n    return new CompositeCollider(polygons.map(points => Shape.Polygon(points)));\r\n  }\r\n\r\n  /**\r\n   * Triangulate the polygon collider using the \"Ear Clipping\" algorithm.\r\n   * Returns a new [[CompositeCollider]] made up of smaller triangles.\r\n   */\r\n  public triangulate(): CompositeCollider {\r\n    // https://www.youtube.com/watch?v=hTJFcHutls8\r\n    if (this.points.length < 3) {\r\n      throw Error('Invalid polygon');\r\n    }\r\n\r\n    /**\r\n     * Helper to get a vertex in the list\r\n     */\r\n    function getItem<T>(index: number, list: T[]) {\r\n      if (index >= list.length) {\r\n        return list[index % list.length];\r\n      } else if (index < 0) {\r\n        return list[index % list.length + list.length];\r\n      } else {\r\n        return list[index];\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Quick test for point in triangle\r\n     */\r\n    function isPointInTriangle(point: Vector, a: Vector, b: Vector, c: Vector) {\r\n      const ab = b.sub(a);\r\n      const bc = c.sub(b);\r\n      const ca = a.sub(c);\r\n\r\n      const ap = point.sub(a);\r\n      const bp = point.sub(b);\r\n      const cp = point.sub(c);\r\n\r\n      const cross1 = ab.cross(ap);\r\n      const cross2 = bc.cross(bp);\r\n      const cross3 = ca.cross(cp);\r\n\r\n      if (cross1 > 0 || cross2 > 0 || cross3 > 0) {\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    const triangles: Vector[][] = [];\r\n    const vertices = [...this.points];\r\n    const indices = range(0, this.points.length - 1);\r\n\r\n    // 1. Loop through vertices clockwise\r\n    //    if the vertex is convex (interior angle is < 180) (cross product positive)\r\n    //    if the polygon formed by it's edges doesn't contain the points\r\n    //         it's an ear add it to our list of triangles, and restart\r\n\r\n    while (indices.length > 3) {\r\n      for (let i = 0; i < indices.length; i++) {\r\n        const a = indices[i];\r\n        const b = getItem(i - 1, indices);\r\n        const c = getItem(i + 1, indices);\r\n\r\n        const va = vertices[a];\r\n        const vb = vertices[b];\r\n        const vc = vertices[c];\r\n\r\n        // Check convexity\r\n        const leftArm = vb.sub(va);\r\n        const rightArm = vc.sub(va);\r\n        const isConvex = rightArm.cross(leftArm) > 0; // positive cross means convex\r\n        if (!isConvex) {\r\n          continue;\r\n        }\r\n\r\n        let isEar = true;\r\n        // Check that if any vertices are in the triangle a, b, c\r\n        for (let j = 0; j < indices.length; j++) {\r\n          const vertIndex = indices[j];\r\n          // We can skip these\r\n          if (vertIndex === a || vertIndex === b || vertIndex === c) {\r\n            continue;\r\n          }\r\n\r\n          const point = vertices[vertIndex];\r\n          if (isPointInTriangle(point, vb, va, vc)) {\r\n            isEar = false;\r\n            break;\r\n          }\r\n        }\r\n\r\n        // Add ear to polygon list and remove from list\r\n        if (isEar) {\r\n          triangles.push([vb, va, vc]);\r\n          indices.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    triangles.push([vertices[indices[0]], vertices[indices[1]], vertices[indices[2]]]);\r\n\r\n    return new CompositeCollider(triangles.map(points => Shape.Polygon(points)));\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    if (this._transform) {\r\n      return this._transform.pos.add(this.offset);\r\n    }\r\n    return this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  private _globalMatrix: AffineMatrix = AffineMatrix.identity();\r\n\r\n  private _transformedPointsDirty = true;\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const points = this.points;\r\n    const len = points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this._globalMatrix.multiply(points[i].clone());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    if (this._transformedPointsDirty) {\r\n      this._calculateTransformation();\r\n      this._transformedPointsDirty = false;\r\n    }\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  private _sidesDirty = true;\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): LineSegment[] {\r\n    if (this._sidesDirty) {\r\n      const lines = [];\r\n      const points = this.getTransformedPoints();\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._sides = lines;\r\n      this._sidesDirty = false;\r\n    }\r\n    return this._sides;\r\n  }\r\n\r\n  private _localSidesDirty = true;\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): LineSegment[] {\r\n    if (this._localSidesDirty) {\r\n      const lines = [];\r\n      const points = this.points;\r\n      const len = points.length;\r\n      for (let i = 0; i < len; i++) {\r\n        // This winding is important\r\n        lines.push(new LineSegment(points[i], points[(i + 1) % len]));\r\n      }\r\n      this._localSides = lines;\r\n      this._localSidesDirty = false;\r\n    }\r\n\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): LineSegment {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): LineSegment {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    const axes: Vector[] = [];\r\n    const sides = this.getSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      axes.push(sides[i].normal());\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Updates the transform for the collision geometry\r\n   *\r\n   * Collision geometry (points/bounds) will not change until this is called.\r\n   * @param transform\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    this._transformedPointsDirty = true;\r\n    this._sidesDirty = true;\r\n    // This change means an update must be performed in order for geometry to update\r\n    const globalMat = transform.matrix ?? this._globalMatrix;\r\n    globalMat.clone(this._globalMatrix);\r\n    this._globalMatrix.translate(this.offset.x, this.offset.y);\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const testRay = new Ray(point, new Vector(1, 0));\r\n    const intersectCount = this.getSides().reduce(function (accum, side) {\r\n      if (testRay.intersect(side) >= 0) {\r\n        return accum + 1;\r\n      }\r\n      return accum;\r\n    }, 0);\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): LineSegment {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: LineSegment } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    return this.localBounds.transform(this._globalMatrix);\r\n  }\r\n\r\n  private _localBoundsDirty = true;\r\n  private _localBounds: BoundingBox;\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    if (this._localBoundsDirty) {\r\n      this._localBounds = BoundingBox.fromPoints(this.points);\r\n      this._localBoundsDirty = false;\r\n    }\r\n\r\n    return this._localBounds;\r\n  }\r\n\r\n  private _cachedMass: number;\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    if (this._cachedMass === mass && this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    const points = this.points;\r\n    for (let i = 0; i < points.length; i++) {\r\n      const iplusone = (i + 1) % points.length;\r\n      const crossTerm = points[iplusone].cross(points[i]);\r\n      numerator +=\r\n        crossTerm *\r\n        (points[i].dot(points[i]) + points[i].dot(points[iplusone]) + points[iplusone].dot(points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    this._cachedMass = mass;\r\n    return this._cachedInertia = (mass / 6) * (numerator / denominator);\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity) {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return ray.getPoint(minContactTime);\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      ex.drawLine(points[i], points[i + 1], color, 2);\r\n      ex.drawCircle(points[i], 2, color);\r\n      ex.drawCircle(points[i + 1], 2, color);\r\n    }\r\n  }\r\n}\r\n", "import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[CircleCollider|circle]] collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[EdgeCollider|edge]] collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   *\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\n\r\nexport class ColliderComponent extends Component<'ex.collider'> {\r\n  public readonly type = 'ex.collider';\r\n\r\n  public events = new EventDispatcher();\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   */\r\n  public get() {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      this.events.wire(collider.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this.events.unwire(this._collider.events);\r\n      this.$colliderRemoved.notifyAll(this._collider);\r\n      this._collider.owner = null;\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx.get());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite lefthand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, center);\r\n    return (this.set(poly));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return (this.set(new CompositeCollider(colliders)));\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Physics } from './Physics';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Math/util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { Transform } from '../Math/transform';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\r\n  public readonly type = 'ex.body';\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventDispatcher();\r\n\r\n  private _oldTransform = new Transform();\r\n\r\n  /**\r\n   * Indicates whether the old transform has been captured at least once for interpolation\r\n   * @internal\r\n   */\r\n  public __oldTransformCaptured: boolean = false;\r\n\r\n  /**\r\n   * Enable or disabled the fixed update interpolation, by default interpolation is on.\r\n   */\r\n  public enableFixedUpdateInterpolate = true;\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n    }\r\n  }\r\n\r\n  public get matrix() {\r\n    return this.transform.get().matrix;\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  private _mass: number = Physics.defaultMass;\r\n  public get mass(): number {\r\n    return this._mass;\r\n  }\r\n\r\n  public set mass(newMass: number) {\r\n    this._mass = newMass;\r\n    this._cachedInertia = undefined;\r\n    this._cachedInverseInertia = undefined;\r\n  }\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = Physics.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.setSleeping(true);\r\n    }\r\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = Physics.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\r\n      this.setSleeping(true);\r\n    }\r\n  }\r\n\r\n  private _cachedInertia: number;\r\n  /**\r\n   * Get the moment of inertia from the [[ColliderComponent]]\r\n   */\r\n  public get inertia() {\r\n    if (this._cachedInertia) {\r\n      return this._cachedInertia;\r\n    }\r\n\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider) {\r\n      collider.$colliderAdded.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      collider.$colliderRemoved.subscribe(() => {\r\n        this._cachedInertia = null;\r\n      });\r\n      const maybeCollider = collider.get();\r\n      if (maybeCollider) {\r\n        return this._cachedInertia = maybeCollider.getInertia(this.mass);\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  private _cachedInverseInertia: number;\r\n  /**\r\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    if (this._cachedInverseInertia) {\r\n      return this._cachedInverseInertia;\r\n    }\r\n    return this._cachedInverseInertia = this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   *\r\n   * Note: this only limits responses in the realistic solver, if velocity/angularVelocity is set the actor will still respond\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.active;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use globalP0s\r\n   */\r\n  public get center() {\r\n    return this.globalPos;\r\n  }\r\n\r\n  public get transform(): TransformComponent {\r\n    return this.owner?.get(TransformComponent);\r\n  }\r\n\r\n  public get motion(): MotionComponent {\r\n    return  this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.pos = val;\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get globalPos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this._oldTransform.pos;\r\n  }\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public get oldRotation(): number {\r\n    return this._oldTransform.rotation;\r\n  }\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   */\r\n  public get oldScale(): Vector {\r\n    return this._oldTransform.scale;\r\n  }\r\n\r\n  /**\r\n   * The scale rate of change of the actor in scale/second\r\n   */\r\n  public get scaleFactor(): Vector {\r\n    return this.motion.scaleFactor;\r\n  }\r\n\r\n  public set scaleFactor(scaleFactor: Vector) {\r\n    this.motion.scaleFactor = scaleFactor;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.globalPos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.__oldTransformCaptured = true;\r\n    this.transform.get().clone(this._oldTransform);\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n  }\r\n}\r\n", "import { Component, ComponentCtor, TagComponent } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { Class } from '../Class';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { Util } from '..';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\r\n  private static _ID = 0;\r\n\r\n  constructor(components?: Component[], name?: string) {\r\n    super();\r\n    this._setName(name);\r\n    if (components) {\r\n      for (const component of components) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  private _name: string = 'anonymous';\r\n  protected _setName(name: string) {\r\n    if (name) {\r\n      this._name = name;\r\n    }\r\n  }\r\n  public get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  public get events(): EventDispatcher {\r\n    return this.eventDispatcher;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public active: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   */\r\n  public kill() {\r\n    this.active = false;\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from [[TagComponent]]\r\n   */\r\n  public get tags(): readonly string[] {\r\n    return this._tagsMemo;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this.tags.includes(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   * @returns Entity\r\n   */\r\n  public addTag(tag: string) {\r\n    return this.addComponent(new TagComponent(tag));\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   * @param force Remove component immediately, no deferred\r\n   */\r\n  public removeTag(tag: string, force = false) {\r\n    return this.removeComponent(tag, force);\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): string[] {\r\n    return this._typesMemo;\r\n  }\r\n\r\n  /**\r\n   * Bucket to hold on to deferred removals\r\n   */\r\n  private _componentsToRemove: (Component | string)[] = [];\r\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\r\n  private _componentStringToInstance = new Map<string, Component>();\r\n\r\n  private _tagsMemo: string[] = [];\r\n  private _typesMemo: string[] = [];\r\n  private _rebuildMemos() {\r\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\r\n      .filter((c) => c instanceof TagComponent)\r\n      .map((c) => c.type);\r\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\r\n  }\r\n\r\n  public getComponents(): Component[] {\r\n    return Array.from(this._componentStringToInstance.values());\r\n  }\r\n\r\n  /**\r\n   * Observable that keeps track of component add or remove changes on the entity\r\n   */\r\n  public componentAdded$ = new Observable<AddedComponent>();\r\n  private _notifyAddComponent(component: Component) {\r\n    this._rebuildMemos();\r\n    const added = new AddedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentAdded$.notifyAll(added);\r\n  }\r\n\r\n  public componentRemoved$ = new Observable<RemovedComponent>();\r\n  private _notifyRemoveComponent(component: Component) {\r\n    const removed = new RemovedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentRemoved$.notifyAll(removed);\r\n    this._rebuildMemos();\r\n  }\r\n\r\n  private _parent: Entity = null;\r\n  public get parent(): Entity {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      Util.removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    this.children.forEach((c) => {\r\n      this.removeChild(c);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      queue = queue.concat(curr.children);\r\n      result = result.concat(curr.children);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      newEntity.addComponent(this.get(c).clone());\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it already exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.type)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component);\r\n      } else {\r\n        // early exit component exits\r\n        return this;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const constuctorType = component.constructor as ComponentCtor<T>;\r\n    this._componentTypeToInstance.set(constuctorType, component);\r\n    this._componentStringToInstance.set(component.type, component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n    this._notifyAddComponent(component);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param componentOrType\r\n   * @param force\r\n   */\r\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\r\n    if (force) {\r\n      if (typeof componentOrType === 'string') {\r\n        this._removeComponentByType(componentOrType);\r\n      } else if (componentOrType instanceof Component) {\r\n        this._removeComponentByType(componentOrType.type);\r\n      }\r\n    } else {\r\n      this._componentsToRemove.push(componentOrType);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  private _removeComponentByType(type: string) {\r\n    if (this.has(type)) {\r\n      const component = this.get(type);\r\n      component.owner = null;\r\n      if (component.onRemove) {\r\n        component.onRemove(this);\r\n      }\r\n      const ctor = component.constructor as ComponentCtor;\r\n      this._componentTypeToInstance.delete(ctor);\r\n      this._componentStringToInstance.delete(component.type);\r\n      this._notifyRemoveComponent(component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const componentOrType of this._componentsToRemove) {\r\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\r\n      this._removeComponentByType(type);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\r\n  public has(type: string): boolean;\r\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.has(type);\r\n    } else {\r\n      return this._componentTypeToInstance.has(type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a component by type with typecheck\r\n   *\r\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\r\n   * @param type\r\n   */\r\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\r\n  public get<T extends Component>(type: string): T | null;\r\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.get(type) as T;\r\n    } else {\r\n      return this._componentTypeToInstance.get(type) as T;\r\n    }\r\n  }\r\n\r\n  private _isInitialized = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   *\r\n   * @internal\r\n   * @param engine\r\n   * @param delta\r\n   */\r\n  public update(engine: Engine, delta: number): void {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    for (const child of this.children) {\r\n      child.update(engine, delta);\r\n    }\r\n    this._postupdate(engine, delta);\r\n  }\r\n}\r\n", "import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsLayerOptions {\r\n  /**\r\n   * Name of the layer required, for example 'background'\r\n   */\r\n  name: string;\r\n  /**\r\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\r\n   */\r\n  order: number;\r\n  /**\r\n   * Offset to shift the entire layer\r\n   */\r\n  offset?: Vector;\r\n}\r\nexport class GraphicsLayer {\r\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\r\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\r\n  public get name(): string {\r\n    return this._options.name;\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in this layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in this layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    if (!nameOrGraphic) {\r\n      this.graphics.length = 0;\r\n    } else {\r\n      let gfx: Graphic = null;\r\n      if (nameOrGraphic instanceof Graphic) {\r\n        gfx = nameOrGraphic;\r\n      } else {\r\n        gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      }\r\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\r\n      this._graphics.recalculateBounds();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\r\n   *\r\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    let gfx: Graphic;\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\r\n    } else {\r\n      gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      if (!gfx) {\r\n        Logger.getInstance().error(\r\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\r\n          this._graphics.getNames()\r\n        );\r\n      }\r\n    }\r\n    if (gfx) {\r\n      this.graphics.push({ graphic: gfx, options });\r\n      this._graphics.recalculateBounds();\r\n      return gfx as T;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a specific graphic, swap out any current graphics being shown\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    this.hide();\r\n    return this.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public get order(): number {\r\n    return this._options.order;\r\n  }\r\n\r\n  /**\r\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public set order(order: number) {\r\n    this._options.order = order;\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\r\n   */\r\n  public get offset(): Vector {\r\n    return this._options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  public set offset(value: Vector) {\r\n    this._options.offset = value;\r\n  }\r\n\r\n  public get currentKeys(): string {\r\n    return this.name ?? 'anonymous';\r\n  }\r\n}\r\n\r\nexport class GraphicsLayers {\r\n  private _layers: GraphicsLayer[] = [];\r\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\r\n  public default: GraphicsLayer;\r\n  constructor(private _component: GraphicsComponent) {\r\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\r\n    this._maybeAddLayer(this.default);\r\n  }\r\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\r\n    const layer = new GraphicsLayer(options, this._component);\r\n    return this._maybeAddLayer(layer);\r\n  }\r\n\r\n  /**\r\n   * Retrieve a single layer by name\r\n   * @param name\r\n   */\r\n  public get(name: string): GraphicsLayer;\r\n  /**\r\n   * Retrieve all layers\r\n   */\r\n  public get(): readonly GraphicsLayer[];\r\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\r\n    if (name) {\r\n      return this._getLayer(name);\r\n    }\r\n    return this._layers;\r\n  }\r\n\r\n  public currentKeys() {\r\n    const graphicsLayerKeys = [];\r\n    for (const layer of this._layers) {\r\n      graphicsLayerKeys.push(layer.currentKeys);\r\n    }\r\n    return graphicsLayerKeys;\r\n  }\r\n\r\n  public has(name: string): boolean {\r\n    return name in this._layerMap;\r\n  }\r\n\r\n  private _maybeAddLayer(layer: GraphicsLayer) {\r\n    if (this._layerMap[layer.name]) {\r\n      // todo log warning\r\n      return this._layerMap[layer.name];\r\n    }\r\n    this._layerMap[layer.name] = layer;\r\n    this._layers.push(layer);\r\n    this._layers.sort((a, b) => a.order - b.order);\r\n    return layer;\r\n  }\r\n\r\n  private _getLayer(name: string): GraphicsLayer | undefined {\r\n    return this._layerMap[name];\r\n  }\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component<'ex.graphics'> {\r\n  readonly type = 'ex.graphics';\r\n\r\n  private _graphics: { [graphicName: string]: Graphic } = {};\r\n\r\n  public layers: GraphicsLayers;\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public visible: boolean = true;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public anchor: Vector = Vector.Half;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can affect performance\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.visible,\r\n      ...options\r\n    };\r\n\r\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\r\n\r\n    this._graphics = graphics || {};\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.visible = !!visible;\r\n\r\n    this.layers = new GraphicsLayers(this);\r\n    if (current && this._graphics[current]) {\r\n      this.show(this._graphics[current]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\r\n   */\r\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\r\n    return this.layers.default.graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * `show(\"default\")`\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic): Graphic;\r\n  public add(name: string, graphic: Graphic): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic = null;\r\n    if (typeof nameOrGraphic === 'string') {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphic;\r\n    } else {\r\n      graphicToSet = nameOrGraphic;\r\n    }\r\n\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    if (name === 'default') {\r\n      this.show('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    const result = this.layers.default.show<T>(nameOrGraphic, options);\r\n    this.recalculateBounds();\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    const result = this.layers.default.use<T>(nameOrGraphic, options);\r\n    this.recalculateBounds();\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in the **default** layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    this.layers.default.hide(nameOrGraphic);\r\n  }\r\n\r\n  private _localBounds: BoundingBox = null;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._localBounds = bounds;\r\n  }\r\n\r\n  public recalculateBounds() {\r\n    let bb = new BoundingBox();\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic, options } of layer.graphics) {\r\n        let anchor = this.anchor;\r\n        let offset = this.offset;\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const bounds = graphic.localBounds;\r\n        const offsetX = -bounds.width *  anchor.x + offset.x;\r\n        const offsetY = -bounds.height *  anchor.y + offset.y;\r\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\r\n      }\r\n    }\r\n    this._localBounds = bb;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    if (!this._localBounds || this._localBounds.hasZeroDimensions()) {\r\n      this.recalculateBounds();\r\n    }\r\n    return this._localBounds;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necesary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic } of layer.graphics) {\r\n        if (hasGraphicsTick(graphic)) {\r\n          graphic?.tick(elapsed, idempotencyToken);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n", "import { ImageFiltering } from '.';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\r\n *\r\n * Circles default to [[ImageFiltering.Blended]]\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Add this component to optionally configure how the pointer\r\n * system detects pointer events.\r\n *\r\n * By default the collider shape is used and graphics bounds is not.\r\n *\r\n * If both collider shape and graphics bounds are enabled it will fire events if either or\r\n * are intersecting the pointer.\r\n */\r\nexport class PointerComponent extends Component<'ex.pointer'> {\r\n  public readonly type = 'ex.pointer';\r\n  /**\r\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\r\n   * user pointer events only to trigger on the same collision geometry used in the collider component\r\n   * for collision resolution. Default is `true`.\r\n   */\r\n  public useColliderShape = true;\r\n  /**\r\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\r\n   * bounds around the graphic to trigger pointer events. Default is `false`.\r\n   */\r\n  public useGraphicsBounds = false;\r\n}", "import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A definition of an EasingFunction. See [[EasingFunctions]].\r\n */\r\n// tslint:disable-next-line\r\nexport interface EasingFunction {\r\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\r\n}\r\n\r\n/**\r\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\r\n * Given a time, the function will return a value from positive startValue to positive endValue.\r\n *\r\n * ```js\r\n * function Linear (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInQuad (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutQuad (t) {\r\n *    return t * (2 - t);\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutQuad (t) {\r\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInCubic (t) {\r\n *    return t * t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutCubic (t) {\r\n *    return (--t) * t * t + 1;\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutCubic (t) {\r\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n * }\r\n * ```\r\n */\r\nexport class EasingFunctions {\r\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\r\n    return (time: number, start: number, end: number, duration: number) => {\r\n      if (end < start) {\r\n        return start - (easing(time, end, start, duration) - end);\r\n      } else {\r\n        return easing(time, start, end, duration);\r\n      }\r\n    };\r\n  }\r\n\r\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\r\n    return (time: number, start: Vector, end: Vector, duration: number) => {\r\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\r\n    };\r\n  }\r\n\r\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      return (endValue * currentTime) / duration + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n\r\n      return endValue * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return -endValue * currentTime * (currentTime - 2) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime--;\r\n\r\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return endValue * currentTime * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      currentTime--;\r\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime -= 2;\r\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\r\n    }\r\n  );\r\n}\r\n", "import { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the [[ActionContext|Action API]] and\r\n * store the list of actions to be executed for an [[Actor]].\r\n *\r\n * Actors implement [[Actor.actions]] which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number) {\r\n    if (this._actions.length > 0) {\r\n      this._currentAction = this._actions[0];\r\n      this._currentAction.update(elapsedMs);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._completedActions.push(this._actions.shift());\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n", "import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n", "import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x: number;\r\n  public y: number;\r\n  private _distance: number;\r\n  private _speed: number;\r\n\r\n  private _start: Vector;\r\n  private _offset: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.size;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distance: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destx, desty);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 0,\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 1,\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 2,\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 3\r\n}\r\n", "import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TwoPI } from '../../Math/util';\r\n\r\nexport class RotateTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angleRadians;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TwoPI } from '../../Math/util';\r\n\r\nexport class RotateBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTraveled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTraveled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._start = undefined;\r\n    this._currentNonCannonAngle = undefined;\r\n    this._distance = undefined;\r\n  }\r\n}\r\n", "import { vec } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class ScaleTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startX: number;\r\n  private _startY: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.y - this._startX) >= (this._distanceX - 0.01) &&\r\n        Math.abs(this._tx.scale.y - this._startY) >= (this._distanceY - 0.01))\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\n\r\nexport class ScaleBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startScale: Vector;\r\n  private _endScale: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _directionX: number;\r\n  private _directionY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= (this._distanceX - 0.01) &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= (this._distanceY - 0.01))\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { Action } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  private _method: () => any = null;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n", "import { Entity} from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class EaseTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += delta;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n", "import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class EaseBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _offset: Vector;\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  constructor(\r\n    entity: Entity,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._lerpEnd = this._lerpStart.add(this._offset);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += delta;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._currentLerpTime >= this._lerpDuration;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n    this._stopped = false;\r\n    this._currentLerpTime = 0;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}", "import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._elapsedTime = 0;\r\n      this._totalTime = 0;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n    this._totalTime += delta;\r\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.visible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.visible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.visible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.visible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n", "import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _endOpacity: number;\r\n  private _speed: number;\r\n  private _ogspeed: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, speed: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._speed = this._ogspeed = speed;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._speed = this._ogspeed;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._speed > 0) {\r\n      this._graphics.opacity += (this._multiplier *\r\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\r\n    }\r\n\r\n    this._speed -= delta;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { Action } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(delay: number) {\r\n    this._delay = delay;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n", "import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n  }\r\n}\r\n", "import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n    this._stopped = false;\r\n    this._distanceBetween = undefined;\r\n  }\r\n}\r\n", "import { RotationType } from './RotationType';\r\n\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { MoveBy } from './Action/MoveBy';\r\nimport { MoveTo } from './Action/MoveTo';\r\nimport { RotateTo } from './Action/RotateTo';\r\nimport { RotateBy } from './Action/RotateBy';\r\nimport { ScaleTo } from './Action/ScaleTo';\r\nimport { ScaleBy } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { EaseBy } from './Action/EaseBy';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector } from '../Math/vector';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * [[Actor|Actors]] such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the [[Action]] interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsedMs: number) {\r\n    this._queue.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  public runAction(action: Action) {\r\n    action.reset();\r\n    this._queue.add(action);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunction]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunction]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by a specified vector offset relative to the current position given\r\n   * a duration and a [[EasingFunction]]. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use [[EasingFunction]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor by a specified x and y offset relative to the current position given\r\n   * a duration and a [[EasingFunction]]. This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset Vector offset relative to the current position\r\n   * @param duration The duration in milliseconds\r\n   * @param easingFcn Use [[EasingFunction]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      offsetX = args[0].x;\r\n      offsetY = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      offsetX = args[0];\r\n      offsetY = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseBy(this._entity, offsetX, offsetY, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPos instanceof Vector) {\r\n      x = xOrPos.x;\r\n      y = xOrPos.y;\r\n      speed = yOrSpeed;\r\n    } else {\r\n      x = xOrPos;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVector instanceof Vector) {\r\n      xOffset = xOffsetOrVector.x;\r\n      yOffset = xOffsetOrVector.y;\r\n      speed = yOffsetOrSpeed;\r\n    } else {\r\n      xOffset = xOffsetOrVector;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined): ActionContext {\r\n\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVector.x;\r\n      sizeY = sizeXOrVector.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVector;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined;\r\n      speedY = speedYOrUndefined;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVector instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVector.x;\r\n      sizeOffsetY = sizeOffsetXOrVector.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVector;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    this._queue.add(new Delay(time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n", "import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { RotationType } from './RotationType';\r\nimport { Action } from './Action';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\r\n\r\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\r\n  public readonly type = 'ex.actions';\r\n  dependencies = [TransformComponent, MotionComponent];\r\n  private _ctx: ActionContext;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queue\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    return this._ctx?.getQueue();\r\n  }\r\n\r\n  public runAction(action: Action): ActionContext {\r\n    return this._ctx?.runAction(action);\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number): void {\r\n    return this._ctx?.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._ctx.easeTo.apply(this._ctx, args);\r\n  }\r\n\r\n  public easeBy(offset: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(offsetX: number, offsetY: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeBy(...args: any[]): ActionContext {\r\n    return this._ctx.easeBy.apply(this._ctx, args);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number): ActionContext {\r\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\r\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    return this._ctx.fade(opacity, time);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    return this._ctx.delay(time);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._ctx.die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._ctx.callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._ctx.repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._ctx.repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._ctx.follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._ctx.meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._ctx.toPromise();\r\n  }\r\n}", "import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Enum representing the different font size units\r\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\r\n */\r\nexport enum FontUnit {\r\n  /**\r\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\r\n   */\r\n  Em = 'em',\r\n  /**\r\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\r\n   */\r\n  Rem = 'rem',\r\n  /**\r\n   * Pixel is a unit of length in screen pixels\r\n   */\r\n  Px = 'px',\r\n  /**\r\n   * Point is a physical unit length (1/72 of an inch)\r\n   */\r\n  Pt = 'pt',\r\n  /**\r\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\r\n   */\r\n  Percent = '%'\r\n}\r\n\r\n/**\r\n * Enum representing the different horizontal text alignments\r\n */\r\nexport enum TextAlign {\r\n  /**\r\n   * The text is left-aligned.\r\n   */\r\n  Left = 'left',\r\n  /**\r\n   * The text is right-aligned.\r\n   */\r\n  Right = 'right',\r\n  /**\r\n   * The text is centered.\r\n   */\r\n  Center = 'center',\r\n  /**\r\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\r\n   * right-aligned for right-to-left locales).\r\n   */\r\n  Start = 'start',\r\n  /**\r\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\r\n   * left-aligned for right-to-left locales).\r\n   */\r\n  End = 'end'\r\n}\r\n\r\n/**\r\n * Enum representing the different baseline text alignments\r\n */\r\nexport enum BaseAlign {\r\n  /**\r\n   * The text baseline is the top of the em square.\r\n   */\r\n  Top = 'top',\r\n  /**\r\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\r\n   * alphabetic.\r\n   */\r\n  Hanging = 'hanging',\r\n  /**\r\n   * The text baseline is the middle of the em square.\r\n   */\r\n  Middle = 'middle',\r\n  /**\r\n   * The text baseline is the normal alphabetic baseline.\r\n   */\r\n  Alphabetic = 'alphabetic',\r\n  /**\r\n   * The text baseline is the ideographic baseline; this is the bottom of\r\n   * the body of the characters, if the main body of characters protrudes\r\n   * beneath the alphabetic baseline.  Currently unsupported; this will\r\n   * act like alphabetic.\r\n   */\r\n  Ideographic = 'ideographic',\r\n  /**\r\n   * The text baseline is the bottom of the bounding box.  This differs\r\n   * from the ideographic baseline in that the ideographic baseline\r\n   * doesn't consider descenders.\r\n   */\r\n  Bottom = 'bottom'\r\n}\r\n\r\n/**\r\n * Enum representing the different possible font styles\r\n */\r\nexport enum FontStyle {\r\n  Normal = 'normal',\r\n  Italic = 'italic',\r\n  Oblique = 'oblique'\r\n}\r\n\r\n/**\r\n * Enum representing the text direction, useful for other languages, or writing text in reverse\r\n */\r\nexport enum Direction {\r\n  LeftToRight = 'ltr',\r\n  RightToLeft = 'rtl'\r\n}\r\n\r\n/**\r\n * Font rendering option\r\n */\r\nexport interface FontOptions {\r\n  /**\r\n   * Optionally the size of the font in the specified [[FontUnit]] by default 10.\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally specify unit to measure fonts in, by default Pixels\r\n   */\r\n  unit?: FontUnit;\r\n  /**\r\n   * Optionally specify the font family, by default 'sans-serif'\r\n   */\r\n  family?: string;\r\n  /**\r\n   * Optionally specify the font style, by default Normal\r\n   */\r\n  style?: FontStyle;\r\n  /**\r\n   * Optionally set whether the font is bold, by default false\r\n   */\r\n  bold?: boolean;\r\n  /**\r\n   * Optionally specify the text align, by default Left\r\n   */\r\n  textAlign?: TextAlign;\r\n  /**\r\n   * Optionally specify the text base align, by default Alphabetic\r\n   */\r\n  baseAlign?: BaseAlign;\r\n  /**\r\n   * Optionally specify the text direction, by default LeftToRight\r\n   */\r\n  direction?: Direction;\r\n  /**\r\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\r\n   * Higher quality text has a higher memory impact\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify a text shadow, by default none is specified\r\n   */\r\n  shadow?: {\r\n    blur?: number;\r\n    offset?: Vector;\r\n    color?: Color;\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface FontRenderer {\r\n  measureText(text: string): BoundingBox;\r\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Color } from '../Color';\r\nimport { line } from '../Util/DrawUtil';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { RasterOptions } from './Raster';\r\nimport { TextureLoader } from '.';\r\nimport { ImageFiltering } from './Filtering';\r\n\r\n/**\r\n * Represents a system or web font in Excalibur\r\n *\r\n * If no options specified, the system sans-serif 10 pixel is used\r\n *\r\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\r\n */\r\nexport class Font extends Graphic implements FontRenderer {\r\n  /**\r\n   * Set the font filtering mode, by default set to [[ImageFiltering.Blended]] regardless of the engine default smoothing\r\n   *\r\n   * If you have a pixel style font that may be a reason to switch this to [[ImageFiltering.Pixel]]\r\n   */\r\n  public filtering: ImageFiltering = ImageFiltering.Blended;\r\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\r\n    super(options); // <- Graphics properties\r\n\r\n    // Raster properties\r\n    this.smoothing = options?.smoothing ?? this.smoothing;\r\n    this.padding = options?.padding ?? this.padding;\r\n    this.color = options?.color ?? this.color;\r\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\r\n    this.lineDash = options?.lineDash ?? this.lineDash;\r\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\r\n    this.filtering = options?.filtering ?? this.filtering;\r\n\r\n    // Font specific properties\r\n    this.family = options?.family ?? this.family;\r\n    this.style = options?.style ?? this.style;\r\n    this.bold = options?.bold ?? this.bold;\r\n    this.size = options?.size ?? this.size;\r\n    this.unit = options?.unit ?? this.unit;\r\n    this.textAlign = options?.textAlign ?? this.textAlign;\r\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\r\n    this.direction = options?.direction ?? this.direction;\r\n    this.quality = options?.quality ?? this.quality;\r\n    if (options?.shadow) {\r\n      this.shadow = {};\r\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\r\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\r\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\r\n    }\r\n  }\r\n\r\n  public clone() {\r\n    return new Font({\r\n      ...this.cloneGraphicOptions(),\r\n      size: this.size,\r\n      unit: this.unit,\r\n      family: this.family,\r\n      style: this.style,\r\n      bold: this.bold,\r\n      textAlign: this.textAlign,\r\n      baseAlign: this.baseAlign,\r\n      direction: this.direction,\r\n      shadow: this.shadow\r\n        ? {\r\n          blur: this.shadow.blur,\r\n          offset: this.shadow.offset,\r\n          color: this.shadow.color\r\n        }\r\n        : null\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\r\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\r\n   *\r\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\r\n   *\r\n   * (Default 2)\r\n   */\r\n  public quality = 2;\r\n\r\n  // Raster properties for fonts\r\n  public padding = 2;\r\n  public smoothing = false;\r\n  public lineWidth = 1;\r\n  public lineDash: number[] = [];\r\n  public color: Color = Color.Black;\r\n  public strokeColor: Color;\r\n\r\n  public family: string = 'sans-serif';\r\n  public style: FontStyle = FontStyle.Normal;\r\n  public bold: boolean = false;\r\n  public unit: FontUnit = FontUnit.Px;\r\n  public textAlign: TextAlign = TextAlign.Left;\r\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\r\n  public direction: Direction = Direction.LeftToRight;\r\n  public size: number = 10;\r\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\r\n\r\n  public get fontString() {\r\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\r\n  }\r\n\r\n  private _textBounds: BoundingBox = new BoundingBox();\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this._textBounds;\r\n  }\r\n\r\n\r\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\r\n    // TODO weird vestigial drawimage\r\n  }\r\n\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext) {\r\n    // TODO this needs to change depending on the bounding box...\r\n    const origin = this.origin ?? this._textBounds.center;\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this._textBounds.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n\r\n  private _cachedTextMeasurement = new Map<string, {text: string, measurement: BoundingBox, rasterProps: string}>();\r\n  private _bitmapToTextMeasurement = new Map<CanvasRenderingContext2D, {text: string, measurement: BoundingBox, rasterProps: string}>();\r\n  /**\r\n   * Returns a BoundingBox that is the total size of the text including multiple lines\r\n   *\r\n   * Does not include any padding or adjustment\r\n   * @param text\r\n   * @returns BoundingBox\r\n   */\r\n  public measureText(text: string): BoundingBox {\r\n    let measurementDirty = false;\r\n    let cached = this._cachedTextMeasurement.get(text);\r\n    if (!cached) {\r\n      measurementDirty = true;\r\n    }\r\n\r\n    const rasterProps = this._getRasterPropertiesHash();\r\n    if (!cached || rasterProps !== cached.rasterProps) {\r\n      measurementDirty = true;\r\n    }\r\n\r\n    if (measurementDirty) {\r\n      const lines = text.split('\\n');\r\n      const maxWidthLine = lines.reduce((a, b) => {\r\n        return a.length > b.length ? a : b;\r\n      });\r\n      const ctx = this._getTextBitmap(text);\r\n\r\n      this._applyFont(ctx); // font must be applied to the context to measure it\r\n      const metrics = ctx.measureText(maxWidthLine);\r\n      let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\r\n\r\n      // TODO lineheight makes the text bounds wonky\r\n      const lineAdjustedHeight = textHeight * lines.length;\r\n      textHeight = lineAdjustedHeight;\r\n      const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\r\n      const x = 0;\r\n      const y = 0;\r\n      // this._cachedText = text;\r\n      // this._cachedRasterProps = rasterProps;\r\n      // this._measurementDirty = false;\r\n      const measurement = new BoundingBox({\r\n        left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\r\n        top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\r\n        bottom: y + bottomBounds + this.padding,\r\n        right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\r\n      });\r\n      cached = {\r\n        text,\r\n        rasterProps,\r\n        measurement\r\n      };\r\n      this._cachedTextMeasurement.set(text, cached);\r\n      this._bitmapToTextMeasurement.set(ctx, cached);\r\n      return cached.measurement;\r\n    } else {\r\n      return cached.measurement;\r\n    }\r\n  }\r\n\r\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\r\n\r\n    // Changing the width and height clears the context properties\r\n    // We double the bitmap width to account for all possible alignment\r\n    // We scale by \"quality\" so we render text without jaggies\r\n    bitmap.canvas.width = (textBounds.width + this.padding * 2) * 2 * this.quality;\r\n    bitmap.canvas.height = (textBounds.height + this.padding * 2) * 2 * this.quality;\r\n  }\r\n\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * We need to identify bitmaps with more than just the text content\r\n   *\r\n   * Any properties that can change the rendering of the text\r\n   */\r\n  private _getRasterPropertiesHash(color?: Color): string {\r\n    const hash = '__hashcode__' +\r\n    this.fontString +\r\n    this.showDebug +\r\n    this.textAlign +\r\n    this.baseAlign +\r\n    this.direction +\r\n    JSON.stringify(this.shadow) +\r\n    (this.padding.toString() +\r\n    this.smoothing.toString() +\r\n    this.lineWidth.toString() +\r\n    this.lineDash.toString() +\r\n    this.strokeColor?.toString() +\r\n    ( color ? color.toString() : this.color?.toString()).toString());\r\n    return hash;\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D, color: Color) {\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.strokeStyle = this.strokeColor?.toString();\r\n    ctx.fillStyle = color ? color.toString() : this.color?.toString();\r\n  }\r\n\r\n  private _applyFont(ctx: CanvasRenderingContext2D) {\r\n    ctx.translate(this.padding + ctx.canvas.width / 2, this.padding + ctx.canvas.height / 2);\r\n    ctx.scale(this.quality, this.quality);\r\n    ctx.textAlign = this.textAlign;\r\n    ctx.textBaseline = this.baseAlign;\r\n    ctx.font = this.fontString;\r\n    ctx.direction = this.direction;\r\n\r\n    if (this.shadow) {\r\n      ctx.shadowColor = this.shadow.color.toString();\r\n      ctx.shadowBlur = this.shadow.blur;\r\n      ctx.shadowOffsetX = this.shadow.offset.x;\r\n      ctx.shadowOffsetY = this.shadow.offset.y;\r\n    }\r\n  }\r\n\r\n  private _drawText(ctx: CanvasRenderingContext2D, text: string, colorOverride: Color, lineHeight: number): void {\r\n    const lines = text.split('\\n');\r\n    this._applyRasterProperties(ctx, colorOverride);\r\n    this._applyFont(ctx);\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (this.color) {\r\n        ctx.fillText(line, 0, i * lineHeight);\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.strokeText(line, 0, i * lineHeight);\r\n      }\r\n    }\r\n\r\n    if (this.showDebug) {\r\n      // Horizontal line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\r\n      // Vertical line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\r\n    }\r\n  }\r\n\r\n  private _textToBitmap = new Map<string, CanvasRenderingContext2D>();\r\n  private _bitmapUsage = new Map<CanvasRenderingContext2D, number>();\r\n  private _getTextBitmap(text: string, color?: Color): CanvasRenderingContext2D {\r\n    const textAndHash = text + this._getRasterPropertiesHash(color);\r\n    const bitmap = this._textToBitmap.get(textAndHash);\r\n    if (bitmap) {\r\n      return bitmap;\r\n    }\r\n\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    this._textToBitmap.set(textAndHash, ctx);\r\n    return ctx;\r\n  }\r\n\r\n  private _splitTextBitmap(bitmap: CanvasRenderingContext2D) {\r\n    const textImages: {x: number, y: number, canvas: HTMLCanvasElement}[] = [];\r\n    let currentX = 0;\r\n    let currentY = 0;\r\n    // 4k is the max for mobile devices\r\n    const width = Math.min(4096, bitmap.canvas.width);\r\n    const height = Math.min(4096, bitmap.canvas.height);\r\n\r\n    // Splits the original bitmap into 4k max chunks\r\n    while (currentX < bitmap.canvas.width) {\r\n      while (currentY < bitmap.canvas.height) {\r\n        // create new bitmap\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n\r\n        // draw current slice to new bitmap in < 4k chunks\r\n        ctx.drawImage(bitmap.canvas, currentX, currentY, width, height, 0, 0, width, height);\r\n\r\n        textImages.push({x: currentX, y: currentY, canvas});\r\n        currentY += height;\r\n      }\r\n      currentX += width;\r\n      currentY = 0;\r\n    }\r\n    return textImages;\r\n  }\r\n\r\n  private _textFragments: {x: number, y: number, canvas: HTMLCanvasElement}[] = [];\r\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number) {\r\n    if (this.showDebug) {\r\n      this.clearCache();\r\n    }\r\n    this.checkAndClearCache();\r\n    // Get bitmap for rastering text, this is cached by raster properties\r\n    const bitmap = this._getTextBitmap(text, colorOverride);\r\n    const isNewBitmap = !this._bitmapUsage.get(bitmap);\r\n\r\n    // Bounds of the text\r\n    this._textBounds = this.measureText(text);\r\n\r\n    if (isNewBitmap) {\r\n      // Setting dimension is expensive because it invalidates the bitmap\r\n      this._setDimension(this._textBounds, bitmap);\r\n    }\r\n\r\n    // Apply affine transformations\r\n    this._preDraw(ex, x, y);\r\n\r\n    const lines = text.split('\\n');\r\n    const lineHeight = this._textBounds.height / lines.length;\r\n\r\n    if (isNewBitmap) {\r\n      // draws the text to the bitmap\r\n      this._drawText(bitmap, text, colorOverride, lineHeight);\r\n\r\n      // clean up any existing fragments\r\n      for (const frag of this._textFragments) {\r\n        TextureLoader.delete(frag.canvas);\r\n      }\r\n\r\n      this._textFragments = this._splitTextBitmap(bitmap);\r\n\r\n      for (const frag of this._textFragments) {\r\n        TextureLoader.load(frag.canvas, this.filtering, true);\r\n      }\r\n    }\r\n\r\n    // draws the bitmap fragments to excalibur graphics context\r\n    for (const frag of this._textFragments) {\r\n      ex.drawImage(\r\n        frag.canvas,\r\n        0,\r\n        0,\r\n        frag.canvas.width,\r\n        frag.canvas.height,\r\n        frag.x / this.quality + x - bitmap.canvas.width / this.quality / 2,\r\n        frag.y / this.quality + y - bitmap.canvas.height / this.quality / 2,\r\n        frag.canvas.width / this.quality,\r\n        frag.canvas.height / this.quality\r\n      );\r\n    }\r\n\r\n    this._postDraw(ex);\r\n\r\n    // Cache the bitmap for certain amount of time\r\n    this._bitmapUsage.set(bitmap, performance.now());\r\n  }\r\n\r\n  /**\r\n   * Get the internal cache size of the font\r\n   * This is useful when debugging memory usage, these numbers indicate the number of cached in memory text bitmaps\r\n   */\r\n  public get cacheSize() {\r\n    return this._bitmapUsage.size;\r\n  }\r\n\r\n  /**\r\n   * Force clear all cached text bitmaps\r\n   */\r\n  public clearCache() {\r\n    this._bitmapUsage.clear();\r\n  }\r\n\r\n  /**\r\n   * Remove any expired cached text bitmaps\r\n   */\r\n  public checkAndClearCache() {\r\n    for (const [bitmap, time] of this._bitmapUsage.entries()) {\r\n      // if bitmap hasn't been used in 1 second clear it\r\n      if (time + 1000 < performance.now()) {\r\n        this._bitmapUsage.delete(bitmap);\r\n        // Cleanup measurements\r\n        const measurement = this._bitmapToTextMeasurement.get(bitmap);\r\n        if (measurement) {\r\n          this._cachedTextMeasurement.delete(measurement.text);\r\n          this._bitmapToTextMeasurement.delete(bitmap);\r\n        }\r\n        TextureLoader.delete(bitmap.canvas);\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\n\r\nexport interface TextOptions {\r\n  /**\r\n   * Text to draw\r\n   */\r\n  text: string;\r\n\r\n  /**\r\n   * Optionally override the font color, currently unsupported by SpriteFont\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\r\n   */\r\n  font?: Font | SpriteFont;\r\n}\r\n\r\n/**\r\n * Represent Text graphics in excalibur\r\n *\r\n * Useful for in game labels, ui, or overlays\r\n */\r\nexport class Text extends Graphic {\r\n  public color?: Color;\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color?.clone() ?? Color.Black,\r\n      font: this.font.clone()\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    const bounds = this.font.measureText(this._text);\r\n    this._textWidth = bounds.width;\r\n    this._textHeight = bounds.height;\r\n  }\r\n\r\n  private _font: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    this._font = font;\r\n  }\r\n\r\n  private _textWidth: number = 0;\r\n\r\n  public get width() {\r\n    if (this._textWidth === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textWidth * this.scale.x;\r\n  }\r\n\r\n  private _textHeight: number = 0;\r\n  public get height() {\r\n    if (this._textHeight === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textHeight * this.scale.y;\r\n  }\r\n\r\n  private _calculateDimension() {\r\n    const { width, height } = this.font.measureText(this._text);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.measureText(this._text).scale(this.scale);\r\n  }\r\n\r\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    let color = Color.Black;\r\n    if (this.font instanceof Font) {\r\n      color = this.color ?? this.font.color;\r\n    }\r\n\r\n    if (this.isStale() || this.font.isStale()) {\r\n      this.font.flipHorizontal = this.flipHorizontal;\r\n      this.font.flipVertical = this.flipVertical;\r\n      this.font.rotation = this.rotation;\r\n      this.font.origin = this.origin;\r\n      this.font.opacity = this.opacity;\r\n    }\r\n    this.font.tint = this.tint;\r\n\r\n    const { width, height } = this.font.measureText(this._text);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n\r\n    this.font.render(ex, this._text, color, x, y);\r\n    if (this.font.showDebug) {\r\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\r\n    }\r\n  }\r\n}\r\n", "import {\r\n  InitializeEvent,\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  GameEvent,\r\n  ExitTriggerEvent,\r\n  EnterTriggerEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent\r\n} from './Events';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { CanInitialize, CanUpdate, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport * as Events from './Events';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionGroup } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { PointerEvent } from './Input/PointerEvent';\r\nimport { WheelEvent } from './Input/WheelEvent';\r\nimport { PointerComponent } from './Input/PointerComponent';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\nimport { Raster } from './Graphics/Raster';\r\nimport { Text } from './Graphics/Text';\r\nimport { CoordPlane } from './Math/coord-plane';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor contructor options\r\n */\r\nexport interface ActorArgs {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the coordinate plane of the actor, default is [[CoordPlane.World]] meaning actor is subject to camera positioning\r\n   */\r\n  coordPlane?: CoordPlane;\r\n  /**\r\n   * Optionally set the width of a box collider for the actor\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of a box collider for the actor\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Optionally set the radius of the circle collider for the actor\r\n   */\r\n  radius?: number;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n  /**\r\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n   */\r\n  collider?: Collider;\r\n  /**\r\n   * Optionally suppy a [[CollisionGroup]]\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n}\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a [[Scene]] for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanBeKilled {\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public get body(): BodyComponent {\r\n    return this.get(BodyComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[TransformComponent]]\r\n   */\r\n  public get transform(): TransformComponent {\r\n    return this.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[MotionComponent]]\r\n   */\r\n  public get motion(): MotionComponent {\r\n    return this.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[GraphicsComponent]]\r\n   */\r\n  public get graphics(): GraphicsComponent {\r\n    return this.get(GraphicsComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[ColliderComponent]]\r\n   */\r\n  public get collider(): ColliderComponent {\r\n    return this.get(ColliderComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[PointerComponent]] config\r\n   */\r\n  public get pointer(): PointerComponent {\r\n    return this.get(PointerComponent);\r\n  }\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\r\n   * [[ActionContext|Action context]] of the actor.\r\n   */\r\n  public get actions(): ActionsComponent {\r\n    return this.get(ActionsComponent);\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('ex.offscreen');\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * The scene that the actor is in\r\n   */\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color) {\r\n    this._color = v.clone();\r\n    const defaultLayer = this.graphics.layers.default;\r\n    const currentGraphic = defaultLayer.graphics[0]?.graphic;\r\n    if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\r\n      currentGraphic.color = this._color;\r\n    }\r\n  }\r\n  private _color: Color;\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      coordPlane,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      anchor,\r\n      collisionType,\r\n      collisionGroup\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this._setName(name);\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n    const tx = new TransformComponent();\r\n    this.addComponent(tx);\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n    tx.coordPlane = coordPlane ?? CoordPlane.World;\r\n\r\n    this.addComponent(new PointerComponent);\r\n\r\n    this.addComponent(new GraphicsComponent({\r\n      anchor: this.anchor\r\n    }));\r\n    this.addComponent(new MotionComponent());\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.addComponent(new ActionsComponent());\r\n\r\n    this.addComponent(new BodyComponent());\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (collider) {\r\n      this.addComponent(new ColliderComponent(collider));\r\n    } else if (radius) {\r\n      this.addComponent(new ColliderComponent(Shape.Circle(radius)));\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\r\n      } else {\r\n        this.addComponent(new ColliderComponent()); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.visible = visible ?? true;\r\n\r\n    if (color) {\r\n      this.color = color;\r\n      if (width && height) {\r\n        this.graphics.add(\r\n          new Rectangle({\r\n            color: color,\r\n            width,\r\n            height\r\n          })\r\n        );\r\n      } else if (radius) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n\r\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\r\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\r\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\r\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\r\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(_scene: Scene) {\r\n    super.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\r\n   */\r\n  public onPreKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(_scene: Scene) {\r\n    super.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\r\n   */\r\n  public onPostKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.active = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor (global position)\r\n   */\r\n  public get center(): Vector {\r\n    const globalPos = this.getGlobalPos();\r\n    return new Vector(\r\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\r\n      globalPos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  /**\r\n   * Get the local center point of an actor\r\n   */\r\n  public get localCenter(): Vector {\r\n    return new Vector(\r\n      this.pos.x + this.width / 2 - this.anchor.x * this.width,\r\n      this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   *\r\n   * @returns Rotation angle in radians\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   *\r\n   * @returns Position in world coordinates\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param delta  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  // endregion\r\n}\r\n", "import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { CoordPlane } from './Math/coord-plane';\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n\r\n/**\r\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.anchor = vec(0, 0);\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n", "import { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport * as ex from './index';\r\nimport { Random } from './Math/Random';\r\n\r\n\r\nexport interface TimerOptions {\r\n  repeats?: boolean;\r\n  numberOfRepeats?: number;\r\n  fcn?: () => void;\r\n  interval: number;\r\n  randomRange?: [number, number];\r\n  random?: ex.Random;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n  public randomRange: [number, number] = [0,0];\r\n  public random: ex.Random;\r\n  private _baseInterval = 10;\r\n  private _generateRandomInterval = () => {\r\n    return this._baseInterval + this.random.integer(this.randomRange[0], this.randomRange[1]);\r\n  };\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\r\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\r\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\r\n   * @param fcn        The callback to be fired after the interval is complete.\r\n   * @param randomRange Indicates a range to select a random number to be added onto the interval\r\n   */\r\n  constructor(options: TimerOptions);\r\n  constructor(fcn: TimerOptions | (() => void), interval?: number,\r\n    repeats?: boolean, numberOfRepeats?: number, randomRange?: [number, number], random?: ex.Random) {\r\n    if (typeof fcn !== 'function') {\r\n      const options = fcn;\r\n      fcn = options.fcn;\r\n      interval = options.interval;\r\n      repeats = options.repeats;\r\n      numberOfRepeats = options.numberOfRepeats;\r\n      randomRange = options.randomRange;\r\n      random= options.random;\r\n    }\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this._callbacks = [];\r\n    this._baseInterval = this.interval = interval;\r\n    if (!!randomRange){\r\n      if (randomRange[0] > randomRange[1]) {\r\n        throw new Error('min value must be lower than max value for range');\r\n      }\r\n      //We use the instance of ex.Random to generate the range\r\n      this.random = random ?? new Random();\r\n      this.randomRange = randomRange;\r\n\r\n      this.interval = this._generateRandomInterval();\r\n      this.on(() => {\r\n        this.interval = this._generateRandomInterval();\r\n      });\r\n    };\r\n    this.repeats = repeats || this.repeats;\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(fcn: () => void) {\r\n    this._callbacks.push(fcn);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(fcn: () => void) {\r\n    const index = this._callbacks.indexOf(fcn);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param delta  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(delta: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += delta;\r\n      this._elapsedTime += delta;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this._baseInterval = this.interval= newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n\r\n", "import { Component } from '../EntityComponentSystem/Component';\r\nimport { vec, Vector } from '../Math/vector';\r\n\r\nexport class ParallaxComponent extends Component<'ex.parallax'> {\r\n  readonly type = 'ex.parallax';\r\n\r\n  parallaxFactor = vec(1.0, 1.0);\r\n\r\n  constructor(parallaxFactor?: Vector) {\r\n    super();\r\n    this.parallaxFactor = parallaxFactor ?? this.parallaxFactor;\r\n  }\r\n}", "import { ExcaliburGraphicsContext } from '.';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n\r\n/**\r\n * Provide arbitrary drawing for the purposes of debugging your game\r\n *\r\n * Will only show when the Engine is set to debug mode [[Engine.showDebug]] or [[Engine.toggleDebug]]\r\n *\r\n */\r\nexport class DebugGraphicsComponent extends Component<'ex.debuggraphics'> {\r\n  readonly type = 'ex.debuggraphics';\r\n  constructor(public draw: (ctx: ExcaliburGraphicsContext) => void, public useTransform = true) {\r\n    super();\r\n  }\r\n}", "import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Engine } from '../Engine';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport * as Events from '../Events';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\nimport { CollisionType } from '../Collision/CollisionType';\r\nimport { Shape } from '../Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, Graphic, GraphicsComponent, hasGraphicsTick, ParallaxComponent } from '../Graphics';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CompositeCollider } from '../Collision/Colliders/CompositeCollider';\r\nimport { Color } from '../Color';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { Collider } from '../Collision/Colliders/Collider';\r\n\r\nexport interface TileMapOptions {\r\n  /**\r\n   * Optionally name the isometric tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the isometric tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n}\r\n\r\n/**\r\n * The TileMap provides a mechanism for doing flat 2D tiles rendered in a grid.\r\n *\r\n * TileMaps are useful for top down or side scrolling grid oriented games.\r\n */\r\nexport class TileMap extends Entity {\r\n  private _token = 0;\r\n  private _onScreenXStart: number = 0;\r\n  private _onScreenXEnd: number = Number.MAX_VALUE;\r\n  private _onScreenYStart: number = 0;\r\n  private _onScreenYEnd: number = Number.MAX_VALUE;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly tiles: Tile[] = [];\r\n  private _rows: Tile[][] = [];\r\n  private _cols: Tile[][] = [];\r\n\r\n  public readonly tileWidth: number;\r\n  public readonly tileHeight: number;\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  public renderFromTopOfGraphic = false;\r\n\r\n  private _collidersDirty = true;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n\r\n  }\r\n  private _transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _graphics: GraphicsComponent;\r\n  private _collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this._transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this._transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this._transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this._transform?.pos) {\r\n      this._transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this._transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this._transform) {\r\n      this._transform.z = val;\r\n    }\r\n  }\r\n\r\n  public get rotation(): number {\r\n    return this._transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this._transform?.rotation) {\r\n      this._transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this._transform?.scale ?? Vector.One;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    if (this._transform?.scale) {\r\n      this._transform.scale = val;\r\n    }\r\n  }\r\n\r\n  private _oldPos: Vector;\r\n  public get pos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this._transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n\r\n  /**\r\n   * @param options\r\n   */\r\n  constructor(options: TileMapOptions) {\r\n    super(null, options.name);\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\r\n      })\r\n    );\r\n    this.addComponent(new DebugGraphicsComponent((ctx) => this.debug(ctx)));\r\n    this.addComponent(new ColliderComponent());\r\n    this._graphics = this.get(GraphicsComponent);\r\n    this._transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this._collider = this.get(ColliderComponent);\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n\r\n    this._transform.pos = options.pos ?? Vector.Zero;\r\n    this._oldPos = this._transform.pos;\r\n    this.renderFromTopOfGraphic = options.renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.tileWidth = options.tileWidth;\r\n    this.tileHeight = options.tileHeight;\r\n    this.rows = options.rows;\r\n    this.columns = options.columns;\r\n    this.tiles = new Array<Tile>(this.rows * this.columns);\r\n    this._rows = new Array(this.rows);\r\n    this._cols = new Array(this.columns);\r\n    let currentCol: Tile[] = [];\r\n    for (let i = 0; i < this.columns; i++) {\r\n      for (let j = 0; j < this.rows; j++) {\r\n        const cd = new Tile({\r\n          x: i,\r\n          y: j,\r\n          map: this\r\n        });\r\n        cd.map = this;\r\n        this.tiles[i + j * this.columns] = cd;\r\n        currentCol.push(cd);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(cd);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this._graphics.localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.columns * this.tileWidth,\r\n      bottom: this.rows * this.tileHeight\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider);\r\n    }\r\n  }\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n    let current: BoundingBox;\r\n    // Bad square tesselation algo\r\n    for (let i = 0; i < this.columns; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        // Columns start with a new collider\r\n        if (j === 0) {\r\n          current = null;\r\n        }\r\n        const tile = this.tiles[i + j * this.columns];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          // Use custom collider otherwise bounding box\r\n          if (tile.getColliders().length > 0) {\r\n            for (const collider of tile.getColliders()) {\r\n              const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n              collider.offset = vec(tile.x * this.tileWidth, tile.y * this.tileHeight).add(originalOffset);\r\n              collider.owner = this;\r\n              this._composite.addCollider(collider);\r\n            }\r\n            current = null;\r\n          } else {\r\n            if (!current) {\r\n              current = tile.bounds;\r\n            } else {\r\n              current = current.combine(tile.bounds);\r\n            }\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          if (current) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      if (current) {\r\n        // if previous is the same combine it\r\n        const prev = colliders[colliders.length - 1];\r\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\r\n          colliders[colliders.length - 1] = prev.combine(current);\r\n        } else {\r\n          // else new collider\r\n          colliders.push(current);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this._collider.update();\r\n  }\r\n\r\n  /**\r\n   * Returns the [[Tile]] by index (row major order)\r\n   */\r\n  public getTileByIndex(index: number): Tile {\r\n    return this.tiles[index];\r\n  }\r\n  /**\r\n   * Returns the [[Tile]] by its x and y integer coordinates\r\n   */\r\n  public getTile(x: number, y: number): Tile {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n  /**\r\n   * Returns the [[Tile]] by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): Tile {\r\n    const x = Math.floor((point.x - this.pos.x) / this.tileWidth);\r\n    const y = Math.floor((point.y - this.pos.y) / this.tileHeight);\r\n    const tile = this.getTile(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.columns && y < this.rows && tile) {\r\n      return tile;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public getRows(): readonly Tile[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Tile[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    this.onPreUpdate(engine, delta);\r\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\r\n    if (!this._oldPos.equals(this.pos)) {\r\n      this.flagCollidersDirty();\r\n      for (let i = 0; i < this.tiles.length; i++) {\r\n        if (this.tiles[i]) {\r\n          this.tiles[i].flagDirty();\r\n        }\r\n      }\r\n    }\r\n    if (this._collidersDirty) {\r\n      this._collidersDirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    this._token++;\r\n    const worldBounds = engine.getWorldBounds();\r\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\r\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\r\n\r\n    let pos = this.pos;\r\n    const maybeParallax = this.get(ParallaxComponent);\r\n    let parallaxOffset = Vector.One;\r\n    if (maybeParallax) {\r\n      const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n      parallaxOffset = engine.currentScene.camera.pos.scale(oneMinusFactor);\r\n      pos = pos.add(parallaxOffset);\r\n    }\r\n\r\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - pos.x) / this.tileWidth) - 2, 0);\r\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - pos.y) / this.tileHeight) - 2, 0);\r\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - pos.x) / this.tileWidth) + 2, 0);\r\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - pos.y) / this.tileHeight) + 2, 0);\r\n    // why are we resetting pos?\r\n    this._transform.pos = vec(this.x, this.y);\r\n\r\n    this.onPostUpdate(engine, delta);\r\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the [[Scene]].\r\n   * @param ctx ExcaliburGraphicsContext\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, delta: number): void {\r\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\r\n\r\n    let x = this._onScreenXStart;\r\n    const xEnd = Math.min(this._onScreenXEnd, this.columns);\r\n    let y = this._onScreenYStart;\r\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\r\n\r\n    let graphics: readonly Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    for (x; x < xEnd; x++) {\r\n      for (y; y < yEnd; y++) {\r\n        // get non-negative tile sprites\r\n        graphics = this.getTile(x, y).getGraphics();\r\n\r\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n          // draw sprite, warning if sprite doesn't exist\r\n          const graphic = graphics[graphicsIndex];\r\n          if (graphic) {\r\n            if (hasGraphicsTick(graphic)) {\r\n              graphic?.tick(delta, this._token);\r\n            }\r\n            const offsetY = this.renderFromTopOfGraphic ? 0 : (graphic.height - this.tileHeight);\r\n            graphic.draw(ctx, x * this.tileWidth, y * this.tileHeight - offsetY);\r\n          }\r\n        }\r\n      }\r\n      y = this._onScreenYStart;\r\n    }\r\n\r\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\r\n  }\r\n\r\n  public debug(gfx: ExcaliburGraphicsContext) {\r\n    const width = this.tileWidth * this.columns;\r\n    const height = this.tileHeight * this.rows;\r\n    const pos = Vector.Zero;\r\n    for (let r = 0; r < this.rows + 1; r++) {\r\n      const yOffset = vec(0, r * this.tileHeight);\r\n      gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), Color.Red, 2);\r\n    }\r\n\r\n    for (let c = 0; c < this.columns + 1; c++) {\r\n      const xOffset = vec(c * this.tileWidth, 0);\r\n      gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), Color.Red, 2);\r\n    }\r\n\r\n    const colliders = this._composite.getColliders();\r\n    for (const collider of colliders) {\r\n      const grayish = Color.Gray;\r\n      grayish.a = 0.5;\r\n      const bounds = collider.localBounds;\r\n      const pos = collider.worldPos.sub(this.pos);\r\n      gfx.drawRectangle(pos, bounds.width, bounds.height, grayish);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface TileOptions {\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  y: number;\r\n  map: TileMap;\r\n  solid?: boolean;\r\n  graphics?: Graphic[];\r\n}\r\n\r\n/**\r\n * TileMap Tile\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a [[TileMap]].\r\n *\r\n * Tiles can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Tile extends Entity {\r\n  private _bounds: BoundingBox;\r\n  private _pos: Vector;\r\n  private _posDirty = false;\r\n  // private _transform: TransformComponent;\r\n\r\n  /**\r\n   * Return the world position of the top left corner of the tile\r\n   */\r\n  public get pos() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n      this._posDirty = false;\r\n    }\r\n    return this._pos;\r\n  }\r\n\r\n  /**\r\n   * Integer x coordinate of the tile\r\n   */\r\n  public readonly x: number;\r\n\r\n  /**\r\n   * Integer y coordinate of the tile\r\n   */\r\n  public readonly y: number;\r\n\r\n  /**\r\n   * Width of the tile in pixels\r\n   */\r\n  public readonly width: number;\r\n\r\n  /**\r\n   * Height of the tile in pixels\r\n   */\r\n  public readonly height: number;\r\n\r\n  /**\r\n   * Reference to the TileMap this tile is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this tile should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagCollidersDirty();\r\n    this._solid = val;\r\n  }\r\n\r\n  private _graphics: Graphic[] = [];\r\n\r\n  /**\r\n   * Current list of graphics for this tile\r\n   */\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Add another [[Graphic]] to this TileMap tile\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphic) {\r\n    this._graphics.push(graphic);\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a [[Graphic]] from this tile\r\n   */\r\n  public removeGraphic(graphic: Graphic) {\r\n    removeItemFromArray(graphic, this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Clear all graphics from this tile\r\n   */\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Current list of colliders for this tile\r\n   */\r\n  private _colliders: Collider[] = [];\r\n\r\n  /**\r\n   * Returns the list of colliders\r\n   */\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a custom collider to the [[Tile]] to use instead of it's bounds\r\n   *\r\n   * If no collider is set but [[Tile.solid]] is set, the tile bounds are used as a collider.\r\n   *\r\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the [[Tile]]\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the [[Tile]]\r\n   */\r\n  public clearColliders() {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Arbitrary data storage per tile, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  constructor(options: TileOptions) {\r\n    super();\r\n    this.x = options.x;\r\n    this.y = options.y;\r\n    this.map = options.map;\r\n    this.width = options.map.tileWidth;\r\n    this.height = options.map.tileHeight;\r\n    this.solid = options.solid ?? this.solid;\r\n    this._graphics = options.graphics ?? [];\r\n    this._recalculate();\r\n  }\r\n\r\n  public flagDirty() {\r\n    return this._posDirty = true;\r\n  }\r\n\r\n  private _recalculate() {\r\n    this._pos = this.map.pos.add(\r\n      vec(\r\n        this.x * this.map.tileWidth,\r\n        this.y * this.map.tileHeight));\r\n    this._bounds = new BoundingBox(this._pos.x, this._pos.y, this._pos.x + this.width, this._pos.y + this.height);\r\n    this._posDirty = false;\r\n  }\r\n\r\n  public get bounds() {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._bounds;\r\n  }\r\n\r\n  public get center(): Vector {\r\n    if (this._posDirty) {\r\n      this._recalculate();\r\n    }\r\n    return new Vector(this._pos.x + this.width / 2, this._pos.y + this.height / 2);\r\n  }\r\n}", "import { Engine } from './Engine';\r\nimport { Screen } from './Screen';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\r\nimport { Class } from './Class';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { watchAny } from './Util/Watch';\r\nimport { AffineMatrix } from './Math/affine-matrix';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param delta The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor, public axis: Axis) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(public target: Actor, public radius: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.size;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   *\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\n/**\r\n * Cameras\r\n *\r\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera extends Class implements CanUpdate, CanInitialize {\r\n  public transform: AffineMatrix = AffineMatrix.identity();\r\n  public inverse: AffineMatrix = AffineMatrix.identity();\r\n\r\n\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  private _angularVelocity: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this._angularVelocity;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this._angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  private _posChanged = false;\r\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._pos = watchAny(vec, () => (this._posChanged = true));\r\n    this._posChanged = true;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Get or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   *\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\r\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\r\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _screen: Screen;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(_engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = _engine;\r\n      this._screen = _engine.screen;\r\n\r\n      const currentRes = this._screen.resolution;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.y;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n      // First frame bootstrap\r\n\r\n      // Ensure camera tx is correct\r\n      // Run update twice to ensure properties are init'd\r\n      this.updateTransform();\r\n\r\n      // Run strategies for first frame\r\n      this.runStrategies(_engine, _engine.clock.elapsed());\r\n\r\n      // Setup the first frame viewport\r\n      this.updateViewport();\r\n\r\n      // It's important to update the camera after strategies\r\n      // This prevents jitter\r\n      this.updateTransform();\r\n\r\n      this.onInitialize(_engine);\r\n      super.emit('initialize', new InitializeEvent(_engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(_engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public on(eventName: any, handler: any) {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\r\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\r\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\r\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public off(eventName: string, handler: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public runStrategies(engine: Engine, delta: number) {\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, engine, delta);\r\n    }\r\n  }\r\n\r\n  public updateViewport() {\r\n    // recalc viewport\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this._initialize(_engine);\r\n    this._preupdate(_engine, delta);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\r\n    this.zoom += (this.dz * delta) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\r\n    this.dz += (this.az * delta) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * delta) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += delta;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += delta;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += delta;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    this.runStrategies(_engine, delta);\r\n\r\n    this.updateViewport();\r\n\r\n    // It's important to update the camera after strategies\r\n    // This prevents jitter\r\n    this.updateTransform();\r\n\r\n    this._postupdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext): void {\r\n    ctx.multiply(this.transform);\r\n  }\r\n\r\n  public updateTransform() {\r\n    // center the camera\r\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\r\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\r\n    const cameraPos = vec(-this.x + newCanvasWidth / 2 + this._xShake, -this.y + newCanvasHeight / 2 + this._yShake);\r\n\r\n    // Calculate camera transform\r\n    this.transform.reset();\r\n    this.transform.scale(this.zoom, this.zoom);\r\n    this.transform.translate(cameraPos.x, cameraPos.y);\r\n    this.transform.inverse(this.inverse);\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n", "import { Engine } from './Engine';\r\nimport { EventDispatcher } from './EventDispatcher';\r\nimport { Vector } from './Math/vector';\r\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Entity } from './EntityComponentSystem';\r\nimport { Actor } from './Actor';\r\n\r\n/**\r\n * ITriggerOptions\r\n */\r\nexport interface TriggerOptions {\r\n  // position of the trigger\r\n  pos: Vector;\r\n  // width of the trigger\r\n  width: number;\r\n  // height of the trigger\r\n  height: number;\r\n  // whether the trigger is visible or not\r\n  visible: boolean;\r\n  // action to take when triggered\r\n  action: () => void;\r\n  // if specified the trigger will only fire on a specific actor and overrides any filter\r\n  target: Entity;\r\n  // Returns true if the triggers should fire on the collided actor\r\n  filter: (actor: Entity) => boolean;\r\n  // -1 if it should repeat forever\r\n  repeat: number;\r\n}\r\n\r\nconst triggerDefaults: Partial<TriggerOptions> = {\r\n  pos: Vector.Zero,\r\n  width: 10,\r\n  height: 10,\r\n  visible: false,\r\n  action: () => {\r\n    return;\r\n  },\r\n  filter: () => true,\r\n  repeat: -1\r\n};\r\n\r\n/**\r\n * Triggers are a method of firing arbitrary code on collision. These are useful\r\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\r\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\r\n */\r\nexport class Trigger extends Actor {\r\n  private _target: Entity;\r\n  /**\r\n   * Action to fire when triggered by collision\r\n   */\r\n  public action: () => void = () => {\r\n    return;\r\n  };\r\n  /**\r\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\r\n   * filter return true for the collided actor.\r\n   */\r\n  public filter: (actor: Entity) => boolean = () => true;\r\n  /**\r\n   * Number of times to repeat before killing the trigger,\r\n   */\r\n  public repeat: number = -1;\r\n\r\n  /**\r\n   *\r\n   * @param opts Trigger options\r\n   */\r\n  constructor(opts: Partial<TriggerOptions>) {\r\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\r\n    opts = {\r\n      ...triggerDefaults,\r\n      ...opts\r\n    };\r\n\r\n    this.filter = opts.filter || this.filter;\r\n    this.repeat = opts.repeat || this.repeat;\r\n    this.action = opts.action || this.action;\r\n    if (opts.target) {\r\n      this.target = opts.target;\r\n    }\r\n\r\n    this.graphics.visible = opts.visible;\r\n    this.body.collisionType = CollisionType.Passive;\r\n    this.eventDispatcher = new EventDispatcher();\r\n\r\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\r\n      if (this.filter(evt.other)) {\r\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\r\n        this._dispatchAction();\r\n        // remove trigger if its done, -1 repeat forever\r\n        if (this.repeat === 0) {\r\n          this.kill();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\r\n      if (this.filter(evt.other)) {\r\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\r\n      }\r\n    });\r\n  }\r\n\r\n  public set target(target: Entity) {\r\n    this._target = target;\r\n    this.filter = (actor: Entity) => actor === target;\r\n  }\r\n\r\n  public get target() {\r\n    return this._target;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  private _dispatchAction() {\r\n    if (this.repeat !== 0) {\r\n      this.action.call(this);\r\n      this.repeat--;\r\n    }\r\n  }\r\n}\r\n", "import { Entity } from './Entity';\r\nimport { Message, Observer } from '../Util/Observable';\r\nimport { Component } from './Component';\r\nimport { Scene } from '../Scene';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * An Excalibur [[System]] that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System<ComponentA | ComponentB> {\r\n *   public readonly types = ['a', 'b'] as const;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public update(entities: Entity<ComponentA | ComponentB>) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\r\nimplements Observer<AddedEntity | RemovedEntity> {\r\n  /**\r\n   * The types of entities that this system operates on\r\n   * For example ['transform', 'motion']\r\n   */\r\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\r\n\r\n  /**\r\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public priority: number = 0;\r\n\r\n  /**\r\n   * Optionally specify a sort order for entities passed to the your system\r\n   * @param a The left entity\r\n   * @param b The right entity\r\n   */\r\n  sort?(a: Entity, b: Entity): number;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(engine: ContextType): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param entities Entities to update that match this system's types\r\n   * @param delta Time in milliseconds\r\n   */\r\n  abstract update(entities: Entity[], delta: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Systems observe when entities match their types or no longer match their types, override\r\n   * @param _entityAddedOrRemoved\r\n   */\r\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\r\n    // Override me\r\n  }\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\r\n */\r\nexport class AddedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Added' = 'Entity Added';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * Type guard to check for AddedEntity messages\r\n * @param x\r\n */\r\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\r\n  return !!x && x.type === 'Entity Added';\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\r\n */\r\nexport class RemovedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Removed' = 'Entity Removed';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * type guard to check for the RemovedEntity message\r\n */\r\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\r\n  return !!x && x.type === 'Entity Removed';\r\n}\r\n", "import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\r\nimport { Observer } from '../Util/Observable';\r\nimport { World } from './World';\r\nimport { Util } from '..';\r\n\r\n// Add/Remove entities and components\r\n\r\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param _context\r\n   */\r\n  public updateEntities(_context: ContextType, elapsed: number) {\r\n    for (const entity of this.entities) {\r\n      // TODO is this right?\r\n      entity.update((_context as any).engine, elapsed);\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (const entity of this.entities) {\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * EntityManager observes changes on entities\r\n   * @param message\r\n   */\r\n  public notify(message: RemovedComponent | AddedComponent): void {\r\n    if (isAddedComponent(message)) {\r\n      // we don't need the component, it's already on the entity\r\n      this._world.queryManager.addEntity(message.data.entity);\r\n    }\r\n\r\n    if (isRemovedComponent(message)) {\r\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.active = true;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n      entity.componentAdded$.register(this);\r\n      entity.componentRemoved$.register(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.addEntity(c));\r\n      entity.childrenAdded$.register({\r\n        notify: (e) => {\r\n          this.addEntity(e);\r\n        }\r\n      });\r\n      entity.childrenRemoved$.register({\r\n        notify: (e) => {\r\n          this.removeEntity(e, false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.active) {\r\n      entity.kill();\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      Util.removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n      entity.componentAdded$.unregister(this);\r\n      entity.componentRemoved$.unregister(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\r\n      entity.childrenAdded$.clear();\r\n      entity.childrenRemoved$.clear();\r\n\r\n      // stats\r\n      if ((this._world.context as any)?.engine) {\r\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (const entity of this._entitiesToRemove) {\r\n      if (entity.active) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (const entity of this.entities) {\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[]{\r\n    return this.entities.filter(e => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const entity of this.entities) {\r\n      this.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n", "export const buildTypeKey = (types: readonly string[]) => {\r\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\r\n  return key;\r\n};\r\n", "import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Util, Component, ComponentCtor } from '..';\r\nimport { AddedEntity, RemovedEntity } from './System';\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\r\n  public types: readonly string[];\r\n  private _entities: Entity[] = [];\r\n  private _key: string;\r\n  public get key(): string {\r\n    if (this._key) {\r\n      return this._key;\r\n    }\r\n    return (this._key = buildTypeKey(this.types));\r\n  }\r\n\r\n  constructor(types: readonly string[]);\r\n  constructor(types: readonly ComponentCtor<T>[]);\r\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\r\n    super();\r\n    if (types[0] instanceof Function) {\r\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\r\n    } else {\r\n      this.types = types as string[];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   *\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\r\n    if (sort) {\r\n      this._entities.sort(sort);\r\n    }\r\n    return this._entities;\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the query, will only be added if the entity matches the query types\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\r\n      this._entities.push(entity);\r\n      this.notifyAll(new AddedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the entity is part of the query it will be removed regardless of types\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity): void {\r\n    if (Util.removeItemFromArray(entity, this._entities)) {\r\n      this.notifyAll(new RemovedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and observers from the query\r\n   */\r\n  public clear(): void {\r\n    this._entities.length = 0;\r\n    for (const observer of this.observers) {\r\n      this.unregister(observer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the entity's types match query\r\n   * @param entity\r\n   */\r\n  public matches(entity: Entity): boolean;\r\n\r\n  /**\r\n   * Returns whether the list of ComponentTypes have at least the same types as the query\r\n   * @param types\r\n   */\r\n  public matches(types: string[]): boolean;\r\n  public matches(typesOrEntity: string[] | Entity): boolean {\r\n    let types: string[] = [];\r\n    if (typesOrEntity instanceof Entity) {\r\n      types = typesOrEntity.types;\r\n    } else {\r\n      types = typesOrEntity;\r\n    }\r\n\r\n    let matches = true;\r\n    for (const type of this.types) {\r\n      matches = matches && types.indexOf(type) > -1;\r\n      if (!matches) {\r\n        return false;\r\n      }\r\n    }\r\n    return matches;\r\n  }\r\n\r\n  public contain(type: string) {\r\n    return this.types.indexOf(type) > -1;\r\n  }\r\n}\r\n", "import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Query } from './Query';\r\nimport { Component } from './Component';\r\nimport { World } from './World';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\r\n\r\n  constructor(private _world: World<any>) {}\r\n\r\n  /**\r\n   * Adds a query to the manager and populates with any entities that match\r\n   * @param query\r\n   */\r\n  private _addQuery(query: Query<any>) {\r\n    this._queries[buildTypeKey(query.types)] = query;\r\n    for (const entity of this._world.entityManager.entities) {\r\n      query.addEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the query if there are no observers left\r\n   * @param query\r\n   */\r\n  public maybeRemoveQuery(query: Query): void {\r\n    if (query.observers.length === 0) {\r\n      query.clear();\r\n      delete this._queries[buildTypeKey(query.types)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the entity to any matching query in the query manage\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      if (this._queries[queryType]) {\r\n        this._queries[queryType].addEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from queries if the removed component disqualifies it\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  public removeComponent(entity: Entity, component: Component) {\r\n    for (const queryType in this._queries) {\r\n      // If the component being removed from an entity is a part of a query,\r\n      // it is now disqualified from that query, remove it\r\n      if (this._queries[queryType].contain(component.type)) {\r\n        this._queries[queryType].removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from all queries it is currently a part of\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      this._queries[queryType].removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\r\n   * @param types\r\n   */\r\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const maybeExistingQuery = this.getQuery<T>(types);\r\n    if (maybeExistingQuery) {\r\n      return maybeExistingQuery;\r\n    }\r\n    const query = new Query<T>(types);\r\n    this._addQuery(query);\r\n    return query;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an existing query by types if it exists otherwise returns null\r\n   * @param types\r\n   */\r\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const key = buildTypeKey(types);\r\n    if (this._queries[key]) {\r\n      return this._queries[key] as Query<T>;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n", "import { System, SystemType } from './System';\r\nimport { Scene, Util } from '..';\r\nimport { World } from './World';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (): T;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager<ContextType> {\r\n  /**\r\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\r\n   */\r\n  public systems: System<any, ContextType>[] = [];\r\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\r\n  public initialized = false;\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param system\r\n   */\r\n  public addSystem(system: System<any, ContextType>): void {\r\n    // validate system has types\r\n    if (!system.types || system.types.length === 0) {\r\n      throw new Error(`Attempted to add a System without any types`);\r\n    }\r\n\r\n    const query = this._world.queryManager.createQuery(system.types);\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => a.priority - b.priority);\r\n    query.register(system);\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world.context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System<any, ContextType>) {\r\n    Util.removeItemFromArray(system, this.systems);\r\n    const query = this._world.queryManager.getQuery(system.types);\r\n    if (query) {\r\n      query.unregister(system);\r\n      this._world.queryManager.maybeRemoveQuery(query);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize all systems in the manager\r\n   *\r\n   * Systems added after initialize() will be initialized on add\r\n   */\r\n  public initialize() {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world.context);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param context context reference\r\n   * @param delta time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(context, delta);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      // Get entities that match the system types, pre-sort\r\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\r\n      // Initialize entities if needed\r\n      if (context instanceof Scene) {\r\n        for (const entity of entities) {\r\n          entity._initialize(context?.engine);\r\n        }\r\n      }\r\n      s.update(entities, delta);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(context, delta);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const system of this.systems) {\r\n      this.removeSystem(system);\r\n    }\r\n  }\r\n}\r\n", "import { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemManager } from './SystemManager';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World<ContextType> {\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\r\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param context\r\n   */\r\n  constructor(public context: ContextType) {}\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, delta: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.context, delta);\r\n    }\r\n    this.systemManager.updateSystems(type, this.context, delta);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System<any, ContextType>): void;\r\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System<any, ContextType>): void;\r\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\n\r\nexport class EulerIntegrator {\r\n  // Scratch vectors to avoid allocation\r\n  private static _POS = new Vector(0, 0);\r\n  private static _SCALE = new Vector(1, 1);\r\n\r\n  private static _ACC = new Vector(0, 0);\r\n  private static _VEL = new Vector(0, 0);\r\n  private static _VEL_ACC = new Vector(0, 0);\r\n  private static _SCALE_FACTOR = new Vector(0, 0);\r\n\r\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\r\n    const seconds = elapsedMs / 1000;\r\n    // This code looks a little wild, but it's to avoid creating any new Vector instances\r\n    // integration is done in a tight loop so this is key to avoid GC'ing\r\n    motion.vel.addEqual(totalAcc.scale(seconds, EulerIntegrator._ACC));\r\n    transform.pos\r\n      .add(motion.vel.scale(seconds, EulerIntegrator._VEL), EulerIntegrator._POS)\r\n      .addEqual(totalAcc.scale(0.5 * seconds * seconds, EulerIntegrator._VEL_ACC));\r\n\r\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\r\n    const rotation = transform.rotation + motion.angularVelocity * seconds;\r\n\r\n    transform.scale.add(motion.scaleFactor.scale(seconds, this._SCALE_FACTOR), EulerIntegrator._SCALE);\r\n    const tx = transform.get();\r\n    tx.setTransform(EulerIntegrator._POS, rotation, EulerIntegrator._SCALE);\r\n  }\r\n}\r\n", "import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Physics } from './Physics';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\n\r\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  update(entities: Entity[], elapsedMs: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    for (let i = 0; i < entities.length; i++) {\r\n      transform = entities[i].get(TransformComponent);\r\n      motion = entities[i].get(MotionComponent);\r\n\r\n      const optionalBody = entities[i].get(BodyComponent);\r\n      if (optionalBody?.sleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(Physics.gravity);\r\n      }\r\n      optionalBody?.captureOldTransform();\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\r\n    }\r\n  }\r\n}\r\n", "import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver implements CollisionSolver {\r\n  directionMap = new Map<string, string>();\r\n  distanceMap = new Map<string, number>();\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Sort contacts by distance to avoid artifacts with seams\r\n    // It's important to solve in a specific order\r\n    contacts.sort((a, b) => {\r\n      const aDist = this.distanceMap.get(a.id);\r\n      const bDist = this.distanceMap.get(b.id);\r\n      return aDist - bDist;\r\n    });\r\n\r\n    for (const contact of contacts) {\r\n      // Solve position first in arcade\r\n      this.solvePosition(contact);\r\n\r\n      // Solve velocity second in arcade\r\n      this.solveVelocity(contact);\r\n    }\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  public preSolve(contacts: CollisionContact[]) {\r\n\r\n    for (const contact of contacts) {\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n\r\n      const distance = contact.colliderA.worldPos.squareDistance(contact.colliderB.worldPos);\r\n      this.distanceMap.set(contact.id, distance);\r\n\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      if (contact.isCanceled()) {\r\n        continue;\r\n      }\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contact: CollisionContact) {\r\n    const epsilon = .0001;\r\n    // if bounds no longer intersect skip to the next\r\n    // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\r\n    if (!contact.colliderA.bounds.overlaps(contact.colliderB.bounds, epsilon)) {\r\n      // Cancel the contact to prevent and solving\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    if (Math.abs(contact.mtv.x) < epsilon && Math.abs(contact.mtv.y) < epsilon) {\r\n      // Cancel near 0 mtv collisions\r\n      contact.cancel();\r\n      return;\r\n    }\r\n\r\n    let mtv = contact.mtv;\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n        // split overlaps if both are Active\r\n        mtv = mtv.scale(0.5);\r\n      }\r\n\r\n      // Resolve overlaps\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        bodyA.globalPos.x -= mtv.x;\r\n        bodyA.globalPos.y -= mtv.y;\r\n        colliderA.update(bodyA.transform.get());\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        bodyB.globalPos.x += mtv.x;\r\n        bodyB.globalPos.y += mtv.y;\r\n        colliderB.update(bodyB.transform.get());\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  public solveVelocity(contact: CollisionContact) {\r\n    if (contact.isCanceled()) {\r\n      return;\r\n    }\r\n\r\n    const colliderA = contact.colliderA;\r\n    const colliderB = contact.colliderB;\r\n    const bodyA = colliderA.owner?.get(BodyComponent);\r\n    const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n    if (bodyA && bodyB) {\r\n\r\n      if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n        return;\r\n      }\r\n\r\n      const normal = contact.normal;\r\n      const opposite = normal.negate();\r\n\r\n      if (bodyA.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform when sliding off\r\n        if (bodyA.vel.normalize().dot(opposite) < 0) {\r\n          // Cancel out velocity opposite direction of collision normal\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n      }\r\n\r\n      if (bodyB.collisionType === CollisionType.Active) {\r\n        // only adjust velocity if the contact normal is opposite to the current velocity\r\n        // this avoids catching edges on a platform\r\n        if (bodyB.vel.normalize().dot(normal) < 0) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Vector } from '../../Math/vector';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * Holds information about contact points, meant to be reused over multiple frames of contact\r\n */\r\nexport class ContactConstraintPoint {\r\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Updates the contact information\r\n   */\r\n  update() {\r\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\r\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\r\n\r\n    if (bodyA && bodyB) {\r\n      const normal = this.contact.normal;\r\n      const tangent = this.contact.tangent;\r\n\r\n      this.aToContact = this.point.sub(bodyA.globalPos);\r\n      this.bToContact = this.point.sub(bodyB.globalPos);\r\n\r\n      const aToContactNormal = this.aToContact.cross(normal);\r\n      const bToContactNormal = this.bToContact.cross(normal);\r\n\r\n      this.normalMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n      const aToContactTangent = this.aToContact.cross(tangent);\r\n      const bToContactTangent = this.bToContact.cross(tangent);\r\n\r\n      this.tangentMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns the relative velocity between bodyA and bodyB\r\n   */\r\n  public getRelativeVelocity() {\r\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\r\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      // Relative velocity in linear terms\r\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\r\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\r\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\r\n      return velB.sub(velA);\r\n    }\r\n    return Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Impulse accumulated over time in normal direction\r\n   */\r\n  public normalImpulse: number = 0;\r\n\r\n  /**\r\n   * Impulse accumulated over time in the tangent direction\r\n   */\r\n  public tangentImpulse: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the normal direction\r\n   */\r\n  public normalMass: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the tangent direction\r\n   */\r\n  public tangentMass: number = 0;\r\n\r\n  /**\r\n   * Direction from center of mass of bodyA to contact point\r\n   */\r\n  public aToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Direction from center of mass of bodyB to contact point\r\n   */\r\n  public bToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Original contact velocity combined with bounciness\r\n   */\r\n  public originalVelocityAndRestitution: number = 0;\r\n}\r\n", "import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Math/util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { Physics } from '../Physics';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent, DegreeOfFreedom } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\n\r\nexport class RealisticSolver implements CollisionSolver {\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (const contact of contacts) {\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        for (const point of contact.points) {\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.globalPos);\r\n          const bToContact = point.sub(bodyB.globalPos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = 1.0 / normalMass;\r\n          contactPoints[pointIndex].tangentMass = 1.0 / tangentMass;\r\n\r\n          // Calculate relative velocity before solving to accurately do restitution\r\n          const restitution = bodyA.bounciness > bodyB.bounciness ? bodyA.bounciness : bodyB.bounciness;\r\n          const relativeVelocity = contact.normal.dot(contactPoints[pointIndex].getRelativeVelocity());\r\n          contactPoints[pointIndex].originalVelocityAndRestitution = 0;\r\n          if (relativeVelocity < -0.1) { // TODO what's a good threshold here?\r\n            contactPoints[pointIndex].originalVelocityAndRestitution = -restitution * relativeVelocity;\r\n          }\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (Physics.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (const contact of contacts) {\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (const c of contacts) {\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (Physics.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.positionIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = Physics.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = Physics.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce * point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              // TODO make applyPseudoImpulse function?\r\n              const impulseForce = impulse.negate().scale(bodyA.inverseMass);\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyA.globalPos = bodyA.globalPos.add(impulseForce);\r\n              if (!bodyA.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n              }\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              const impulseForce = impulse.scale(bodyB.inverseMass);\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n                impulseForce.x = 0;\r\n              }\r\n              if (bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n                impulseForce.y = 0;\r\n              }\r\n\r\n              bodyB.globalPos = bodyB.globalPos.add(impulseForce);\r\n              if (!bodyB.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n                bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.velocityIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          // Friction constraint\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity * point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          // Bounce constraint\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n\r\n            // Per Erin it is a mistake to apply the restitution inside the iteration\r\n            // From Erin Catto's Box2D we keep original contact velocity and adjust by small impulses\r\n            let impulseDelta = -point.normalMass * (normalVelocity - point.originalVelocityAndRestitution);\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { CollisionResolutionStrategy, Physics } from './Physics';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\r\n\r\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _realisticSolver = new RealisticSolver();\r\n  private _arcadeSolver = new ArcadeSolver();\r\n  private _processor = new DynamicTreeCollisionProcessor();\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n\r\n  private _trackCollider = (c: Collider) => this._processor.track(c);\r\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n\r\n  notify(message: AddedEntity | RemovedEntity) {\r\n    if (isAddedSystemEntity(message)) {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    } else {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    }\r\n  }\r\n\r\n  initialize(scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(entities: Entity[], elapsedMs: number): void {\r\n    if (!Physics.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Collect up all the colliders and update them\r\n    let colliders: Collider[] = [];\r\n    for (const entity of entities) {\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.active && collider) {\r\n        colliderComp.update();\r\n        if (collider instanceof CompositeCollider) {\r\n          const compositeColliders = collider.getColliders();\r\n          colliders = colliders.concat(compositeColliders);\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts = this._processor.narrowphase(pairs, this._engine?.debug?.stats?.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities aren't overlapping\r\n    contacts = solver.solve(contacts);\r\n\r\n    // Record contacts for start/end\r\n    for (const contact of contacts) {\r\n      // Process composite ids, things with the same composite id are treated as the same collider for start/end\r\n      const index = contact.id.indexOf('|');\r\n      if (index > 0) {\r\n        const compositeId = contact.id.substring(index + 1);\r\n        this._currentFrameContacts.set(compositeId, contact);\r\n      } else {\r\n        this._currentFrameContacts.set(contact.id, contact);\r\n      }\r\n    }\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    // Composite collider collisions may have a duplicate id because we want to treat those as a singular start/end\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts that have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Math/util';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is play backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 1000)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the [[AnimationStrategy]] for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\n// TODO wire up to new Emitter\r\nexport type AnimationEvents = {\r\n  frame: Frame;\r\n  loop: Animation;\r\n  ended: Animation;\r\n};\r\n\r\n/**\r\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\r\n *\r\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventDispatcher<any>(); // TODO replace with new Emitter\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n  public timeScale: number = 1;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _direction = 1; // TODO only used in ping-pong\r\n  private _done = false;\r\n  private _playing = true;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame) {\r\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public override get height(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame) {\r\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n\r\n  /**\r\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\r\n   * and optional [[AnimationStrategy]]\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   *\r\n   * @param spriteSheet\r\n   * @param frameIndices\r\n   * @param durationPerFrameMs\r\n   * @param strategy\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    frameIndices: number[],\r\n    durationPerFrameMs: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrameMs\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   * @param frameNumber\r\n   */\r\n  public goToFrame(frameNumber: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n      this.events.emit('frame', maybeFrame as any);\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._direction >= this.frames.length) {\r\n          this._direction = -1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        if (currentFrame + this._direction < 0) {\r\n          this._direction = 1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        next = currentFrame + (this._direction % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsedMilliseconds Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', this.currentFrame as any);\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n", "import { Vector } from '../Math/vector';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Animation, HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\n\r\nexport interface GraphicsGroupingOptions {\r\n  members: GraphicsGrouping[];\r\n}\r\n\r\nexport interface GraphicsGrouping {\r\n  pos: Vector;\r\n  graphic: Graphic;\r\n}\r\n\r\nexport class GraphicsGroup extends Graphic implements HasTick {\r\n  public members: GraphicsGrouping[] = [];\r\n\r\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\r\n    super(options);\r\n    this.members = options.members;\r\n    this._updateDimensions();\r\n  }\r\n\r\n  public clone(): GraphicsGroup {\r\n    return new GraphicsGroup({\r\n      members: [...this.members],\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  private _updateDimensions(): BoundingBox {\r\n    let bb = new BoundingBox();\r\n    for (const { graphic, pos } of this.members) {\r\n      bb = graphic.localBounds.translate(pos).combine(bb);\r\n    }\r\n\r\n    this.width = bb.width;\r\n    this.height = bb.height;\r\n\r\n    return bb;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    let bb = new BoundingBox();\r\n    for (const { graphic, pos } of this.members) {\r\n      bb = graphic.localBounds.translate(pos).combine(bb);\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\r\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\r\n  }\r\n\r\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\r\n    for (const member of this.members) {\r\n      const maybeAnimation = member.graphic;\r\n      if (this._isAnimationOrGroup(maybeAnimation)) {\r\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset() {\r\n    for (const member of this.members) {\r\n      const maybeAnimation = member.graphic;\r\n      if (this._isAnimationOrGroup(maybeAnimation)) {\r\n        maybeAnimation.reset();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    this._updateDimensions();\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    for (const member of this.members) {\r\n      ex.save();\r\n      ex.translate(x, y);\r\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\r\n      if (this.showDebug) {\r\n        /* istanbul ignore next */\r\n        ex.debug.drawRect(0, 0, this.width, this.height);\r\n      }\r\n      ex.restore();\r\n    }\r\n  }\r\n}\r\n", "export type Constructor<T> = {\r\n  new (...args: any[]): T;\r\n};\r\n/**\r\n * Configurable helper extends base type and makes all properties available as option bag arguments\r\n * @internal\r\n * @param base\r\n */\r\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\r\n  return class extends base {\r\n    public assign(props: Partial<T>) {\r\n      //set the value of every property that was passed in,\r\n      //if the constructor previously set this value, it will be overridden here\r\n      for (const k in props) {\r\n        // eslint-disable-next-line\r\n        if (typeof (<any>this)[k] !== 'function') {\r\n          // eslint-disable-next-line\r\n          (<any>this)[k] = (<any>props)[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\r\n      //of whatever ctor is the implementation, so args.length doesn't work here.\r\n      const size = args.filter(function(value) {\r\n        return value !== undefined;\r\n      }).length;\r\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\r\n        this.assign(args[0]);\r\n      }\r\n    }\r\n  };\r\n}\r\n", "import { Engine } from './Engine';\r\nimport { Actor } from './Actor';\r\nimport { Color } from './Color';\r\nimport { Vector, vec } from './Math/vector';\r\nimport * as Util from './Util/Util';\r\nimport { Configurable } from './Configurable';\r\nimport { Random } from './Math/Random';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { Sprite } from './Graphics/Sprite';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { clamp, randomInRange } from './Math/util';\r\n\r\n/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle,\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class ParticleImpl extends Entity {\r\n  public position: Vector = new Vector(0, 0);\r\n  public velocity: Vector = new Vector(0, 0);\r\n  public acceleration: Vector = new Vector(0, 0);\r\n  public particleRotationalVelocity: number = 0;\r\n  public currentRotation: number = 0;\r\n\r\n  public focus: Vector = null;\r\n  public focusAccel: number = 0;\r\n  public opacity: number = 1;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fadeFlag: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public emitter: ParticleEmitter = null;\r\n  public particleSize: number = 5;\r\n  public particleSprite: Sprite = null;\r\n\r\n  public startSize: number;\r\n  public endSize: number;\r\n  public sizeRate: number = 0;\r\n  public elapsedMultiplier: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public graphics: GraphicsComponent;\r\n\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super();\r\n    let emitter = emitterOrConfig;\r\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\r\n      const config = emitterOrConfig;\r\n      emitter = config.emitter;\r\n      life = config.life;\r\n      opacity = config.opacity;\r\n      endColor = config.endColor;\r\n      beginColor = config.beginColor;\r\n      position = config.position;\r\n      velocity = config.velocity;\r\n      acceleration = config.acceleration;\r\n      startSize = config.startSize;\r\n      endSize = config.endSize;\r\n    }\r\n    this.emitter = <ParticleEmitter>emitter;\r\n    this.life = life || this.life;\r\n    this.opacity = opacity || this.opacity;\r\n    this.endColor = endColor || this.endColor.clone();\r\n    this.beginColor = beginColor || this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n    this.position = (position || this.position).add(this.emitter.pos);\r\n    this.velocity = velocity || this.velocity;\r\n    this.acceleration = acceleration || this.acceleration;\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.opacity / this.life;\r\n\r\n    this.startSize = startSize || 0;\r\n    this.endSize = endSize || 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.particleSize = this.startSize;\r\n    }\r\n\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // TODO wut\r\n    if (this.particleSprite) {\r\n      this.graphics.opacity = this.opacity;\r\n      this.graphics.use(this.particleSprite);\r\n    } else {\r\n      this.graphics.localBounds = BoundingBox.fromDimension(this.particleSize, this.particleSize, Vector.Half);\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        this.graphics.opacity = this.opacity;\r\n        const tmpColor = this._currentColor.clone();\r\n        tmpColor.a = 1;\r\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public kill() {\r\n    this.emitter.removeParticle(this);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this.life = this.life - delta;\r\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fadeFlag) {\r\n      this.opacity = clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize > 0 && this.endSize > 0) {\r\n      this.particleSize = clamp(\r\n        this.sizeRate * delta + this.particleSize,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * delta, 0, 255);\r\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * delta, 0, 255);\r\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * delta, 0, 255);\r\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\r\n\r\n    if (this.focus) {\r\n      const accel = this.focus\r\n        .sub(this.position)\r\n        .normalize()\r\n        .scale(this.focusAccel)\r\n        .scale(delta / 1000);\r\n      this.velocity = this.velocity.add(accel);\r\n    } else {\r\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\r\n    }\r\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\r\n\r\n    if (this.particleRotationalVelocity) {\r\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\r\n    }\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // todo wut\r\n    this.graphics.opacity = this.opacity;\r\n  }\r\n}\r\n\r\nexport interface ParticleArgs extends Partial<ParticleImpl> {\r\n  emitter: ParticleEmitter;\r\n  position?: Vector;\r\n  velocity?: Vector;\r\n  acceleration?: Vector;\r\n  particleRotationalVelocity?: number;\r\n  currentRotation?: number;\r\n  particleSize?: number;\r\n  particleSprite?: Sprite;\r\n}\r\n\r\n/**\r\n * Particle is used in a [[ParticleEmitter]]\r\n */\r\nexport class Particle extends Configurable(ParticleImpl) {\r\n  constructor(config: ParticleArgs);\r\n  constructor(\r\n    emitter: ParticleEmitter,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  );\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\r\n  }\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  isEmitting?: boolean;\r\n  minVel?: number;\r\n  maxVel?: number;\r\n  acceleration?: Vector;\r\n  minAngle?: number;\r\n  maxAngle?: number;\r\n  emitRate?: number;\r\n  particleLife?: number;\r\n  opacity?: number;\r\n  fadeFlag?: boolean;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  startSize?: number;\r\n  endSize?: number;\r\n  minSize?: number;\r\n  maxSize?: number;\r\n  beginColor?: Color;\r\n  endColor?: Color;\r\n  particleSprite?: Sprite;\r\n  emitterType?: EmitterType;\r\n  radius?: number;\r\n  particleRotationalVelocity?: number;\r\n  randomRotation?: boolean;\r\n  random?: Random;\r\n}\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend [[Actor]] allowing you to use all of the features that come with.\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n  /**\r\n   * Gets or sets the backing particle collection\r\n   */\r\n  public particles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the minimum particle velocity\r\n   */\r\n  public minVel: number = 0;\r\n  /**\r\n   * Gets or sets the maximum particle velocity\r\n   */\r\n  public maxVel: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the acceleration vector for all particles\r\n   */\r\n  public acceleration: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Gets or sets the minimum angle in radians\r\n   */\r\n  public minAngle: number = 0;\r\n  /**\r\n   * Gets or sets the maximum angle in radians\r\n   */\r\n  public maxAngle: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n  /**\r\n   * Gets or sets the life of each particle in milliseconds\r\n   */\r\n  public particleLife: number = 2000;\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public get opacity(): number {\r\n    return super.graphics.opacity;\r\n  }\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public set opacity(opacity: number) {\r\n    super.graphics.opacity = opacity;\r\n  }\r\n  /**\r\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\r\n   */\r\n  public fadeFlag: boolean = false;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   */\r\n  public focus: Vector = null;\r\n  /**\r\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\r\n   */\r\n  public focusAccel: number = null;\r\n  /**\r\n   * Gets or sets the optional starting size for the particles\r\n   */\r\n  public startSize: number = null;\r\n  /**\r\n   * Gets or sets the optional ending size for the particles\r\n   */\r\n  public endSize: number = null;\r\n\r\n  /**\r\n   * Gets or sets the minimum size of all particles\r\n   */\r\n  public minSize: number = 5;\r\n  /**\r\n   * Gets or sets the maximum size of all particles\r\n   */\r\n  public maxSize: number = 5;\r\n\r\n  /**\r\n   * Gets or sets the beginning color of all particles\r\n   */\r\n  public beginColor: Color = Color.White;\r\n  /**\r\n   * Gets or sets the ending color of all particles\r\n   */\r\n  public endColor: Color = Color.White;\r\n\r\n  private _sprite: Sprite = null;\r\n  /**\r\n   * Gets or sets the sprite that a particle should use\r\n   */\r\n  public get particleSprite(): Sprite {\r\n    return this._sprite;\r\n  }\r\n\r\n  public set particleSprite(val: Sprite) {\r\n    if (val) {\r\n      this._sprite = val;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\r\n   */\r\n  public radius: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the particle rotational speed velocity\r\n   */\r\n  public particleRotationalVelocity: number = 0;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  public randomRotation: boolean = false;\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const {\r\n      x,\r\n      y,\r\n      pos,\r\n      isEmitting,\r\n      minVel,\r\n      maxVel,\r\n      acceleration,\r\n      minAngle,\r\n      maxAngle,\r\n      emitRate,\r\n      particleLife,\r\n      opacity,\r\n      fadeFlag,\r\n      focus,\r\n      focusAccel,\r\n      startSize,\r\n      endSize,\r\n      minSize,\r\n      maxSize,\r\n      beginColor,\r\n      endColor,\r\n      particleSprite,\r\n      emitterType,\r\n      radius,\r\n      particleRotationalVelocity,\r\n      randomRotation,\r\n      random\r\n    } = { ...config };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.minVel = minVel ?? this.minVel;\r\n    this.maxVel = maxVel ?? this.maxVel;\r\n    this.acceleration = acceleration ?? this.acceleration;\r\n    this.minAngle = minAngle ?? this.minAngle;\r\n    this.maxAngle = maxAngle ?? this.maxAngle;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.particleLife = particleLife ?? this.particleLife;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\r\n    this.focus = focus ?? this.focus;\r\n    this.focusAccel = focusAccel ?? this.focusAccel;\r\n    this.startSize = startSize ?? this.startSize;\r\n    this.endSize = endSize ?? this.endSize;\r\n    this.minSize = minSize ?? this.minSize;\r\n    this.maxSize = maxSize ?? this.maxSize;\r\n    this.beginColor = beginColor ?? this.beginColor;\r\n    this.endColor = endColor ?? this.endColor;\r\n    this.particleSprite = particleSprite ?? this.particleSprite;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\r\n    this.randomRotation = randomRotation ?? this.randomRotation;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      this.particles.push(p);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.add(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.particles.length = 0;\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    // todo implement emitter constraints;\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = randomInRange(this.minAngle, this.maxAngle, this.random);\r\n    const vel = randomInRange(this.minVel, this.maxVel, this.random);\r\n    const size = this.startSize || randomInRange(this.minSize, this.maxSize, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = randomInRange(0, this.width, this.random);\r\n      ranY = randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = new Particle(\r\n      this,\r\n      this.particleLife,\r\n      this.opacity,\r\n      this.beginColor,\r\n      this.endColor,\r\n      new Vector(ranX, ranY),\r\n      new Vector(dx, dy),\r\n      this.acceleration,\r\n      this.startSize,\r\n      this.endSize\r\n    );\r\n    p.fadeFlag = this.fadeFlag;\r\n    p.particleSize = size;\r\n    if (this.particleSprite) {\r\n      p.particleSprite = this.particleSprite;\r\n      p.graphics.opacity = this.opacity;\r\n      p.graphics.use(this._sprite);\r\n    }\r\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\r\n    if (this.randomRotation) {\r\n      p.currentRotation = randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.focus) {\r\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    super.update(engine, delta);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (delta / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n}\r\n", "import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsGroup } from '.';\r\nimport { Particle } from '../Particles';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\nimport { BodyComponent } from '../Collision/BodyComponent';\r\n\r\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 0;\r\n  private _token = 0;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  public get sortedTransforms() {\r\n    return this._sortedTransforms;\r\n  }\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    // Graphics context could be switched to fallback in a new frame\r\n    this._graphicsContext = this._engine.graphicsContext;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return a.z - b.z;\r\n      });\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\r\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\r\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\r\n      this._sortedTransforms.push(tx);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    } else {\r\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public update(_entities: Entity[], delta: number): void {\r\n    this._token++;\r\n    let graphics: GraphicsComponent;\r\n\r\n    // This is a performance enhancement, most things are in world space\r\n    // so if we can only do this once saves a ton of transform updates\r\n    this._graphicsContext.save();\r\n    if (this._camera) {\r\n      this._camera.draw(this._graphicsContext);\r\n    }\r\n    for (const transform of this._sortedTransforms) {\r\n      const entity = transform.owner as Entity;\r\n\r\n      // If the entity is offscreen skip\r\n      if (entity.hasTag('ex.offscreen')) {\r\n        continue;\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      // Exit if graphics set to not visible\r\n      if (!graphics.visible) {\r\n        continue;\r\n      }\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.restore();\r\n      }\r\n\r\n      this._graphicsContext.save();\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(delta, this._token);\r\n\r\n      // Apply parallax\r\n      const parallax = entity.get(ParallaxComponent);\r\n      if (parallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(parallax.parallaxFactor);\r\n        const parallaxOffset = this._camera.pos.scale(oneMinusFactor);\r\n        this._graphicsContext.translate(parallaxOffset.x, parallaxOffset.y);\r\n      }\r\n\r\n      // Position the entity + estimate lag\r\n      this._applyTransform(entity);\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      // TODO remove this hack on the particle redo\r\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\r\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original world space\r\n      if (transform.coordPlane === CoordPlane.Screen) {\r\n        this._graphicsContext.save();\r\n        if (this._camera) {\r\n          this._camera.draw(this._graphicsContext);\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\r\n    if (graphicsComponent.visible) {\r\n      // this should be moved to the graphics system\r\n      for (const layer of graphicsComponent.layers.get()) {\r\n        for (const { graphic, options } of layer.graphics) {\r\n          let anchor = graphicsComponent.anchor;\r\n          let offset = graphicsComponent.offset;\r\n          if (options?.anchor) {\r\n            anchor = options.anchor;\r\n          }\r\n          if (options?.offset) {\r\n            offset = options.offset;\r\n          }\r\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n          const offsetX = -graphic.width * anchor.x + offset.x;\r\n          const offsetY = -graphic.height * anchor.y + offset.y;\r\n\r\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n\r\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n            if (graphic instanceof GraphicsGroup) {\r\n              for (const g of graphic.members) {\r\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            } else {\r\n              /* istanbul ignore next */\r\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      const optionalBody = ancestor?.get(BodyComponent);\r\n      let interpolatedPos = transform.pos;\r\n      let interpolatedScale = transform.scale;\r\n      let interpolatedRotation = transform.rotation;\r\n      if (optionalBody) {\r\n        if (this._engine.fixedUpdateFps &&\r\n            optionalBody.__oldTransformCaptured &&\r\n            optionalBody.enableFixedUpdateInterpolate) {\r\n\r\n          // Interpolate graphics if needed\r\n          const blend = this._engine.currentFrameLagMs / (1000 / this._engine.fixedUpdateFps);\r\n          interpolatedPos = transform.pos.scale(blend).add(\r\n            optionalBody.oldPos.scale(1.0 - blend)\r\n          );\r\n          interpolatedScale = transform.scale.scale(blend).add(\r\n            optionalBody.oldScale.scale(1.0 - blend)\r\n          );\r\n          // Rotational lerp https://stackoverflow.com/a/30129248\r\n          const cosine = (1.0 - blend) * Math.cos(optionalBody.oldRotation) + blend * Math.cos(transform.rotation);\r\n          const sine = (1.0 - blend) * Math.sin(optionalBody.oldRotation) + blend * Math.sin(transform.rotation);\r\n          interpolatedRotation = Math.atan2(sine, cosine);\r\n        }\r\n      }\r\n\r\n      if (transform) {\r\n        this._graphicsContext.z = transform.z;\r\n        this._graphicsContext.translate(interpolatedPos.x, interpolatedPos.y);\r\n        this._graphicsContext.scale(interpolatedScale.x, interpolatedScale.y);\r\n        this._graphicsContext.rotate(interpolatedRotation);\r\n      }\r\n    }\r\n  }\r\n}\r\n", "import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { toDegrees } from '../Math/util';\r\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle } from '..';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\n\r\nexport class DebugSystem extends System<TransformComponent> {\r\n  public readonly types = ['ex.transform'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 999; // lowest priority\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(entities: Entity[], _delta: number): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let debugDraw: DebugGraphicsComponent;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (const entity of entities) {\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\r\n        }\r\n        if (txSettings.showAll || txSettings.showPositionLabel) {\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n        if (txSettings.showAll || txSettings.showZIndex) {\r\n          this._graphicsContext.debug.drawText(`z(${tx.z.toFixed(1)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${entity.parent ? 'child of id(' + entity.parent?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      debugDraw = entity.get(DebugGraphicsComponent);\r\n      if (debugDraw) {\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.restore();\r\n        }\r\n        debugDraw.draw(this._graphicsContext);\r\n        if (!debugDraw.useTransform) {\r\n          this._graphicsContext.save();\r\n          this._applyTransform(entity);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n", "import { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Engine } from '../Engine';\r\nimport {\r\n  System,\r\n  TransformComponent,\r\n  SystemType,\r\n  Entity,\r\n  AddedEntity,\r\n  RemovedEntity,\r\n  isAddedSystemEntity\r\n} from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Scene } from '../Scene';\r\nimport { PointerComponent } from './PointerComponent';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\n\r\n/**\r\n * The PointerSystem is responsible for dispatching pointer events to entities\r\n * that need them.\r\n *\r\n * The PointerSystem can be optionally configured by the [[PointerComponent]], by default Entities use\r\n * the [[Collider]]'s shape for pointer events.\r\n */\r\nexport class PointerSystem extends System<TransformComponent | PointerComponent> {\r\n  public readonly types = ['ex.transform', 'ex.pointer'] as const;\r\n  public readonly systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _receiver: PointerEventReceiver;\r\n\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseColliderShape = false;\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseGraphicsBounds = false;\r\n\r\n  public lastFrameEntityToPointers = new Map<number, number[]>();\r\n  public currentFrameEntityToPointers = new Map<number, number[]>();\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  private _sortedTransforms: TransformComponent[] = [];\r\n  private _sortedEntities: Entity[] = [];\r\n\r\n  private _zHasChanged = false;\r\n  private _zIndexUpdate = () => {\r\n    this._zHasChanged = true;\r\n  };\r\n\r\n  public preupdate(): void {\r\n    // event receiver might change per frame\r\n    this._receiver = this._engine.input.pointers;\r\n    if (this._zHasChanged) {\r\n      this._sortedTransforms.sort((a, b) => {\r\n        return b.z - a.z;\r\n      });\r\n      this._sortedEntities = this._sortedTransforms.map(t => t.owner);\r\n      this._zHasChanged = false;\r\n    }\r\n  }\r\n\r\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\r\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\r\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\r\n      this._sortedTransforms.push(tx);\r\n      this._sortedEntities.push(tx.owner);\r\n      tx.zIndexChanged$.subscribe(this._zIndexUpdate);\r\n      this._zHasChanged = true;\r\n    } else {\r\n      const tx = entityAddedOrRemoved.data.get(TransformComponent);\r\n      tx.zIndexChanged$.unsubscribe(this._zIndexUpdate);\r\n      const index = this._sortedTransforms.indexOf(tx);\r\n      if (index > -1) {\r\n        this._sortedTransforms.splice(index, 1);\r\n        this._sortedEntities.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public entityCurrentlyUnderPointer(entity: Entity, pointerId: number) {\r\n    return this.currentFrameEntityToPointers.has(entity.id) &&\r\n           this.currentFrameEntityToPointers.get(entity.id).includes(pointerId);\r\n  }\r\n\r\n  public entityWasUnderPointer(entity: Entity, pointerId: number) {\r\n    return this.lastFrameEntityToPointers.has(entity.id) &&\r\n           this.lastFrameEntityToPointers.get(entity.id).includes(pointerId);\r\n  }\r\n\r\n  public entered(entity: Entity, pointerId: number) {\r\n    return this.entityCurrentlyUnderPointer(entity, pointerId) &&\r\n           !this.lastFrameEntityToPointers.has(entity.id);\r\n  }\r\n\r\n  public left(entity: Entity, pointerId: number) {\r\n    return !this.currentFrameEntityToPointers.has(entity.id) &&\r\n            this.entityWasUnderPointer(entity, pointerId);\r\n  }\r\n\r\n  public addPointerToEntity(entity: Entity, pointerId: number) {\r\n    if (!this.currentFrameEntityToPointers.has(entity.id)) {\r\n      this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\r\n      return;\r\n    }\r\n    const pointers = this.currentFrameEntityToPointers.get(entity.id);\r\n    this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\r\n  }\r\n\r\n  public update(_entities: Entity[]): void {\r\n    // Locate all the pointer/entity mappings\r\n    this._processPointerToEntity(this._sortedEntities);\r\n\r\n    // Dispatch pointer events on entities\r\n    this._dispatchEvents(this._sortedEntities);\r\n\r\n    // Clear last frame's events\r\n    this._receiver.update();\r\n    this.lastFrameEntityToPointers.clear();\r\n    this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\r\n    this.currentFrameEntityToPointers.clear();\r\n    this._receiver.clear();\r\n  }\r\n\r\n  private _processPointerToEntity(entities: Entity[]) {\r\n    let transform: TransformComponent;\r\n    let collider: ColliderComponent;\r\n    let graphics: GraphicsComponent;\r\n    let pointer: PointerComponent;\r\n\r\n    // TODO probably a spatial partition optimization here to quickly query bounds for pointer\r\n    // doesn't seem to cause issues tho for perf\r\n\r\n    // Pre-process find entities under pointers\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      pointer = entity.get(PointerComponent) ?? new PointerComponent;\r\n      // Check collider contains pointer\r\n      collider = entity.get(ColliderComponent);\r\n      if (collider && (pointer.useColliderShape || this.overrideUseColliderShape)) {\r\n        collider.update();\r\n        const geom = collider.get();\r\n        if (geom) {\r\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n            if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n              this.addPointerToEntity(entity, pointerId);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check graphics contains pointer\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics && (pointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\r\n        const graphicBounds = graphics.localBounds.transform(transform.get().matrix);\r\n        for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n          if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n            this.addPointerToEntity(entity, pointerId);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processDownAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastDownPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through down and dispatch to entities\r\n    for (const event of this._receiver.currentFrameDown) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        entity.events.emit('pointerdown', event as any);\r\n        if (this._receiver.isDragStart(event.pointerId)) {\r\n          entity.events.emit('pointerdragstart', event as any);\r\n        }\r\n      }\r\n      lastDownPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastDownPerPointer;\r\n  }\r\n\r\n  private _processUpAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastUpPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through up and dispatch to entities\r\n    for (const event of this._receiver.currentFrameUp) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        entity.events.emit('pointerup', event as any);\r\n        if (this._receiver.isDragEnd(event.pointerId)) {\r\n          entity.events.emit('pointerdragend', event as any);\r\n        }\r\n      }\r\n      lastUpPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastUpPerPointer;\r\n  }\r\n\r\n  private _processMoveAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastMovePerPointer = new Map<number, PointerEvent>();\r\n    // Loop through move and dispatch to entities\r\n    for (const event of this._receiver.currentFrameMove) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        // move\r\n        entity.events.emit('pointermove', event as any);\r\n\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragmove', event as any);\r\n        }\r\n      }\r\n      lastMovePerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastMovePerPointer;\r\n  }\r\n\r\n  private _processEnterLeaveAndEmit(entity: Entity, lastUpDownMoveEvents: PointerEvent[]) {\r\n    // up, down, and move are considered for enter and leave\r\n    for (const event of lastUpDownMoveEvents) {\r\n      // enter\r\n      if (event.active && entity.active && this.entered(entity, event.pointerId)) {\r\n        entity.events.emit('pointerenter', event as any);\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragenter', event as any);\r\n        }\r\n        break;\r\n      }\r\n      if (event.active && entity.active &&\r\n          // leave can happen on move\r\n          (this.left(entity, event.pointerId) ||\r\n          // or leave can happen on pointer up\r\n          (this.entityCurrentlyUnderPointer(entity, event.pointerId) && event.type === 'up'))) {\r\n        entity.events.emit('pointerleave', event as any);\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragleave', event as any);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processCancelAndEmit(entity: Entity) {\r\n    // cancel\r\n    for (const event of this._receiver.currentFrameCancel) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)){\r\n        entity.events.emit('pointercancel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processWheelAndEmit(entity: Entity) {\r\n    // wheel\r\n    for (const event of this._receiver.currentFrameWheel) {\r\n      // Currently the wheel only fires under the primary pointer '0'\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, 0)) {\r\n        entity.events.emit('pointerwheel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchEvents(entities: Entity[]) {\r\n    const lastFrameEntities = new Set(this.lastFrameEntityToPointers.keys());\r\n    const currentFrameEntities = new Set(this.currentFrameEntityToPointers.keys());\r\n    // Filter preserves z order\r\n    const entitiesWithEvents = entities.filter(e => lastFrameEntities.has(e.id) || currentFrameEntities.has(e.id));\r\n    let lastMovePerPointer: Map<number, PointerEvent>;\r\n    let lastUpPerPointer: Map<number, PointerEvent>;\r\n    let lastDownPerPointer: Map<number, PointerEvent>;\r\n    // Dispatch events in entity z order\r\n    for (const entity of entitiesWithEvents) {\r\n      lastDownPerPointer = this._processDownAndEmit(entity);\r\n\r\n      lastUpPerPointer = this._processUpAndEmit(entity);\r\n\r\n      lastMovePerPointer = this._processMoveAndEmit(entity);\r\n\r\n      const lastUpDownMoveEvents = [\r\n        ...lastMovePerPointer.values(),\r\n        ...lastDownPerPointer.values(),\r\n        ...lastUpPerPointer.values()\r\n      ];\r\n      this._processEnterLeaveAndEmit(entity, lastUpDownMoveEvents);\r\n\r\n      this._processCancelAndEmit(entity);\r\n\r\n      this._processWheelAndEmit(entity);\r\n    }\r\n  }\r\n}", "import { Entity } from '../EntityComponentSystem';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\n\r\nexport class ActionsSystem extends System<ActionsComponent> {\r\n  public readonly types = ['ex.actions'] as const;\r\n  systemType = SystemType.Update;\r\n  priority = -1;\r\n\r\n  private _actions: ActionsComponent[] = [];\r\n  public notify(entityAddedOrRemoved: AddedEntity | RemovedEntity): void {\r\n    if (isAddedSystemEntity(entityAddedOrRemoved)) {\r\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\r\n      this._actions.push(action);\r\n    } else {\r\n      const action = entityAddedOrRemoved.data.get(ActionsComponent);\r\n      const index = this._actions.indexOf(action);\r\n      if (index > -1) {\r\n        this._actions.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  update(_entities: Entity[], delta: number): void {\r\n    for (const actions of this._actions) {\r\n      actions.update(delta);\r\n    }\r\n  }\r\n}", "import { Component } from '../EntityComponentSystem/Component';\r\nimport { IsometricMap } from './IsometricMap';\r\n\r\nexport class IsometricEntityComponent extends Component<'ex.isometricentity'> {\r\n  public readonly type = 'ex.isometricentity';\r\n  /**\r\n   * Vertical \"height\" in the isometric world\r\n   */\r\n  public elevation: number = 0;\r\n\r\n  public map: IsometricMap;\r\n\r\n  /**\r\n   * Specify the isometric map to use to position this entity's z-index\r\n   * @param map\r\n   */\r\n  constructor(map: IsometricMap) {\r\n    super();\r\n    this.map = map;\r\n  }\r\n}", "import { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\n\r\n\r\nexport class IsometricEntitySystem extends System<TransformComponent | IsometricEntityComponent> {\r\n  public readonly types = ['ex.transform', 'ex.isometricentity'] as const;\r\n  public readonly systemType = SystemType.Update;\r\n  priority: number = 99;\r\n  update(entities: Entity[], _delta: number): void {\r\n    let transform: TransformComponent;\r\n    let iso: IsometricEntityComponent;\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      iso = entity.get(IsometricEntityComponent);\r\n\r\n      const maxZindexPerElevation = Math.max(iso.map.columns * iso.map.tileWidth, iso.map.rows * iso.map.tileHeight);\r\n\r\n      const newZ = maxZindexPerElevation * iso.elevation + transform.pos.y;\r\n      transform.z = newZ;\r\n    }\r\n  }\r\n}", "import { GraphicsComponent } from './GraphicsComponent';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { Scene } from '../Scene';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ParallaxComponent } from './ParallaxComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { CoordPlane } from '../Math/coord-plane';\r\n\r\nexport class OffscreenSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public systemType = SystemType.Draw;\r\n  priority: number = -1;\r\n  private _camera: Camera;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._camera = scene.camera;\r\n  }\r\n\r\n  update(entities: Entity[]): void {\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n    let maybeParallax: ParallaxComponent;\r\n\r\n    for (const entity of entities) {\r\n      graphics = entity.get(GraphicsComponent);\r\n      transform = entity.get(TransformComponent);\r\n      maybeParallax = entity.get(ParallaxComponent);\r\n\r\n      let parallaxOffset: Vector;\r\n      if (maybeParallax) {\r\n        // We use the Tiled formula\r\n        // https://doc.mapeditor.org/en/latest/manual/layers/#parallax-scrolling-factor\r\n        // cameraPos * (1 - parallaxFactor)\r\n        const oneMinusFactor = Vector.One.sub(maybeParallax.parallaxFactor);\r\n        parallaxOffset = this._camera.pos.scale(oneMinusFactor);\r\n      }\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics, parallaxOffset);\r\n      if (entityOffscreen && !entity.hasTag('ex.offscreen')) {\r\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addTag('ex.offscreen');\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('ex.offscreen')) {\r\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeTag('ex.offscreen');\r\n      }\r\n    }\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent, parallaxOffset: Vector) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      let bounds = graphics.localBounds;\r\n      if (parallaxOffset) {\r\n        bounds = bounds.translate(parallaxOffset);\r\n      }\r\n      const transformedBounds = bounds.transform(transform.get().matrix);\r\n      const graphicsOffscreen = !this._camera.viewport.overlaps(transformedBounds);\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO screen coordinates\r\n      return false;\r\n    }\r\n  }\r\n\r\n}", "import { isScreenElement, ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  GameEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { Class } from './Class';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw, SceneActivationContext } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport * as Events from './Events';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { PointerSystem } from './Input/PointerSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\nimport { IsometricEntitySystem } from './TileMap/IsometricEntitySystem';\r\nimport { OffscreenSystem } from './Graphics/OffscreenSystem';\r\nimport { ExcaliburGraphicsContext } from './Graphics';\r\n/**\r\n * [[Actor|Actors]] are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene<TActivationData = unknown>\r\n  extends Class\r\n  implements CanInitialize, CanActivate<TActivationData>, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world = new World(this);\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): readonly Actor[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): readonly Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): readonly Trigger[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The [[TileMap]]s in the scene, if any\r\n   */\r\n  public get tileMaps(): readonly TileMap[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  public get timers(): readonly Timer[] {\r\n    return this._timers;\r\n  }\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n    // Initialize systems\r\n\r\n    // Update\r\n    this.world.add(new ActionsSystem());\r\n    this.world.add(new MotionSystem());\r\n    this.world.add(new CollisionSystem());\r\n    this.world.add(new PointerSystem());\r\n    this.world.add(new IsometricEntitySystem());\r\n    // Draw\r\n    this.world.add(new OffscreenSystem());\r\n    this.world.add(new GraphicsSystem());\r\n    this.world.add(new DebugSystem());\r\n  }\r\n\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\r\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\r\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\r\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(_context: SceneActivationContext<TActivationData>): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(_context: SceneActivationContext): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   *\r\n   */\r\n  public onPreDraw(_ctx: ExcaliburGraphicsContext, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   *\r\n   */\r\n  public onPostDraw(_ctx: ExcaliburGraphicsContext, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren(): void {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the [[Scene]] has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.engine = engine;\r\n      // Initialize camera first\r\n      this.camera._initialize(engine);\r\n\r\n      this.world.systemManager.initialize();\r\n\r\n      // This order is important! we want to be sure any custom init that add actors\r\n      // fire before the actor init\r\n      this.onInitialize.call(this, engine);\r\n      this._initializeChildren();\r\n\r\n      this._logger.debug('Scene.onInitialize', this, engine);\r\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public _activate(context: SceneActivationContext<TActivationData>): void {\r\n    this._logger.debug('Scene.onActivate', this);\r\n    this.onActivate(context);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public _deactivate(context: SceneActivationContext<never>): void {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.onDeactivate(context);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(_engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\r\n    this.onPreUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(_engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\r\n    this.onPostUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: ExcaliburGraphicsContext, _delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\r\n    this.onPreDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: ExcaliburGraphicsContext, _delta: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\r\n    this.onPostDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\r\n   * @param engine  Reference to the current Engine\r\n   * @param delta   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._preupdate(engine, delta);\r\n\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(delta);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, delta);\r\n\r\n    // Camera last keeps renders smooth that are based on entity/actor\r\n    if (this.camera) {\r\n      this.camera.update(engine, delta);\r\n    }\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the [[Engine]].\r\n   *\r\n   * @param ctx    The current rendering context\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: ExcaliburGraphicsContext, delta: number) {\r\n    this._predraw(ctx, delta);\r\n\r\n    this.world.update(SystemType.Draw, delta);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\r\n   * @param ctx  The current rendering context\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: ExcaliburGraphicsContext) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the current [[Scene]].\r\n   * @param timer  The timer to add to the current [[Scene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and timers from the scene, optionally indicate whether deferred should or shouldn't be used.\r\n   *\r\n   * By default entities use deferred removal\r\n   * @param deferred\r\n   */\r\n  public clear(deferred: boolean = true): void {\r\n    for (const entity of this.entities) {\r\n      this.world.remove(entity, deferred);\r\n    }\r\n    for (const timer of this.timers) {\r\n      this.removeTimer(timer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the scene.\r\n   * @warning Can be dangerous, use [[cancelTimer]] instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a [[Timer]], removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a [[Timer]] is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n    for (const _ui of screenElements) {\r\n      engine.stats.currFrame.actors.ui++;\r\n    }\r\n\r\n    for (const actor of this.actors) {\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (const child of actor.children) {\r\n        if (isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n", "\r\n\r\nexport enum ColorBlindnessMode {\r\n  Protanope = 'Protanope',\r\n  Deuteranope = 'Deuteranope',\r\n  Tritanope = 'Tritanope'\r\n}\r\n", "export default \"#version 300 es\\r\\nprecision mediump float;\\r\\n// our texture\\r\\nuniform sampler2D u_image;\\r\\n// the texCoords passed in from the vertex shader.\\r\\nin vec2 v_texcoord;\\r\\n\\r\\n// color blind type\\r\\nuniform int u_type;\\r\\n\\r\\n// simulation?\\r\\nuniform bool u_simulate;\\r\\n\\r\\nout vec4 fragColor;\\r\\n\\r\\nvoid main() {\\r\\n  vec4 o =  texture(u_image, v_texcoord);\\r\\n  // RGB to LMS matrix conversion\\r\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\r\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\r\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\r\\n  // Simulate color blindness\\r\\n  float l;\\r\\n  float m;\\r\\n  float s;\\r\\n  //MODE CODE//\\r\\n  if (u_type == 0) {\\r\\n    // Protanope\\r\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\r\\n  } else if (u_type == 1) {\\r\\n    // Deuteranope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\r\\n  } else if (u_type == 2) {\\r\\n    // Tritanope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\r\\n  }\\r\\n\\r\\n  // LMS to RGB matrix conversion\\r\\n  vec4 error; // simulate the colors\\r\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\r\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\r\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\r\\n  error.a = 1.0;\\r\\n  vec4 diff = o - error;\\r\\n  vec4 correction; // correct the colors\\r\\n  correction.r = 0.0;\\r\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\r\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\r\\n  correction = o + correction;\\r\\n  correction.a = o.a;\\r\\n  //SIMULATE//\\r\\n\\r\\n  // sim \\r\\n  if (u_simulate) {\\r\\n    fragColor = error.rgba;\\r\\n  } else {\\r\\n    fragColor = correction.rgba;\\r\\n  }\\r\\n}\";", "import { Shader } from '../Context/shader';\r\nimport { VertexBuffer } from '../Context/vertex-buffer';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\n\r\n/**\r\n * Helper that defines a whole screen renderer, just provide a fragment source!\r\n *\r\n * Currently supports 1 varying\r\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\r\n */\r\nexport class ScreenShader {\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(fragmentSource: string) {\r\n    this._shader = new Shader({\r\n      vertexSource: `#version 300 es\r\n      in vec2 a_position;\r\n      in vec2 a_texcoord;\r\n      out vec2 v_texcoord;\r\n\r\n      void main() {\r\n        gl_Position = vec4(a_position, 0.0, 1.0);\r\n        // Pass the texcoord to the fragment shader.\r\n        v_texcoord = a_texcoord;\r\n      }`,\r\n      fragmentSource: fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1,          0, 0,\r\n        -1, 1,           0, 1,\r\n        1, -1,           1, 0,\r\n\r\n        1, -1,            1, 0,\r\n        -1, 1,           0, 1,\r\n        1, 1,            1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  public getShader() {\r\n    return this._shader;\r\n  }\r\n  public getLayout() {\r\n    return this._layout;\r\n  }\r\n}", "import colorBlindCorrectSource from './color-blind-fragment.glsl';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\nimport { ScreenShader } from './ScreenShader';\r\n\r\nexport class ColorBlindnessPostProcessor implements PostProcessor {\r\n  private _shader: ScreenShader;\r\n  private _simulate = false;\r\n  constructor(private _colorBlindnessMode: ColorBlindnessMode, simulate = false) {\r\n    this._simulate = simulate;\r\n  }\r\n\r\n  initialize(_gl: WebGLRenderingContext): void {\r\n    this._shader = new ScreenShader(colorBlindCorrectSource);\r\n    this.simulate = this._simulate;\r\n    this.colorBlindnessMode = this._colorBlindnessMode;\r\n  }\r\n\r\n  getShader(): Shader {\r\n    return this._shader.getShader();\r\n  }\r\n\r\n  getLayout(): VertexLayout {\r\n    return this._shader.getLayout();\r\n  }\r\n\r\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\r\n    this._colorBlindnessMode = colorBlindMode;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\r\n        shader.setUniformInt('u_type', 0);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\r\n        shader.setUniformInt('u_type', 1);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\r\n        shader.setUniformInt('u_type', 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  get colorBlindnessMode(): ColorBlindnessMode {\r\n    return this._colorBlindnessMode;\r\n  }\r\n\r\n  set simulate(value: boolean) {\r\n    this._simulate = value;\r\n    if (this._shader) {\r\n\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      shader.setUniformBoolean('u_simulate', value);\r\n    }\r\n  }\r\n\r\n  get simulate(): boolean {\r\n    return this._simulate;\r\n  }\r\n}\r\n", "import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\r\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\r\nimport { Engine } from '../Engine';\r\nimport { ExcaliburGraphicsContextWebGL } from '..';\r\n\r\nexport interface DebugFlags {\r\n  colorBlindMode: ColorBlindFlags;\r\n}\r\n\r\nexport class ColorBlindFlags {\r\n  private _engine: Engine;\r\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\r\n  }\r\n\r\n  /**\r\n   * Correct colors for a specified color blindness\r\n   * @param colorBlindness\r\n   */\r\n  public correct(colorBlindness: ColorBlindnessMode) {\r\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this.clear();\r\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\r\n      this._colorBlindPostProcessor.simulate = false;\r\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Simulate colors for a specified color blindness\r\n   * @param colorBlindness\r\n   */\r\n  public simulate(colorBlindness: ColorBlindnessMode) {\r\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this.clear();\r\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\r\n      this._colorBlindPostProcessor.simulate = true;\r\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove color blindness post processor\r\n   */\r\n  public clear() {\r\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\r\n  }\r\n}\r\n", "import { DebugFlags, ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\nimport { StandardClock, TestClock } from '..';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\r\n   */\r\n  delta: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\r\n * updated during a frame.\r\n */\r\nexport class Debug implements DebugFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the [[TestClock]] and return\r\n   * it in the same running state.\r\n   *\r\n   * This is useful when you need to debug frame by frame.\r\n   */\r\n  public useTestClock(): TestClock {\r\n    const clock = this._engine.clock;\r\n    const wasRunning = clock.isRunning();\r\n    clock.stop();\r\n\r\n    const testClock = clock.toTestClock();\r\n    if (wasRunning) {\r\n      testClock.start();\r\n    }\r\n    this._engine.clock = testClock;\r\n    return testClock;\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the [[StandardClock]] and\r\n   * return it in the same running state.\r\n   *\r\n   * This is useful when you need to switch back to normal mode after\r\n   * debugging.\r\n   */\r\n  public useStandardClock(): StandardClock {\r\n    const currentClock = this._engine.clock;\r\n    const wasRunning = currentClock.isRunning();\r\n    currentClock.stop();\r\n\r\n    const standardClock = currentClock.toStandardClock();\r\n    if (wasRunning) {\r\n      standardClock.start();\r\n    }\r\n    this._engine.clock = standardClock;\r\n    return standardClock;\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using [[ColorBlindnessPostProcessor]].\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: true,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    showPosition: false,\r\n    showPositionLabel: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showZIndex: false,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _delta: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.delta = otherStats.delta;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.delta = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get delta() {\r\n    return this._delta;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set delta(value: number) {\r\n    this._delta = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n", "/**\r\n * Determines the scope of handling mouse/touch events.\r\n */\r\n\r\nexport enum PointerScope {\r\n  /**\r\n   * Handle events on the `canvas` element only. Events originating outside the\r\n   * `canvas` will not be handled.\r\n   */\r\n  Canvas = 'Canvas',\r\n\r\n  /**\r\n   * Handles events on the entire document. All events will be handled by Excalibur.\r\n   */\r\n  Document = 'Document'\r\n}\r\n", "import { Logger } from '../Util/Log';\r\nimport { Class } from '../Class';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n */\r\nexport enum Keys {\r\n  // NUMPAD\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n  NumAdd = 'NumpadAdd',\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumDivide = 'NumpadDivide',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  NumDecimal = 'NumpadDecimal',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  NumpadAdd = 'NumpadAdd',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n  NumpadDivide = 'NumpadDivide',\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  // MODIFIERS\r\n  NumLock = 'NumLock',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n  ControlLeft = 'ControlLeft',\r\n  ControlRight = 'ControlRight',\r\n  MetaLeft = 'MetaLeft',\r\n  MetaRight = 'MetaRight',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  // FUNCTION KEYS\r\n  F1 = 'F1',\r\n  F2 = 'F2',\r\n  F3 = 'F3',\r\n  F4 = 'F4',\r\n  F5 = 'F5',\r\n  F6 = 'F6',\r\n  F7 = 'F7',\r\n  F8 = 'F8',\r\n  F9 = 'F9',\r\n  F10 = 'F10',\r\n  F11 = 'F11',\r\n  F12 = 'F12',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Semicolon = 'Semicolon',\r\n  Quote = 'Quote',\r\n  Comma = 'Comma',\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Slash = 'Slash',\r\n  Equal = 'Equal',\r\n  BracketLeft = 'BracketLeft',\r\n  Backslash = 'Backslash',\r\n  BracketRight = 'BracketRight',\r\n  Backquote = 'Backquote',\r\n\r\n  // DIRECTIONS\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // OTHER\r\n  Space = 'Space',\r\n  Backspace = 'Backspace',\r\n  Delete = 'Delete',\r\n  Esc = 'Escape',\r\n  Escape = 'Escape',\r\n  Enter = 'Enter',\r\n  NumpadEnter = 'NumpadEnter',\r\n  ContextMenu = 'ContextMenu'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard extends Class {\r\n  private _keys: Keys[] = [];\r\n  private _keysUp: Keys[] = [];\r\n  private _keysDown: Keys[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(global?: GlobalEventHandlers): void {\r\n    if (!global) {\r\n      try {\r\n        // Try and listen to events on top window frame if within an iframe.\r\n        //\r\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n        //\r\n        // Attempt to add an event listener, which triggers a DOMException on\r\n        // cross-origin iframes\r\n        const noop = () => {\r\n          return;\r\n        };\r\n        window.top.addEventListener('blur', noop);\r\n        window.top.removeEventListener('blur', noop);\r\n\r\n        // this will be the same as window if not embedded within an iframe\r\n        global = window.top;\r\n      } catch {\r\n        // fallback to current frame\r\n        global = window;\r\n\r\n        Logger.getInstance().warn(\r\n          'Failed to bind to keyboard events to top frame. ' +\r\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\r\n        );\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', this._handleKeyUp);\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', this._handleKeyDown);\r\n  }\r\n\r\n  private _handleKeyDown = (ev: KeyboardEvent) => {\r\n    const code = ev.code as Keys;\r\n    if (this._keys.indexOf(code) === -1) {\r\n      this._keys.push(code);\r\n      this._keysDown.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n      this.eventDispatcher.emit('down', keyEvent);\r\n      this.eventDispatcher.emit('press', keyEvent);\r\n    }\r\n  };\r\n\r\n  private _handleKeyUp = (ev: KeyboardEvent) => {\r\n    const code = ev.code as Keys;\r\n    const key = this._keys.indexOf(code);\r\n    this._keys.splice(key, 1);\r\n    this._keysUp.push(code);\r\n    const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n    // alias the old api, we may want to deprecate this in the future\r\n    this.eventDispatcher.emit('up', keyEvent);\r\n    this.eventDispatcher.emit('release', keyEvent);\r\n  };\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Trigger a manual key event\r\n   * @param type\r\n   * @param key\r\n   * @param character\r\n   */\r\n  public triggerEvent(type: 'down' | 'up', key: Keys, character?: string) {\r\n    if (type === 'down') {\r\n      this._handleKeyDown(new KeyboardEvent('keydown', {\r\n        code: key,\r\n        key: character ?? null\r\n      }));\r\n    }\r\n    if (type === 'up') {\r\n      this._handleKeyUp(new KeyboardEvent('keyup', {\r\n        code: key,\r\n        key: character ?? null\r\n      }));\r\n    }\r\n  }\r\n}\r\n", "import { Class } from './../Class';\r\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads extends Class {\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\r\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\r\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\r\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad extends Class {\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _buttons: number[] = new Array(16);\r\n  private _axes: number[] = new Array(4);\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * [[MinAxisMoveThreshold]] are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n", "export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n", "import { Engine } from '../Engine';\r\nimport { Vector } from './vector';\r\n\r\nexport class GlobalCoordinates {\r\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\r\n    let pageX: number;\r\n    let pageY: number;\r\n    let pagePos: Vector;\r\n    let engine: Engine;\r\n\r\n    if (arguments.length === 3) {\r\n      pageX = <number>xOrPos;\r\n      pageY = <number>yOrEngine;\r\n      pagePos = new Vector(pageX, pageY);\r\n      engine = engineOrUndefined;\r\n    } else {\r\n      pagePos = <Vector>xOrPos;\r\n      pageX = pagePos.x;\r\n      pageY = pagePos.y;\r\n      engine = <Engine>yOrEngine;\r\n    }\r\n\r\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\r\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\r\n\r\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\r\n  }\r\n\r\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\r\n}\r\n", "import { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { PointerButton } from './PointerButton';\r\nimport { PointerType } from './PointerType';\r\n\r\nexport class PointerEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n\r\n  get pagePos(): Vector {\r\n    return this.coordinates.pagePos;\r\n  }\r\n\r\n  get screenPos(): Vector {\r\n    return this.coordinates.screenPos;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return this.coordinates.worldPos;\r\n  }\r\n\r\n  constructor(\r\n    public type: 'down' | 'up' | 'move' | 'cancel',\r\n    public pointerId: number,\r\n    public button: PointerButton,\r\n    public pointerType: PointerType,\r\n    public coordinates: GlobalCoordinates,\r\n    public nativeEvent: Event) { };\r\n}\r\n", "import { WheelDeltaMode } from './WheelDeltaMode';\r\n\r\n\r\nexport class WheelEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: Event\r\n  ) { }\r\n}\r\n", "import { Class } from '../Class';\r\nimport { Vector } from '../Math/vector';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerEvent } from './PointerEvent';\r\n\r\nexport class PointerAbstraction extends Class {\r\n\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = Vector.Zero;\r\n\r\n  constructor() {\r\n    super();\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  private _onPointerMove = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n\r\n  private _onPointerDown = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n}\r\n", "\r\nexport enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n", "/**\r\n * Native browser button enumeration\r\n */\r\nexport enum NativePointerButton {\r\n  NoButton = -1,\r\n  Left = 0,\r\n  Middle = 1,\r\n  Right = 2,\r\n  Unknown = 3\r\n}\r\n", "/**\r\n * The mouse button being pressed.\r\n */\r\nexport enum PointerButton {\r\n  Left = 'Left',\r\n  Middle = 'Middle',\r\n  Right = 'Right',\r\n  Unknown = 'Unknown',\r\n  NoButton = 'NoButton'\r\n}\r\n", "/**\r\n * The type of pointer for a [[PointerEvent]].\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n", "import { Class } from '../Class';\r\nimport { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerAbstraction } from './PointerAbstraction';\r\n\r\nimport { WheelDeltaMode } from './WheelDeltaMode';\r\nimport { PointerSystem } from './PointerSystem';\r\nimport { NativePointerButton } from './NativePointerButton';\r\nimport { PointerButton } from './PointerButton';\r\nimport { fail } from '../Util/Util';\r\nimport { PointerType } from './PointerType';\r\n\r\n\r\nexport type NativePointerEvent = globalThis.PointerEvent;\r\nexport type NativeMouseEvent = globalThis.MouseEvent;\r\nexport type NativeTouchEvent = globalThis.TouchEvent;\r\nexport type NativeWheelEvent = globalThis.WheelEvent;\r\n\r\n/**\r\n * Is this event a native touch event?\r\n */\r\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\r\n}\r\n\r\n/**\r\n * Is this event a native pointer event\r\n */\r\nfunction isPointerEvent(value: any): value is NativePointerEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\r\n}\r\n\r\n/**\r\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\r\n */\r\nexport class PointerEventReceiver extends Class {\r\n  public primary: PointerAbstraction = new PointerAbstraction();\r\n\r\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\r\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n\r\n  public currentFramePointerDown = new Map<number, boolean>();\r\n  public lastFramePointerDown = new Map<number, boolean>();\r\n\r\n  public currentFrameDown: PointerEvent[] = [];\r\n  public currentFrameUp: PointerEvent[] = [];\r\n  public currentFrameMove: PointerEvent[] = [];\r\n  public currentFrameCancel: PointerEvent[] = [];\r\n  public currentFrameWheel: WheelEvent[] = [];\r\n\r\n  constructor(public readonly target: GlobalEventHandlers & EventTarget, public engine: Engine) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Creates a new PointerEventReceiver with a new target and engine while preserving existing pointer event\r\n   * handlers.\r\n   * @param target\r\n   * @param engine\r\n   */\r\n  public recreate(target: GlobalEventHandlers & EventTarget, engine: Engine) {\r\n    const eventReceiver = new PointerEventReceiver(target, engine);\r\n    eventReceiver.primary = this.primary;\r\n    eventReceiver._pointers = this._pointers;\r\n    return eventReceiver;\r\n  }\r\n\r\n  private _pointers: PointerAbstraction[] = [this.primary];\r\n  /**\r\n   * Locates a specific pointer by id, creates it if it doesn't exist\r\n   * @param index\r\n   */\r\n  public at(index: number): PointerAbstraction {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new PointerAbstraction());\r\n      }\r\n    }\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * The number of pointers currently being tracked by excalibur\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  /**\r\n   * Is the specified pointer id down this frame\r\n   * @param pointerId\r\n   */\r\n  public isDown(pointerId: number) {\r\n    return this.currentFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Was the specified pointer id down last frame\r\n   * @param pointerId\r\n   */\r\n  public wasDown(pointerId: number) {\r\n    return this.lastFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public isDragging(pointerId: number): boolean {\r\n    return this.isDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public isDragStart(pointerId: number): boolean {\r\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public isDragEnd(pointerId: number): boolean {\r\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur\r\n   *\r\n   * Updates the current frame pointer info and emits raw pointer events\r\n   *\r\n   * This does not emit events to entities, see PointerSystem\r\n   */\r\n  public update() {\r\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\r\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\r\n\r\n    for (const event of this.currentFrameDown) {\r\n      this.emit('down', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('down', event);\r\n      this.primary.emit('pointerdown', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameUp) {\r\n      this.emit('up', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('up', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameMove) {\r\n      this.emit('move', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('move', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameCancel) {\r\n      this.emit('cancel', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('cancel', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameWheel) {\r\n      this.emit('wheel', event);\r\n      this.primary.emit('pointerwheel', event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current frame event and pointer data\r\n   */\r\n  public clear() {\r\n    for (const event of this.currentFrameUp) {\r\n      this.currentFramePointerCoords.delete(event.pointerId);\r\n      const ids = this._activeNativePointerIdsToNormalized.entries();\r\n      for (const [native, normalized] of ids) {\r\n        if (normalized === event.pointerId) {\r\n          this._activeNativePointerIdsToNormalized.delete(native);\r\n        }\r\n      }\r\n    }\r\n    this.currentFrameDown.length = 0;\r\n    this.currentFrameUp.length = 0;\r\n    this.currentFrameMove.length = 0;\r\n    this.currentFrameCancel.length = 0;\r\n    this.currentFrameWheel.length = 0;\r\n  }\r\n\r\n  private _boundHandle = this._handle.bind(this);\r\n  private _boundWheel = this._handleWheel.bind(this);\r\n  /**\r\n   * Initializes the pointer event receiver so that it can start listening to native\r\n   * browser events.\r\n   */\r\n  public init() {\r\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\r\n    // It is important on mobile to have touch action 'none'\r\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\r\n    if (this.target === this.engine.canvas) {\r\n      this.engine.canvas.style.touchAction = 'none';\r\n    } else {\r\n      document.body.style.touchAction = 'none';\r\n    }\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.addEventListener('pointerdown', this._boundHandle);\r\n      this.target.addEventListener('pointerup', this._boundHandle);\r\n      this.target.addEventListener('pointermove', this._boundHandle);\r\n      this.target.addEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.addEventListener('touchstart', this._boundHandle);\r\n      this.target.addEventListener('touchend', this._boundHandle);\r\n      this.target.addEventListener('touchmove', this._boundHandle);\r\n      this.target.addEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.addEventListener('mousedown', this._boundHandle);\r\n      this.target.addEventListener('mouseup', this._boundHandle);\r\n      this.target.addEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.removeEventListener('pointerdown', this._boundHandle);\r\n      this.target.removeEventListener('pointerup', this._boundHandle);\r\n      this.target.removeEventListener('pointermove', this._boundHandle);\r\n      this.target.removeEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.removeEventListener('touchstart', this._boundHandle);\r\n      this.target.removeEventListener('touchend', this._boundHandle);\r\n      this.target.removeEventListener('touchmove', this._boundHandle);\r\n      this.target.removeEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.removeEventListener('mousedown', this._boundHandle);\r\n      this.target.removeEventListener('mouseup', this._boundHandle);\r\n      this.target.removeEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.removeEventListener('wheel', this._boundWheel);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Take native pointer id and map it to index in active pointers\r\n   * @param nativePointerId\r\n   */\r\n  private _normalizePointerId(nativePointerId: number) {\r\n    // Add to the the native pointer set id\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\r\n\r\n    // Native pointer ids in ascending order\r\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\r\n\r\n    // The index into sorted ids will be the new id, will always have an id\r\n    const id = currentPointerIds.findIndex(p => p === nativePointerId);\r\n\r\n    // Save the mapping so we can reverse it later\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\r\n\r\n    // ignore pointer because game isn't watching\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Responsible for handling and parsing pointer events\r\n   */\r\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\r\n    ev.preventDefault();\r\n    const eventCoords = new Map<number, GlobalCoordinates>();\r\n    let button: PointerButton;\r\n    let pointerType: PointerType;\r\n    if (isTouchEvent(ev)) {\r\n      button = PointerButton.Unknown;\r\n      pointerType = PointerType.Touch;\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n      for (let i = 0; i < ev.changedTouches.length; i++) {\r\n        const touch = ev.changedTouches[i];\r\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\r\n        const nativePointerId = i + 1;\r\n        const pointerId = this._normalizePointerId(nativePointerId);\r\n        this.currentFramePointerCoords.set(pointerId, coordinates);\r\n        eventCoords.set(pointerId, coordinates);\r\n      }\r\n    } else {\r\n      button = this._nativeButtonToPointerButton(ev.button);\r\n      pointerType = PointerType.Mouse;\r\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\r\n      let nativePointerId = 1;\r\n      if (isPointerEvent(ev)) {\r\n        nativePointerId = ev.pointerId;\r\n        pointerType = this._stringToPointerType(ev.pointerType);\r\n      }\r\n      const pointerId = this._normalizePointerId(nativePointerId);\r\n      this.currentFramePointerCoords.set(pointerId, coordinates);\r\n      eventCoords.set(pointerId, coordinates);\r\n    }\r\n\r\n    for (const [pointerId, coord] of eventCoords.entries()) {\r\n      switch (ev.type) {\r\n        case 'mousedown':\r\n        case 'pointerdown':\r\n        case 'touchstart':\r\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, true);\r\n          break;\r\n        case 'mouseup':\r\n        case 'pointerup':\r\n        case 'touchend':\r\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, false);\r\n          break;\r\n        case 'mousemove':\r\n        case 'pointermove':\r\n        case 'touchmove':\r\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n        case 'touchcancel':\r\n        case 'pointercancel':\r\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWheel(ev: NativeWheelEvent) {\r\n    // Should we prevent page scroll because of this event\r\n    if (\r\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\r\n    ) {\r\n      ev.preventDefault();\r\n    }\r\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\r\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\r\n\r\n    /**\r\n     * A constant used to normalize wheel events across different browsers\r\n     *\r\n     * This normalization factor is pulled from\r\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n     */\r\n    const ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n    const deltaY =\r\n        ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\r\n    const deltaZ = ev.deltaZ || 0;\r\n    let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n    if (ev.deltaMode) {\r\n      if (ev.deltaMode === 1) {\r\n        deltaMode = WheelDeltaMode.Line;\r\n      } else if (ev.deltaMode === 2) {\r\n        deltaMode = WheelDeltaMode.Page;\r\n      }\r\n    }\r\n\r\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\r\n    this.currentFrameWheel.push(we);\r\n  }\r\n\r\n  /**\r\n   * Triggers an excalibur pointer event in a world space pos\r\n   *\r\n   * Useful for testing pointers in excalibur\r\n   * @param type\r\n   * @param pos\r\n   */\r\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\r\n    const page = this.engine.screen.worldToPageCoordinates(pos);\r\n    // Send an event to the event receiver\r\n    if (window.PointerEvent) {\r\n      this._handle(new window.PointerEvent('pointer' + type, {\r\n        pointerId: 0,\r\n        clientX: page.x,\r\n        clientY: page.y\r\n      }));\r\n    } else {\r\n      // Safari hack\r\n      this._handle(new window.MouseEvent('mouse' + type, {\r\n        clientX: page.x,\r\n        clientY: page.y\r\n      }));\r\n    }\r\n\r\n    // Force update pointer system\r\n    const pointerSystem = this.engine.currentScene.world.systemManager.get(PointerSystem);\r\n    const transformEntities = this.engine.currentScene.world.queryManager.createQuery(pointerSystem.types);\r\n    pointerSystem.preupdate();\r\n    pointerSystem.update(transformEntities.getEntities());\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}", "export interface FpsSamplerOptions {\r\n  /**\r\n   * Specify the sampling period in milliseconds (default 100)\r\n   */\r\n  samplePeriod?: number;\r\n  /**\r\n   * Specify the initial FPS\r\n   */\r\n  initialFps: number;\r\n\r\n  /**\r\n   * Specify the function used to return the current time (in milliseconds)\r\n   */\r\n  nowFn: () => number;\r\n}\r\n\r\nexport class FpsSampler {\r\n  private _fps: number;\r\n  private _samplePeriod: number = 100;\r\n  private _currentFrameTime: number = 0;\r\n  private _frames: number = 0;\r\n  private _previousSampleTime: number = 0;\r\n  private _beginFrameTime: number = 0;\r\n  private _nowFn: () => number;\r\n\r\n  constructor(options: FpsSamplerOptions) {\r\n    this._fps = options.initialFps;\r\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\r\n    this._currentFrameTime = 1000/options.initialFps;\r\n    this._nowFn = options.nowFn;\r\n    this._previousSampleTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * Start of code block to sample FPS for\r\n   */\r\n  start() {\r\n    this._beginFrameTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * End of code block to sample FPS for\r\n   */\r\n  end() {\r\n    this._frames++;\r\n    const time = this._nowFn();\r\n\r\n    this._currentFrameTime = time - this._beginFrameTime;\r\n\r\n    if (time >= this._previousSampleTime + this._samplePeriod) {\r\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\r\n      this._previousSampleTime = time;\r\n      this._frames = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the currently sampled fps over the last sample period, by default every 100ms\r\n   */\r\n  get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\r\n   */\r\n  get instant() {\r\n    return 1000 / this._currentFrameTime;\r\n  }\r\n}", "import { Logger } from '..';\r\nimport { FpsSampler } from './Fps';\r\n\r\nexport interface ClockOptions {\r\n  /**\r\n   * Define the function you'd like the clock to tick when it is started\r\n   */\r\n  tick: (elapsedMs: number) => any;\r\n  /**\r\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\r\n   */\r\n  onFatalException?: (e: unknown) => any;\r\n  /**\r\n   * Optionally limit the maximum FPS of the clock\r\n   */\r\n  maxFps?: number;\r\n}\r\n\r\n\r\n/**\r\n * Abstract Clock is the base type of all Clocks\r\n *\r\n * It has a few opinions\r\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\r\n * 2. The default timing api is implemented in now()\r\n *\r\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\r\n * method is unique to your clock implementation.\r\n */\r\nexport abstract class Clock {\r\n  protected tick: (elapsedMs: number) => any;\r\n  private _onFatalException: (e: unknown) => any = () => { /* default nothing */ };\r\n  private _maxFps: number = Infinity;\r\n  private _lastTime: number = 0;\r\n  public fpsSampler: FpsSampler;\r\n  private _options: ClockOptions;\r\n  private _elapsed: number = 1;\r\n  private _scheduledCbs: [cb: () => any, scheduledTime: number][] = [];\r\n  private _totalElapsed: number = 0;\r\n  constructor(options: ClockOptions) {\r\n    this._options = options;\r\n    this.tick = options.tick;\r\n    this._lastTime = this.now() ?? 0;\r\n    this._maxFps = options.maxFps ?? this._maxFps;\r\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\r\n    this.fpsSampler = new FpsSampler({\r\n      initialFps: 60,\r\n      nowFn: () => this.now()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the elapsed time for the last completed frame\r\n   */\r\n  public elapsed(): number {\r\n    return this._elapsed;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public now(): number {\r\n    return performance.now();\r\n  }\r\n\r\n  public toTestClock() {\r\n    const testClock = new TestClock({\r\n      ...this._options,\r\n      defaultUpdateMs: 16.6\r\n    });\r\n    return testClock;\r\n  }\r\n\r\n  public toStandardClock() {\r\n    const clock = new StandardClock({\r\n      ...this._options\r\n    });\r\n    return clock;\r\n  }\r\n\r\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\r\n    this._onFatalException = handler;\r\n  }\r\n\r\n  /**\r\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur [[Clock]]\r\n   *\r\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\r\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\r\n   * stopped or paused.\r\n   *\r\n   * @param cb callback to fire\r\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   */\r\n  public schedule(cb: () => any, timeoutMs: number = 0) {\r\n    // Scheduled based on internal elapsed time\r\n    const scheduledTime = this._totalElapsed + timeoutMs;\r\n    this._scheduledCbs.push([cb, scheduledTime]);\r\n  }\r\n\r\n  private _runScheduledCbs() {\r\n    // walk backwards to delete items as we loop\r\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\r\n      if (this._scheduledCbs[i][1] <= this._totalElapsed) {\r\n        this._scheduledCbs[i][0]();\r\n        this._scheduledCbs.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected update(overrideUpdateMs?: number): void {\r\n    try {\r\n      this.fpsSampler.start();\r\n      // Get the time to calculate time-elapsed\r\n      const now = this.now();\r\n      let elapsed = now - this._lastTime || 1; // first frame\r\n\r\n      // Constrain fps\r\n      const fpsInterval = (1000 / this._maxFps);\r\n\r\n      // only run frame if enough time has elapsed\r\n      if (elapsed >= fpsInterval) {\r\n        let leftover = 0;\r\n        if (fpsInterval !== 0) {\r\n          leftover = (elapsed % fpsInterval);\r\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\r\n        }\r\n\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n\r\n        // tick the mainloop and run scheduled callbacks\r\n        this._elapsed = overrideUpdateMs || elapsed;\r\n        this._totalElapsed += this._elapsed;\r\n        this._runScheduledCbs();\r\n        this.tick(overrideUpdateMs || elapsed);\r\n\r\n        if (fpsInterval !== 0) {\r\n          this._lastTime = now - leftover;\r\n        } else {\r\n          this._lastTime = now;\r\n        }\r\n        this.fpsSampler.end();\r\n      }\r\n    } catch (e) {\r\n      this._onFatalException(e);\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns if the clock is currently running\r\n   */\r\n  public abstract isRunning(): boolean;\r\n\r\n  /**\r\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\r\n   */\r\n  public abstract start(): void;\r\n\r\n  /**\r\n   * Stop the clock, tick() is no longer called\r\n   */\r\n  public abstract stop(): void;\r\n}\r\n\r\n\r\n/**\r\n * The [[StandardClock]] implements the requestAnimationFrame browser api to run the tick()\r\n */\r\nexport class StandardClock extends Clock {\r\n\r\n  private _running = false;\r\n  private _requestId: number;\r\n  constructor(options: ClockOptions) {\r\n    super(options);\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n\r\n  public start(): void {\r\n    if (this._running) {\r\n      return;\r\n    }\r\n    this._running = true;\r\n    const mainloop = () => {\r\n      // stop the loop\r\n      if (!this._running) {\r\n        return;\r\n      }\r\n      try {\r\n        // request next loop\r\n        this._requestId = window.requestAnimationFrame(mainloop);\r\n        this.update();\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(this._requestId);\r\n        throw e;\r\n      }\r\n    };\r\n\r\n    // begin the first frame\r\n    mainloop();\r\n  }\r\n\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n}\r\n\r\nexport interface TestClockOptions {\r\n  /**\r\n   * Specify the update milliseconds to use for each manual step()\r\n   */\r\n  defaultUpdateMs: number;\r\n}\r\n\r\n/**\r\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\r\n */\r\nexport class TestClock extends Clock {\r\n  private _logger = Logger.getInstance();\r\n  private _updateMs: number;\r\n  private _running: boolean = false;\r\n  private _currentTime = 0;\r\n  constructor(options: ClockOptions & TestClockOptions) {\r\n    super({\r\n      ...options\r\n    });\r\n    this._updateMs = options.defaultUpdateMs;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public override now() {\r\n    return this._currentTime ?? 0;\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n  public start(): void {\r\n    this._running = true;\r\n  }\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n\r\n  /**\r\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\r\n   * @param overrideUpdateMs\r\n   */\r\n  step(overrideUpdateMs?: number): void {\r\n    const time = overrideUpdateMs ?? this._updateMs;\r\n\r\n    if (this._running) {\r\n      // to be comparable to RAF this needs to be a full blown Task\r\n      // For example, images cannot decode synchronously in a single step\r\n      this.update(time);\r\n      this._currentTime += time;\r\n    } else {\r\n      this._logger.warn('The clock is not running, no step will be performed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\r\n   * @param numberOfSteps\r\n   * @param overrideUpdateMs\r\n   */\r\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\r\n    for (let i = 0; i < numberOfSteps; i++) {\r\n      this.step(overrideUpdateMs ?? this._updateMs);\r\n    }\r\n  }\r\n}", "import toasterCss from './Toaster.css';\r\n\r\n/**\r\n * The Toaster is only meant to be called from inside Excalibur to display messages to players\r\n */\r\nexport class Toaster {\r\n  private _styleBlock: HTMLStyleElement;\r\n  private _container: HTMLDivElement;\r\n  private _toasterCss: string = toasterCss.toString();\r\n\r\n  private _isInitialized = false;\r\n  private _initialize() {\r\n    if (!this._isInitialized) {\r\n      this._container = document.createElement('div');\r\n      this._container.id = 'ex-toast-container';\r\n      document.body.appendChild(this._container);\r\n      this._isInitialized = true;\r\n\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._toasterCss;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n  }\r\n\r\n  public dispose() {\r\n    this._container.parentElement.removeChild(this._container);\r\n\r\n    this._styleBlock.parentElement.removeChild(this._styleBlock);\r\n\r\n    this._isInitialized = false;\r\n  }\r\n\r\n  private _createFragment(message: string) {\r\n    const toastMessage = document.createElement('span');\r\n    toastMessage.innerText = message;\r\n    return toastMessage;\r\n  }\r\n\r\n  /**\r\n   * Display a toast message to a player\r\n   * @param message Text of the message, messages may have a single \"[LINK]\" to influence placement\r\n   * @param linkTarget Optionally specify a link location\r\n   * @param linkName Optionally specify a name for that link location\r\n   */\r\n  public toast(message: string, linkTarget?: string, linkName?: string) {\r\n    this._initialize();\r\n    const toast = document.createElement('div');\r\n    toast.className = 'ex-toast-message';\r\n\r\n    const messageFragments: HTMLElement[] = message.split('[LINK]').map(message => this._createFragment(message));\r\n\r\n    if (linkTarget) {\r\n      const link = document.createElement('a');\r\n      link.href = linkTarget;\r\n      if (linkName) {\r\n        link.innerText = linkName;\r\n      } else {\r\n        link.innerText = linkTarget;\r\n      }\r\n      messageFragments.splice(1, 0, link);\r\n    }\r\n\r\n    // Assembly message\r\n    const finalMessage = document.createElement('div');\r\n    messageFragments.forEach(message => {\r\n      finalMessage.appendChild(message);\r\n    });\r\n    toast.appendChild(finalMessage);\r\n\r\n    // Dismiss button\r\n    const dismissBtn = document.createElement('button');\r\n    dismissBtn.innerText = 'x';\r\n    dismissBtn.addEventListener('click', () => {\r\n      this._container.removeChild(toast);\r\n    });\r\n    toast.appendChild(dismissBtn);\r\n\r\n    // Escape to dismiss\r\n    const keydownHandler = (evt: KeyboardEvent) => {\r\n      if (evt.key === 'Escape') {\r\n        try {\r\n          this._container.removeChild(toast);\r\n        } catch {\r\n          // pass\r\n        }\r\n      }\r\n      document.removeEventListener('keydown', keydownHandler);\r\n    };\r\n    document.addEventListener('keydown', keydownHandler);\r\n\r\n    // Insert into container\r\n    const first = this._container.firstChild;\r\n    this._container.insertBefore(toast, first);\r\n  }\r\n}", "import { EX_VERSION } from './';\r\nimport { Flags } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, ScreenDimension, Resolution } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { Loader } from './Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  GameEvent,\r\n  DeactivateEvent,\r\n  ActivateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { Debug, DebugStats } from './Debug/Debug';\r\nimport { Class } from './Class';\r\nimport * as Input from './Input/Index';\r\nimport * as Events from './Events';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL, TextureLoader } from './Graphics';\r\nimport { PointerEventReceiver } from './Input/PointerEventReceiver';\r\nimport { Clock, StandardClock } from './Util/Clock';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\r\nimport { Toaster } from './Util/Toaster';\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\r\n   */\r\n  viewport?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See [[Resolution]] for common presets.\r\n   */\r\n  resolution?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   *\r\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\r\n   * with [[ImageFiltering.Blended]]\r\n   *\r\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\r\n   * with [[ImageFiltering.Pixel]]\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally upscale the number of pixels in the canvas. Normally only useful if you need a smoother look to your assets, especially\r\n   * [[Text]].\r\n   *\r\n   * **WARNING** It is recommended you try using `antialiasing: true` before adjusting pixel ratio. Pixel ratio will consume more memory\r\n   * and on mobile may break if the internal size of the canvas exceeds 4k pixels in width or height.\r\n   *\r\n   * Default is based the display's pixel ratio, for example a HiDPI screen might have the value 2;\r\n   */\r\n  pixelRatio?: number;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally snap graphics to nearest pixel, default is false\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, [[width]] and [[height]] may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: Input.PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  maxFps?: number;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desireable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   */\r\n  fixedUpdateFps?: number\r\n\r\n  /**\r\n   * Default `true`, optionally configure excalibur to use optimal draw call sorting, to opt out set this to `false`.\r\n   *\r\n   * Excalibur will automatically sort draw calls by z and priority into renderer batches for maximal draw performance,\r\n   * this can disrupt a specific desired painter order.\r\n   */\r\n  useDrawSorting?: boolean;\r\n\r\n  /**\r\n   * Optionally configure how excalibur handles poor performance on a player's browser\r\n   */\r\n  configurePerformanceCanvas2DFallback?: {\r\n    /**\r\n     * By default `true`, this will switch the internal graphics context to Canvas2D which can improve performance on non hardware\r\n     * accelerated browsers.\r\n     */\r\n    allow: boolean;\r\n    /**\r\n     * By default `false`, if set to `true` a dialogue will be presented to the player about their browser and how to potentially\r\n     * address any issues.\r\n     */\r\n    showPlayerMessage?: boolean;\r\n    /**\r\n     * Default `{ numberOfFrames: 100, fps: 20 }`, optionally configure excalibur to fallback to the 2D Canvas renderer\r\n     * if bad performance is detected.\r\n     *\r\n     * In this example of the default if excalibur is running at 20fps or less for 100 frames it will trigger the fallback to the 2D\r\n     * Canvas renderer.\r\n     */\r\n    threshold?: { numberOfFrames: number, fps: number };\r\n  }\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The [[Engine]] is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\r\n  /**\r\n   * Excalibur browser events abstraction used for wiring to native browser events safely\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\r\n   */\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  public maxFps: number = Number.POSITIVE_INFINITY;\r\n\r\n  /**\r\n   * Optionally configure a fixed update fps, this can be desireable if you need the physics simulation to be very stable. When set\r\n   * the update step and physics will use the same elapsed time for each tick even if the graphical framerate drops. In order for the\r\n   * simulation to be correct, excalibur will run multiple updates in a row (at the configured update elapsed) to catch up, for example\r\n   * there could be X updates and 1 draw each clock step.\r\n   *\r\n   * **NOTE:** This does come at a potential perf cost because each catch-up update will need to be run if the fixed rate is greater than\r\n   * the current instantaneous framerate, or perf gain if the fixed rate is less than the current framerate.\r\n   *\r\n   * By default is unset and updates will use the current instantaneous framerate with 1 update and 1 draw each clock step.\r\n   */\r\n  public fixedUpdateFps?: number;\r\n\r\n  /**\r\n   * Direct access to the excalibur clock\r\n   */\r\n  public clock: Clock;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: Input.EngineInput;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   *\r\n   * Useful when you want to debug different aspects of built in engine features like\r\n   *   * Transform\r\n   *   * Graphics\r\n   *   * Colliders\r\n   */\r\n  public debug: Debug;\r\n\r\n  /**\r\n   * Access [[stats]] that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * The current [[Scene]] being drawn and updated on screen\r\n   */\r\n  public currentScene: Scene;\r\n\r\n  /**\r\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public readonly scenes: { [key: string]: Scene } = {};\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current [[DisplayMode]] of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * Hints the graphics context to truncate fractional world space coordinates\r\n   */\r\n  public get snapToPixel(): boolean {\r\n    return this.graphicsContext.snapToPixel;\r\n  };\r\n\r\n  public set snapToPixel(shouldSnapToPixel: boolean) {\r\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\r\n  };\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  private _toaster: Toaster = new Toaster();\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: Loader;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  private _deferredGoTo: string = null;\r\n\r\n  public on(eventName: 'fallbackgraphicscontext', handler: (event: ExcaliburGraphicsContext2DCanvas) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'fallbackgraphicscontext', handler: (event: ExcaliburGraphicsContext2DCanvas) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'fallbackgraphicscontext', handler?: (event: ExcaliburGraphicsContext2DCanvas) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\r\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\r\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\r\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\r\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default [[EngineOptions]]\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    useDrawSorting: true,\r\n    configurePerformanceCanvas2DFallback: {\r\n      allow: true,\r\n      showPlayerMessage: false,\r\n      threshold: { fps: 20, numberOfFrames: 100 }\r\n    },\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    snapToPixel: false,\r\n    pointerScope: Input.PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  private _originalOptions: EngineOptions = {};\r\n  public readonly _originalDisplayMode: DisplayMode;\r\n\r\n  /**\r\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through [[EngineOptions]].\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions) {\r\n    super();\r\n\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n    this._originalOptions = options;\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|');\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    this._originalDisplayMode = displayMode;\r\n\r\n    // Canvas 2D fallback can be flagged on\r\n    let useCanvasGraphicsContext = Flags.isEnabled('use-canvas-context');\r\n    if (!useCanvasGraphicsContext) {\r\n      // Attempt webgl first\r\n      try {\r\n        this.graphicsContext = new ExcaliburGraphicsContextWebGL({\r\n          canvasElement: this.canvas,\r\n          enableTransparency: this.enableCanvasTransparency,\r\n          smoothing: options.antialiasing,\r\n          backgroundColor: options.backgroundColor,\r\n          snapToPixel: options.snapToPixel,\r\n          useDrawSorting: options.useDrawSorting\r\n        });\r\n      } catch (e) {\r\n        this._logger.warn(\r\n          `Excalibur could not load webgl for some reason (${(e as Error).message}) and loaded a Canvas 2D fallback. ` +\r\n          `Some features of Excalibur will not work in this mode. \\n\\n` +\r\n          'Read more about this issue at https://excaliburjs.com/docs/webgl'\r\n        );\r\n        // fallback to canvas in case of failure\r\n        useCanvasGraphicsContext = true;\r\n      }\r\n    }\r\n\r\n    if (useCanvasGraphicsContext) {\r\n      this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel,\r\n        useDrawSorting: options.useDrawSorting\r\n      });\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : (options.pixelRatio ?? null)\r\n    });\r\n\r\n    // Set default filtering based on antialiasing\r\n    TextureLoader.filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.maxFps = options.maxFps ?? this.maxFps;\r\n    this.fixedUpdateFps = options.fixedUpdateFps ?? this.fixedUpdateFps;\r\n\r\n    this.clock = new StandardClock({\r\n      maxFps: this.maxFps,\r\n      tick: this._mainloop.bind(this),\r\n      onFatalException: (e) => this.onFatalException(e)\r\n    });\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    this._loader = new Loader();\r\n    this._loader.wireEngine(this);\r\n    this.debug = new Debug(this);\r\n\r\n    this._initialize(options);\r\n\r\n    this.rootScene = this.currentScene = new Scene();\r\n\r\n    this.addScene('root', this.rootScene);\r\n    (window as any).___EXCALIBUR_DEVTOOL = this;\r\n  }\r\n\r\n  private _performanceThresholdTriggered = false;\r\n  private _fpsSamples: number[] = [];\r\n  private _monitorPerformanceThresholdAndTriggerFallback() {\r\n    const { allow } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    let { threshold, showPlayerMessage } = this._originalOptions.configurePerformanceCanvas2DFallback;\r\n    if (threshold === undefined) {\r\n      threshold = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold;\r\n    }\r\n    if (showPlayerMessage === undefined) {\r\n      showPlayerMessage = Engine._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage;\r\n    }\r\n    if (!Flags.isEnabled('use-canvas-context') && allow && this.ready && !this._performanceThresholdTriggered) {\r\n      // Calculate Average fps for last X number of frames after start\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        this._fpsSamples.splice(0, 1);\r\n      }\r\n      this._fpsSamples.push(this.clock.fpsSampler.fps);\r\n      let total = 0;\r\n      for (let i = 0; i < this._fpsSamples.length; i++) {\r\n        total += this._fpsSamples[i];\r\n      }\r\n      const average = total / this._fpsSamples.length;\r\n\r\n      if (this._fpsSamples.length === threshold.numberOfFrames) {\r\n        if (average <= threshold.fps) {\r\n          this._performanceThresholdTriggered = true;\r\n          this._logger.warn(\r\n            `Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.\\n` +\r\n            'this might mean your browser doesn\\'t have webgl enabled or hardware acceleration is unavailable.\\n\\n' +\r\n            'If in Chrome:\\n' +\r\n            '  * Visit Settings > Advanced > System, and ensure \"Use Hardware Acceleration\" is checked.\\n'+\r\n            '  * Visit chrome://flags/#ignore-gpu-blocklist and ensure \"Override software rendering list\" is \"enabled\"\\n' +\r\n            'If in Firefox, visit about:config\\n' +\r\n            '  * Ensure webgl.disabled = false\\n' +\r\n            '  * Ensure webgl.force-enabled = true\\n' +\r\n            '  * Ensure layers.acceleration.force-enabled = true\\n\\n' +\r\n            'Read more about this issue at https://excaliburjs.com/docs/performance'\r\n          );\r\n\r\n          if (showPlayerMessage) {\r\n            this._toaster.toast(\r\n              'Excalibur is encountering performance issues. '+\r\n              'It\\'s possible that your browser doesn\\'t have hardware acceleration enabled. ' +\r\n              'Visit [LINK] for more information and potential solutions.',\r\n              'https://excaliburjs.com/docs/performance'\r\n            );\r\n          }\r\n          this.useCanvas2DFallback();\r\n          this.emit('fallbackgraphicscontext', this.graphicsContext);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switches the engine's graphics context to the 2D Canvas.\r\n   * @warning Some features of Excalibur will not work in this mode.\r\n   */\r\n  public useCanvas2DFallback() {\r\n    // Swap out the canvas\r\n    const newCanvas = this.canvas.cloneNode(false) as HTMLCanvasElement;\r\n    this.canvas.parentNode.replaceChild(newCanvas, this.canvas);\r\n    this.canvas = newCanvas;\r\n\r\n    const options = this._originalOptions;\r\n    const displayMode = this._originalDisplayMode;\r\n\r\n    // New graphics context\r\n    this.graphicsContext = new ExcaliburGraphicsContext2DCanvas({\r\n      canvasElement: this.canvas,\r\n      enableTransparency: this.enableCanvasTransparency,\r\n      smoothing: options.antialiasing,\r\n      backgroundColor: options.backgroundColor,\r\n      snapToPixel: options.snapToPixel,\r\n      useDrawSorting: options.useDrawSorting\r\n    });\r\n\r\n    // Reset screen\r\n    if (this.screen) {\r\n      this.screen.dispose();\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : (options.pixelRatio ?? null)\r\n    });\r\n    this.screen.setCurrentCamera(this.currentScene.camera);\r\n\r\n    // Reset pointers\r\n    this.input.pointers.detach();\r\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\r\n    this.input.pointers = this.input.pointers.recreate(pointerTarget, this);\r\n    this.input.pointers.init();\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value <= 0) {\r\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   *\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene(key: string, scene: Scene) {\r\n    if (this.scenes[key]) {\r\n      this._logger.warn('Scene', key, 'already exists overwriting');\r\n    }\r\n    this.scenes[key] = scene;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Scene]] instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    if (entity instanceof Scene) {\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          if (this.scenes[key] === entity) {\r\n            delete this.scenes[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      // remove scene\r\n      delete this.scenes[entity];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene): void;\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the [[currentScene]] may be drawn or updated.\r\n   *\r\n   * @param actor  The actor to add to the [[currentScene]]\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\r\n      return;\r\n    }\r\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\r\n      this.scenes[this._deferredGoTo].add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   *\r\n   * @param actor  The actor to remove from the [[currentScene]].\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the currently updating and drawing scene to a different,\r\n   * named scene. Calls the [[Scene]] lifecycle events.\r\n   * @param key  The key of the scene to transition to.\r\n   * @param data Optional data to send to the scene's onActivate method\r\n   */\r\n  public goToScene<TData = undefined>(key: string, data?: TData): void {\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoTo = key;\r\n      return;\r\n    }\r\n\r\n    if (this.scenes[key]) {\r\n      const previousScene = this.currentScene;\r\n      const nextScene = this.scenes[key];\r\n\r\n      this._logger.debug('Going to scene:', key);\r\n\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        const context = { engine: this, previousScene, nextScene };\r\n        this.currentScene._deactivate.apply(this.currentScene, [context, nextScene]);\r\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(context, this.currentScene));\r\n      }\r\n\r\n      // set current scene to new one\r\n      this.currentScene = nextScene;\r\n      this.screen.setCurrentCamera(nextScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      this.currentScene._initialize(this);\r\n\r\n      const context = { engine: this, previousScene, nextScene, data };\r\n      this.currentScene._activate.apply(this.currentScene, [context, nextScene]);\r\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(context, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', key, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\r\n    this.input = {\r\n      keyboard: new Input.Keyboard(),\r\n      pointers: new PointerEventReceiver(pointerTarget, this),\r\n      gamepads: new Input.Gamepads()\r\n    };\r\n    this.input.keyboard.init();\r\n    this.input.pointers.init();\r\n    this.input.gamepads.init();\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    let hidden: keyof HTMLDocument, visibilityChange: string;\r\n    if (typeof document.hidden !== 'undefined') {\r\n      // Opera 12.10 and Firefox 18 and later support\r\n      hidden = 'hidden';\r\n      visibilityChange = 'visibilitychange';\r\n    } else if ('msHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'msHidden';\r\n      visibilityChange = 'msvisibilitychange';\r\n    } else if ('webkitHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'webkitHidden';\r\n      visibilityChange = 'webkitvisibilitychange';\r\n    }\r\n\r\n    this.browser.document.on(visibilityChange, () => {\r\n      if (document[hidden]) {\r\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else {\r\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public onInitialize(_engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If supported by the browser, this will set the antialiasing flag on the\r\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\r\n   * image resources.\r\n   * @param isSmooth  Set smoothing to true or false\r\n   */\r\n  public setAntialiasing(isSmooth: boolean) {\r\n    this.screen.antialiasing = isSmooth;\r\n  }\r\n\r\n  /**\r\n   * Return the current smoothing status of the canvas\r\n   */\r\n  public getAntialiasing(): boolean {\r\n    return this.screen.antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n      if (this._deferredGoTo) {\r\n        const deferredScene = this._deferredGoTo;\r\n        this._deferredGoTo = null;\r\n        this.goToScene(deferredScene);\r\n      } else {\r\n        this.goToScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param delta  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(delta: number) {\r\n    if (!this.ready) {\r\n      // suspend updates until loading is finished\r\n      this._loader.update(this, delta);\r\n      // Update input listeners\r\n      this.input.keyboard.update();\r\n      this.input.gamepads.update();\r\n      return;\r\n    }\r\n\r\n\r\n    // Publish preupdate events\r\n    this._preupdate(delta);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, delta);\r\n\r\n    // Publish update event\r\n    this._postupdate(delta);\r\n\r\n    // Update input listeners\r\n    this.input.keyboard.update();\r\n    this.input.gamepads.update();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(delta: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\r\n    this.onPreUpdate(this, delta);\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(delta: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\r\n    this.onPostUpdate(this, delta);\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param delta  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(delta: number) {\r\n    this.graphicsContext.beginDrawLifecycle();\r\n    this.graphicsContext.clear();\r\n    this._predraw(this.graphicsContext, delta);\r\n\r\n    // Drawing nothing else while loading\r\n    if (!this._isReady) {\r\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\r\n      this.graphicsContext.flush();\r\n      return;\r\n    }\r\n\r\n    this.graphicsContext.backgroundColor = this.backgroundColor;\r\n\r\n    this.currentScene.draw(this.graphicsContext, delta);\r\n\r\n    this._postdraw(this.graphicsContext, delta);\r\n\r\n    // Flush any pending drawings\r\n    this.graphicsContext.flush();\r\n    this.graphicsContext.endDrawLifecycle();\r\n\r\n    this._checkForScreenShots();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: ExcaliburGraphicsContext, delta: number) {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\r\n    this.onPreDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPreDraw(_ctx: ExcaliburGraphicsContext, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: ExcaliburGraphicsContext, delta: number) {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\r\n    this.onPostDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPostDraw(_ctx: ExcaliburGraphicsContext, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  private _loadingComplete: boolean = false;\r\n\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return this._loadingComplete;\r\n  }\r\n\r\n  private _isReady = false;\r\n  public get ready() {\r\n    return this._isReady;\r\n  }\r\n  private _isReadyResolve: () => any;\r\n  private _isReadyPromise = new Promise<void>(resolve => {\r\n    this._isReadyResolve = resolve;\r\n  });\r\n  public isReady(): Promise<void> {\r\n    return this._isReadyPromise;\r\n  }\r\n\r\n\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\r\n   * custom loader.\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(loader?: Loader): Promise<void> {\r\n    if (!this._compatible) {\r\n      throw new Error('Excalibur is incompatible with your browser');\r\n    }\r\n\r\n    // Wire loader if we have it\r\n    if (loader) {\r\n      // Push the current user entered resolution/viewport\r\n      this.screen.pushResolutionAndViewport();\r\n\r\n      // Configure resolution for loader, it expects resolution === viewport\r\n      this.screen.resolution = this.screen.viewport;\r\n      this.screen.applyResolutionAndViewport();\r\n      this._loader = loader;\r\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\r\n      this._loader.wireEngine(this);\r\n    }\r\n\r\n    // Start the excalibur clock which drives the mainloop\r\n    // has started is a slight misnomer, it's really mainloop started\r\n    this._logger.debug('Starting game clock...');\r\n    this.browser.resume();\r\n    this.clock.start();\r\n    this._logger.debug('Game clock started');\r\n\r\n    if (loader) {\r\n      await this.load(this._loader);\r\n      this._loadingComplete = true;\r\n\r\n      // reset back to previous user resolution/viewport\r\n      this.screen.popResolutionAndViewport();\r\n      this.screen.applyResolutionAndViewport();\r\n    }\r\n\r\n    this._loadingComplete = true;\r\n\r\n    // Initialize before ready\r\n    this._overrideInitialize(this);\r\n\r\n    this._isReady = true;\r\n\r\n    this._isReadyResolve();\r\n    this.emit('start', new GameStartEvent(this));\r\n    return this._isReadyPromise;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frames elapsed milliseconds\r\n   */\r\n  public currentFrameElapsedMs = 0;\r\n\r\n  /**\r\n   * Returns the current frame lag when in fixed update mode\r\n   */\r\n  public currentFrameLagMs = 0;\r\n\r\n  private _lagMs = 0;\r\n  private _mainloop(elapsed: number) {\r\n    this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\r\n    const delta = elapsed * this.timescale;\r\n    this.currentFrameElapsedMs = delta;\r\n\r\n    // reset frame stats (reuse existing instances)\r\n    const frameId = this.stats.prevFrame.id + 1;\r\n    this.stats.currFrame.reset();\r\n    this.stats.currFrame.id = frameId;\r\n    this.stats.currFrame.delta = delta;\r\n    this.stats.currFrame.fps = this.clock.fpsSampler.fps;\r\n    GraphicsDiagnostics.clear();\r\n\r\n    const beforeUpdate = this.clock.now();\r\n    const fixedTimestepMs = 1000 / this.fixedUpdateFps;\r\n    if (this.fixedUpdateFps) {\r\n      this._lagMs += delta;\r\n      while (this._lagMs >= fixedTimestepMs) {\r\n        this._update(fixedTimestepMs);\r\n        this._lagMs -= fixedTimestepMs;\r\n      }\r\n    } else {\r\n      this._update(delta);\r\n    }\r\n    const afterUpdate = this.clock.now();\r\n    this.currentFrameLagMs = this._lagMs;\r\n    this._draw(delta);\r\n    const afterDraw = this.clock.now();\r\n\r\n    this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n    this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n    this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n\r\n    this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\r\n    this.stats.prevFrame.reset(this.stats.currFrame);\r\n\r\n    this._monitorPerformanceThresholdAndTriggerFallback();\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this.clock.isRunning()) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this.clock.stop();\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isRunning() {\r\n    return this.clock.isRunning();\r\n  }\r\n\r\n\r\n  private _screenShotRequests: { preserveHiDPIResolution: boolean, resolve: (image: HTMLImageElement) => void }[] = [];\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\r\n   */\r\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\r\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\r\n      this._screenShotRequests.push({preserveHiDPIResolution, resolve});\r\n    });\r\n    return screenShotPromise;\r\n  }\r\n\r\n  private _checkForScreenShots() {\r\n    // We must grab the draw buffer before we yield to the browser\r\n    // the draw buffer is cleared after compositing\r\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\r\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\r\n    for (const request of this._screenShotRequests) {\r\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\r\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\r\n      const screenshot = document.createElement('canvas');\r\n      screenshot.width = finalWidth;\r\n      screenshot.height = finalHeight;\r\n      const ctx = screenshot.getContext('2d');\r\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\r\n\r\n      const result = new Image();\r\n      const raw = screenshot.toDataURL('image/png');\r\n      result.src = raw;\r\n      request.resolve(result);\r\n    }\r\n    // Reset state\r\n    this._screenShotRequests.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\r\n   */\r\n  public async load(loader: Loadable<any>): Promise<void> {\r\n    try {\r\n      await loader.load();\r\n    } catch (e) {\r\n      this._logger.error('Error loading resources, things may not behave properly', e);\r\n      await Promise.resolve();\r\n    }\r\n  }\r\n}", "export * from './vector';\r\nexport * from './vector-view';\r\nexport * from './matrix';\r\nexport * from './affine-matrix';\r\nexport * from './transform';\r\nexport * from './coord-plane';\r\nexport * from './Random';\r\nexport * from './global-coordinates';\r\nexport * from './line-segment';\r\nexport * from './projection';\r\nexport * from './ray';\r\nexport * from './util';", "export * from './Debug';\r\nexport * from './DebugFlags';\r\nexport * from './DebugSystem';\r\n", "import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from '.';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\r\n   */\r\n  spriteFont?: SpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  private _font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this._font });\r\n\r\n  public get font(): Font {\r\n    return this._font;\r\n  }\r\n\r\n  public set font(newFont: Font) {\r\n    this._font = newFont;\r\n    this._text.font = newFont;\r\n  }\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public override get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public override set color(color: Color) {\r\n    if (this._text) {\r\n      this._text.color = color;\r\n    }\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._text.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this._text.opacity = opacity;\r\n  }\r\n\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The [[SpriteFont]] to use, if any. Overrides [[Font|font]] if present.\r\n   */\r\n  public get spriteFont(): SpriteFont {\r\n    return this._spriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: SpriteFont) {\r\n    if (sf) {\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const {text, pos, x, y, spriteFont, font, color} = options;\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.font = font ?? this.font;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this._text.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n}\r\n", "import { BodyComponent, BoundingBox, Collider, ColliderComponent, CollisionType, Color, CompositeCollider, vec, Vector } from '..';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { DebugGraphicsComponent, ExcaliburGraphicsContext, Graphic, GraphicsComponent } from '../Graphics';\r\nimport { IsometricEntityComponent } from './IsometricEntityComponent';\r\n\r\nexport class IsometricTile extends Entity {\r\n  /**\r\n   * Indicates whether this tile is solid\r\n   */\r\n  public solid: boolean = false;\r\n\r\n  private _gfx: GraphicsComponent;\r\n  private _tileBounds = new BoundingBox();\r\n  private _graphics: Graphic[] = [];\r\n  public getGraphics(): readonly Graphic[] {\r\n    return this._graphics;\r\n  }\r\n  /**\r\n   * Tile graphics\r\n   */\r\n  public addGraphic(graphic: Graphic) {\r\n    this._graphics.push(graphic);\r\n    this._gfx.visible = true;\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  private _recalculateBounds(): BoundingBox {\r\n    let bounds = this._tileBounds.clone();\r\n    for (const graphic of this._graphics) {\r\n      const offset = vec(\r\n        this.map.graphicsOffset.x - this.map.tileWidth / 2,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\r\n      bounds = bounds.combine(graphic.localBounds.translate(offset));\r\n    }\r\n    return bounds;\r\n  }\r\n\r\n  public removeGraphic(graphic: Graphic) {\r\n    const index = this._graphics.indexOf(graphic);\r\n    if (index > -1) {\r\n      this._graphics.splice(index, 1);\r\n    }\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  public clearGraphics() {\r\n    this._graphics.length = 0;\r\n    this._gfx.visible = false;\r\n    this._gfx.localBounds = this._recalculateBounds();\r\n  }\r\n\r\n  /**\r\n   * Tile colliders\r\n   */\r\n  private _colliders: Collider[] = [];\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Adds a collider to the IsometricTile\r\n   *\r\n   * **Note!** the [[Tile.solid]] must be set to true for it to act as a \"fixed\" collider\r\n   * @param collider\r\n   */\r\n  public addCollider(collider: Collider) {\r\n    this._colliders.push(collider);\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Removes a collider from the IsometricTile\r\n   * @param collider\r\n   */\r\n  public removeCollider(collider: Collider) {\r\n    const index = this._colliders.indexOf(collider);\r\n    if (index > -1) {\r\n      this._colliders.splice(index, 1);\r\n    }\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Clears all colliders from the IsometricTile\r\n   */\r\n  public clearColliders(): void {\r\n    this._colliders.length = 0;\r\n    this.map.flagCollidersDirty();\r\n  }\r\n\r\n  /**\r\n   * Integer tile x coordinate\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * Integer tile y coordinate\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Reference to the [[IsometricMap]] this tile is part of\r\n   */\r\n  public readonly map: IsometricMap;\r\n\r\n  private _transform: TransformComponent;\r\n  private _isometricEntityComponent: IsometricEntityComponent;\r\n\r\n  /**\r\n   * Returns the top left corner of the [[IsometricTile]] in world space\r\n   */\r\n  public get pos(): Vector {\r\n    return this.map.tileToWorld(vec(this.x, this.y));\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the [[IsometricTile]]\r\n   */\r\n  public get center(): Vector {\r\n    return this.pos.add(vec(0, this.map.tileHeight / 2));\r\n  }\r\n\r\n  /**\r\n   * Construct a new IsometricTile\r\n   * @param x tile coordinate in x (not world position)\r\n   * @param y tile coordinate in y (not world position)\r\n   * @param graphicsOffset offset that tile should be shifted by (default (0, 0))\r\n   * @param map reference to owning IsometricMap\r\n   */\r\n  constructor(x: number, y: number, graphicsOffset: Vector | null, map: IsometricMap) {\r\n    super([\r\n      new TransformComponent(),\r\n      new GraphicsComponent({\r\n        offset: graphicsOffset ?? Vector.Zero,\r\n        onPostDraw: (gfx, elapsed) => this.draw(gfx, elapsed)\r\n      }),\r\n      new IsometricEntityComponent(map)\r\n    ]);\r\n    this.x = x;\r\n    this.y = y;\r\n    this.map = map;\r\n    this._transform = this.get(TransformComponent);\r\n    this._isometricEntityComponent = this.get(IsometricEntityComponent);\r\n\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    const halfTileHeight = this.map.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    // The x position shifts left with every y step\r\n    const xPos = (this.x - this.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (this.x + this.y) * halfTileHeight;\r\n    this._transform.pos = vec(xPos, yPos);\r\n    this._isometricEntityComponent.elevation = 0;\r\n\r\n    this._gfx = this.get(GraphicsComponent);\r\n    this._gfx.visible = false; // start not visible\r\n    const totalWidth = this.map.tileWidth;\r\n    const totalHeight = this.map.tileHeight;\r\n\r\n    // initial guess at gfx bounds based on the tile\r\n    const offset = vec(0, (this.map.renderFromTopOfGraphic ? totalHeight : 0));\r\n    this._gfx.localBounds = this._tileBounds = new BoundingBox({\r\n      left: -totalWidth / 2,\r\n      top: -totalHeight,\r\n      right: totalWidth / 2,\r\n      bottom: totalHeight\r\n    }).translate(offset);\r\n  }\r\n\r\n  draw(gfx: ExcaliburGraphicsContext, _elapsed: number) {\r\n    const halfTileWidth = this.map.tileWidth / 2;\r\n    gfx.save();\r\n    // shift left origin to corner of map, not the left corner of the first sprite\r\n    gfx.translate(-halfTileWidth, 0);\r\n    for (const graphic of this._graphics) {\r\n      graphic.draw(\r\n        gfx,\r\n        this.map.graphicsOffset.x,\r\n        this.map.graphicsOffset.y - (this.map.renderFromTopOfGraphic ? 0 : (graphic.height - this.map.tileHeight)));\r\n    }\r\n    gfx.restore();\r\n  }\r\n}\r\n\r\nexport interface IsometricMapOptions {\r\n  /**\r\n   * Optionally name the isometric tile map\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally specify the position of the isometric tile map\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally render from the top of the graphic, by default tiles are rendered from the bottom\r\n   */\r\n  renderFromTopOfGraphic?: boolean;\r\n  /**\r\n   * Optionally present a graphics offset, this can be useful depending on your tile graphics\r\n   */\r\n  graphicsOffset?: Vector;\r\n  /**\r\n   * Width of an individual tile in pixels, this should be the width of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileWidth: number;\r\n  /**\r\n   * Height of an individual tile in pixels, this should be the height of the parallelogram of the base of the tile art asset.\r\n   */\r\n  tileHeight: number;\r\n  /**\r\n   * The number of tile columns, or the number of tiles wide\r\n   */\r\n  columns: number;\r\n  /**\r\n   * The number of tile  rows, or the number of tiles high\r\n   */\r\n  rows: number;\r\n}\r\n\r\n/**\r\n * The IsometricMap is a special tile map that provides isometric rendering support to Excalibur\r\n *\r\n * The tileWidth and tileHeight should be the height and width in pixels of the parallelogram of the base of the tile art asset.\r\n * The tileWidth and tileHeight is not necessarily the same as your graphic pixel width and height.\r\n *\r\n * Please refer to the docs https://excaliburjs.com for more details calculating what your tile width and height should be given\r\n * your art assets.\r\n */\r\nexport class IsometricMap extends Entity {\r\n  /**\r\n   * Width of individual tile in pixels\r\n   */\r\n  public readonly tileWidth: number;\r\n  /**\r\n   * Height of individual tile in pixels\r\n   */\r\n  public readonly tileHeight: number;\r\n  /**\r\n   * Number of tiles wide\r\n   */\r\n  public readonly columns: number;\r\n  /**\r\n   * Number of tiles high\r\n   */\r\n  public readonly rows: number;\r\n  /**\r\n   * List containing all of the tiles in IsometricMap\r\n   */\r\n  public readonly tiles: IsometricTile[];\r\n\r\n  /**\r\n   * Render the tile graphic from the top instead of the bottom\r\n   *\r\n   * default is `false` meaning rendering from the bottom\r\n   */\r\n  public renderFromTopOfGraphic: boolean = false;\r\n  public graphicsOffset: Vector = vec(0, 0);\r\n\r\n  /**\r\n   * Isometric map [[TransformComponent]]\r\n   */\r\n  public transform: TransformComponent;\r\n\r\n  /**\r\n   * Isometric map [[ColliderComponent]]\r\n   */\r\n  public collider: ColliderComponent;\r\n\r\n  private _composite: CompositeCollider;\r\n\r\n  constructor(options: IsometricMapOptions) {\r\n    super([\r\n      new TransformComponent(),\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      }),\r\n      new ColliderComponent(),\r\n      new DebugGraphicsComponent((ctx) => this.debug(ctx), false)\r\n    ], options.name);\r\n    const { pos, tileWidth, tileHeight, columns: width, rows: height, renderFromTopOfGraphic, graphicsOffset } = options;\r\n\r\n    this.transform = this.get(TransformComponent);\r\n    if (pos) {\r\n      this.transform.pos = pos;\r\n    }\r\n\r\n    this.collider = this.get(ColliderComponent);\r\n    if (this.collider) {\r\n      this.collider.set(this._composite = new CompositeCollider([]));\r\n    }\r\n\r\n\r\n    this.renderFromTopOfGraphic = renderFromTopOfGraphic ?? this.renderFromTopOfGraphic;\r\n    this.graphicsOffset = graphicsOffset ?? this.graphicsOffset;\r\n\r\n    this.tileWidth = tileWidth;\r\n    this.tileHeight = tileHeight;\r\n    this.columns = width;\r\n    this.rows = height;\r\n\r\n    this.tiles = new Array(width * height);\r\n\r\n    // build up tile representation\r\n    for (let y = 0; y < height; y++) {\r\n      for (let x = 0; x < width; x++) {\r\n        const tile = new IsometricTile(x, y, this.graphicsOffset, this);\r\n        this.tiles[x + y * width] = tile;\r\n        this.addChild(tile);\r\n        // TODO row/columns helpers\r\n      }\r\n    }\r\n  }\r\n\r\n  public update(): void {\r\n    if (this._collidersDirty) {\r\n      this.updateColliders();\r\n      this._collidersDirty = false;\r\n    }\r\n  }\r\n\r\n  private _collidersDirty = false;\r\n  public flagCollidersDirty() {\r\n    this._collidersDirty = true;\r\n  }\r\n\r\n  private _originalOffsets = new WeakMap<Collider, Vector>();\r\n  private _getOrSetColliderOriginalOffset(collider: Collider): Vector {\r\n    if (!this._originalOffsets.has(collider)) {\r\n      const originalOffset = collider.offset;\r\n      this._originalOffsets.set(collider, originalOffset);\r\n      return originalOffset;\r\n    } else {\r\n      return this._originalOffsets.get(collider);\r\n    }\r\n  }\r\n  public updateColliders() {\r\n    this._composite.clearColliders();\r\n    const pos = this.get(TransformComponent).pos;\r\n    for (const tile of this.tiles) {\r\n      if (tile.solid) {\r\n        for (const collider of tile.getColliders()) {\r\n          const originalOffset = this._getOrSetColliderOriginalOffset(collider);\r\n          collider.offset = this.tileToWorld(vec(tile.x, tile.y))\r\n            .sub(pos)\r\n            .add(originalOffset)\r\n            .sub(vec(this.tileWidth / 2, this.tileHeight)); // We need to unshift height based on drawing\r\n          collider.owner = this;\r\n          this._composite.addCollider(collider);\r\n        }\r\n      }\r\n    }\r\n    this.collider.update();\r\n  }\r\n\r\n  /**\r\n   * Convert world space coordinates to the tile x, y coordinate\r\n   * @param worldCoordinate\r\n   */\r\n  public worldToTile(worldCoordinate: Vector): Vector {\r\n    worldCoordinate = worldCoordinate.sub(this.transform.globalPos);\r\n\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // See https://clintbellanger.net/articles/isometric_math/ for formula\r\n    return vec(\r\n      ~~((worldCoordinate.x / halfTileWidth + (worldCoordinate.y / halfTileHeight)) / 2),\r\n      ~~((worldCoordinate.y / halfTileHeight - (worldCoordinate.x / halfTileWidth)) / 2));\r\n  }\r\n\r\n  /**\r\n   * Given a tile coordinate, return the top left corner in world space\r\n   * @param tileCoordinate\r\n   */\r\n  public tileToWorld(tileCoordinate: Vector): Vector {\r\n    const halfTileWidth = this.tileWidth / 2;\r\n    const halfTileHeight = this.tileHeight / 2;\r\n    // The x position shifts left with every y step\r\n    const xPos = (tileCoordinate.x - tileCoordinate.y) * halfTileWidth;\r\n    // The y position needs to go down with every x step\r\n    const yPos = (tileCoordinate.x + tileCoordinate.y) * halfTileHeight;\r\n    return vec(xPos, yPos).add(this.transform.pos);\r\n  }\r\n\r\n  /**\r\n   * Returns the [[IsometricTile]] by its x and y coordinates\r\n   */\r\n  public getTile(x: number, y: number): IsometricTile | null {\r\n    if (x < 0 || y < 0 || x >= this.columns || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.tiles[x + y * this.columns];\r\n  }\r\n\r\n  /**\r\n   * Returns the [[IsometricTile]] by testing a point in world coordinates,\r\n   * returns `null` if no Tile was found.\r\n   */\r\n  public getTileByPoint(point: Vector): IsometricTile | null {\r\n    const tileCoord = this.worldToTile(point);\r\n    const tile = this.getTile(tileCoord.x, tileCoord.y);\r\n    return tile;\r\n  }\r\n\r\n  private _getMaxZIndex(): number {\r\n    let maxZ = Number.NEGATIVE_INFINITY;\r\n    for (const tile of this.tiles) {\r\n      const currentZ = tile.get(TransformComponent).z;\r\n      if (currentZ > maxZ) {\r\n        maxZ =  currentZ;\r\n      }\r\n    }\r\n    return maxZ;\r\n  }\r\n\r\n  /**\r\n   * Debug draw for IsometricMap, called internally by excalibur when debug mode is toggled on\r\n   * @param gfx\r\n   */\r\n  public debug(gfx: ExcaliburGraphicsContext) {\r\n    gfx.save();\r\n    gfx.z = this._getMaxZIndex() + 0.5;\r\n    for (let y = 0; y < this.rows + 1; y++) {\r\n      const left = this.tileToWorld(vec(0, y));\r\n      const right = this.tileToWorld(vec(this.columns, y));\r\n      gfx.drawLine(left, right, Color.Red, 2);\r\n    }\r\n\r\n    for (let x = 0; x < this.columns + 1; x++) {\r\n      const top = this.tileToWorld(vec(x, 0));\r\n      const bottom = this.tileToWorld(vec(x, this.rows));\r\n      gfx.drawLine(top, bottom, Color.Red, 2);\r\n    }\r\n\r\n    for (const tile of this.tiles) {\r\n      gfx.drawCircle(this.tileToWorld(vec(tile.x, tile.y)), 3, Color.Yellow);\r\n    }\r\n    gfx.restore();\r\n  }\r\n}", "export * from './TileMap';\r\nexport * from './IsometricMap';\r\nexport * from './IsometricEntityComponent';\r\nexport * from './IsometricEntitySystem';", "import { Entity } from '../../EntityComponentSystem';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * Action that can represent a sequence of actions, this can be useful in conjunction with\r\n * [[ParallelActions]] to run multiple sequences in parallel.\r\n */\r\nexport class ActionSequence implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _sequenceContext: ActionContext;\r\n  private _sequenceBuilder: (actionContext: ActionContext) => any;\r\n  constructor(entity: Entity, actionBuilder: (actionContext: ActionContext) => any) {\r\n    this._sequenceBuilder = actionBuilder;\r\n    this._sequenceContext = new ActionContext(entity);\r\n    this._actionQueue = this._sequenceContext.getQueue();\r\n    this._sequenceBuilder(this._sequenceContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._actionQueue.isComplete();\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._stopped = false;\r\n    this._actionQueue.reset();\r\n  }\r\n\r\n  public clone(entity: Entity) {\r\n    return new ActionSequence(entity, this._sequenceBuilder);\r\n  }\r\n}", "import { Entity } from '../../EntityComponentSystem';\r\nimport { Action } from '../Action';\r\n\r\n\r\n/**\r\n * Action that can run multiple [[Action]]s or [[ActionSequence]]s at the same time\r\n */\r\nexport class ParallelActions implements Action {\r\n  private _actions: Action[];\r\n\r\n  constructor(parallelActions: Action[]) {\r\n    this._actions = parallelActions;\r\n  }\r\n\r\n  update(delta: number): void {\r\n    for (let i = 0; i < this._actions.length; i++) {\r\n      this._actions[i].update(delta);\r\n    }\r\n  }\r\n  isComplete(entity: Entity): boolean {\r\n    return this._actions.every(a => a.isComplete(entity));\r\n  }\r\n  reset(): void {\r\n    this._actions.forEach(a => a.reset());\r\n  }\r\n  stop(): void {\r\n    this._actions.forEach(a => a.stop());\r\n  }\r\n}", "export * from './ActionContext';\r\nexport * from './ActionQueue';\r\nexport * from './Actionable';\r\nexport * from './RotationType';\r\n\r\nexport * from './Action';\r\nexport * from './Action/ActionSequence';\r\nexport * from './Action/ParallelActions';\r\nexport * from './Action/Repeat';\r\nexport * from './Action/RepeatForever';\r\nexport * from './Action/Blink';\r\nexport * from './Action/Die';\r\nexport * from './Action/EaseTo';\r\nexport * from './Action/EaseBy';\r\nexport * from './Action/Fade';\r\nexport * from './Action/Follow';\r\nexport * from './Action/Meet';\r\nexport * from './Action/MoveBy';\r\nexport * from './Action/MoveTo';\r\nexport * from './Action/RotateBy';\r\nexport * from './Action/RotateTo';\r\nexport * from './Action/ScaleBy';\r\nexport * from './Action/ScaleTo';\r\nexport * from './Action/Delay';\r\n\r\nexport * from './ActionsComponent';\r\nexport * from './ActionsSystem';", "import { CollisionGroup } from './CollisionGroup';\r\n\r\n/**\r\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\r\n */\r\nexport class CollisionGroupManager {\r\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\r\n  private static _STARTING_BIT = 0b1 | 0;\r\n  private static _MAX_GROUPS = 32;\r\n  private static _CURRENT_GROUP = 1;\r\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\r\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\r\n\r\n  /**\r\n   * Create a new named collision group up to a max of 32.\r\n   * @param name Name for the collision group\r\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\r\n   */\r\n  public static create(name: string, mask?: number) {\r\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\r\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\r\n    }\r\n    if (this._GROUPS.get(name)) {\r\n      throw new Error(`Collision group ${name} already exists`);\r\n    }\r\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\r\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\r\n    this._CURRENT_GROUP++;\r\n    this._GROUPS.set(name, group);\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get all collision groups currently tracked by excalibur\r\n   */\r\n  public static get groups(): CollisionGroup[] {\r\n    return Array.from(this._GROUPS.values());\r\n  }\r\n\r\n  /**\r\n   * Get a collision group by it's name\r\n   * @param name\r\n   */\r\n  public static groupByName(name: string) {\r\n    return this._GROUPS.get(name);\r\n  }\r\n\r\n  /**\r\n   * Resets the managers internal group management state\r\n   */\r\n  public static reset() {\r\n    this._GROUPS = new Map<string, CollisionGroup>();\r\n    this._CURRENT_BIT = this._STARTING_BIT;\r\n    this._CURRENT_GROUP = 1;\r\n  }\r\n}\r\n", "export * from './BodyComponent';\r\nexport * from './ColliderComponent';\r\nexport * from './CollisionType';\r\n\r\nexport * from './Colliders/Collider';\r\nexport * from './BoundingBox';\r\n\r\nexport * from './Colliders/Shape';\r\nexport * from './Colliders/Collider';\r\nexport * from './Colliders/CompositeCollider';\r\nexport * from './Colliders/CircleCollider';\r\nexport * from './Colliders/EdgeCollider';\r\nexport * from './Colliders/PolygonCollider';\r\nexport * from './Colliders/CollisionJumpTable';\r\nexport * from './Colliders/ClosestLineJumpTable';\r\n\r\nexport * from './Group/CollisionGroup';\r\nexport * from './Group/CollisionGroupManager';\r\n\r\nexport * from './Detection/Pair';\r\nexport * from './Detection/CollisionContact';\r\nexport * from './Detection/CollisionProcessor';\r\nexport * from './Detection/DynamicTree';\r\nexport * from './Detection/DynamicTreeCollisionProcessor';\r\n\r\nexport * from './Solver/ArcadeSolver';\r\nexport * from './Solver/ContactConstraintPoint';\r\nexport * from './Solver/RealisticSolver';\r\nexport * from './Solver/Solver';\r\n\r\nexport * from './CollisionSystem';\r\nexport * from './MotionSystem';\r\n\r\nexport * from './Physics';\r\nexport * from './Side';\r\n", "import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\nimport { ExcaliburGraphicsContext } from '../Graphics';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(_engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface SceneActivationContext<TData = undefined> {\r\n  data?: TData;\r\n  previousScene: Scene;\r\n  nextScene: Scene;\r\n  engine: Engine;\r\n}\r\n\r\nexport interface CanActivate<TData = undefined> {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(context: SceneActivationContext<TData>): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(context: SceneActivationContext<never>): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(_ctx: ExcaliburGraphicsContext, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(_ctx: ExcaliburGraphicsContext, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n", "export * from './Clonable';\r\nexport * from './Audio';\r\nexport * from './AudioImplementation';\r\nexport * from './Evented';\r\nexport * from './Loadable';\r\nexport * from './LifecycleEvents';\r\nexport * from './PointerEventHandlers';\r\n", "export * from './Sound';\r\nexport * from './AudioContext';\r\nexport * from './WebAudioInstance';\r\n", "import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { Color } from '../Color';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\nimport { range } from '../Math/util';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n\r\n  private _stream: Stream = null;\r\n  private _gif: ParseGif = null;\r\n  private _textures: ImageSource[] = [];\r\n  private _animation: Animation = null;\r\n  private _transparentColor: Color = null;\r\n\r\n  public data: ImageSource[];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n    this._transparentColor = color;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new ParseGif(this._stream, this._transparentColor);\r\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\r\n\r\n    // Load all textures\r\n    await Promise.all(images.map(t => t.load()));\r\n    return this.data = this._textures = images;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite {\r\n    const sprite = this._textures[id].toSprite();\r\n    return sprite;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet {\r\n    const sprites: Sprite[] = this._textures.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   */\r\n  public toAnimation(durationPerFrameMs: number): Animation {\r\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\r\n    const length = spriteSheet.sprites.length;\r\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\r\n    return this._animation;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif.checkBytes;\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: any) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a;\r\n};\r\n\r\nexport class Stream {\r\n  data: any = null;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code;\r\n  let last;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\n// The actual parsing; returns an object with properties.\r\nexport class ParseGif {\r\n  private _st: Stream = null;\r\n  private _handler: any = {};\r\n  private _transparentColor: Color = null;\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  public globalColorTable: any[] = [];\r\n  public checkBytes: number[] = [];\r\n\r\n  constructor(stream: Stream, color: Color = Color.Magenta) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._transparentColor = color;\r\n    this.parseHeader();\r\n    this.parseBlock();\r\n  }\r\n\r\n  // LZW (GIF-specific)\r\n  parseColorTable = (entries: any) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const ct = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb: number[] = this._st.readBytes(3);\r\n      const rgba =\r\n        '#' +\r\n        rgb\r\n          .map((x: any) => {\r\n            const hex = x.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n          })\r\n          .join('');\r\n      ct.push(rgba);\r\n    }\r\n    return ct;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: any = {\r\n      sig: null,\r\n      ver: null,\r\n      width: null,\r\n      height: null,\r\n      colorRes: null,\r\n      globalColorTableSize: null,\r\n      gctFlag: null,\r\n      sorted: null,\r\n      globalColorTable: [],\r\n      bgColor: null,\r\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift();\r\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n    hdr.sorted = bits.shift();\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.bgColor = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTable = hdr.globalColorTable;\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: any) => {\r\n    const parseGCExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInput = bits.shift();\r\n      block.transparencyGiven = bits.shift();\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparencyIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte();\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: any) => {\r\n    const deinterlace = (pixels: any, width: any) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: any, fromRow: any) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift();\r\n    img.interlaced = bits.shift();\r\n    img.sorted = bits.shift();\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlock = () => {\r\n    const block = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlock();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame) => {\r\n    let count = 0;\r\n    const c = document.createElement('canvas');\r\n    c.id = count.toString();\r\n    c.width = frame.width;\r\n    c.height = frame.height;\r\n    count++;\r\n    const context = c.getContext('2d');\r\n    const pixSize = 1;\r\n    let y = 0;\r\n    let x = 0;\r\n    for (let i = 0; i < frame.pixels.length; i++) {\r\n      if (x % frame.width === 0) {\r\n        y++;\r\n        x = 0;\r\n      }\r\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\r\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\r\n      } else {\r\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\r\n      }\r\n\r\n      context.fillRect(x, y, pixSize, pixSize);\r\n      x++;\r\n    }\r\n    const img = new Image();\r\n    img.src = c.toDataURL();\r\n    this.images.push(img);\r\n  };\r\n}\r\n", "export * from './Resource';\r\nexport * from './Sound/Index';\r\nexport * from './Gif';\r\n", "export * from './Component';\r\nexport * from './Entity';\r\nexport * from './EntityManager';\r\nexport * from './Query';\r\nexport * from './QueryManager';\r\nexport * from './System';\r\nexport * from './SystemManager';\r\nexport * from './World';\r\n\r\nexport * from './Components/TransformComponent';\r\nexport * from './Components/MotionComponent';\r\n", "import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Graphic } from './Graphic';\r\n\r\nexport interface LineOptions {\r\n  start: Vector;\r\n  end: Vector;\r\n  color?: Color;\r\n  thickness?: number;\r\n}\r\nexport class Line extends Graphic {\r\n  readonly start: Vector;\r\n  readonly end: Vector;\r\n  color: Color = Color.Black;\r\n  thickness: number = 1;\r\n  constructor(options: LineOptions) {\r\n    super();\r\n    const { start, end, color, thickness } = options;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.color = color ?? this.color;\r\n    this.thickness = thickness ?? this.thickness;\r\n    const { width, height } = BoundingBox.fromPoints([start, end]);\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, _x: number, _y: number): void {\r\n    ctx.drawLine(this.start, this.end, this.color, this.thickness);\r\n  }\r\n\r\n  clone(): Line {\r\n    return new Line({\r\n      start: this.start,\r\n      end: this.end,\r\n      color: this.color,\r\n      thickness: this.thickness\r\n    });\r\n  }\r\n}", "import { ImageFiltering } from '.';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface PolygonOptions {\r\n  points: Vector[];\r\n}\r\n\r\n/**\r\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\r\n *\r\n * Polygons default to [[ImageFiltering.Blended]]\r\n */\r\nexport class Polygon extends Raster {\r\n  private _points: Vector[];\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n  public set points(points: Vector[]) {\r\n    this._points = points;\r\n    const min = this.minPoint;\r\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\r\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  public get minPoint() {\r\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\r\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\r\n    return vec(minX, minY);\r\n  }\r\n\r\n  constructor(options: RasterOptions & PolygonOptions) {\r\n    super(options);\r\n    this.points = options.points;\r\n    this.filtering = ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Polygon {\r\n    return new Polygon({\r\n      points: this.points.map((p) => p.clone()),\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.points && this.points.length) {\r\n      ctx.beginPath();\r\n      // Iterate through the supplied points and construct a 'polygon'\r\n      const min = this.minPoint.negate();\r\n      const firstPoint = this.points[0].add(min);\r\n      ctx.moveTo(firstPoint.x, firstPoint.y);\r\n      this.points.forEach((point) => {\r\n        ctx.lineTo(point.x + min.x, point.y + min.y);\r\n      });\r\n      ctx.lineTo(firstPoint.x, firstPoint.y);\r\n      ctx.closePath();\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n", "// Graphics\r\nexport * from './Graphic';\r\nexport * from './Sprite';\r\nexport * from './SpriteSheet';\r\nexport * from './GraphicsGroup';\r\nexport * from './ImageSource';\r\nexport * from './Animation';\r\nexport * from './Line';\r\n\r\n// Graphics ECS\r\nexport * from './GraphicsComponent';\r\nexport * from './DebugGraphicsComponent';\r\nexport * from './GraphicsSystem';\r\nexport * from './OffscreenSystem';\r\nexport * from './ParallaxComponent';\r\n\r\n// Raster graphics\r\nexport * from './Raster';\r\nexport * from './Circle';\r\nexport * from './Rectangle';\r\nexport * from './Polygon';\r\nexport * from './Text';\r\nexport * from './FontCommon';\r\nexport * from './Font';\r\nexport * from './SpriteFont';\r\nexport * from './Canvas';\r\n\r\nexport * from './Context/ExcaliburGraphicsContext';\r\nexport * from './Context/ExcaliburGraphicsContext2DCanvas';\r\nexport * from './Context/ExcaliburGraphicsContextWebGL';\r\n\r\nexport * from './Context/debug-text';\r\n\r\n// Post Processor\r\nexport * from './PostProcessor/PostProcessor';\r\nexport * from './PostProcessor/ScreenShader';\r\nexport * from './PostProcessor/ColorBlindnessMode';\r\nexport * from './PostProcessor/ColorBlindnessPostProcessor';\r\n\r\nexport * from './Context/texture-loader';\r\nexport * from './Filtering';\r\n\r\n\r\n// Rendering\r\nexport * from './Context/shader';\r\nexport * from './Context/vertex-buffer';\r\nexport * from './Context/vertex-layout';\r\nexport * from './Context/quad-index-buffer';\r\nexport * from './Context/webgl-adapter';\r\n\r\n// Util\r\n\r\nimport * as webgl from './Context/webgl-util';\r\nexport { webgl };", "/**\r\n * @module\r\n * Provides support for mice, keyboards, and controllers.\r\n */\r\n\r\n/**\r\n * @typedoc\r\n */\r\nexport * from './Gamepad';\r\nexport * from './PointerScope';\r\nexport * from './PointerType';\r\nexport * from './PointerSystem';\r\nexport * from './PointerComponent';\r\nexport * from './PointerEventReceiver';\r\nexport * from './Keyboard';\r\nexport * from './EngineInput';\r\nexport * from './CapturePointerConfig';\r\n\r\nexport * from './NativePointerButton';\r\nexport * from './PointerButton';\r\nexport * from './WheelDeltaMode';\r\nexport * from './PointerEvent';\r\nexport * from './WheelEvent';\r\n", "export * from './Util';\r\n\r\nexport * from './Log';\r\n\r\nexport * from './Observable';\r\n\r\nexport * from './EasingFunctions';\r\n\r\nimport * as drawUtil from './DrawUtil';\r\nexport { drawUtil as DrawUtil };\r\n", "import { Future } from './Future';\r\n\r\nclass AsyncWaitQueue<T> {\r\n  // Code from StephenCleary https://gist.github.com/StephenCleary/ba50b2da419c03b9cba1d20cb4654d5e\r\n  private _queue: Future<T>[] = [];\r\n\r\n  public get length(): number {\r\n    return this._queue.length;\r\n  }\r\n\r\n  public enqueue(): Promise<T> {\r\n    const future = new Future<T>();\r\n    this._queue.push(future);\r\n    return future.promise;\r\n  }\r\n\r\n  public dequeue(value: T): void {\r\n    const future = this._queue.shift();\r\n    future.resolve(value);\r\n  }\r\n}\r\n\r\n/**\r\n * Semaphore allows you to limit the amount of async calls happening between `enter()` and `exit()`\r\n *\r\n * This can be useful when limiting the number of http calls, browser api calls, etc either for performance or to work\r\n * around browser limitations like max Image.decode() calls in chromium being 256.\r\n */\r\nexport class Semaphore {\r\n  private _waitQueue = new AsyncWaitQueue();\r\n  constructor(private _count: number) { }\r\n\r\n  public get count() {\r\n    return this._count;\r\n  }\r\n\r\n  public get waiting() {\r\n    return this._waitQueue.length;\r\n  }\r\n\r\n  public async enter() {\r\n    if (this._count !== 0) {\r\n      this._count--;\r\n      return Promise.resolve();\r\n    }\r\n    return this._waitQueue.enqueue();\r\n  }\r\n\r\n  public exit(count: number = 1) {\r\n    if (count === 0) {\r\n      return;\r\n    }\r\n    while (count !== 0 && this._waitQueue.length !== 0) {\r\n      this._waitQueue.dequeue(null);\r\n      count--;\r\n    }\r\n    this._count += count;\r\n  }\r\n}", "/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './Screen';\r\nexport { Actor, ActorArgs } from './Actor';\r\nexport * from './Math/Index';\r\nexport * from './Camera';\r\nexport * from './Class';\r\nexport * from './Configurable';\r\nexport * from './Debug/index';\r\nexport * from './EventDispatcher';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Loader';\r\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\r\nexport * from './Collision/Physics';\r\nexport * from './Scene';\r\n\r\nexport * from './TileMap/index';\r\n\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/Index';\r\nexport * from './Collision/Index';\r\n\r\nexport * from './Interfaces/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\n// ex.Input namespace\r\nimport * as input from './Input/Index';\r\nexport { input as Input };\r\nexport { PointerComponent } from './Input/Index';\r\nexport { PointerSystem } from './Input/PointerSystem';\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/Pool';\r\nexport * from './Util/Fps';\r\nexport * from './Util/Clock';\r\nexport * from './Util/WebAudio';\r\nexport * from './Util/Toaster';\r\nexport * from './Util/StateMachine';\r\nexport * from './Util/Future';\r\nexport * from './Util/Semaphore';\r\n\r\n// ex.Deprecated\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n", "import {Actor, CollisionType, Color, Engine, Polygon, PolygonCollider, vec} from \"excalibur\";\n\nexport class Turtle extends Actor {\n    // Rotation speed in radians per second.\n    private rotationSpeed: number = 1.0;\n\n    constructor(size: number) {\n        const halfSize = size / 2;\n        const points = [\n            vec(halfSize, halfSize),\n            vec(-halfSize, halfSize),\n            vec(0, -halfSize),\n        ];\n        super({\n            x: 0,\n            y: 0,\n            color: Color.Chartreuse,\n            collider: new PolygonCollider({\n                points: points,\n            }),\n            collisionType: CollisionType.Active,\n        });\n        const shape = new Polygon({\n            color: Color.Red,\n            points: points,\n        });\n        this.graphics.use(shape);\n    }\n\n    onInitialize(engine: Engine) {\n        super.onInitialize(engine);\n        this.pos.x = engine.halfDrawWidth;\n        this.pos.y = engine.halfDrawHeight;\n    }\n\n    get rotationInDegrees(): number {\n        return this.rotation / Math.PI * 180;\n    }\n\n    async rotateBy(deltaDegrees: number): Promise<void> {\n        return new Promise<void>((resolve, _reject) => {\n            const deltaRadians = deltaDegrees / 180 * Math.PI;\n            this.actions.rotateBy(deltaRadians, this.rotationSpeed);\n\n            const seconds = Math.abs(deltaRadians) * this.rotationSpeed;\n            setTimeout(() => {\n                resolve();\n            }, seconds*1000);\n        });\n    }\n\n    async thrust(force: number, time: number): Promise<void> {\n        return new Promise<void>((resolve, _reject) => {\n            const delta = vec(0, -force).rotate(this.rotation);\n            this.acc.addEqual(delta);\n            setTimeout(() => {\n                this.acc.subEqual(delta);\n                resolve();\n            }, time*1000);\n        });\n    }\n}", "import {Color, ExcaliburGraphicsContext, PostUpdateEvent, Scene, Vector,} from \"excalibur\";\n\nimport {Turtle} from \"./turtle\";\n\nexport class Drawing extends Scene {\n    private points: Array<Vector|Color> = [];\n\n    private prevPoint?: Vector;\n\n    constructor(turtle: Turtle) {\n        super();\n\n        this.add(turtle);\n\n        turtle.on('postupdate', (evt: PostUpdateEvent<Turtle>) => {\n            const pos = evt.target.pos.clone();\n\n            if (this.points.length == 0) {\n                this.points.push(pos);\n                this.prevPoint = pos;\n                return;\n            }\n\n            const dist = pos.distance(this.prevPoint);\n            if (dist > 3) {\n                this.points.push(pos);\n                return;\n            }\n        });\n    }\n\n    setLineColor(color: Color) {\n        this.points.push(color);\n    }\n\n    onPostDraw(ctx: ExcaliburGraphicsContext, _delta: number) {\n        super.onPostDraw(ctx, _delta);\n\n        ctx.save();\n        ctx.z = -1;\n\n        let color = Color.DarkGray;\n        for (let i = 0; i < this.points.length - 1; i++) {\n            const item = this.points[i];\n            if (item instanceof Color) {\n                color = item;\n                continue;\n            }\n\n            const start = this.points[i] as Vector;\n            const end = this.points[i+1] as Vector;\n            ctx.drawLine(start, end, color, 1);\n        }\n\n        ctx.restore();\n    }\n}", "import {any, lexerInput, mret, parse, Token} from \"parzec\";\n\nimport {eofToken, lnLexer, LNToken} from \"./lexer\";\nimport {Instruction} from \"../ast/Instruction\";\nimport {nameParser} from \"./name\";\nimport {newlineParser} from \"./newline\";\nimport {Program} from \"../ast/Program\";\nimport {whitespaceParser} from \"./whitespace\";\nimport {enumParser} from \"./enum\";\nimport {numberParser} from \"./number\";\nimport {Num} from \"../ast/Num\";\nimport {Name} from \"../ast/Name\";\nimport {Enum} from \"../ast/Enum\";\n\ntype Element = Enum | Name | Num;\n\nconst instruction = nameParser\n    .surroundedBy(whitespaceParser.zeroOrMore())\n    .bind(c => {\n        return any<Element, Token<LNToken>>(\n            enumParser,\n            nameParser,\n            numberParser,\n        )\n            .surroundedBy(whitespaceParser.zeroOrMore())\n            .zeroOrMore()\n            .bind(a => {\n                return mret(new Instruction(c, a));\n            });\n    });\n\nconst root = instruction\n    .oneOrMoreSeparatedBy(newlineParser)\n    .map(i => new Program(i));\n\nexport function parseProgram(program: string): Program {\n    const tokens = lexerInput(program, lnLexer, eofToken);\n    const ast = parse(root, tokens);\n    console.log(ast);\n    return ast;\n}\n", "import {Lexer, Token} from \"parzec\";\nimport {nameExp} from \"./name\";\nimport {whitespaceExp} from \"./whitespace\";\nimport {newlineExp} from \"./newline\";\nimport {enumExp} from \"./enum\";\nimport {numberExp} from \"./number\";\n\nexport enum LNToken {\n    Whitespace,\n    Newline,\n    Name,\n    Number,\n    Enum,\n    EOF,\n}\n\nexport const eofToken = new Token(LNToken.EOF, \"<end of input>\");\n\nexport const lnLexer = new Lexer<LNToken>(\n    [whitespaceExp, LNToken.Whitespace],\n    [newlineExp, LNToken.Newline],\n    [nameExp, LNToken.Name],\n    [numberExp, LNToken.Number],\n    [enumExp, LNToken.Enum],\n);\n", "import {terminal} from \"parzec\";\n\nimport {LNToken} from \"./lexer\";\nimport {Name} from \"../ast/Name\";\n\nexport const nameExp = /[a-z][a-z0-9]*/;\n\nexport const nameParser = terminal(LNToken.Name, \"<command>\")\n    .map(t => new Name(t.text));\n", "export class Name {\n    readonly value: string;\n\n    constructor(value: string) {\n        this.value = value;\n    }\n}\n", "import {terminal} from \"parzec\";\n\nimport {LNToken} from \"./lexer\";\n\nexport const whitespaceExp = /[\\t ]/;\n\nexport const whitespaceParser = terminal(LNToken.Whitespace, \"<whitespace>\");\n", "import {terminal} from \"parzec\";\n\nimport {LNToken} from \"./lexer\";\n\nexport const newlineExp = /\\r?\\n/;\n\nexport const newlineParser = terminal(LNToken.Newline, \"<newline>\")\n    .oneOrMore();\n", "import {terminal} from \"parzec\";\n\nimport {LNToken} from \"./lexer\";\nimport {Enum} from \"../ast/Enum\";\n\nexport const enumExp = /[A-Z][A-Za-z0-9]*/;\n\nexport const enumParser = terminal(LNToken.Enum, \"<enum>\")\n    .map(t => new Enum(t.text));\n", "export class Enum {\n    readonly value: string\n\n    constructor(value: string) {\n        this.value = value;\n    }\n}\n", "import {terminal} from \"parzec\";\n\nimport {LNToken} from \"./lexer\";\nimport {Num} from \"../ast/Num\";\n\nexport const numberExp = /([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+|[0-9]+)/;\n\nexport const numberParser = terminal(LNToken.Number, \"<number>\")\n    .map(t => new Num(parseFloat(t.text)));\n", "export class Num {\n    readonly value: number;\n\n    constructor(value: number) {\n        this.value = value;\n    }\n}\n", "import {Enum} from \"./Enum\";\nimport {Name} from \"./Name\";\nimport {Num} from \"./Num\";\n\nexport class Instruction {\n    readonly name: Name\n    readonly args: Array<Enum|Name|Num>\n\n    constructor(name: Name, args: Array<Enum|Name|Num>) {\n        this.name = name;\n        this.args = args;\n    }\n}\n", "import {Instruction} from \"./Instruction\";\n\nexport class Program {\n    readonly instructions: Array<Instruction>\n\n    constructor(commands: Array<Instruction>) {\n        this.instructions = commands;\n    }\n}\n", "import {Color} from \"excalibur\";\n\nexport class Scope {\n    private readonly enums: Record<string, any> = {\n        // Colors\n        'Black': Color.Black,\n        'White': Color.White,\n        'Red': Color.Red,\n        'Green': Color.Green,\n        'Blue': Color.Blue,\n        'Orange': Color.Orange,\n        'Cyan': Color.Cyan,\n        'Azure': Color.Azure,\n        'Violet': Color.Violet,\n        'Yellow': Color.Yellow,\n\n        // Direction\n        'Left': -1,\n        'Right': 1,\n\n        // Heading\n        'N': 0.0,\n        'NE': 45.0,\n        'E': 90.0,\n        'SE': 135.0,\n        'S': 180.0,\n        'SW': 225.0,\n        'W': 270.0,\n        'NW': 315.0,\n    };\n\n    lookupEnum(key: string): any {\n        return this.enums[key];\n    }\n}\n", "import {Turtle} from \"../../game/turtle\";\nimport {Program} from \"../ast/Program\";\nimport {Instruction} from \"../ast/Instruction\";\nimport {Drawing} from \"../../game/drawing\";\nimport {parseProgram} from \"../parser/parser\";\nimport {Scope} from \"./Scope\";\nimport {Enum} from \"../ast/Enum\";\nimport {Color} from \"excalibur\";\nimport {Num} from \"../ast/Num\";\n\nexport class Interpreter {\n    private readonly drawing: Drawing;\n    private readonly turtle: Turtle;\n    private readonly scope: Scope = new Scope();\n\n    private tasks: Array<Promise<void>> = [];\n\n    constructor(turtle: Turtle, drawing: Drawing) {\n        this.turtle = turtle;\n        this.drawing = drawing;\n    }\n\n    getDrawing(): Drawing {\n        return this.drawing;\n    }\n\n    async run(program: string) {\n        const programTree = parseProgram(program);\n        await this.execute(programTree);\n    }\n\n    async execute(program: Program) {\n        for (const instruction of program.instructions) {\n            await this.executeInstruction(instruction);\n        }\n    }\n\n    async executeInstruction(instruction: Instruction) {\n        switch (instruction.name.value) {\n            case \"color\":\n                this.executeColor(instruction);\n                break;\n            case \"head\":\n                await this.executeHead(instruction);\n                break;\n            case \"sleep\":\n                await this.executeSleep(instruction);\n                break;\n            case \"thrust\":\n                await this.executeThrust(instruction);\n                break;\n            case \"turn\":\n                await this.executeTurn(instruction);\n                break;\n            case \"wait\":\n                await this.executeWait(instruction);\n                break;\n            default:\n                throw new Error(`instruction ${instruction.name.value} not found`);\n        }\n    }\n\n    executeColor(instruction: Instruction) {\n        const colorArg = instruction.args[0] as Enum;\n        const color = this.scope.lookupEnum(colorArg.value) as Color;\n\n        console.log(`color = ${color} colorArg.value = ${colorArg.value}`);\n\n        this.drawing.setLineColor(color);\n    }\n\n    async executeHead(instruction: Instruction) {\n        const deltaArg = instruction.args[0] as Num;\n        const delta = deltaArg.value - this.turtle.rotationInDegrees;\n\n        await this.turtle.rotateBy(delta);\n    }\n\n    async executeSleep(instruction: Instruction) {\n        const secondsArg = instruction.args[0] as Num;\n        const seconds = secondsArg.value;\n\n        await new Promise((resolve, _reject) => {\n            setTimeout(() => {\n                resolve();\n            }, seconds * 1000);\n        });\n    }\n\n    async executeThrust(instruction: Instruction) {\n        const forceArg = instruction.args[0] as Num;\n        const durationArg = instruction.args[1] as Num;\n\n        const force = forceArg.value;\n        const duration = durationArg.value;\n\n        await this.turtle.thrust(force, duration);\n    }\n\n    async executeTurn(instruction: Instruction) {\n        const directionArg = instruction.args[0] as Enum;\n        const direction = this.scope.lookupEnum(directionArg.value) as number;\n\n        const deltaArg = instruction.args[1] as Num;\n        const delta = deltaArg.value;\n\n        await this.turtle.rotateBy(direction * delta);\n    }\n\n    // TODO: This doesn't do anything, but we might want it later to allow async ops\n    async executeWait(instruction: Instruction) {\n        await Promise.all(this.tasks);\n        this.tasks = [];\n    }\n}\n\n// TODO: Unsure if this will work\nfunction verifyArg<T>(arg: any): T {\n    if (arg instanceof T) {\n        return arg as T;\n    }\n\n    throw Error(`expected ${T} but found ${arg}`);\n}\n", "import {Engine} from \"excalibur\";\nimport {Turtle} from \"./turtle\";\nimport {Drawing} from \"./drawing\";\nimport {Interpreter} from \"../language/execution/Interpreter\";\n\nexport class Game {\n    engine: Engine;\n    turtle: Turtle;\n    drawing: Drawing;\n    interpreter: Interpreter;\n    code: string;\n\n    constructor() {\n        this.engine = new Engine({\n            width: 640,\n            height: 480,\n            canvasElementId: \"game\",\n        });\n\n        this.setup();\n    }\n\n    changeCode(code: string) {\n        if (this.engine.isRunning()) {\n            return;\n        }\n        this.code = code.trim();\n    }\n\n    reset() {\n        this.engine.stop();\n        this.engine.removeScene(this.drawing);\n        this.drawing.remove(this.turtle);\n\n        this.setup();\n    }\n\n    run() {\n        this.engine.start().then(() => {\n            this.interpreter.run(this.code).then(() => {\n                this.engine.stop();\n            });\n        });\n    }\n\n    setup() {\n        this.turtle = new Turtle(25);\n        this.drawing = new Drawing(this.turtle);\n\n        this.engine.addScene('drawing', this.drawing);\n        this.engine.goToScene('drawing');\n\n        this.interpreter = new Interpreter(this.turtle, this.drawing);\n\n        this.engine.start().then(() => {\n            setTimeout(() => {\n                this.engine.stop();\n            }, 100);\n        });\n    }\n}", "import {Game} from \"./game/game\";\n\nconst game = new Game();\n\nconst codeArea = document.getElementById(\"code-box\") as HTMLTextAreaElement;\ncodeArea.addEventListener('keyup', (e) => {\n    game.changeCode(codeArea.value);\n});\n\nconst runButton = document.getElementById(\"run-btn\") as HTMLButtonElement;\nrunButton.addEventListener('click', (e) => {\n    game.changeCode(codeArea.value);\n    game.run();\n});\n"],
  "mappings": "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",
  "names": ["require_ref", "__commonJSMin", "exports", "Ref", "value", "require_error", "__commonJSMin", "exports", "ErrorSource", "ParseError", "source", "position", "found", "expected", "s", "require_input", "__commonJSMin", "exports", "ArrayInput", "array", "eof", "pos", "arrayInput", "require_result", "__commonJSMin", "exports", "joinExpected", "result", "other", "expectedAsCsv", "s", "succeeded", "pos", "res", "failed", "fnd", "exp", "require_utils", "__commonJSMin", "exports", "initObject", "members", "res", "i", "m", "v", "escapeWhitespace", "text", "require_lexer", "__commonJSMin", "exports", "utils", "err", "Token", "token", "text", "Lexer", "tokens", "t", "input", "pos", "i", "matcher", "match", "LexerInput", "lexer", "eof", "lexerInput", "require_parser", "__commonJSMin", "exports", "pr", "utils", "err", "Parser", "parse", "binder", "input", "pos", "res1", "res2", "other", "_", "mapper", "x", "mret", "defaultValue", "predicate", "fail", "list", "res", "min", "max", "cnt", "found", "expected", "resParser", "ruleName", "text", "tabs", "tryParse", "parser", "value", "satisfy", "item", "notSatisfy", "any", "parsers", "i", "r", "peek", "next", "choose", "selector", "position", "getState", "setState", "newValue", "mutateState", "mutate", "checkState", "cleanupState", "cleanup", "forwardRef", "anything", "is", "token", "t", "terminal", "tok", "name", "require_arrayparsers", "__commonJSMin", "exports", "par", "separator", "x", "xs", "after", "p", "_", "surround", "o", "c", "open", "close", "operation", "f", "y", "fys", "z", "value", "operators", "ops", "require_lib", "__commonJSMin", "exports", "__createBinding", "o", "m", "k", "k2", "__exportStar", "p", "__webpack_require__", "entryUnbind", "module", "path", "isCallable", "tryToString", "$TypeError", "argument", "isObject", "$String", "toIndexedObject", "toAbsoluteIndex", "lengthOfArrayLike", "createMethod", "IS_INCLUDES", "$this", "el", "fromIndex", "length", "index", "value", "fails", "METHOD_NAME", "method", "createProperty", "$Array", "max", "O", "start", "end", "k", "fin", "result", "n", "arraySlice", "floor", "mergeSort", "array", "comparefn", "middle", "insertionSort", "merge", "i", "element", "j", "left", "right", "llength", "rlength", "lindex", "rindex", "uncurryThis", "toString", "stringSlice", "it", "TO_STRING_TAG_SUPPORT", "classofRaw", "wellKnownSymbol", "TO_STRING_TAG", "$Object", "CORRECT_ARGUMENTS", "tryGet", "key", "tag", "hasOwn", "ownKeys", "getOwnPropertyDescriptorModule", "definePropertyModule", "target", "source", "exceptions", "keys", "defineProperty", "getOwnPropertyDescriptor", "DESCRIPTORS", "createPropertyDescriptor", "object", "bitmap", "toPropertyKey", "propertyKey", "makeBuiltIn", "defineGlobalProperty", "options", "simple", "name", "global", "P", "document", "EXISTS", "userAgent", "firefox", "UA", "getBuiltIn", "process", "Deno", "versions", "v8", "match", "version", "webkit", "CONSTRUCTOR", "METHOD", "createNonEnumerableProperty", "defineBuiltIn", "copyConstructorProperties", "isForced", "TARGET", "GLOBAL", "STATIC", "FORCED", "targetProperty", "sourceProperty", "descriptor", "exec", "test", "NATIVE_BIND", "call", "FunctionPrototype", "getDescriptor", "PROPER", "CONFIGURABLE", "bind", "fn", "aFunction", "namespace", "aCallable", "V", "func", "check", "toObject", "hasOwnProperty", "createElement", "classof", "split", "store", "functionToString", "NATIVE_WEAK_MAP", "shared", "sharedKey", "hiddenKeys", "OBJECT_ALREADY_INITIALIZED", "TypeError", "WeakMap", "set", "get", "has", "enforce", "getterFor", "TYPE", "state", "wmget", "wmhas", "wmset", "metadata", "STATE", "replacement", "feature", "detection", "data", "normalize", "POLYFILL", "NATIVE", "string", "isPrototypeOf", "USE_SYMBOL_AS_UID", "$Symbol", "toLength", "obj", "CONFIGURABLE_FUNCTION_NAME", "inspectSource", "InternalStateModule", "enforceInternalState", "getInternalState", "CONFIGURABLE_LENGTH", "TEMPLATE", "ceil", "x", "V8_VERSION", "symbol", "IE8_DOM_DEFINE", "V8_PROTOTYPE_DEFINE_BUG", "anObject", "$defineProperty", "$getOwnPropertyDescriptor", "ENUMERABLE", "WRITABLE", "exports", "Attributes", "current", "propertyIsEnumerableModule", "internalObjectKeys", "enumBugKeys", "indexOf", "push", "names", "$propertyIsEnumerable", "NASHORN_BUG", "input", "pref", "val", "getOwnPropertyNamesModule", "getOwnPropertySymbolsModule", "concat", "getOwnPropertySymbols", "uid", "SHARED", "IS_PURE", "toIntegerOrInfinity", "min", "integer", "IndexedObject", "requireObjectCoercible", "trunc", "number", "isSymbol", "getMethod", "ordinaryToPrimitive", "TO_PRIMITIVE", "exoticToPrim", "toPrimitive", "id", "postfix", "NATIVE_SYMBOL", "WellKnownSymbolsStore", "Symbol", "symbolFor", "createWellKnownSymbol", "description", "$", "deletePropertyOrThrow", "internalSort", "arrayMethodIsStrict", "FF", "IE_OR_EDGE", "V8", "WEBKIT", "un$Sort", "FAILS_ON_UNDEFINED", "FAILS_ON_NULL", "STRICT_METHOD", "STABLE_SORT", "code", "chr", "a", "b", "getSortCompare", "y", "items", "arrayLength", "itemsLength", "nativeKeys", "FAILS_ON_PRIMITIVES", "___CSS_LOADER_EXPORT___", "_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default", "_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default", "__WEBPACK_DEFAULT_EXPORT__", "cssWithMappingToString", "list", "item", "content", "needLayer", "modules", "media", "dedupe", "supports", "layer", "alreadyImportedModules", "_k", "cssMapping", "base64", "sourceMapping", "sourceURLs", "__webpack_module_cache__", "moduleId", "cachedModule", "__webpack_modules__", "getter", "definition", "prop", "polyfill", "callback", "replaceMe", "arrayBuffer", "resolve", "reject", "Flags", "flagName", "createId", "type", "BITMASK32", "Random", "seed", "mag01", "likelihood", "numPicks", "allowDuplicates", "currentPick", "tempArray", "swap", "randomIndex", "TwoPI", "frac", "sign", "clamp", "canonicalizeAngle", "angle", "tmpAngle", "toDegrees", "radians", "toRadians", "degrees", "range", "from", "to", "_x", "randomInRange", "random", "randomIntInRange", "Vector", "vec", "vec1", "vec2", "vector", "tolerance", "v", "deltaX", "deltaY", "magnitude", "size", "newSize", "newLength", "d", "sizeOrScale", "dest", "num", "anchor", "sinAngle", "cosAngle", "fixed", "LogLevel", "Logger", "ConsoleAppender", "appender", "level", "args", "len", "consoleArgs", "ScreenAppender", "width", "height", "message", "pos", "opacity", "Color", "r", "g", "rgbaRegEx", "hex", "hexRegEx", "h", "s", "l", "HSLColor", "factor", "temp", "color", "newR", "newG", "newB", "newA", "color1", "color2", "format", "c", "p", "q", "t", "Side", "getOpposite", "side", "fromDirection", "direction", "directions", "directionEnum", "maxIndex", "BoundingBox", "leftOrOptions", "top", "bottom", "intersection", "points", "minX", "minY", "maxX", "maxY", "point", "scale", "shifted", "matrix", "xa1", "xa2", "xb1", "xb2", "ya1", "ya2", "yb1", "yb2", "matrixPos", "wx", "wy", "results", "ray", "farClipDistance", "tmin", "tmax", "xinv", "yinv", "tx1", "tx2", "ty1", "ty2", "other", "epsilon", "e", "totalBoundingBox", "overlapX", "overlapY", "bb", "intersect", "ex", "Future", "error", "getPosition", "oLeft", "oTop", "calcOffsetLeft", "parent", "calcOffsetTop", "addItemToArray", "removeItemFromArray", "contains", "fail", "delay", "milliseconds", "clock", "future", "_a", "MatrixLocations", "Matrix", "near", "far", "mat", "sx", "sy", "angleRadians", "vectorOrMatrix", "resultX", "resultY", "a11", "a21", "a31", "a41", "a12", "a22", "a32", "a42", "a13", "a23", "a33", "a43", "a14", "a24", "a34", "a44", "b11", "b21", "b31", "b41", "b12", "b22", "b32", "b42", "b13", "b23", "b33", "b43", "b14", "b24", "b34", "b44", "z", "w", "sine", "cosine", "currentScale", "xscale", "yscale", "inverseDet", "m", "tx", "ty", "AffineMatrix", "TransformStack", "StateStack", "EventTypes", "GameEvent", "KillEvent", "PreKillEvent", "PostKillEvent", "GameStartEvent", "GameStopEvent", "PreDrawEvent", "ctx", "delta", "PostDrawEvent", "PreDebugDrawEvent", "PostDebugDrawEvent", "PreUpdateEvent", "engine", "PostUpdateEvent", "PreFrameEvent", "prevStats", "PostFrameEvent", "stats", "GamepadConnectEvent", "gamepad", "GamepadDisconnectEvent", "GamepadButtonEvent", "button", "GamepadAxisEvent", "axis", "VisibleEvent", "HiddenEvent", "PreCollisionEvent", "actor", "PostCollisionEvent", "ContactStartEvent", "contact", "ContactEndEvent", "CollisionPreSolveEvent", "CollisionPostSolveEvent", "CollisionStartEvent", "CollisionEndEvent", "InitializeEvent", "ActivateEvent", "context", "DeactivateEvent", "ExitViewPortEvent", "EnterViewPortEvent", "EnterTriggerEvent", "ExitTriggerEvent", "EventDispatcher", "eventHandler", "eventName", "event", "handler", "eventHandlers", "metaHandler", "ev", "eventDispatcher", "Resource", "responseType", "bustCache", "uri", "request", "watch", "change", "watchAny", "Graphic", "_b", "_c", "_d", "_e", "_f", "scaleDirX", "scaleDirY", "origin", "Sprite", "image", "newWidth", "newHeight", "nativeWidth", "nativeHeight", "ImageFiltering", "TextureLoader", "filtering", "forceUpdate", "gl", "tex", "filterMode", "originalSrc", "ImageSource", "url", "blob", "loadedFuture", "SpriteSheet", "sprites", "rows", "columns", "spriteIndex", "sourceView", "cols", "spriteWidth", "spriteHeight", "originOffset", "margin", "offsetDefaults", "marginDefaults", "SpriteFont", "alphabet", "spriteSheet", "caseInsensitive", "spacing", "shadow", "text", "textToRender", "letterIndex", "letter", "letterSprite", "lines", "maxWidthLine", "sprite", "xCursor", "yCursor", "line", "_color", "bounds", "debug_font", "DebugText", "RenderSource", "_gl", "_texture", "RenderTarget", "attachmentPoint", "ExcaliburWebGLContextAccessor", "line_vertex", "line_fragment", "getGlTypeSizeBytes", "getAttributeComponentSize", "getAttributePointerType", "Shader", "vertexSource", "fragmentSource", "vertexShader", "fragmentShader", "attributes", "attribute", "uniforms", "uniform", "uniformCount", "uniformLocation", "attributeCount", "attributeLocation", "slotNumber", "texture", "uniformType", "location", "program", "typeName", "shader", "errorInfo", "errorLineStart", "errorLineEnd", "_", "error2", "VertexBuffer", "count", "VertexLayout", "vertexBuffer", "shaderAttributes", "attrib", "componentsPerVertex", "vertAttribute", "typeSize", "uploadBuffer", "offset", "vert", "GraphicsDiagnostics", "LineRenderer", "transform", "finalStart", "finalEnd", "point_vertex", "point_fragment", "PointRenderer", "snapToPixel", "finalPoint", "pixelSnapEpsilon", "screen_vertex", "screen_fragment", "ScreenPassPainter", "postprocessor", "QuadIndexBuffer", "numberOfQuads", "useUint16", "totalVertices", "maxUint16Index", "currentQuad", "image_renderer_frag", "image_renderer_vert", "ImageRenderer", "transformedFrag", "maxTextures", "newSource", "texturePickerBuilder", "swidth", "sheight", "dx", "dy", "dwidth", "dheight", "view", "sw", "sh", "topLeft", "topRight", "bottomLeft", "bottomRight", "tint", "textureId", "imageWidth", "imageHeight", "uvx0", "uvy0", "uvx1", "uvy1", "rectangle_renderer_frag", "rectangle_renderer_vert", "RectangleRenderer", "thickness", "dir", "normal", "halfThick", "startTop", "startBottom", "endTop", "endBottom", "stroke", "strokeThickness", "circle_renderer_frag", "circle_renderer_vert", "CircleRenderer", "radius", "Pool", "builder", "recycler", "maxObjects", "objects", "poolIndex", "DrawCall", "ExcaliburGraphicsContextWebGLDebug", "_webglCtx", "rectOptions", "lineOptions", "pointOptions", "ExcaliburGraphicsContextWebGL", "instance", "canvasElement", "enableTransparency", "smoothing", "backgroundColor", "useDrawSorting", "dim", "supported", "renderer", "rendererName", "drawCall", "resolution", "originalSort", "firstIndex", "dc", "zIndex", "originalSortOrder", "priority", "oldTransform", "oldState", "currentRendererName", "currentRenderer", "ExcaliburGraphicsContext2DCanvas_pixelSnapEpsilon", "ExcaliburGraphicsContext2DCanvasDebug", "_ex", "ExcaliburGraphicsContext2DCanvas", "_resolution", "_m", "_postprocessor", "DisplayMode", "Resolution", "Screen", "viewport", "camera", "isSmooth", "elementId", "maybeElement", "newX", "newY", "screenHeight", "screenMarginY", "screenWidth", "screenMarginX", "screen", "aspect", "adjustedWidth", "adjustedHeight", "vw", "vh", "clip", "scaleX", "scaleY", "maxScaleFactor", "zoomedWidth", "zoomedHeight", "AudioContextFactory", "isLegacyWebAudioSource", "WebAudio", "unlockTimeoutTimer", "audioContext", "buffer", "ended", "Class", "eventObject", "x1", "y1", "x2", "y2", "cap", "roundRect", "fill", "br", "defaultRadius", "circle", "Loader_logo", "Raster", "_g", "_h", "bitmapWidth", "_j", "bitmapHeight", "maybeCtx", "Canvas", "_options", "ExResponse", "StateMachine", "machineDescription", "machine", "stateName", "transitionState", "eventData", "potentialNewState", "elapsedMs", "saveKey", "WebAudioInstance", "_src", "position", "duration", "playStarted", "pausedAt", "startedAt", "playbackRate", "MediaEvent", "_name", "_value", "_val", "_actor", "NativeSoundEvent", "track", "NativeSoundProcessedEvent", "_processedData", "canPlayFile", "file", "filetype", "Sound", "paths", "arraybuffer", "audiobuffer", "volume", "trackId", "resumed", "complete", "newTrack", "Loader", "loadables", "Loader_0", "buttonElement", "existingRoot", "loadable", "resizeHandler", "evt", "startButtonHandler", "_engine", "_delta", "resource", "buttonWidth", "buttonHeight", "canvasHeight", "canvasWidth", "logoY", "logoX", "oldAntialias", "loadingX", "loadingY", "progress", "progressWidth", "REPORTED_FEATURES", "Detector", "elem", "xhr", "style", "msg", "failedCritical", "warning", "CollisionType", "maxMessages", "obsoleteMessage", "resetObsoleteCounter", "logMessage", "suppressObsoleteMessages", "obsolete", "property", "DecoratedClass", "CollisionResolutionStrategy", "BroadphaseStrategy", "Integrator", "Physics", "__decorate", "CoordPlane", "VectorView", "WatchVector", "original", "Transform", "localPos", "rotation", "canonRotation", "inverseRotation", "inverseScale", "globalScaleX", "globalScaleY", "hasClone", "Component", "newComponent", "TagComponent", "Observable", "observer", "observersLength", "subscriptionsLength", "TransformComponent", "child", "childTxComponent", "owner", "_previousOwner", "oldz", "MotionComponent", "CollisionGroup", "category", "mask", "collisionGroups", "combinedName", "combinedCategory", "combinedMask", "Pair", "colliderA", "colliderB", "bodyA", "BodyComponent", "bodyB", "collider", "idA", "idB", "Projection", "projection", "TreeNode", "DynamicTree", "worldBounds", "leaf", "leafAABB", "currentRoot", "area", "combinedArea", "cost", "inheritanceCost", "leftCost", "leftCombined", "newArea", "oldArea", "rightCost", "rightCombined", "oldParent", "newParent", "currentNode", "grandParent", "sibling", "node", "body", "multdx", "multdy", "f", "balance", "helper", "Ray", "numerator", "divisor", "u", "time", "DynamicTreeCollisionProcessor", "CompositeCollider", "colliders", "hash", "targets", "seconds", "potentialColliders", "pair", "updateDistance", "minDimension", "updateVec", "centerPoint", "furthestPoint", "minCollider", "minTranslate", "hitPoint", "translate", "shift", "pairs", "contacts", "newContacts", "updated", "Collider", "acc", "axes", "furthestPoints", "bestPoint", "maxDistance", "distance", "mass", "totalInertia", "otherColliders", "potentialCollider", "maybeLine", "minLength", "minLine", "minPoint", "minDistance", "projs", "proj", "newProjection", "LineSegment", "begin", "sideVector", "clipTime", "signed", "x0", "y0", "aMinusP", "currPoint", "threshold", "dxc", "dyc", "dx1", "dy1", "cross", "ClosestLine", "p0", "q0", "w0", "denom", "sDenom", "tDenom", "tClosestParallel", "sClosest", "tClosest", "ClosestLineJumpTable", "polygonA", "polygonB", "otherWorldPos", "otherDirection", "thisDirection", "rayTowardsOther", "rayTowardsThis", "thisPoint", "otherPoint", "thisFace", "otherFace", "polygon", "edge", "edgeLine", "edgeStart", "edgeVector", "circlex", "circley", "circleA", "circleB", "circleWorlPos", "edgeA", "edgeB", "edgeLineA", "edgeStartA", "edgeVectorA", "edgeLineB", "edgeStartB", "edgeVectorB", "CircleCollider", "orig", "discriminant", "toi", "toi1", "toi2", "positiveToi", "mintoi", "shape", "PolygonCollider", "EdgeCollider", "CollisionJumpTable", "scalars", "dotProduct", "CollisionContact", "mtv", "tangent", "localPoints", "info", "SeparatingAxis", "polyA", "polyB", "bestSeparation", "bestSide", "bestAxis", "bestSideIndex", "bestOtherPoint", "sides", "localSides", "vertB", "vertSeparation", "polyDir", "closestPointOnPoly", "minOverlap", "minAxis", "minIndex", "proj1", "proj2", "overlap", "circleAPos", "circleBPos", "combinedRadius", "separation", "mvt", "local", "cc", "edgeWorld", "localSide", "da", "dda", "db", "ddb", "den", "pointOnEdge", "dd", "pc", "linePoly", "separationA", "separationB", "incident", "reference", "refDir", "clipRight", "clipLeft", "xf", "localPoint", "shapeA", "txA", "shapeB", "txB", "worldPoint", "circlePoint", "dist", "transformedBegin", "transformedEnd", "padding", "edgeNormal", "sum", "oldPoint", "newPoint", "oldDirection", "orientation", "angleSum", "polygons", "Shape", "getItem", "isPointInTriangle", "ab", "bc", "ca", "ap", "bp", "cp", "cross1", "cross2", "cross3", "triangles", "vertices", "indices", "va", "vb", "vc", "leftArm", "isEar", "vertIndex", "currentSide", "mostDirection", "testRay", "accum", "pts", "faceIndex", "denominator", "iplusone", "crossTerm", "minContactTime", "contactIndex", "contactTime", "scalar", "firstPoint", "logger", "ColliderComponent", "flipped", "entity", "precollision", "postcollision", "center", "poly", "DegreeOfFreedom", "newMass", "sleeping", "currentMotion", "bias", "maybeCollider", "scaleFactor", "impulse", "finalImpulse", "distanceFromCenter", "AddedComponent", "isAddedComponent", "RemovedComponent", "isRemovedComponent", "Entity", "components", "component", "force", "added", "removed", "queue", "curr", "newEntity", "templateEntity", "ctor", "constuctorType", "componentOrType", "hasGraphicsTick", "graphic", "GraphicsLayer", "_graphics", "nameOrGraphic", "gfx", "order", "GraphicsLayers", "_component", "graphicsLayerKeys", "GraphicsComponent", "visible", "graphics", "copyGraphics", "onPreDraw", "onPostDraw", "graphicToSet", "offsetX", "offsetY", "elapsed", "idempotencyToken", "Rectangle", "Circle", "PointerComponent", "EasingFunctions", "easing", "currentTime", "startValue", "endValue", "ActionQueue", "action", "Repeat", "repeatBuilder", "repeat", "ActionContext", "RepeatForever", "MoveBy", "speed", "MoveTo", "destx", "desty", "RotationType", "RotateTo", "rotationType", "distance1", "distance2", "distanceTraveled", "RotateBy", "angleRadiansOffset", "ScaleTo", "speedX", "speedY", "directionX", "directionY", "ScaleBy", "scaleOffsetX", "scaleOffsetY", "CallMethod", "EaseTo", "easingFcn", "EaseBy", "Blink", "timeVisible", "timeNotVisible", "numBlinks", "Fade", "endOpacity", "Delay", "Die", "ActionsComponent", "Follow", "entityToFollow", "followDistance", "actorToFollowSpeed", "Meet", "actorToMeet", "actorToMeetSpeed", "xOrPos", "yOrSpeed", "speedOrUndefined", "xOffsetOrVector", "yOffsetOrSpeed", "xOffset", "yOffset", "sizeXOrVector", "sizeYOrSpeed", "speedXOrUndefined", "speedYOrUndefined", "sizeX", "sizeY", "sizeOffsetXOrVector", "sizeOffsetYOrSpeed", "sizeOffsetX", "sizeOffsetY", "times", "FontUnit", "TextAlign", "BaseAlign", "FontStyle", "Direction", "Font", "_l", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "_y", "measurementDirty", "cached", "rasterProps", "metrics", "textHeight", "lineAdjustedHeight", "bottomBounds", "measurement", "textBounds", "colorOverride", "lineHeight", "textAndHash", "textImages", "currentX", "currentY", "canvas", "isNewBitmap", "frag", "Text", "font", "isActor", "Actor", "config", "pe", "coordPlane", "vel", "angularVelocity", "collisionType", "collisionGroup", "thePos", "theVel", "theAcc", "theAngle", "isDraggable", "currentGraphic", "_scene", "newZ", "globalPos", "recurse", "geom", "containment", "otherCollider", "me", "isScreenElement", "ScreenElement", "useWorld", "coords", "Timer", "fcn", "interval", "repeats", "numberOfRepeats", "randomRange", "newInterval", "newNumberOfRepeats", "ParallaxComponent", "parallaxFactor", "DebugGraphicsComponent", "draw", "useTransform", "TileMap", "currentCol", "cd", "Tile", "originalOffset", "tile", "prev", "worldCoordsUpperLeft", "worldCoordsLowerRight", "maybeParallax", "parallaxOffset", "oneMinusFactor", "xEnd", "yEnd", "graphicsIndex", "graphicsLen", "grayish", "StrategyContainer", "LockCameraToActorStrategy", "LockCameraToActorAxisStrategy", "cameraElasticity", "cameraFriction", "ElasticToActorStrategy", "RadiusAroundActorStrategy", "box", "LimitCameraBoundsStrategy", "Axis", "_cam", "_eng", "cam", "currentFocus", "focus", "cameraVel", "stretch", "friction", "focusX", "focusY", "Camera", "easingFn", "magnitudeX", "magnitudeY", "cameraStrategy", "currentRes", "res", "zoomEasing", "newZoom", "lerpPoint", "newCanvasWidth", "newCanvasHeight", "cameraPos", "triggerDefaults", "Trigger", "opts", "SystemType", "System", "_entityAddedOrRemoved", "AddedEntity", "isAddedSystemEntity", "RemovedEntity", "isRemoveSystemEntity", "EntityManager", "_world", "_context", "idOrEntity", "deferred", "buildTypeKey", "types", "Query", "T", "sort", "typesOrEntity", "matches", "QueryManager", "query", "queryType", "maybeExistingQuery", "SystemManager", "systemType", "system", "systems", "entities", "Scene", "World", "entityOrSystem", "EulerIntegrator", "motion", "totalAcc", "MotionSystem", "optionalBody", "ArcadeSolver", "aDist", "bDist", "opposite", "velAdj", "ContactConstraintPoint", "aToContactNormal", "bToContactNormal", "aToContactTangent", "bToContactTangent", "velA", "RealisticSolver", "finishedContactIds", "contactPoints", "pointIndex", "aToContact", "bToContact", "normalMass", "tangentMass", "restitution", "relativeVelocity", "normalImpulse", "tangentImpulse", "constraints", "steeringConstant", "maxCorrection", "slop", "steeringForce", "impulseForce", "impulseDelta", "maxFriction", "newImpulse", "normalVelocity", "CollisionSystem", "colliderComponent", "scene", "colliderComp", "compositeColliders", "compositeId", "AnimationDirection", "AnimationStrategy", "Animation", "maybeFrame", "frameIndices", "durationPerFrameMs", "strategy", "invalidIndices", "frameNumber", "currentFrame", "next", "elapsedMilliseconds", "GraphicsGroup", "member", "maybeAnimation", "Configurable", "base", "props", "EmitterType", "ParticleImpl", "emitterOrConfig", "life", "beginColor", "endColor", "velocity", "acceleration", "startSize", "endSize", "emitter", "ParticleEmitter", "tmpColor", "accel", "Particle", "isEmitting", "minVel", "maxVel", "minAngle", "maxAngle", "emitRate", "particleLife", "fadeFlag", "focusAccel", "minSize", "maxSize", "particleSprite", "emitterType", "particleRotationalVelocity", "randomRotation", "particle", "particleCount", "ranX", "ranY", "GraphicsSystem", "entityAddedOrRemoved", "_entities", "parallax", "particleOpacity", "graphicsComponent", "ancestors", "ancestor", "interpolatedPos", "interpolatedScale", "interpolatedRotation", "blend", "DebugSystem", "filterSettings", "entitySettings", "txSettings", "motionSettings", "colliderSettings", "physicsSettings", "graphicsSettings", "debugDraw", "bodySettings", "cameraSettings", "cursor", "PointerSystem", "pointerId", "pointers", "pointer", "graphicBounds", "lastDownPerPointer", "lastUpPerPointer", "lastMovePerPointer", "lastUpDownMoveEvents", "lastFrameEntities", "currentFrameEntities", "entitiesWithEvents", "ActionsSystem", "actions", "IsometricEntityComponent", "map", "IsometricEntitySystem", "iso", "OffscreenSystem", "entityOffscreen", "transformedBounds", "_ctx", "timer", "screenElements", "_ui", "ColorBlindnessMode", "color_blind_fragment", "ScreenShader", "ColorBlindnessPostProcessor", "_colorBlindnessMode", "simulate", "colorBlindMode", "ColorBlindFlags", "colorBlindness", "Debug", "FrameStats", "wasRunning", "testClock", "currentClock", "standardClock", "PhysicsStats", "otherStats", "fs", "ps", "PointerScope", "Keys", "KeyEvent", "originalEvent", "Keyboard", "keyEvent", "noop", "character", "Gamepads", "pad", "axesLength", "buttonLength", "gamepads", "bi", "ai", "Buttons", "Axes", "Gamepad", "pads", "arr", "clonedPad", "buttonIndex", "axesIndex", "BrowserComponent", "nativeComponent", "BrowserEvents", "_windowGlobal", "_documentGlobal", "GlobalCoordinates", "worldPos", "pagePos", "screenPos", "yOrEngine", "engineOrUndefined", "pageX", "pageY", "PointerEvent", "pointerType", "coordinates", "nativeEvent", "WheelEvent", "screenX", "screenY", "deltaZ", "deltaMode", "PointerAbstraction", "WheelDeltaMode", "NativePointerButton", "PointerButton", "PointerType", "isTouchEvent", "isPointerEvent", "PointerEventReceiver", "eventReceiver", "ids", "native", "normalized", "wheelOptions", "ScrollPreventionMode", "nativePointerId", "eventCoords", "touch", "coord", "world", "ScrollWheelNormalizationFactor", "we", "page", "pointerSystem", "transformEntities", "FpsSampler", "Clock", "TestClock", "StandardClock", "cb", "timeoutMs", "scheduledTime", "overrideUpdateMs", "now", "fpsInterval", "leftover", "mainloop", "numberOfSteps", "Toaster", "Util_Toaster", "toastMessage", "linkTarget", "linkName", "toast", "messageFragments", "link", "finalMessage", "dismissBtn", "keydownHandler", "first", "Engine", "detector", "testMessage", "EX_VERSION", "displayMode", "useCanvasGraphicsContext", "shouldSnapToPixel", "allow", "showPlayerMessage", "total", "average", "newCanvas", "pointerTarget", "previousScene", "nextScene", "hidden", "visibilityChange", "deferredScene", "toggle", "loader", "frameId", "beforeUpdate", "fixedTimestepMs", "afterUpdate", "afterDraw", "preserveHiDPIResolution", "finalWidth", "finalHeight", "screenshot", "raw", "Label", "spriteFont", "newFont", "sf", "IsometricTile", "graphicsOffset", "halfTileWidth", "halfTileHeight", "xPos", "yPos", "totalWidth", "totalHeight", "_elapsed", "IsometricMap", "tileWidth", "tileHeight", "renderFromTopOfGraphic", "worldCoordinate", "tileCoordinate", "tileCoord", "maxZ", "currentZ", "ActionSequence", "actionBuilder", "ParallelActions", "parallelActions", "CollisionGroupManager", "group", "has_initialize", "hasOnInitialize", "has_preupdate", "hasOnPreUpdate", "has_postupdate", "hasOnPostUpdate", "hasPreDraw", "hasPostDraw", "Gif", "Stream", "ParseGif", "images", "bitsToNum", "ba", "byteToBitArr", "bite", "dataArray", "bytes", "lzwDecode", "minCodeSize", "readCode", "output", "clearCode", "eoiCode", "codeSize", "dict", "clear", "last", "stream", "entries", "ct", "rgba", "hdr", "bits", "block", "parseGCExt", "parseComExt", "parsePTExt", "parseAppExt", "parseNetscapeExt", "parseUnknownAppExt", "parseUnknownExt", "img", "deinterlace", "pixels", "newPixels", "cpRow", "toRow", "fromRow", "fromPixels", "offsets", "steps", "pass", "lzwData", "frame", "pixSize", "Line", "Polygon", "AsyncWaitQueue", "Semaphore", "_count", "Turtle", "__webpack_exports__Actor", "size", "halfSize", "points", "__webpack_exports__vec", "__webpack_exports__Color", "__webpack_exports__PolygonCollider", "__webpack_exports__CollisionType", "shape", "__webpack_exports__Polygon", "engine", "deltaDegrees", "resolve", "_reject", "deltaRadians", "seconds", "force", "time", "delta", "Drawing", "__webpack_exports__Scene", "turtle", "evt", "pos", "color", "ctx", "_delta", "__webpack_exports__Color", "i", "item", "start", "end", "import_parzec", "import_parzec", "import_parzec", "Name", "value", "nameExp", "nameParser", "t", "Name", "import_parzec", "whitespaceExp", "whitespaceParser", "import_parzec", "newlineExp", "newlineParser", "import_parzec", "Enum", "value", "enumExp", "enumParser", "t", "Enum", "import_parzec", "Num", "value", "numberExp", "numberParser", "t", "Num", "eofToken", "lnLexer", "whitespaceExp", "newlineExp", "nameExp", "numberExp", "enumExp", "Instruction", "name", "args", "Program", "commands", "instruction", "nameParser", "whitespaceParser", "c", "enumParser", "numberParser", "a", "Instruction", "root", "newlineParser", "i", "Program", "parseProgram", "program", "tokens", "lnLexer", "eofToken", "ast", "Scope", "__webpack_exports__Color", "key", "Interpreter", "turtle", "drawing", "Scope", "program", "programTree", "parseProgram", "instruction", "colorArg", "color", "delta", "seconds", "resolve", "_reject", "forceArg", "durationArg", "force", "duration", "directionArg", "direction", "Game", "__webpack_exports__Engine", "code", "Turtle", "Drawing", "Interpreter", "game", "Game", "codeArea", "e", "runButton"]
}
